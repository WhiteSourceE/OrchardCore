Ó:
~D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\AdminMenu.cs
	namespace 	
OrchardCore
 
. 
Media 
{ 
public 

class 
	AdminMenu 
: 
INavigationProvider 0
{		 
private

 
readonly

 
IStringLocalizer

 )
S

* +
;

+ ,
public 
	AdminMenu 
( 
IStringLocalizer )
<) *
	AdminMenu* 3
>3 4
	localizer5 >
)> ?
{ 	
S 
= 
	localizer 
; 
} 	
public 
Task  
BuildNavigationAsync (
(( )
string) /
name0 4
,4 5
NavigationBuilder6 G
builderH O
)O P
{ 	
if 
( 
! 
String 
. 
Equals 
( 
name #
,# $
$str% ,
,, -
StringComparison. >
.> ?
OrdinalIgnoreCase? P
)P Q
)Q R
{ 
return 
Task 
. 
CompletedTask )
;) *
} 
builder 
. 
Add 
( 
S 
[ 
$str  
]  !
,! "
content# *
=>+ -
content. 5
. 
AddClass 
( 
$str %
)% &
.& '
Id' )
() *
$str* 1
)1 2
. 
Add 
( 
S 
[ 
$str *
]* +
,+ ,
S- .
[. /
$str/ >
]> ?
.? @
PrefixPosition@ N
(N O
)O P
,P Q
mediaR W
=>X Z
media[ `
. 

Permission #
(# $
Permissions$ /
./ 0
ManageMedia0 ;
); <
. 
Action 
(  
$str  '
,' (
$str) 0
,0 1
new2 5
{6 7
area8 <
== >
$str? R
}S T
)T U
. 
LocalNav !
(! "
)" #
) 
) 
; 
builder!! 
.!! 
Add!! 
(!! 
S!! 
[!! 
$str!! )
]!!) *
,!!* +
configuration!!, 9
=>!!: <
configuration!!= J
."" 
Add"" 
("" 
S"" 
["" 
$str"" 
]"" 
,""  
S""! "
[""" #
$str""# *
]""* +
.""+ ,
PrefixPosition"", :
("": ;
)""; <
,""< =
media""> C
=>""D F
media""G L
.## 
Add## 
(## 
S## 
[## 
$str## *
]##* +
,##+ ,
S##- .
[##. /
$str##/ >
]##> ?
.##? @
PrefixPosition##@ N
(##N O
)##O P
,##P Q
options##R Y
=>##Z \
options##] d
.$$ 
Action$$ 
($$  
$str$$  )
,$$) *
$str$$+ 2
,$$2 3
new$$4 7
{$$8 9
area$$: >
=$$? @
$str$$A T
}$$U V
)$$V W
.%% 

Permission%% #
(%%# $
Permissions%%$ /
.%%/ 0
ManageMedia%%0 ;
)%%; <
.&& 
LocalNav&& !
(&&! "
)&&" #
)&&# $
.'' 
Add'' 
('' 
S'' 
['' 
$str'' +
]''+ ,
,'', -
S''. /
[''/ 0
$str''0 @
]''@ A
.''A B
PrefixPosition''B P
(''P Q
)''Q R
,''R S
mediaProfiles''T a
=>''b d
mediaProfiles''e r
.(( 
Action(( 
(((  
$str((  '
,((' (
$str(() 8
,((8 9
new((: =
{((> ?
area((@ D
=((E F
$str((G Z
}(([ \
)((\ ]
.)) 

Permission)) #
())# $
Permissions))$ /
.))/ 0
ManageMediaProfiles))0 C
)))C D
.** 
LocalNav** !
(**! "
)**" #
)**# $
)++ 
)++ 
;++ 
return-- 
Task-- 
.-- 
CompletedTask-- %
;--% &
}.. 	
}// 
public11 

class11 
MediaCacheAdminMenu11 $
:11% &
INavigationProvider11' :
{22 
private33 
readonly33 
IStringLocalizer33 )
S33* +
;33+ ,
public55 
MediaCacheAdminMenu55 "
(55" #
IStringLocalizer55# 3
<553 4
	AdminMenu554 =
>55= >
	localizer55? H
)55H I
{66 	
S77 
=77 
	localizer77 
;77 
}88 	
public:: 
Task::  
BuildNavigationAsync:: (
(::( )
string::) /
name::0 4
,::4 5
NavigationBuilder::6 G
builder::H O
)::O P
{;; 	
if<< 
(<< 
!<< 
String<< 
.<< 
Equals<< 
(<< 
name<< #
,<<# $
$str<<% ,
,<<, -
StringComparison<<. >
.<<> ?
OrdinalIgnoreCase<<? P
)<<P Q
)<<Q R
{== 
return>> 
Task>> 
.>> 
CompletedTask>> )
;>>) *
}?? 
builderAA 
.AA 
AddAA 
(AA 
SAA 
[AA 
$strAA )
]AA) *
,AA* +
configurationAA, 9
=>AA: <
configurationAA= J
.BB 
AddBB 
(BB 
SBB 
[BB 
$strBB 
]BB 
,BB  
SBB! "
[BB" #
$strBB# *
]BB* +
.BB+ ,
PrefixPositionBB, :
(BB: ;
)BB; <
,BB< =
mediaBB> C
=>BBD F
mediaBBG L
.CC 
AddCC 
(CC 
SCC 
[CC 
$strCC (
]CC( )
,CC) *
SCC+ ,
[CC, -
$strCC- :
]CC: ;
.CC; <
PrefixPositionCC< J
(CCJ K
)CCK L
,CCL M
cacheCCN S
=>CCT V
cacheCCW \
.DD 
ActionDD 
(DD  
$strDD  '
,DD' (
$strDD) 5
,DD5 6
newDD7 :
{DD; <
areaDD= A
=DDB C
$strDDD W
}DDX Y
)DDY Z
.EE 

PermissionEE #
(EE# $!
MediaCachePermissionsEE$ 9
.EE9 :
ManageAssetCacheEE: J
)EEJ K
.FF 
LocalNavFF !
(FF! "
)FF" #
)FF# $
)GG 
)GG 
;GG 
returnII 
TaskII 
.II 
CompletedTaskII %
;II% &
}JJ 	
}KK 
}LL ¶¾
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Controllers\AdminController.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Controllers '
{ 
public 

class 
AdminController  
:! "

Controller# -
{ 
private 
static 
readonly 
char  $
[$ %
]% &(
_invalidFolderNameCharacters' C
=D E
newF I
charJ N
[N O
]O P
{Q R
$charS W
,W X
$charY \
}] ^
;^ _
private 
readonly 
HashSet  
<  !
string! '
>' ("
_allowedFileExtensions) ?
;? @
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly '
IMediaNameNormalizerService 4'
_mediaNameNormalizerService5 P
;P Q
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly  
IContentTypeProvider - 
_contentTypeProvider. B
;B C
private 
readonly 
ILogger  
_logger! (
;( )
private 
readonly 
IStringLocalizer )
S* +
;+ ,
private 
readonly 
MediaOptions %
_mediaOptions& 3
;3 4
public   
AdminController   
(   
IMediaFileStore!! 
mediaFileStore!! *
,!!* +'
IMediaNameNormalizerService"" '&
mediaNameNormalizerService""( B
,""B C!
IAuthorizationService## ! 
authorizationService##" 6
,##6 7 
IContentTypeProvider$$  
contentTypeProvider$$! 4
,$$4 5
IOptions%% 
<%% 
MediaOptions%% !
>%%! "
options%%# *
,%%* +
ILogger&& 
<&& 
AdminController&& #
>&&# $
logger&&% +
,&&+ ,
IStringLocalizer'' 
<'' 
AdminController'' ,
>'', -
stringLocalizer''. =
)(( 
{)) 	
_mediaFileStore** 
=** 
mediaFileStore** ,
;**, -'
_mediaNameNormalizerService++ '
=++( )&
mediaNameNormalizerService++* D
;++D E!
_authorizationService,, !
=,," # 
authorizationService,,$ 8
;,,8 9 
_contentTypeProvider--  
=--! "
contentTypeProvider--# 6
;--6 7
_mediaOptions.. 
=.. 
options.. #
...# $
Value..$ )
;..) *"
_allowedFileExtensions// "
=//# $
_mediaOptions//% 2
.//2 3!
AllowedFileExtensions//3 H
;//H I
_logger00 
=00 
logger00 
;00 
S11 
=11 
stringLocalizer11 
;11  
}22 	
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
Index44) .
(44. /
)44/ 0
{55 	
if66 
(66 
!66 
await66 !
_authorizationService66 ,
.66, -
AuthorizeAsync66- ;
(66; <
User66< @
,66@ A
Permissions66B M
.66M N
ManageMedia66N Y
)66Y Z
)66Z [
{77 
return88 
Forbid88 
(88 
)88 
;88  
}99 
return;; 
View;; 
(;; 
);; 
;;; 
}<< 	
public>> 
async>> 
Task>> 
<>> 
ActionResult>> &
<>>& '
IAsyncEnumerable>>' 7
<>>7 8
IFileStoreEntry>>8 G
>>>G H
>>>H I
>>>I J

GetFolders>>K U
(>>U V
string>>V \
path>>] a
)>>a b
{?? 	
if@@ 
(@@ 
!@@ 
await@@ !
_authorizationService@@ ,
.@@, -
AuthorizeAsync@@- ;
(@@; <
User@@< @
,@@@ A
Permissions@@B M
.@@M N
ManageMedia@@N Y
)@@Y Z
)@@Z [
{AA 
returnBB 
ForbidBB 
(BB 
)BB 
;BB  
}CC 
ifEE 
(EE 
stringEE 
.EE 
IsNullOrEmptyEE $
(EE$ %
pathEE% )
)EE) *
)EE* +
{FF 
pathGG 
=GG 
$strGG 
;GG 
}HH 
ifJJ 
(JJ 
awaitJJ 
_mediaFileStoreJJ %
.JJ% &!
GetDirectoryInfoAsyncJJ& ;
(JJ; <
pathJJ< @
)JJ@ A
==JJB D
nullJJE I
)JJI J
{KK 
returnLL 
NotFoundLL 
(LL  
)LL  !
;LL! "
}MM 
varOO 
allowedOO 
=OO 
_mediaFileStoreOO )
.OO) *$
GetDirectoryContentAsyncOO* B
(OOB C
pathOOC G
)OOG H
.PP 

WhereAwaitPP 
(PP 
asyncPP !
ePP" #
=>PP$ &
ePP' (
.PP( )
IsDirectoryPP) 4
&&PP5 7
awaitPP8 =!
_authorizationServicePP> S
.PPS T
AuthorizeAsyncPPT b
(PPb c
UserPPc g
,PPg h
PermissionsPPi t
.PPt u,
ManageAttachedMediaFieldsFolder	PPu ”
,
PP” •
(
PP– —
object
PP— 
)
PP 
e
PP Ÿ
.
PPŸ  
Path
PP  ¤
)
PP¤ ¥
)
PP¥ ¦
;
PP¦ §
returnRR 
OkRR 
(RR 
allowedRR 
)RR 
;RR 
}SS 	
publicUU 
asyncUU 
TaskUU 
<UU 
ActionResultUU &
<UU& '
IAsyncEnumerableUU' 7
<UU7 8
objectUU8 >
>UU> ?
>UU? @
>UU@ A
GetMediaItemsUUB O
(UUO P
stringUUP V
pathUUW [
)UU[ \
{VV 	
ifWW 
(WW 
stringWW 
.WW 
IsNullOrEmptyWW $
(WW$ %
pathWW% )
)WW) *
)WW* +
{XX 
pathYY 
=YY 
$strYY 
;YY 
}ZZ 
if\\ 
(\\ 
!\\ 
await\\ !
_authorizationService\\ ,
.\\, -
AuthorizeAsync\\- ;
(\\; <
User\\< @
,\\@ A
Permissions\\B M
.\\M N
ManageMedia\\N Y
)\\Y Z
||]] 
!]] 
await]] !
_authorizationService]] /
.]]/ 0
AuthorizeAsync]]0 >
(]]> ?
User]]? C
,]]C D
Permissions]]E P
.]]P Q+
ManageAttachedMediaFieldsFolder]]Q p
,]]p q
(]]r s
object]]s y
)]]y z
path]]z ~
)]]~ 
)	]] €
{^^ 
return__ 
Forbid__ 
(__ 
)__ 
;__  
}`` 
ifbb 
(bb 
awaitbb 
_mediaFileStorebb %
.bb% &!
GetDirectoryInfoAsyncbb& ;
(bb; <
pathbb< @
)bb@ A
==bbB D
nullbbE I
)bbI J
{cc 
returndd 
NotFounddd 
(dd  
)dd  !
;dd! "
}ee 
vargg 
allowedgg 
=gg 
_mediaFileStoregg )
.gg) *$
GetDirectoryContentAsyncgg* B
(ggB C
pathggC G
)ggG H
.hh 

WhereAwaithh 
(hh 
asynchh !
ehh" #
=>hh$ &
!hh' (
ehh( )
.hh) *
IsDirectoryhh* 5
&&hh6 8
awaithh9 >!
_authorizationServicehh? T
.hhT U
AuthorizeAsynchhU c
(hhc d
Userhhd h
,hhh i
Permissionshhj u
.hhu v,
ManageAttachedMediaFieldsFolder	hhv •
,
hh• –
(
hh— ˜
object
hh˜ 
)
hh Ÿ
e
hhŸ  
.
hh  ¡
Path
hh¡ ¥
)
hh¥ ¦
)
hh¦ §
.ii 
Selectii 
(ii 
eii 
=>ii 
CreateFileResultii -
(ii- .
eii. /
)ii/ 0
)ii0 1
;ii1 2
returnkk 
Okkk 
(kk 
allowedkk 
)kk 
;kk 
}ll 	
publicnn 
asyncnn 
Tasknn 
<nn 
ActionResultnn &
<nn& '
objectnn' -
>nn- .
>nn. /
GetMediaItemnn0 <
(nn< =
stringnn= C
pathnnD H
)nnH I
{oo 	
ifpp 
(pp 
!pp 
awaitpp !
_authorizationServicepp ,
.pp, -
AuthorizeAsyncpp- ;
(pp; <
Userpp< @
,pp@ A
PermissionsppB M
.ppM N
ManageMediappN Y
)ppY Z
)ppZ [
{qq 
returnrr 
Forbidrr 
(rr 
)rr 
;rr  
}ss 
ifuu 
(uu 
stringuu 
.uu 
IsNullOrEmptyuu $
(uu$ %
pathuu% )
)uu) *
)uu* +
{vv 
returnww 
NotFoundww 
(ww  
)ww  !
;ww! "
}xx 
varzz 
fzz 
=zz 
awaitzz 
_mediaFileStorezz )
.zz) *
GetFileInfoAsynczz* :
(zz: ;
pathzz; ?
)zz? @
;zz@ A
if|| 
(|| 
f|| 
==|| 
null|| 
)|| 
{}} 
return~~ 
NotFound~~ 
(~~  
)~~  !
;~~! "
} 
return
 
CreateFileResult
 #
(
# $
f
$ %
)
% &
;
& '
}
‚‚ 	
[
„„ 	
HttpPost
„„	 
]
„„ 
[
…… 	
MediaSizeLimit
……	 
]
…… 
public
†† 
async
†† 
Task
†† 
<
†† 
ActionResult
†† &
<
††& '
object
††' -
>
††- .
>
††. /
Upload
††0 6
(
††6 7
string
‡‡ 
path
‡‡ 
,
‡‡ 
string
ˆˆ 
contentType
ˆˆ 
,
ˆˆ 
ICollection
‰‰ 
<
‰‰ 
	IFormFile
‰‰ !
>
‰‰! "
files
‰‰# (
)
‰‰( )
{
ŠŠ 	
if
‹‹ 
(
‹‹ 
!
‹‹ 
await
‹‹ #
_authorizationService
‹‹ ,
.
‹‹, -
AuthorizeAsync
‹‹- ;
(
‹‹; <
User
‹‹< @
,
‹‹@ A
Permissions
‹‹B M
.
‹‹M N
ManageMedia
‹‹N Y
)
‹‹Y Z
)
‹‹Z [
{
ŒŒ 
return
 
Forbid
 
(
 
)
 
;
  
}
 
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
path
% )
)
) *
)
* +
{
‘‘ 
path
’’ 
=
’’ 
$str
’’ 
;
’’ 
}
““ 
var
•• 
result
•• 
=
•• 
new
•• 
List
•• !
<
••! "
object
••" (
>
••( )
(
••) *
)
••* +
;
••+ ,
foreach
˜˜ 
(
˜˜ 
var
˜˜ 
file
˜˜ 
in
˜˜  
files
˜˜! &
)
˜˜& '
{
™™ 
if
œœ 
(
œœ 
!
œœ $
_allowedFileExtensions
œœ +
.
œœ+ ,
Contains
œœ, 4
(
œœ4 5
Path
œœ5 9
.
œœ9 :
GetExtension
œœ: F
(
œœF G
file
œœG K
.
œœK L
FileName
œœL T
)
œœT U
,
œœU V
StringComparer
œœW e
.
œœe f
OrdinalIgnoreCase
œœf w
)
œœw x
)
œœx y
{
 
result
 
.
 
Add
 
(
 
new
 "
{
ŸŸ 
name
   
=
   
file
   #
.
  # $
FileName
  $ ,
,
  , -
size
¡¡ 
=
¡¡ 
file
¡¡ #
.
¡¡# $
Length
¡¡$ *
,
¡¡* +
folder
¢¢ 
=
¢¢  
path
¢¢! %
,
¢¢% &
error
££ 
=
££ 
S
££  !
[
££! "
$str
££" K
,
££K L
Path
££M Q
.
££Q R
GetExtension
££R ^
(
££^ _
file
££_ c
.
££c d
FileName
££d l
)
££l m
]
££m n
.
££n o
ToString
££o w
(
££w x
)
££x y
}
¤¤ 
)
¤¤ 
;
¤¤ 
_logger
¦¦ 
.
¦¦ 
LogInformation
¦¦ *
(
¦¦* +
$str
¦¦+ N
,
¦¦N O
file
¦¦P T
.
¦¦T U
FileName
¦¦U ]
)
¦¦] ^
;
¦¦^ _
continue
¨¨ 
;
¨¨ 
}
©© 
var
«« 
fileName
«« 
=
«« )
_mediaNameNormalizerService
«« :
.
««: ;
NormalizeFileName
««; L
(
««L M
file
««M Q
.
««Q R
FileName
««R Z
)
««Z [
;
««[ \
Stream
­­ 
stream
­­ 
=
­­ 
null
­­  $
;
­­$ %
try
®® 
{
¯¯ 
var
°° 
mediaFilePath
°° %
=
°°& '
_mediaFileStore
°°( 7
.
°°7 8
Combine
°°8 ?
(
°°? @
path
°°@ D
,
°°D E
fileName
°°F N
)
°°N O
;
°°O P
stream
±± 
=
±± 
file
±± !
.
±±! "
OpenReadStream
±±" 0
(
±±0 1
)
±±1 2
;
±±2 3
mediaFilePath
²² !
=
²²" #
await
²²$ )
_mediaFileStore
²²* 9
.
²²9 :'
CreateFileFromStreamAsync
²²: S
(
²²S T
mediaFilePath
²²T a
,
²²a b
stream
²²c i
)
²²i j
;
²²j k
var
´´ 
	mediaFile
´´ !
=
´´" #
await
´´$ )
_mediaFileStore
´´* 9
.
´´9 :
GetFileInfoAsync
´´: J
(
´´J K
mediaFilePath
´´K X
)
´´X Y
;
´´Y Z
result
¶¶ 
.
¶¶ 
Add
¶¶ 
(
¶¶ 
CreateFileResult
¶¶ /
(
¶¶/ 0
	mediaFile
¶¶0 9
)
¶¶9 :
)
¶¶: ;
;
¶¶; <
}
·· 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸  
ex
¸¸! #
)
¸¸# $
{
¹¹ 
_logger
ºº 
.
ºº 
LogError
ºº $
(
ºº$ %
ex
ºº% '
,
ºº' (
$str
ºº) T
)
ººT U
;
ººU V
result
¼¼ 
.
¼¼ 
Add
¼¼ 
(
¼¼ 
new
¼¼ "
{
½½ 
name
¾¾ 
=
¾¾ 
fileName
¾¾ '
,
¾¾' (
size
¿¿ 
=
¿¿ 
file
¿¿ #
.
¿¿# $
Length
¿¿$ *
,
¿¿* +
folder
ÀÀ 
=
ÀÀ  
path
ÀÀ! %
,
ÀÀ% &
error
ÁÁ 
=
ÁÁ 
ex
ÁÁ  "
.
ÁÁ" #
Message
ÁÁ# *
}
ÂÂ 
)
ÂÂ 
;
ÂÂ 
}
ÃÃ 
finally
ÄÄ 
{
ÅÅ 
stream
ÆÆ 
?
ÆÆ 
.
ÆÆ 
Dispose
ÆÆ #
(
ÆÆ# $
)
ÆÆ$ %
;
ÆÆ% &
}
ÇÇ 
}
ÈÈ 
return
ÊÊ 
new
ÊÊ 
{
ÊÊ 
files
ÊÊ 
=
ÊÊ  
result
ÊÊ! '
.
ÊÊ' (
ToArray
ÊÊ( /
(
ÊÊ/ 0
)
ÊÊ0 1
}
ÊÊ2 3
;
ÊÊ3 4
}
ËË 	
[
ÍÍ 	
HttpPost
ÍÍ	 
]
ÍÍ 
public
ÎÎ 
async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
IActionResult
ÎÎ '
>
ÎÎ' (
DeleteFolder
ÎÎ) 5
(
ÎÎ5 6
string
ÎÎ6 <
path
ÎÎ= A
)
ÎÎA B
{
ÏÏ 	
if
ĞĞ 
(
ĞĞ 
!
ĞĞ 
await
ĞĞ #
_authorizationService
ĞĞ ,
.
ĞĞ, -
AuthorizeAsync
ĞĞ- ;
(
ĞĞ; <
User
ĞĞ< @
,
ĞĞ@ A
Permissions
ĞĞB M
.
ĞĞM N
ManageMedia
ĞĞN Y
)
ĞĞY Z
||
ÑÑ 
!
ÑÑ 
await
ÑÑ #
_authorizationService
ÑÑ /
.
ÑÑ/ 0
AuthorizeAsync
ÑÑ0 >
(
ÑÑ> ?
User
ÑÑ? C
,
ÑÑC D
Permissions
ÑÑE P
.
ÑÑP Q-
ManageAttachedMediaFieldsFolder
ÑÑQ p
,
ÑÑp q
(
ÑÑr s
object
ÑÑs y
)
ÑÑy z
path
ÑÑz ~
)
ÑÑ~ 
)ÑÑ €
{
ÒÒ 
return
ÓÓ 
Forbid
ÓÓ 
(
ÓÓ 
)
ÓÓ 
;
ÓÓ  
}
ÔÔ 
if
ÖÖ 
(
ÖÖ 
string
ÖÖ 
.
ÖÖ 
IsNullOrEmpty
ÖÖ $
(
ÖÖ$ %
path
ÖÖ% )
)
ÖÖ) *
)
ÖÖ* +
{
×× 
return
ØØ 

StatusCode
ØØ !
(
ØØ! "
StatusCodes
ØØ" -
.
ØØ- . 
Status403Forbidden
ØØ. @
,
ØØ@ A
S
ØØB C
[
ØØC D
$str
ØØD e
]
ØØe f
)
ØØf g
;
ØØg h
}
ÙÙ 
var
ÛÛ 
mediaFolder
ÛÛ 
=
ÛÛ 
await
ÛÛ #
_mediaFileStore
ÛÛ$ 3
.
ÛÛ3 4#
GetDirectoryInfoAsync
ÛÛ4 I
(
ÛÛI J
path
ÛÛJ N
)
ÛÛN O
;
ÛÛO P
if
ÜÜ 
(
ÜÜ 
mediaFolder
ÜÜ 
!=
ÜÜ 
null
ÜÜ #
&&
ÜÜ$ &
!
ÜÜ' (
mediaFolder
ÜÜ( 3
.
ÜÜ3 4
IsDirectory
ÜÜ4 ?
)
ÜÜ? @
{
İİ 
return
ŞŞ 

StatusCode
ŞŞ !
(
ŞŞ! "
StatusCodes
ŞŞ" -
.
ŞŞ- . 
Status403Forbidden
ŞŞ. @
,
ŞŞ@ A
S
ŞŞB C
[
ŞŞC D
$str
ŞŞD v
]
ŞŞv w
)
ŞŞw x
;
ŞŞx y
}
ßß 
if
áá 
(
áá 
await
áá 
_mediaFileStore
áá %
.
áá% &%
TryDeleteDirectoryAsync
áá& =
(
áá= >
path
áá> B
)
ááB C
==
ááD F
false
ááG L
)
ááL M
{
ââ 
return
ãã 
NotFound
ãã 
(
ãã  
)
ãã  !
;
ãã! "
}
ää 
return
ææ 
Ok
ææ 
(
ææ 
)
ææ 
;
ææ 
}
çç 	
[
éé 	
HttpPost
éé	 
]
éé 
public
êê 
async
êê 
Task
êê 
<
êê 
IActionResult
êê '
>
êê' (
DeleteMedia
êê) 4
(
êê4 5
string
êê5 ;
path
êê< @
)
êê@ A
{
ëë 	
if
ìì 
(
ìì 
!
ìì 
await
ìì #
_authorizationService
ìì ,
.
ìì, -
AuthorizeAsync
ìì- ;
(
ìì; <
User
ìì< @
,
ìì@ A
Permissions
ììB M
.
ììM N
ManageMedia
ììN Y
)
ììY Z
||
íí 
!
íí 
await
íí #
_authorizationService
íí /
.
íí/ 0
AuthorizeAsync
íí0 >
(
íí> ?
User
íí? C
,
ííC D
Permissions
ííE P
.
ííP Q-
ManageAttachedMediaFieldsFolder
ííQ p
,
ííp q
(
íír s
object
íís y
)
ííy z
path
ííz ~
)
íí~ 
)íí €
{
îî 
return
ïï 
Forbid
ïï 
(
ïï 
)
ïï 
;
ïï  
}
ğğ 
if
òò 
(
òò 
string
òò 
.
òò 
IsNullOrEmpty
òò $
(
òò$ %
path
òò% )
)
òò) *
)
òò* +
{
óó 
return
ôô 
NotFound
ôô 
(
ôô  
)
ôô  !
;
ôô! "
}
õõ 
if
÷÷ 
(
÷÷ 
await
÷÷ 
_mediaFileStore
÷÷ %
.
÷÷% & 
TryDeleteFileAsync
÷÷& 8
(
÷÷8 9
path
÷÷9 =
)
÷÷= >
==
÷÷? A
false
÷÷B G
)
÷÷G H
return
øø 
NotFound
øø 
(
øø  
)
øø  !
;
øø! "
return
úú 
Ok
úú 
(
úú 
)
úú 
;
úú 
}
ûû 	
[
ıı 	
HttpPost
ıı	 
]
ıı 
public
şş 
async
şş 
Task
şş 
<
şş 
IActionResult
şş '
>
şş' (
	MoveMedia
şş) 2
(
şş2 3
string
şş3 9
oldPath
şş: A
,
şşA B
string
şşC I
newPath
şşJ Q
)
şşQ R
{
ÿÿ 	
if
€€ 
(
€€ 
!
€€ 
await
€€ #
_authorizationService
€€ ,
.
€€, -
AuthorizeAsync
€€- ;
(
€€; <
User
€€< @
,
€€@ A
Permissions
€€B M
.
€€M N
ManageMedia
€€N Y
)
€€Y Z
||
 
!
 
await
 #
_authorizationService
 /
.
/ 0
AuthorizeAsync
0 >
(
> ?
User
? C
,
C D
Permissions
E P
.
P Q-
ManageAttachedMediaFieldsFolder
Q p
,
p q
(
r s
object
s y
)
y z
oldPathz 
) ‚
)‚ ƒ
{
‚‚ 
return
ƒƒ 
Forbid
ƒƒ 
(
ƒƒ 
)
ƒƒ 
;
ƒƒ  
}
„„ 
if
†† 
(
†† 
string
†† 
.
†† 
IsNullOrEmpty
†† $
(
††$ %
oldPath
††% ,
)
††, -
||
††. 0
string
††1 7
.
††7 8
IsNullOrEmpty
††8 E
(
††E F
newPath
††F M
)
††M N
)
††N O
{
‡‡ 
return
ˆˆ 
NotFound
ˆˆ 
(
ˆˆ  
)
ˆˆ  !
;
ˆˆ! "
}
‰‰ 
if
‹‹ 
(
‹‹ 
await
‹‹ 
_mediaFileStore
‹‹ %
.
‹‹% &
GetFileInfoAsync
‹‹& 6
(
‹‹6 7
oldPath
‹‹7 >
)
‹‹> ?
==
‹‹@ B
null
‹‹C G
)
‹‹G H
{
ŒŒ 
return
 
NotFound
 
(
  
)
  !
;
! "
}
 
if
 
(
 
!
 $
_allowedFileExtensions
 '
.
' (
Contains
( 0
(
0 1
Path
1 5
.
5 6
GetExtension
6 B
(
B C
newPath
C J
)
J K
,
K L
StringComparer
M [
.
[ \
OrdinalIgnoreCase
\ m
)
m n
)
n o
{
‘‘ 
return
’’ 

StatusCode
’’ !
(
’’! "
StatusCodes
’’" -
.
’’- .!
Status400BadRequest
’’. A
,
’’A B
S
’’C D
[
’’D E
$str
’’E n
,
’’n o
Path
’’p t
.
’’t u
GetExtension’’u 
(’’ ‚
newPath’’‚ ‰
)’’‰ Š
]’’Š ‹
)’’‹ Œ
;’’Œ 
}
““ 
if
•• 
(
•• 
await
•• 
_mediaFileStore
•• %
.
••% &
GetFileInfoAsync
••& 6
(
••6 7
newPath
••7 >
)
••> ?
!=
••@ B
null
••C G
)
••G H
{
–– 
return
—— 

StatusCode
—— !
(
——! "
StatusCodes
——" -
.
——- .!
Status400BadRequest
——. A
,
——A B
S
——C D
[
——D E
$str——E ‰
]——‰ Š
)——Š ‹
;——‹ Œ
}
˜˜ 
await
šš 
_mediaFileStore
šš !
.
šš! "
MoveFileAsync
šš" /
(
šš/ 0
oldPath
šš0 7
,
šš7 8
newPath
šš9 @
)
šš@ A
;
ššA B
return
œœ 
Ok
œœ 
(
œœ 
)
œœ 
;
œœ 
}
 	
[
ŸŸ 	
HttpPost
ŸŸ	 
]
ŸŸ 
public
   
async
   
Task
   
<
   
IActionResult
   '
>
  ' (
DeleteMediaList
  ) 8
(
  8 9
string
  9 ?
[
  ? @
]
  @ A
paths
  B G
)
  G H
{
¡¡ 	
if
¢¢ 
(
¢¢ 
!
¢¢ 
await
¢¢ #
_authorizationService
¢¢ ,
.
¢¢, -
AuthorizeAsync
¢¢- ;
(
¢¢; <
User
¢¢< @
,
¢¢@ A
Permissions
¢¢B M
.
¢¢M N
ManageMedia
¢¢N Y
)
¢¢Y Z
)
¢¢Z [
{
££ 
return
¤¤ 
Forbid
¤¤ 
(
¤¤ 
)
¤¤ 
;
¤¤  
}
¥¥ 
foreach
§§ 
(
§§ 
var
§§ 
path
§§ 
in
§§  
paths
§§! &
)
§§& '
{
¨¨ 
if
©© 
(
©© 
!
©© 
await
©© #
_authorizationService
©© 0
.
©©0 1
AuthorizeAsync
©©1 ?
(
©©? @
User
©©@ D
,
©©D E
Permissions
©©F Q
.
©©Q R-
ManageAttachedMediaFieldsFolder
©©R q
,
©©q r
(
©©s t
object
©©t z
)
©©z {
path
©©{ 
)©© €
)©©€ 
{
ªª 
return
«« 
Forbid
«« !
(
««! "
)
««" #
;
««# $
}
¬¬ 
}
­­ 
if
¯¯ 
(
¯¯ 
paths
¯¯ 
==
¯¯ 
null
¯¯ 
)
¯¯ 
{
°° 
return
±± 
NotFound
±± 
(
±±  
)
±±  !
;
±±! "
}
²² 
foreach
´´ 
(
´´ 
var
´´ 
p
´´ 
in
´´ 
paths
´´ #
)
´´# $
{
µµ 
if
¶¶ 
(
¶¶ 
await
¶¶ 
_mediaFileStore
¶¶ )
.
¶¶) * 
TryDeleteFileAsync
¶¶* <
(
¶¶< =
p
¶¶= >
)
¶¶> ?
==
¶¶@ B
false
¶¶C H
)
¶¶H I
return
·· 
NotFound
·· #
(
··# $
)
··$ %
;
··% &
}
¸¸ 
return
ºº 
Ok
ºº 
(
ºº 
)
ºº 
;
ºº 
}
»» 	
[
½½ 	
HttpPost
½½	 
]
½½ 
public
¾¾ 
async
¾¾ 
Task
¾¾ 
<
¾¾ 
IActionResult
¾¾ '
>
¾¾' (
MoveMediaList
¾¾) 6
(
¾¾6 7
string
¾¾7 =
[
¾¾= >
]
¾¾> ?

mediaNames
¾¾@ J
,
¾¾J K
string
¾¾L R
sourceFolder
¾¾S _
,
¾¾_ `
string
¾¾a g
targetFolder
¾¾h t
)
¾¾t u
{
¿¿ 	
if
ÀÀ 
(
ÀÀ 
!
ÀÀ 
await
ÀÀ #
_authorizationService
ÀÀ ,
.
ÀÀ, -
AuthorizeAsync
ÀÀ- ;
(
ÀÀ; <
User
ÀÀ< @
,
ÀÀ@ A
Permissions
ÀÀB M
.
ÀÀM N
ManageMedia
ÀÀN Y
)
ÀÀY Z
||
ÁÁ 
!
ÁÁ 
await
ÁÁ #
_authorizationService
ÁÁ /
.
ÁÁ/ 0
AuthorizeAsync
ÁÁ0 >
(
ÁÁ> ?
User
ÁÁ? C
,
ÁÁC D
Permissions
ÁÁE P
.
ÁÁP Q-
ManageAttachedMediaFieldsFolder
ÁÁQ p
,
ÁÁp q
(
ÁÁr s
object
ÁÁs y
)
ÁÁy z
sourceFolderÁÁz †
)ÁÁ† ‡
||
ÂÂ 
!
ÂÂ 
await
ÂÂ #
_authorizationService
ÂÂ /
.
ÂÂ/ 0
AuthorizeAsync
ÂÂ0 >
(
ÂÂ> ?
User
ÂÂ? C
,
ÂÂC D
Permissions
ÂÂE P
.
ÂÂP Q-
ManageAttachedMediaFieldsFolder
ÂÂQ p
,
ÂÂp q
(
ÂÂr s
object
ÂÂs y
)
ÂÂy z
targetFolderÂÂz †
)ÂÂ† ‡
)ÂÂ‡ ˆ
{
ÃÃ 
return
ÄÄ 
Forbid
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ  
}
ÅÅ 
if
ÇÇ 
(
ÇÇ 
(
ÇÇ 

mediaNames
ÇÇ 
==
ÇÇ 
null
ÇÇ #
)
ÇÇ# $
||
ÇÇ% '
(
ÇÇ( )

mediaNames
ÇÇ) 3
.
ÇÇ3 4
Length
ÇÇ4 :
<
ÇÇ; <
$num
ÇÇ= >
)
ÇÇ> ?
||
ÈÈ 
string
ÈÈ 
.
ÈÈ 
IsNullOrEmpty
ÈÈ '
(
ÈÈ' (
sourceFolder
ÈÈ( 4
)
ÈÈ4 5
||
ÉÉ 
string
ÉÉ 
.
ÉÉ 
IsNullOrEmpty
ÉÉ '
(
ÉÉ' (
targetFolder
ÉÉ( 4
)
ÉÉ4 5
)
ÉÉ5 6
{
ÊÊ 
return
ËË 
NotFound
ËË 
(
ËË  
)
ËË  !
;
ËË! "
}
ÌÌ 
sourceFolder
ÎÎ 
=
ÎÎ 
sourceFolder
ÎÎ '
==
ÎÎ( *
$str
ÎÎ+ 1
?
ÎÎ2 3
string
ÎÎ4 :
.
ÎÎ: ;
Empty
ÎÎ; @
:
ÎÎA B
sourceFolder
ÎÎC O
;
ÎÎO P
targetFolder
ÏÏ 
=
ÏÏ 
targetFolder
ÏÏ '
==
ÏÏ( *
$str
ÏÏ+ 1
?
ÏÏ2 3
string
ÏÏ4 :
.
ÏÏ: ;
Empty
ÏÏ; @
:
ÏÏA B
targetFolder
ÏÏC O
;
ÏÏO P
var
ÑÑ 
filesOnError
ÑÑ 
=
ÑÑ 
new
ÑÑ "
List
ÑÑ# '
<
ÑÑ' (
string
ÑÑ( .
>
ÑÑ. /
(
ÑÑ/ 0
)
ÑÑ0 1
;
ÑÑ1 2
foreach
ÓÓ 
(
ÓÓ 
var
ÓÓ 
name
ÓÓ 
in
ÓÓ  

mediaNames
ÓÓ! +
)
ÓÓ+ ,
{
ÔÔ 
var
ÕÕ 

sourcePath
ÕÕ 
=
ÕÕ  
_mediaFileStore
ÕÕ! 0
.
ÕÕ0 1
Combine
ÕÕ1 8
(
ÕÕ8 9
sourceFolder
ÕÕ9 E
,
ÕÕE F
name
ÕÕG K
)
ÕÕK L
;
ÕÕL M
var
ÖÖ 

targetPath
ÖÖ 
=
ÖÖ  
_mediaFileStore
ÖÖ! 0
.
ÖÖ0 1
Combine
ÖÖ1 8
(
ÖÖ8 9
targetFolder
ÖÖ9 E
,
ÖÖE F
name
ÖÖG K
)
ÖÖK L
;
ÖÖL M
try
×× 
{
ØØ 
await
ÙÙ 
_mediaFileStore
ÙÙ )
.
ÙÙ) *
MoveFileAsync
ÙÙ* 7
(
ÙÙ7 8

sourcePath
ÙÙ8 B
,
ÙÙB C

targetPath
ÙÙD N
)
ÙÙN O
;
ÙÙO P
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ  
FileStoreException
ÛÛ )
)
ÛÛ) *
{
ÜÜ 
filesOnError
İİ  
.
İİ  !
Add
İİ! $
(
İİ$ %

sourcePath
İİ% /
)
İİ/ 0
;
İİ0 1
}
ŞŞ 
}
ßß 
if
áá 
(
áá 
filesOnError
áá 
.
áá 
Count
áá "
>
áá# $
$num
áá% &
)
áá& '
{
ââ 
return
ãã 

BadRequest
ãã !
(
ãã! "
S
ãã" #
[
ãã# $
$strãã$ 
,ãã ‚
stringããƒ ‰
.ãã‰ Š
JoinããŠ 
(ãã 
$strãã ’
,ãã’ “
filesOnErrorãã”  
)ãã  ¡
]ãã¡ ¢
.ãã¢ £
ToStringãã£ «
(ãã« ¬
)ãã¬ ­
)ãã­ ®
;ãã® ¯
}
ää 
else
åå 
{
ææ 
return
çç 
Ok
çç 
(
çç 
)
çç 
;
çç 
}
èè 
}
éé 	
[
ëë 	
HttpPost
ëë	 
]
ëë 
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
ActionResult
ìì &
<
ìì& '
IFileStoreEntry
ìì' 6
>
ìì6 7
>
ìì7 8
CreateFolder
ìì9 E
(
ììE F
string
íí 
path
íí 
,
íí 
string
íí 
name
íí  $
,
íí$ %
[
îî 
FromServices
îî 
]
îî #
IAuthorizationService
îî 0"
authorizationService
îî1 E
)
îîE F
{
ïï 	
if
ğğ 
(
ğğ 
string
ğğ 
.
ğğ 
IsNullOrEmpty
ğğ $
(
ğğ$ %
path
ğğ% )
)
ğğ) *
)
ğğ* +
{
ññ 
path
òò 
=
òò 
$str
òò 
;
òò 
}
óó 
name
õõ 
=
õõ )
_mediaNameNormalizerService
õõ .
.
õõ. /!
NormalizeFolderName
õõ/ B
(
õõB C
name
õõC G
)
õõG H
;
õõH I
if
÷÷ 
(
÷÷ *
_invalidFolderNameCharacters
÷÷ ,
.
÷÷, -
Any
÷÷- 0
(
÷÷0 1
invalidChar
÷÷1 <
=>
÷÷= ?
name
÷÷@ D
.
÷÷D E
Contains
÷÷E M
(
÷÷M N
invalidChar
÷÷N Y
)
÷÷Y Z
)
÷÷Z [
)
÷÷[ \
{
øø 
return
ùù 

StatusCode
ùù !
(
ùù! "
StatusCodes
ùù" -
.
ùù- .!
Status400BadRequest
ùù. A
,
ùùA B
S
ùùC D
[
ùùD E
$strùùE 
]ùù 
)ùù ‘
;ùù‘ ’
}
úú 
var
üü 
newPath
üü 
=
üü 
_mediaFileStore
üü )
.
üü) *
Combine
üü* 1
(
üü1 2
path
üü2 6
,
üü6 7
name
üü8 <
)
üü< =
;
üü= >
if
şş 
(
şş 
!
şş 
await
şş "
authorizationService
şş +
.
şş+ ,
AuthorizeAsync
şş, :
(
şş: ;
User
şş; ?
,
şş? @
Permissions
şşA L
.
şşL M
ManageMedia
şşM X
)
şşX Y
||
ÿÿ 
!
ÿÿ 
await
ÿÿ "
authorizationService
ÿÿ .
.
ÿÿ. /
AuthorizeAsync
ÿÿ/ =
(
ÿÿ= >
User
ÿÿ> B
,
ÿÿB C
Permissions
ÿÿD O
.
ÿÿO P-
ManageAttachedMediaFieldsFolder
ÿÿP o
,
ÿÿo p
(
ÿÿq r
object
ÿÿr x
)
ÿÿx y
newPathÿÿy €
)ÿÿ€ 
)ÿÿ ‚
{
€€ 
return
 
Forbid
 
(
 
)
 
;
  
}
‚‚ 
var
„„ 
mediaFolder
„„ 
=
„„ 
await
„„ #
_mediaFileStore
„„$ 3
.
„„3 4#
GetDirectoryInfoAsync
„„4 I
(
„„I J
newPath
„„J Q
)
„„Q R
;
„„R S
if
…… 
(
…… 
mediaFolder
…… 
!=
…… 
null
…… #
)
……# $
{
†† 
return
‡‡ 

StatusCode
‡‡ !
(
‡‡! "
StatusCodes
‡‡" -
.
‡‡- .!
Status400BadRequest
‡‡. A
,
‡‡A B
S
‡‡C D
[
‡‡D E
$str‡‡E 
]‡‡ 
)‡‡ 
;‡‡ ‘
}
ˆˆ 
var
ŠŠ 
existingFile
ŠŠ 
=
ŠŠ 
await
ŠŠ $
_mediaFileStore
ŠŠ% 4
.
ŠŠ4 5
GetFileInfoAsync
ŠŠ5 E
(
ŠŠE F
newPath
ŠŠF M
)
ŠŠM N
;
ŠŠN O
if
‹‹ 
(
‹‹ 
existingFile
‹‹ 
!=
‹‹ 
null
‹‹  $
)
‹‹$ %
{
ŒŒ 
return
 

StatusCode
 !
(
! "
StatusCodes
" -
.
- .!
Status400BadRequest
. A
,
A B
S
C D
[
D E
$strE Œ
]Œ 
) 
; 
}
 
await
 
_mediaFileStore
 !
.
! "%
TryCreateDirectoryAsync
" 9
(
9 :
newPath
: A
)
A B
;
B C
mediaFolder
’’ 
=
’’ 
await
’’ 
_mediaFileStore
’’  /
.
’’/ 0#
GetDirectoryInfoAsync
’’0 E
(
’’E F
newPath
’’F M
)
’’M N
;
’’N O
return
”” 
new
”” 
ObjectResult
”” #
(
””# $
mediaFolder
””$ /
)
””/ 0
;
””0 1
}
•• 	
public
—— 
object
—— 
CreateFileResult
—— &
(
——& '
IFileStoreEntry
——' 6
	mediaFile
——7 @
)
——@ A
{
˜˜ 	"
_contentTypeProvider
™™  
.
™™  !
TryGetContentType
™™! 2
(
™™2 3
	mediaFile
™™3 <
.
™™< =
Name
™™= A
,
™™A B
out
™™C F
var
™™G J
contentType
™™K V
)
™™V W
;
™™W X
return
›› 
new
›› 
{
œœ 
name
 
=
 
	mediaFile
  
.
  !
Name
! %
,
% &
size
 
=
 
	mediaFile
  
.
  !
Length
! '
,
' (

lastModify
ŸŸ 
=
ŸŸ 
	mediaFile
ŸŸ &
.
ŸŸ& '
LastModifiedUtc
ŸŸ' 6
.
ŸŸ6 7
Subtract
ŸŸ7 ?
(
ŸŸ? @
new
ŸŸ@ C
DateTime
ŸŸD L
(
ŸŸL M
$num
ŸŸM Q
,
ŸŸQ R
$num
ŸŸS T
,
ŸŸT U
$num
ŸŸV W
,
ŸŸW X
$num
ŸŸY Z
,
ŸŸZ [
$num
ŸŸ\ ]
,
ŸŸ] ^
$num
ŸŸ_ `
,
ŸŸ` a
DateTimeKind
ŸŸb n
.
ŸŸn o
Utc
ŸŸo r
)
ŸŸr s
)
ŸŸs t
.
ŸŸt u 
TotalMillisecondsŸŸu †
,ŸŸ† ‡
folder
   
=
   
	mediaFile
   "
.
  " #
DirectoryPath
  # 0
,
  0 1
url
¡¡ 
=
¡¡ 
_mediaFileStore
¡¡ %
.
¡¡% & 
MapPathToPublicUrl
¡¡& 8
(
¡¡8 9
	mediaFile
¡¡9 B
.
¡¡B C
Path
¡¡C G
)
¡¡G H
,
¡¡H I
	mediaPath
¢¢ 
=
¢¢ 
	mediaFile
¢¢ %
.
¢¢% &
Path
¢¢& *
,
¢¢* +
mime
££ 
=
££ 
contentType
££ "
??
££# %
$str
££& @
,
££@ A
	mediaText
¤¤ 
=
¤¤ 
String
¤¤ "
.
¤¤" #
Empty
¤¤# (
,
¤¤( )
anchor
¥¥ 
=
¥¥ 
new
¥¥ 
{
¥¥ 
x
¥¥  
=
¥¥! "
$num
¥¥# '
,
¥¥' (
y
¥¥) *
=
¥¥+ ,
$num
¥¥- 1
}
¥¥2 3
}
¦¦ 
;
¦¦ 
}
§§ 	
public
©© 
IActionResult
©© 
MediaApplication
©© -
(
©©- .
)
©©. /
{
ªª 	
return
«« 
View
«« 
(
«« 
)
«« 
;
«« 
}
¬¬ 	
public
®® 
async
®® 
Task
®® 
<
®® 
IActionResult
®® '
>
®®' (
Options
®®) 0
(
®®0 1
)
®®1 2
{
¯¯ 	
if
°° 
(
°° 
!
°° 
await
°° #
_authorizationService
°° ,
.
°°, -
AuthorizeAsync
°°- ;
(
°°; <
User
°°< @
,
°°@ A
Permissions
°°B M
.
°°M N
ViewMediaOptions
°°N ^
)
°°^ _
)
°°_ `
{
±± 
return
²² 
Forbid
²² 
(
²² 
)
²² 
;
²²  
}
³³ 
return
µµ 
View
µµ 
(
µµ 
_mediaOptions
µµ %
)
µµ% &
;
µµ& '
}
¶¶ 	
}
·· 
}¸¸ º%
•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Controllers\MediaCacheController.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Controllers '
{ 
[ 
Feature 
( 
$str &
)& '
]' (
[ 
Admin 

]
 
public 

class  
MediaCacheController %
:& '

Controller( 2
{ 
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly  
IMediaFileStoreCache - 
_mediaFileStoreCache. B
;B C
private 
readonly 
	INotifier "
	_notifier# ,
;, -
private 
readonly 
IHtmlLocalizer '
H( )
;) *
public  
MediaCacheController #
(# $!
IAuthorizationService ! 
authorizationService" 6
,6 7
IServiceProvider 
serviceProvider ,
,, -
	INotifier 
notifier 
, 
IHtmlLocalizer 
<  
MediaCacheController /
>/ 0
htmlLocalizer1 >
) 
{ 	!
_authorizationService !
=" # 
authorizationService$ 8
;8 9 
_mediaFileStoreCache    
=  ! "
serviceProvider  # 2
.  2 3

GetService  3 =
<  = > 
IMediaFileStoreCache  > R
>  R S
(  S T
)  T U
;  U V
	_notifier!! 
=!! 
notifier!!  
;!!  !
H"" 
="" 
htmlLocalizer"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (
Index%%) .
(%%. /
)%%/ 0
{&& 	
if'' 
('' 
!'' 
await'' !
_authorizationService'' ,
.'', -
AuthorizeAsync''- ;
(''; <
User''< @
,''@ A!
MediaCachePermissions''B W
.''W X
ManageAssetCache''X h
)''h i
)''i j
{(( 
return)) 
Forbid)) 
()) 
))) 
;))  
}** 
var++ 
model++ 
=++ 
new++ 
MediaCacheViewModel++ /
{,, 
IsConfigured-- 
=--  
_mediaFileStoreCache-- 3
!=--4 6
null--7 ;
}.. 
;.. 
return00 
View00 
(00 
model00 
)00 
;00 
}11 	
[33 	
HttpPost33	 
]33 
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
Purge44) .
(44. /
)44/ 0
{55 	
if66 
(66 
!66 
await66 !
_authorizationService66 ,
.66, -
AuthorizeAsync66- ;
(66; <
User66< @
,66@ A!
MediaCachePermissions66B W
.66W X
ManageAssetCache66X h
)66h i
)66i j
{77 
return88 
Forbid88 
(88 
)88 
;88  
}99 
if;; 
(;;  
_mediaFileStoreCache;; $
==;;% '
null;;( ,
);;, -
{<< 
	_notifier== 
.== 
Error== 
(==  
H==  !
[==! "
$str	==" ¡
]
==¡ ¢
)
==¢ £
;
==£ ¤
RedirectToAction>>  
(>>  !
$str>>! (
)>>( )
;>>) *
}?? 
varAA 
	hasErrorsAA 
=AA 
awaitAA ! 
_mediaFileStoreCacheAA" 6
.AA6 7

PurgeAsyncAA7 A
(AAA B
)AAB C
;AAC D
ifBB 
(BB 
	hasErrorsBB 
)BB 
{CC 
	_notifierDD 
.DD 
ErrorDD 
(DD  
HDD  !
[DD! "
$strDD" D
]DDD E
)DDE F
;DDF G
}EE 
elseFF 
{GG 
	_notifierHH 
.HH 
InformationHH %
(HH% &
HHH& '
[HH' (
$strHH( =
]HH= >
)HH> ?
;HH? @
}II 
returnKK 
RedirectToActionKK #
(KK# $
$strKK$ +
)KK+ ,
;KK, -
}LL 	
}MM 
}NN ’×
˜D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Controllers\MediaProfilesController.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Controllers '
{ 
[ 
Admin 

]
 
public 

class #
MediaProfilesController (
:) *

Controller+ 5
{ 
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly  
MediaProfilesManager -!
_mediaProfilesManager. C
;C D
private 
readonly 
MediaOptions %
_mediaOptions& 3
;3 4
private 
readonly 
ISiteService %
_siteService& 2
;2 3
private   
readonly   
	INotifier   "
	_notifier  # ,
;  , -
private!! 
readonly!! 
IStringLocalizer!! )
S!!* +
;!!+ ,
private"" 
readonly"" 
IHtmlLocalizer"" '
H""( )
;"") *
private## 
readonly## 
dynamic##  
New##! $
;##$ %
public%% #
MediaProfilesController%% &
(%%& '!
IAuthorizationService&& ! 
authorizationService&&" 6
,&&6 7 
MediaProfilesManager''   
mediaProfilesManager''! 5
,''5 6
IOptions(( 
<(( 
MediaOptions(( !
>((! "
mediaOptions((# /
,((/ 0
ISiteService)) 
siteService)) $
,))$ %
	INotifier** 
notifier** 
,** 
IShapeFactory++ 
shapeFactory++ &
,++& '
IStringLocalizer,, 
<,, #
MediaProfilesController,, 4
>,,4 5
stringLocalizer,,6 E
,,,E F
IHtmlLocalizer-- 
<-- #
MediaProfilesController-- 2
>--2 3
htmlLocalizer--4 A
).. 
{// 	!
_authorizationService00 !
=00" # 
authorizationService00$ 8
;008 9!
_mediaProfilesManager11 !
=11" # 
mediaProfilesManager11$ 8
;118 9
_mediaOptions22 
=22 
mediaOptions22 (
.22( )
Value22) .
;22. /
_siteService33 
=33 
siteService33 &
;33& '
	_notifier44 
=44 
notifier44  
;44  !
New55 
=55 
shapeFactory55 
;55 
S66 
=66 
stringLocalizer66 
;66  
H77 
=77 
htmlLocalizer77 
;77 
}88 	
public:: 
async:: 
Task:: 
<:: 
IActionResult:: '
>::' (
Index::) .
(::. /
ContentOptions::/ =
options::> E
,::E F
PagerParameters::G V
pagerParameters::W f
)::f g
{;; 	
if<< 
(<< 
!<< 
await<< !
_authorizationService<< ,
.<<, -
AuthorizeAsync<<- ;
(<<; <
User<<< @
,<<@ A
Permissions<<B M
.<<M N
ManageMediaProfiles<<N a
)<<a b
)<<b c
{== 
return>> 
Forbid>> 
(>> 
)>> 
;>>  
}?? 
varAA 
siteSettingsAA 
=AA 
awaitAA $
_siteServiceAA% 1
.AA1 2 
GetSiteSettingsAsyncAA2 F
(AAF G
)AAG H
;AAH I
varBB 
pagerBB 
=BB 
newBB 
PagerBB !
(BB! "
pagerParametersBB" 1
,BB1 2
siteSettingsBB3 ?
.BB? @
PageSizeBB@ H
)BBH I
;BBI J
varDD !
mediaProfilesDocumentDD %
=DD& '
awaitDD( -!
_mediaProfilesManagerDD. C
.DDC D)
GetMediaProfilesDocumentAsyncDDD a
(DDa b
)DDb c
;DDc d
varEE 
mediaProfilesEE 
=EE !
mediaProfilesDocumentEE  5
.EE5 6
MediaProfilesEE6 C
.EEC D
ToListEED J
(EEJ K
)EEK L
;EEL M
ifGG 
(GG 
!GG 
stringGG 
.GG 
IsNullOrWhiteSpaceGG *
(GG* +
optionsGG+ 2
.GG2 3
SearchGG3 9
)GG9 :
)GG: ;
{HH 
mediaProfilesII 
=II 
mediaProfilesII  -
.II- .
WhereII. 3
(II3 4
xII4 5
=>II6 8
xII9 :
.II: ;
KeyII; >
.II> ?
ContainsII? G
(IIG H
optionsIIH O
.IIO P
SearchIIP V
,IIV W
StringComparisonIIX h
.IIh i
OrdinalIgnoreCaseIIi z
)IIz {
)II{ |
.II| }
ToList	II} ƒ
(
IIƒ „
)
II„ …
;
II… †
}JJ 
varLL 
countLL 
=LL 
mediaProfilesLL %
.LL% &
CountLL& +
;LL+ ,
mediaProfilesNN 
=NN 
mediaProfilesNN )
.NN) *
OrderByNN* 1
(NN1 2
xNN2 3
=>NN4 6
xNN7 8
.NN8 9
KeyNN9 <
)NN< =
.OO 
SkipOO 
(OO 
pagerOO 
.OO 
GetStartIndexOO )
(OO) *
)OO* +
)OO+ ,
.PP 
TakePP 
(PP 
pagerPP 
.PP 
PageSizePP $
)PP$ %
.PP% &
ToListPP& ,
(PP, -
)PP- .
;PP. /
varRR 

pagerShapeRR 
=RR 
(RR 
awaitRR #
NewRR$ '
.RR' (
PagerRR( -
(RR- .
pagerRR. 3
)RR3 4
)RR4 5
.RR5 6
TotalItemCountRR6 D
(RRD E
countRRE J
)RRJ K
;RRK L
varTT 
modelTT 
=TT 
newTT &
MediaProfileIndexViewModelTT 6
{UU 
MediaProfilesVV 
=VV 
mediaProfilesVV  -
.VV- .
SelectVV. 4
(VV4 5
xVV5 6
=>VV7 9
newVV: =
MediaProfileEntryVV> O
{VVP Q
NameVVR V
=VVW X
xVVY Z
.VVZ [
KeyVV[ ^
,VV^ _
MediaProfileVV` l
=VVm n
xVVo p
.VVp q
ValueVVq v
}VVw x
)VVx y
.VVy z
ToList	VVz €
(
VV€ 
)
VV ‚
,
VV‚ ƒ
PagerWW 
=WW 

pagerShapeWW "
}XX 
;XX 
modelZZ 
.ZZ 
OptionsZZ 
.ZZ 
ContentsBulkActionZZ ,
=ZZ- .
newZZ/ 2
ListZZ3 7
<ZZ7 8
SelectListItemZZ8 F
>ZZF G
(ZZG H
)ZZH I
{ZZJ K
new[[ 
SelectListItem[[ "
([[" #
)[[# $
{[[% &
Text[[' +
=[[, -
S[[. /
[[[/ 0
$str[[0 8
][[8 9
,[[9 :
Value[[; @
=[[A B
nameof[[C I
([[I J
ContentsBulkAction[[J \
.[[\ ]
Remove[[] c
)[[c d
}[[e f
}\\ 
;\\ 
return^^ 
View^^ 
(^^ 
$str^^ 
,^^  
model^^! &
)^^& '
;^^' (
}__ 	
[aa 	
HttpPostaa	 
,aa 

ActionNameaa 
(aa 
$straa %
)aa% &
]aa& '
[bb 	
FormValueRequiredbb	 
(bb 
$strbb *
)bb* +
]bb+ ,
publiccc 
ActionResultcc 
IndexFilterPOSTcc +
(cc+ ,&
MediaProfileIndexViewModelcc, F
modelccG L
)ccL M
{dd 	
returnee 
RedirectToActionee #
(ee# $
$stree$ +
,ee+ ,
newee- 0 
RouteValueDictionaryee1 E
{eeF G
{ff 
$strff "
,ff" #
modelff$ )
.ff) *
Optionsff* 1
.ff1 2
Searchff2 8
}ff9 :
}gg 
)gg 
;gg 
}hh 	
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
Createjj) /
(jj/ 0
)jj0 1
{kk 	
ifll 
(ll 
!ll 
awaitll !
_authorizationServicell ,
.ll, -
AuthorizeAsyncll- ;
(ll; <
Userll< @
,ll@ A
PermissionsllB M
.llM N
ManageMediaProfilesllN a
)lla b
)llb c
{mm 
returnnn 
Forbidnn 
(nn 
)nn 
;nn  
}oo 
varqq 
modelqq 
=qq 
newqq !
MediaProfileViewModelqq 1
(qq1 2
)qq2 3
;qq3 4
BuildViewModelss 
(ss 
modelss  
)ss  !
;ss! "
returnuu 
Viewuu 
(uu 
modeluu 
)uu 
;uu 
}vv 	
[xx 	
HttpPostxx	 
,xx 

ActionNamexx 
(xx 
$strxx &
)xx& '
]xx' (
publicyy 
asyncyy 
Taskyy 
<yy 
IActionResultyy '
>yy' (

CreatePostyy) 3
(yy3 4!
MediaProfileViewModelyy4 I
modelyyJ O
,yyO P
stringyyQ W
submityyX ^
)yy^ _
{zz 	
if{{ 
({{ 
!{{ 
await{{ !
_authorizationService{{ ,
.{{, -
AuthorizeAsync{{- ;
({{; <
User{{< @
,{{@ A
Permissions{{B M
.{{M N
ManageMediaProfiles{{N a
){{a b
){{b c
{|| 
return}} 
Forbid}} 
(}} 
)}} 
;}}  
}~~ 
if
€€ 
(
€€ 

ModelState
€€ 
.
€€ 
IsValid
€€ "
)
€€" #
{
 
if
‚‚ 
(
‚‚ 
String
‚‚ 
.
‚‚  
IsNullOrWhiteSpace
‚‚ -
(
‚‚- .
model
‚‚. 3
.
‚‚3 4
Name
‚‚4 8
)
‚‚8 9
)
‚‚9 :
{
ƒƒ 

ModelState
„„ 
.
„„ 
AddModelError
„„ ,
(
„„, -
nameof
„„- 3
(
„„3 4#
MediaProfileViewModel
„„4 I
.
„„I J
Name
„„J N
)
„„N O
,
„„O P
S
„„Q R
[
„„R S
$str
„„S k
]
„„k l
)
„„l m
;
„„m n
}
…… 
else
†† 
{
‡‡ 
var
ˆˆ #
mediaProfilesDocument
ˆˆ -
=
ˆˆ. /
await
ˆˆ0 5#
_mediaProfilesManager
ˆˆ6 K
.
ˆˆK L+
GetMediaProfilesDocumentAsync
ˆˆL i
(
ˆˆi j
)
ˆˆj k
;
ˆˆk l
if
ŠŠ 
(
ŠŠ #
mediaProfilesDocument
ŠŠ -
.
ŠŠ- .
MediaProfiles
ŠŠ. ;
.
ŠŠ; <
ContainsKey
ŠŠ< G
(
ŠŠG H
model
ŠŠH M
.
ŠŠM N
Name
ŠŠN R
)
ŠŠR S
)
ŠŠS T
{
‹‹ 

ModelState
ŒŒ "
.
ŒŒ" #
AddModelError
ŒŒ# 0
(
ŒŒ0 1
nameof
ŒŒ1 7
(
ŒŒ7 8#
MediaProfileViewModel
ŒŒ8 M
.
ŒŒM N
Name
ŒŒN R
)
ŒŒR S
,
ŒŒS T
S
ŒŒU V
[
ŒŒV W
$strŒŒW …
]ŒŒ… †
)ŒŒ† ‡
;ŒŒ‡ ˆ
}
 
}
 
}
 
if
‘‘ 
(
‘‘ 

ModelState
‘‘ 
.
‘‘ 
IsValid
‘‘ "
)
‘‘" #
{
’’ 
var
““ 
isCustomWidth
““ !
=
““" #
model
““$ )
.
““) *
SelectedWidth
““* 7
!=
““8 :
$num
““; <
&&
““= ?
Array
““@ E
.
““E F
BinarySearch
““F R
<
““R S
int
““S V
>
““V W
(
““W X
_mediaOptions
““X e
.
““e f
SupportedSizes
““f t
,
““t u
model
““v {
.
““{ |
SelectedWidth““| ‰
)““‰ Š
<““‹ Œ
$num““ 
;““ 
var
”” 
isCustomHeight
”” "
=
””# $
model
””% *
.
””* +
SelectedHeight
””+ 9
!=
””: <
$num
””= >
&&
””? A
Array
””A F
.
””F G
BinarySearch
””G S
<
””S T
int
””T W
>
””W X
(
””X Y
_mediaOptions
””Y f
.
””f g
SupportedSizes
””g u
,
””u v
model
””w |
.
””| }
SelectedHeight””} ‹
)””‹ Œ
<”” 
$num”” 
;”” ‘
var
–– 
mediaProfile
––  
=
––! "
new
––# &
MediaProfile
––' 3
{
—— 
Hint
˜˜ 
=
˜˜ 
model
˜˜  
.
˜˜  !
Hint
˜˜! %
,
˜˜% &
Width
™™ 
=
™™ 
isCustomWidth
™™ )
?
™™* +
model
™™, 1
.
™™1 2
CustomWidth
™™2 =
:
™™> ?
model
™™@ E
.
™™E F
SelectedWidth
™™F S
,
™™S T
Height
šš 
=
šš 
isCustomHeight
šš +
?
šš, -
model
šš. 3
.
šš3 4
CustomHeight
šš4 @
:
ššA B
model
ššC H
.
ššH I
SelectedHeight
ššI W
,
ššW X
Mode
›› 
=
›› 
model
››  
.
››  !
SelectedMode
››! -
,
››- .
Format
œœ 
=
œœ 
model
œœ "
.
œœ" #
SelectedFormat
œœ# 1
,
œœ1 2
Quality
 
=
 
model
 #
.
# $
Quality
$ +
,
+ ,
BackgroundColor
 #
=
$ %
model
& +
.
+ ,
BackgroundColor
, ;
}
ŸŸ 
;
ŸŸ 
await
¡¡ #
_mediaProfilesManager
¡¡ +
.
¡¡+ ,%
UpdateMediaProfileAsync
¡¡, C
(
¡¡C D
model
¡¡D I
.
¡¡I J
Name
¡¡J N
,
¡¡N O
mediaProfile
¡¡P \
)
¡¡\ ]
;
¡¡] ^
if
££ 
(
££ 
submit
££ 
==
££ 
$str
££ /
)
££/ 0
{
¤¤ 
return
¥¥ 
RedirectToAction
¥¥ +
(
¥¥+ ,
nameof
¥¥, 2
(
¥¥2 3
Edit
¥¥3 7
)
¥¥7 8
,
¥¥8 9
new
¥¥: =
{
¥¥> ?
name
¥¥@ D
=
¥¥E F
model
¥¥G L
.
¥¥L M
Name
¥¥M Q
}
¥¥R S
)
¥¥S T
;
¥¥T U
}
¦¦ 
else
§§ 
{
¨¨ 
return
©© 
RedirectToAction
©© +
(
©©+ ,
nameof
©©, 2
(
©©2 3
Index
©©3 8
)
©©8 9
)
©©9 :
;
©©: ;
}
ªª 
}
«« 
BuildViewModel
®® 
(
®® 
model
®®  
)
®®  !
;
®®! "
return
°° 
View
°° 
(
°° 
model
°° 
)
°° 
;
°° 
}
±± 	
public
³³ 
async
³³ 
Task
³³ 
<
³³ 
IActionResult
³³ '
>
³³' (
Edit
³³) -
(
³³- .
string
³³. 4
name
³³5 9
)
³³9 :
{
´´ 	
if
µµ 
(
µµ 
!
µµ 
await
µµ #
_authorizationService
µµ ,
.
µµ, -
AuthorizeAsync
µµ- ;
(
µµ; <
User
µµ< @
,
µµ@ A
Permissions
µµB M
.
µµM N!
ManageMediaProfiles
µµN a
)
µµa b
)
µµb c
{
¶¶ 
return
·· 
Forbid
·· 
(
·· 
)
·· 
;
··  
}
¸¸ 
var
ºº #
mediaProfilesDocument
ºº %
=
ºº& '
await
ºº( -#
_mediaProfilesManager
ºº. C
.
ººC D+
GetMediaProfilesDocumentAsync
ººD a
(
ººa b
)
ººb c
;
ººc d
if
¼¼ 
(
¼¼ 
!
¼¼ #
mediaProfilesDocument
¼¼ &
.
¼¼& '
MediaProfiles
¼¼' 4
.
¼¼4 5
ContainsKey
¼¼5 @
(
¼¼@ A
name
¼¼A E
)
¼¼E F
)
¼¼F G
{
½½ 
return
¾¾ 
RedirectToAction
¾¾ '
(
¾¾' (
$str
¾¾( 0
,
¾¾0 1
new
¾¾2 5
{
¾¾6 7
name
¾¾8 <
}
¾¾= >
)
¾¾> ?
;
¾¾? @
}
¿¿ 
var
ÁÁ 
mediaProfile
ÁÁ 
=
ÁÁ #
mediaProfilesDocument
ÁÁ 4
.
ÁÁ4 5
MediaProfiles
ÁÁ5 B
[
ÁÁB C
name
ÁÁC G
]
ÁÁG H
;
ÁÁH I
var
ÃÃ 
isCustomWidth
ÃÃ 
=
ÃÃ 
mediaProfile
ÃÃ  ,
.
ÃÃ, -
Width
ÃÃ- 2
!=
ÃÃ3 5
$num
ÃÃ6 7
&&
ÃÃ8 :
Array
ÃÃ; @
.
ÃÃ@ A
BinarySearch
ÃÃA M
<
ÃÃM N
int
ÃÃN Q
>
ÃÃQ R
(
ÃÃR S
_mediaOptions
ÃÃS `
.
ÃÃ` a
SupportedSizes
ÃÃa o
,
ÃÃo p
mediaProfile
ÃÃq }
.
ÃÃ} ~
WidthÃÃ~ ƒ
)ÃÃƒ „
<ÃÃ… †
$numÃÃ‡ ˆ
;ÃÃˆ ‰
var
ÄÄ 
isCustomHeight
ÄÄ 
=
ÄÄ  
mediaProfile
ÄÄ! -
.
ÄÄ- .
Height
ÄÄ. 4
!=
ÄÄ5 7
$num
ÄÄ8 9
&&
ÄÄ: <
Array
ÄÄ= B
.
ÄÄB C
BinarySearch
ÄÄC O
<
ÄÄO P
int
ÄÄP S
>
ÄÄS T
(
ÄÄT U
_mediaOptions
ÄÄU b
.
ÄÄb c
SupportedSizes
ÄÄc q
,
ÄÄq r
mediaProfile
ÄÄs 
.ÄÄ €
HeightÄÄ€ †
)ÄÄ† ‡
<ÄÄˆ ‰
$numÄÄŠ ‹
;ÄÄ‹ Œ
var
ÆÆ 
model
ÆÆ 
=
ÆÆ 
new
ÆÆ #
MediaProfileViewModel
ÆÆ 1
{
ÇÇ 
Name
ÈÈ 
=
ÈÈ 
name
ÈÈ 
,
ÈÈ 
Hint
ÉÉ 
=
ÉÉ 
mediaProfile
ÉÉ #
.
ÉÉ# $
Hint
ÉÉ$ (
,
ÉÉ( )
SelectedWidth
ÊÊ 
=
ÊÊ 
isCustomWidth
ÊÊ  -
?
ÊÊ. /
-
ÊÊ0 1
$num
ÊÊ1 2
:
ÊÊ3 4
mediaProfile
ÊÊ5 A
.
ÊÊA B
Width
ÊÊB G
,
ÊÊG H
CustomWidth
ËË 
=
ËË 
isCustomWidth
ËË +
?
ËË, -
mediaProfile
ËË. :
.
ËË: ;
Width
ËË; @
:
ËËA B
$num
ËËC D
,
ËËD E
SelectedHeight
ÌÌ 
=
ÌÌ  
isCustomHeight
ÌÌ! /
?
ÌÌ0 1
-
ÌÌ2 3
$num
ÌÌ3 4
:
ÌÌ5 6
mediaProfile
ÌÌ7 C
.
ÌÌC D
Height
ÌÌD J
,
ÌÌJ K
CustomHeight
ÍÍ 
=
ÍÍ 
isCustomHeight
ÍÍ -
?
ÍÍ. /
mediaProfile
ÍÍ0 <
.
ÍÍ< =
Height
ÍÍ= C
:
ÍÍD E
$num
ÍÍF G
,
ÍÍG H
SelectedMode
ÎÎ 
=
ÎÎ 
mediaProfile
ÎÎ +
.
ÎÎ+ ,
Mode
ÎÎ, 0
,
ÎÎ0 1
SelectedFormat
ÏÏ 
=
ÏÏ  
mediaProfile
ÏÏ! -
.
ÏÏ- .
Format
ÏÏ. 4
,
ÏÏ4 5
Quality
ĞĞ 
=
ĞĞ 
mediaProfile
ĞĞ &
.
ĞĞ& '
Quality
ĞĞ' .
,
ĞĞ. /
BackgroundColor
ÑÑ 
=
ÑÑ  !
mediaProfile
ÑÑ" .
.
ÑÑ. /
BackgroundColor
ÑÑ/ >
}
ÒÒ 
;
ÒÒ 
BuildViewModel
ÔÔ 
(
ÔÔ 
model
ÔÔ  
)
ÔÔ  !
;
ÔÔ! "
return
ÖÖ 
View
ÖÖ 
(
ÖÖ 
model
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
×× 	
[
ÙÙ 	
HttpPost
ÙÙ	 
]
ÙÙ 
public
ÚÚ 
async
ÚÚ 
Task
ÚÚ 
<
ÚÚ 
IActionResult
ÚÚ '
>
ÚÚ' (
Edit
ÚÚ) -
(
ÚÚ- .
string
ÚÚ. 4

sourceName
ÚÚ5 ?
,
ÚÚ? @#
MediaProfileViewModel
ÚÚA V
model
ÚÚW \
,
ÚÚ\ ]
string
ÚÚ^ d
submit
ÚÚe k
)
ÚÚk l
{
ÛÛ 	
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
await
ÜÜ #
_authorizationService
ÜÜ ,
.
ÜÜ, -
AuthorizeAsync
ÜÜ- ;
(
ÜÜ; <
User
ÜÜ< @
,
ÜÜ@ A
Permissions
ÜÜB M
.
ÜÜM N!
ManageMediaProfiles
ÜÜN a
)
ÜÜa b
)
ÜÜb c
{
İİ 
return
ŞŞ 
Forbid
ŞŞ 
(
ŞŞ 
)
ŞŞ 
;
ŞŞ  
}
ßß 
var
áá #
mediaProfilesDocument
áá %
=
áá& '
await
áá( -#
_mediaProfilesManager
áá. C
.
ááC D,
LoadMediaProfilesDocumentAsync
ááD b
(
ááb c
)
áác d
;
áád e
if
ãã 
(
ãã 
!
ãã #
mediaProfilesDocument
ãã &
.
ãã& '
MediaProfiles
ãã' 4
.
ãã4 5
ContainsKey
ãã5 @
(
ãã@ A

sourceName
ããA K
)
ããK L
)
ããL M
{
ää 
return
åå 
NotFound
åå 
(
åå  
)
åå  !
;
åå! "
}
ææ 
if
èè 
(
èè 

ModelState
èè 
.
èè 
IsValid
èè "
)
èè" #
{
éé 
if
êê 
(
êê 
String
êê 
.
êê  
IsNullOrWhiteSpace
êê -
(
êê- .
model
êê. 3
.
êê3 4
Name
êê4 8
)
êê8 9
)
êê9 :
{
ëë 

ModelState
ìì 
.
ìì 
AddModelError
ìì ,
(
ìì, -
nameof
ìì- 3
(
ìì3 4#
MediaProfileViewModel
ìì4 I
.
ììI J
Name
ììJ N
)
ììN O
,
ììO P
S
ììQ R
[
ììR S
$str
ììS k
]
ììk l
)
ììl m
;
ììm n
}
íí 
}
îî 
if
ğğ 
(
ğğ 

ModelState
ğğ 
.
ğğ 
IsValid
ğğ "
)
ğğ" #
{
ññ 
var
òò 
isCustomWidth
òò !
=
òò" #
Array
òò$ )
.
òò) *
BinarySearch
òò* 6
<
òò6 7
int
òò7 :
>
òò: ;
(
òò; <
_mediaOptions
òò< I
.
òòI J
SupportedSizes
òòJ X
,
òòX Y
model
òòZ _
.
òò_ `
SelectedWidth
òò` m
)
òòm n
<
òòo p
$num
òòq r
;
òòr s
var
óó 
isCustomHeight
óó "
=
óó# $
Array
óó% *
.
óó* +
BinarySearch
óó+ 7
<
óó7 8
int
óó8 ;
>
óó; <
(
óó< =
_mediaOptions
óó= J
.
óóJ K
SupportedSizes
óóK Y
,
óóY Z
model
óó[ `
.
óó` a
SelectedHeight
óóa o
)
óóo p
<
óóq r
$num
óós t
;
óót u
var
õõ 
mediaProfile
õõ  
=
õõ! "
new
õõ# &
MediaProfile
õõ' 3
{
öö 
Hint
÷÷ 
=
÷÷ 
model
÷÷  
.
÷÷  !
Hint
÷÷! %
,
÷÷% &
Width
øø 
=
øø 
isCustomWidth
øø )
?
øø* +
model
øø, 1
.
øø1 2
CustomWidth
øø2 =
:
øø> ?
model
øø@ E
.
øøE F
SelectedWidth
øøF S
,
øøS T
Height
ùù 
=
ùù 
isCustomHeight
ùù +
?
ùù, -
model
ùù. 3
.
ùù3 4
CustomHeight
ùù4 @
:
ùùA B
model
ùùC H
.
ùùH I
SelectedHeight
ùùI W
,
ùùW X
Mode
úú 
=
úú 
model
úú  
.
úú  !
SelectedMode
úú! -
,
úú- .
Format
ûû 
=
ûû 
model
ûû "
.
ûû" #
SelectedFormat
ûû# 1
,
ûû1 2
Quality
üü 
=
üü 
model
üü #
.
üü# $
Quality
üü$ +
,
üü+ ,
BackgroundColor
ıı #
=
ıı$ %
model
ıı& +
.
ıı+ ,
BackgroundColor
ıı, ;
}
şş 
;
şş 
await
€€ #
_mediaProfilesManager
€€ +
.
€€+ ,%
RemoveMediaProfileAsync
€€, C
(
€€C D

sourceName
€€D N
)
€€N O
;
€€O P
await
‚‚ #
_mediaProfilesManager
‚‚ +
.
‚‚+ ,%
UpdateMediaProfileAsync
‚‚, C
(
‚‚C D
model
‚‚D I
.
‚‚I J
Name
‚‚J N
,
‚‚N O
mediaProfile
‚‚P \
)
‚‚\ ]
;
‚‚] ^
if
„„ 
(
„„ 
submit
„„ 
!=
„„ 
$str
„„ /
)
„„/ 0
{
…… 
return
†† 
RedirectToAction
†† +
(
††+ ,
nameof
††, 2
(
††2 3
Index
††3 8
)
††8 9
)
††9 :
;
††: ;
}
‡‡ 
}
ˆˆ 
BuildViewModel
‹‹ 
(
‹‹ 
model
‹‹  
)
‹‹  !
;
‹‹! "
return
 
View
 
(
 
model
 
)
 
;
 
}
 	
[
 	
HttpPost
	 
]
 
public
‘‘ 
async
‘‘ 
Task
‘‘ 
<
‘‘ 
IActionResult
‘‘ '
>
‘‘' (
Delete
‘‘) /
(
‘‘/ 0
string
‘‘0 6
name
‘‘7 ;
)
‘‘; <
{
’’ 	
if
““ 
(
““ 
!
““ 
await
““ #
_authorizationService
““ ,
.
““, -
AuthorizeAsync
““- ;
(
““; <
User
““< @
,
““@ A
Permissions
““B M
.
““M N!
ManageMediaProfiles
““N a
)
““a b
)
““b c
{
”” 
return
•• 
Forbid
•• 
(
•• 
)
•• 
;
••  
}
–– 
var
˜˜ #
mediaProfilesDocument
˜˜ %
=
˜˜& '
await
˜˜( -#
_mediaProfilesManager
˜˜. C
.
˜˜C D,
LoadMediaProfilesDocumentAsync
˜˜D b
(
˜˜b c
)
˜˜c d
;
˜˜d e
if
šš 
(
šš 
!
šš #
mediaProfilesDocument
šš &
.
šš& '
MediaProfiles
šš' 4
.
šš4 5
ContainsKey
šš5 @
(
šš@ A
name
ššA E
)
ššE F
)
ššF G
{
›› 
return
œœ 
NotFound
œœ 
(
œœ  
)
œœ  !
;
œœ! "
}
 
await
ŸŸ #
_mediaProfilesManager
ŸŸ '
.
ŸŸ' (%
RemoveMediaProfileAsync
ŸŸ( ?
(
ŸŸ? @
name
ŸŸ@ D
)
ŸŸD E
;
ŸŸE F
	_notifier
¡¡ 
.
¡¡ 
Success
¡¡ 
(
¡¡ 
H
¡¡ 
[
¡¡  
$str
¡¡  E
]
¡¡E F
)
¡¡F G
;
¡¡G H
return
££ 
RedirectToAction
££ #
(
££# $
nameof
££$ *
(
££* +
Index
££+ 0
)
££0 1
)
££1 2
;
££2 3
}
¤¤ 	
[
¦¦ 	
HttpPost
¦¦	 
,
¦¦ 

ActionName
¦¦ 
(
¦¦ 
$str
¦¦ %
)
¦¦% &
]
¦¦& '
[
§§ 	
FormValueRequired
§§	 
(
§§ 
$str
§§ .
)
§§. /
]
§§/ 0
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨ 
ActionResult
¨¨ &
>
¨¨& '
	IndexPost
¨¨( 1
(
¨¨1 2

ViewModels
¨¨2 <
.
¨¨< =
ContentOptions
¨¨= K
options
¨¨L S
,
¨¨S T
IEnumerable
¨¨U `
<
¨¨` a
string
¨¨a g
>
¨¨g h
itemIds
¨¨i p
)
¨¨p q
{
©© 	
if
ªª 
(
ªª 
!
ªª 
await
ªª #
_authorizationService
ªª ,
.
ªª, -
AuthorizeAsync
ªª- ;
(
ªª; <
User
ªª< @
,
ªª@ A
Permissions
ªªB M
.
ªªM N!
ManageMediaProfiles
ªªN a
)
ªªa b
)
ªªb c
{
«« 
return
¬¬ 
Forbid
¬¬ 
(
¬¬ 
)
¬¬ 
;
¬¬  
}
­­ 
if
¯¯ 
(
¯¯ 
itemIds
¯¯ 
?
¯¯ 
.
¯¯ 
Count
¯¯ 
(
¯¯ 
)
¯¯  
>
¯¯! "
$num
¯¯# $
)
¯¯$ %
{
°° 
var
±± #
mediaProfilesDocument
±± )
=
±±* +
await
±±, 1#
_mediaProfilesManager
±±2 G
.
±±G H,
LoadMediaProfilesDocumentAsync
±±H f
(
±±f g
)
±±g h
;
±±h i
var
²² !
checkedContentItems
²² '
=
²²( )#
mediaProfilesDocument
²²* ?
.
²²? @
MediaProfiles
²²@ M
.
²²M N
Where
²²N S
(
²²S T
x
²²T U
=>
²²V X
itemIds
²²Y `
.
²²` a
Contains
²²a i
(
²²i j
x
²²j k
.
²²k l
Key
²²l o
)
²²o p
)
²²p q
;
²²q r
switch
³³ 
(
³³ 
options
³³ 
.
³³  

BulkAction
³³  *
)
³³* +
{
´´ 
case
µµ  
ContentsBulkAction
µµ +
.
µµ+ ,
None
µµ, 0
:
µµ0 1
break
¶¶ 
;
¶¶ 
case
··  
ContentsBulkAction
·· +
.
··+ ,
Remove
··, 2
:
··2 3
foreach
¸¸ 
(
¸¸  !
var
¸¸! $
item
¸¸% )
in
¸¸* ,!
checkedContentItems
¸¸- @
)
¸¸@ A
{
¹¹ 
await
ºº !#
_mediaProfilesManager
ºº" 7
.
ºº7 8%
RemoveMediaProfileAsync
ºº8 O
(
ººO P
item
ººP T
.
ººT U
Key
ººU X
)
ººX Y
;
ººY Z
}
»» 
	_notifier
¼¼ !
.
¼¼! "
Success
¼¼" )
(
¼¼) *
H
¼¼* +
[
¼¼+ ,
$str
¼¼, R
]
¼¼R S
)
¼¼S T
;
¼¼T U
break
½½ 
;
½½ 
default
¾¾ 
:
¾¾ 
throw
¿¿ 
new
¿¿ !)
ArgumentOutOfRangeException
¿¿" =
(
¿¿= >
)
¿¿> ?
;
¿¿? @
}
ÀÀ 
}
ÁÁ 
return
ÃÃ 
RedirectToAction
ÃÃ #
(
ÃÃ# $
$str
ÃÃ$ +
)
ÃÃ+ ,
;
ÃÃ, -
}
ÄÄ 	
private
ÆÆ 
void
ÆÆ 
BuildViewModel
ÆÆ #
(
ÆÆ# $#
MediaProfileViewModel
ÆÆ$ 9
model
ÆÆ: ?
)
ÆÆ? @
{
ÇÇ 	
model
ÈÈ 
.
ÈÈ 
AvailableWidths
ÈÈ !
.
ÈÈ! "
Add
ÈÈ" %
(
ÈÈ% &
new
ÈÈ& )
SelectListItem
ÈÈ* 8
(
ÈÈ8 9
)
ÈÈ9 :
{
ÈÈ; <
Text
ÈÈ= A
=
ÈÈB C
S
ÈÈD E
[
ÈÈE F
$str
ÈÈF O
]
ÈÈO P
,
ÈÈP Q
Value
ÈÈR W
=
ÈÈX Y
$str
ÈÈZ ]
}
ÈÈ^ _
)
ÈÈ_ `
;
ÈÈ` a
model
ÉÉ 
.
ÉÉ 
AvailableHeights
ÉÉ "
.
ÉÉ" #
Add
ÉÉ# &
(
ÉÉ& '
new
ÉÉ' *
SelectListItem
ÉÉ+ 9
(
ÉÉ9 :
)
ÉÉ: ;
{
ÉÉ< =
Text
ÉÉ> B
=
ÉÉC D
S
ÉÉE F
[
ÉÉF G
$str
ÉÉG P
]
ÉÉP Q
,
ÉÉQ R
Value
ÉÉS X
=
ÉÉY Z
$str
ÉÉ[ ^
}
ÉÉ_ `
)
ÉÉ` a
;
ÉÉa b
model
ÊÊ 
.
ÊÊ 
AvailableWidths
ÊÊ !
.
ÊÊ! "
AddRange
ÊÊ" *
(
ÊÊ* +
_mediaOptions
ÊÊ+ 8
.
ÊÊ8 9
SupportedSizes
ÊÊ9 G
.
ÊÊG H
Select
ÊÊH N
(
ÊÊN O
x
ÊÊO P
=>
ÊÊQ S
new
ÊÊT W
SelectListItem
ÊÊX f
(
ÊÊf g
)
ÊÊg h
{
ÊÊi j
Text
ÊÊk o
=
ÊÊp q
x
ÊÊr s
.
ÊÊs t
ToString
ÊÊt |
(
ÊÊ| }
)
ÊÊ} ~
,
ÊÊ~ 
ValueÊÊ€ …
=ÊÊ† ‡
xÊÊˆ ‰
.ÊÊ‰ Š
ToStringÊÊŠ ’
(ÊÊ’ “
)ÊÊ“ ”
}ÊÊ• –
)ÊÊ– —
)ÊÊ— ˜
;ÊÊ˜ ™
model
ËË 
.
ËË 
AvailableHeights
ËË "
.
ËË" #
AddRange
ËË# +
(
ËË+ ,
_mediaOptions
ËË, 9
.
ËË9 :
SupportedSizes
ËË: H
.
ËËH I
Select
ËËI O
(
ËËO P
x
ËËP Q
=>
ËËR T
new
ËËU X
SelectListItem
ËËY g
(
ËËg h
)
ËËh i
{
ËËj k
Text
ËËl p
=
ËËq r
x
ËËs t
.
ËËt u
ToString
ËËu }
(
ËË} ~
)
ËË~ 
,ËË €
ValueËË †
=ËË‡ ˆ
xËË‰ Š
.ËËŠ ‹
ToStringËË‹ “
(ËË“ ”
)ËË” •
}ËË– —
)ËË— ˜
)ËË˜ ™
;ËË™ š
if
ÌÌ 
(
ÌÌ 
_mediaOptions
ÌÌ 
.
ÌÌ %
UseTokenizedQueryString
ÌÌ 5
)
ÌÌ5 6
{
ÍÍ 
model
ÎÎ 
.
ÎÎ 
AvailableWidths
ÎÎ %
.
ÎÎ% &
Add
ÎÎ& )
(
ÎÎ) *
new
ÎÎ* -
SelectListItem
ÎÎ. <
(
ÎÎ< =
)
ÎÎ= >
{
ÎÎ? @
Text
ÎÎA E
=
ÎÎF G
S
ÎÎH I
[
ÎÎI J
$str
ÎÎJ W
]
ÎÎW X
,
ÎÎX Y
Value
ÎÎZ _
=
ÎÎ` a
$str
ÎÎb f
}
ÎÎg h
)
ÎÎh i
;
ÎÎi j
model
ÏÏ 
.
ÏÏ 
AvailableHeights
ÏÏ &
.
ÏÏ& '
Add
ÏÏ' *
(
ÏÏ* +
new
ÏÏ+ .
SelectListItem
ÏÏ/ =
(
ÏÏ= >
)
ÏÏ> ?
{
ÏÏ@ A
Text
ÏÏB F
=
ÏÏG H
S
ÏÏI J
[
ÏÏJ K
$str
ÏÏK X
]
ÏÏX Y
,
ÏÏY Z
Value
ÏÏ[ `
=
ÏÏa b
$str
ÏÏc g
}
ÏÏh i
)
ÏÏi j
;
ÏÏj k
}
ĞĞ 
model
ÒÒ 
.
ÒÒ "
AvailableResizeModes
ÒÒ &
.
ÒÒ& '
Add
ÒÒ' *
(
ÒÒ* +
new
ÒÒ+ .
SelectListItem
ÒÒ/ =
(
ÒÒ= >
)
ÒÒ> ?
{
ÒÒ@ A
Text
ÒÒB F
=
ÒÒG H
S
ÒÒI J
[
ÒÒJ K
$str
ÒÒK Z
]
ÒÒZ [
,
ÒÒ[ \
Value
ÒÒ] b
=
ÒÒc d
(
ÒÒe f
(
ÒÒf g
int
ÒÒg j
)
ÒÒj k

ResizeMode
ÒÒk u
.
ÒÒu v
	Undefined
ÒÒv 
)ÒÒ €
.ÒÒ€ 
ToStringÒÒ ‰
(ÒÒ‰ Š
)ÒÒŠ ‹
}ÒÒŒ 
)ÒÒ 
;ÒÒ 
model
ÓÓ 
.
ÓÓ "
AvailableResizeModes
ÓÓ &
.
ÓÓ& '
Add
ÓÓ' *
(
ÓÓ* +
new
ÓÓ+ .
SelectListItem
ÓÓ/ =
(
ÓÓ= >
)
ÓÓ> ?
{
ÓÓ@ A
Text
ÓÓB F
=
ÓÓG H
S
ÓÓI J
[
ÓÓJ K
$str
ÓÓK P
]
ÓÓP Q
,
ÓÓQ R
Value
ÓÓS X
=
ÓÓY Z
(
ÓÓ[ \
(
ÓÓ\ ]
int
ÓÓ] `
)
ÓÓ` a

ResizeMode
ÓÓa k
.
ÓÓk l
Max
ÓÓl o
)
ÓÓo p
.
ÓÓp q
ToString
ÓÓq y
(
ÓÓy z
)
ÓÓz {
}
ÓÓ| }
)
ÓÓ} ~
;
ÓÓ~ 
model
ÔÔ 
.
ÔÔ "
AvailableResizeModes
ÔÔ &
.
ÔÔ& '
Add
ÔÔ' *
(
ÔÔ* +
new
ÔÔ+ .
SelectListItem
ÔÔ/ =
(
ÔÔ= >
)
ÔÔ> ?
{
ÔÔ@ A
Text
ÔÔB F
=
ÔÔG H
S
ÔÔI J
[
ÔÔJ K
$str
ÔÔK Q
]
ÔÔQ R
,
ÔÔR S
Value
ÔÔT Y
=
ÔÔZ [
(
ÔÔ\ ]
(
ÔÔ] ^
int
ÔÔ^ a
)
ÔÔa b

ResizeMode
ÔÔb l
.
ÔÔl m
Crop
ÔÔm q
)
ÔÔq r
.
ÔÔr s
ToString
ÔÔs {
(
ÔÔ{ |
)
ÔÔ| }
}
ÔÔ~ 
)ÔÔ €
;ÔÔ€ 
model
ÕÕ 
.
ÕÕ "
AvailableResizeModes
ÕÕ &
.
ÕÕ& '
Add
ÕÕ' *
(
ÕÕ* +
new
ÕÕ+ .
SelectListItem
ÕÕ/ =
(
ÕÕ= >
)
ÕÕ> ?
{
ÕÕ@ A
Text
ÕÕB F
=
ÕÕG H
S
ÕÕI J
[
ÕÕJ K
$str
ÕÕK P
]
ÕÕP Q
,
ÕÕQ R
Value
ÕÕS X
=
ÕÕY Z
(
ÕÕ[ \
(
ÕÕ\ ]
int
ÕÕ] `
)
ÕÕ` a

ResizeMode
ÕÕa k
.
ÕÕk l
Pad
ÕÕl o
)
ÕÕo p
.
ÕÕp q
ToString
ÕÕq y
(
ÕÕy z
)
ÕÕz {
}
ÕÕ| }
)
ÕÕ} ~
;
ÕÕ~ 
model
ÖÖ 
.
ÖÖ "
AvailableResizeModes
ÖÖ &
.
ÖÖ& '
Add
ÖÖ' *
(
ÖÖ* +
new
ÖÖ+ .
SelectListItem
ÖÖ/ =
(
ÖÖ= >
)
ÖÖ> ?
{
ÖÖ@ A
Text
ÖÖB F
=
ÖÖG H
S
ÖÖI J
[
ÖÖJ K
$str
ÖÖK S
]
ÖÖS T
,
ÖÖT U
Value
ÖÖV [
=
ÖÖ\ ]
(
ÖÖ^ _
(
ÖÖ_ `
int
ÖÖ` c
)
ÖÖc d

ResizeMode
ÖÖd n
.
ÖÖn o
BoxPad
ÖÖo u
)
ÖÖu v
.
ÖÖv w
ToString
ÖÖw 
(ÖÖ €
)ÖÖ€ 
}ÖÖ‚ ƒ
)ÖÖƒ „
;ÖÖ„ …
model
×× 
.
×× "
AvailableResizeModes
×× &
.
××& '
Add
××' *
(
××* +
new
××+ .
SelectListItem
××/ =
(
××= >
)
××> ?
{
××@ A
Text
××B F
=
××G H
S
××I J
[
××J K
$str
××K P
]
××P Q
,
××Q R
Value
××S X
=
××Y Z
(
××[ \
(
××\ ]
int
××] `
)
××` a

ResizeMode
××a k
.
××k l
Min
××l o
)
××o p
.
××p q
ToString
××q y
(
××y z
)
××z {
}
××| }
)
××} ~
;
××~ 
model
ØØ 
.
ØØ "
AvailableResizeModes
ØØ &
.
ØØ& '
Add
ØØ' *
(
ØØ* +
new
ØØ+ .
SelectListItem
ØØ/ =
(
ØØ= >
)
ØØ> ?
{
ØØ@ A
Text
ØØB F
=
ØØG H
S
ØØI J
[
ØØJ K
$str
ØØK T
]
ØØT U
,
ØØU V
Value
ØØW \
=
ØØ] ^
(
ØØ_ `
(
ØØ` a
int
ØØa d
)
ØØd e

ResizeMode
ØØe o
.
ØØo p
Stretch
ØØp w
)
ØØw x
.
ØØx y
ToStringØØy 
(ØØ ‚
)ØØ‚ ƒ
}ØØ„ …
)ØØ… †
;ØØ† ‡
model
ÛÛ 
.
ÛÛ 
AvailableFormats
ÛÛ "
.
ÛÛ" #
Add
ÛÛ# &
(
ÛÛ& '
new
ÛÛ' *
SelectListItem
ÛÛ+ 9
(
ÛÛ9 :
)
ÛÛ: ;
{
ÛÛ< =
Text
ÛÛ> B
=
ÛÛC D
S
ÛÛE F
[
ÛÛF G
$str
ÛÛG P
]
ÛÛP Q
,
ÛÛQ R
Value
ÛÛS X
=
ÛÛY Z
(
ÛÛ[ \
(
ÛÛ\ ]
int
ÛÛ] `
)
ÛÛ` a
Format
ÛÛa g
.
ÛÛg h
	Undefined
ÛÛh q
)
ÛÛq r
.
ÛÛr s
ToString
ÛÛs {
(
ÛÛ{ |
)
ÛÛ| }
}
ÛÛ~ 
)ÛÛ €
;ÛÛ€ 
model
ÜÜ 
.
ÜÜ 
AvailableFormats
ÜÜ "
.
ÜÜ" #
Add
ÜÜ# &
(
ÜÜ& '
new
ÜÜ' *
SelectListItem
ÜÜ+ 9
(
ÜÜ9 :
)
ÜÜ: ;
{
ÜÜ< =
Text
ÜÜ> B
=
ÜÜC D
S
ÜÜE F
[
ÜÜF G
$str
ÜÜG L
]
ÜÜL M
,
ÜÜM N
Value
ÜÜO T
=
ÜÜU V
(
ÜÜW X
(
ÜÜX Y
int
ÜÜY \
)
ÜÜ\ ]
Format
ÜÜ] c
.
ÜÜc d
Bmp
ÜÜd g
)
ÜÜg h
.
ÜÜh i
ToString
ÜÜi q
(
ÜÜq r
)
ÜÜr s
}
ÜÜt u
)
ÜÜu v
;
ÜÜv w
model
İİ 
.
İİ 
AvailableFormats
İİ "
.
İİ" #
Add
İİ# &
(
İİ& '
new
İİ' *
SelectListItem
İİ+ 9
(
İİ9 :
)
İİ: ;
{
İİ< =
Text
İİ> B
=
İİC D
S
İİE F
[
İİF G
$str
İİG L
]
İİL M
,
İİM N
Value
İİO T
=
İİU V
(
İİW X
(
İİX Y
int
İİY \
)
İİ\ ]
Format
İİ] c
.
İİc d
Gif
İİd g
)
İİg h
.
İİh i
ToString
İİi q
(
İİq r
)
İİr s
}
İİt u
)
İİu v
;
İİv w
model
ŞŞ 
.
ŞŞ 
AvailableFormats
ŞŞ "
.
ŞŞ" #
Add
ŞŞ# &
(
ŞŞ& '
new
ŞŞ' *
SelectListItem
ŞŞ+ 9
(
ŞŞ9 :
)
ŞŞ: ;
{
ŞŞ< =
Text
ŞŞ> B
=
ŞŞC D
S
ŞŞE F
[
ŞŞF G
$str
ŞŞG L
]
ŞŞL M
,
ŞŞM N
Value
ŞŞO T
=
ŞŞU V
(
ŞŞW X
(
ŞŞX Y
int
ŞŞY \
)
ŞŞ\ ]
Format
ŞŞ] c
.
ŞŞc d
Jpg
ŞŞd g
)
ŞŞg h
.
ŞŞh i
ToString
ŞŞi q
(
ŞŞq r
)
ŞŞr s
}
ŞŞt u
)
ŞŞu v
;
ŞŞv w
model
ßß 
.
ßß 
AvailableFormats
ßß "
.
ßß" #
Add
ßß# &
(
ßß& '
new
ßß' *
SelectListItem
ßß+ 9
(
ßß9 :
)
ßß: ;
{
ßß< =
Text
ßß> B
=
ßßC D
S
ßßE F
[
ßßF G
$str
ßßG L
]
ßßL M
,
ßßM N
Value
ßßO T
=
ßßU V
(
ßßW X
(
ßßX Y
int
ßßY \
)
ßß\ ]
Format
ßß] c
.
ßßc d
Png
ßßd g
)
ßßg h
.
ßßh i
ToString
ßßi q
(
ßßq r
)
ßßr s
}
ßßt u
)
ßßu v
;
ßßv w
model
àà 
.
àà 
AvailableFormats
àà "
.
àà" #
Add
àà# &
(
àà& '
new
àà' *
SelectListItem
àà+ 9
(
àà9 :
)
àà: ;
{
àà< =
Text
àà> B
=
ààC D
S
ààE F
[
ààF G
$str
ààG L
]
ààL M
,
ààM N
Value
ààO T
=
ààU V
(
ààW X
(
ààX Y
int
ààY \
)
àà\ ]
Format
àà] c
.
ààc d
Tga
ààd g
)
ààg h
.
ààh i
ToString
àài q
(
ààq r
)
ààr s
}
ààt u
)
ààu v
;
ààv w
}
áá 	
}
ââ 
}ãã ˆ
 D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\AllMediaProfilesDeploymentSource.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{ 
public 

class ,
 AllMediaProfilesDeploymentSource 1
:2 3
IDeploymentSource4 E
{		 
private

 
readonly

  
MediaProfilesManager

 -!
_mediaProfilesManager

. C
;

C D
public ,
 AllMediaProfilesDeploymentSource /
(/ 0 
MediaProfilesManager0 D 
mediaProfilesManagerE Y
)Y Z
{ 	!
_mediaProfilesManager !
=" # 
mediaProfilesManager$ 8
;8 9
} 	
public 
async 
Task &
ProcessDeploymentStepAsync 4
(4 5
DeploymentStep5 C
stepD H
,H I 
DeploymentPlanResultJ ^
result_ e
)e f
{ 	
var  
allMediaProfilesStep $
=% &
step' +
as, .*
AllMediaProfilesDeploymentStep/ M
;M N
if 
(  
allMediaProfilesStep $
==% '
null( ,
), -
{ 
return 
; 
} 
var 
mediaProfiles 
= 
await  %!
_mediaProfilesManager& ;
.; <)
GetMediaProfilesDocumentAsync< Y
(Y Z
)Z [
;[ \
result 
. 
Steps 
. 
Add 
( 
new  
JObject! (
(( )
new 
	JProperty 
( 
$str $
,$ %
$str& 5
)5 6
,6 7
new 
	JProperty 
( 
$str -
,- .
JObject/ 6
.6 7

FromObject7 A
(A B
mediaProfilesB O
.O P
MediaProfilesP ]
)] ^
)^ _
) 
) 
; 
}   	
}!! 
}"" Œ
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\AllMediaProfilesDeploymentStep.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{ 
public 

class *
AllMediaProfilesDeploymentStep /
:0 1
DeploymentStep2 @
{		 
public

 *
AllMediaProfilesDeploymentStep

 -
(

- .
)

. /
{ 	
Name 
= 
$str %
;% &
} 	
} 
} ç
¤D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\AllMediaProfilesDeploymentStepDriver.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{ 
public 

class 0
$AllMediaProfilesDeploymentStepDriver 5
:6 7
DisplayDriver8 E
<E F
DeploymentStepF T
,T U*
AllMediaProfilesDeploymentStepV t
>t u
{ 
public		 
override		 
IDisplayResult		 &
Display		' .
(		. /*
AllMediaProfilesDeploymentStep		/ M
step		N R
)		R S
{

 	
return 
Combine 
( 
View 
( 
$str A
,A B
stepC G
)G H
.H I
LocationI Q
(Q R
$strR [
,[ \
$str] f
)f g
,g h
View 
( 
$str C
,C D
stepE I
)I J
.J K
LocationK S
(S T
$strT _
,_ `
$stra j
)j k
) 
; 
} 	
public 
override 
IDisplayResult &
Edit' +
(+ ,*
AllMediaProfilesDeploymentStep, J
stepK O
)O P
{ 	
return 
View 
( 
$str =
,= >
step? C
)C D
.D E
LocationE M
(M N
$strN W
)W X
;X Y
} 	
} 
} «.
•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\MediaDeploymentSource.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{		 
public

 

class

 !
MediaDeploymentSource

 &
:

' (
IDeploymentSource

) :
{ 
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
public !
MediaDeploymentSource $
($ %
IMediaFileStore% 4
mediaFileStore5 C
)C D
{ 	
_mediaFileStore 
= 
mediaFileStore ,
;, -
} 	
public 
async 
Task &
ProcessDeploymentStepAsync 4
(4 5
DeploymentStep5 C
stepD H
,H I 
DeploymentPlanResultJ ^
result_ e
)e f
{ 	
if 
( 
! 
( 
step 
is 
MediaDeploymentStep -
	mediaStep. 7
)7 8
)8 9
{ 
return 
; 
} 
IAsyncEnumerable 
< 
string #
># $
paths% *
=+ ,
null- 1
;1 2
if 
( 
	mediaStep 
. 

IncludeAll $
)$ %
{ 
paths 
= 
_mediaFileStore '
.' ($
GetDirectoryContentAsync( @
(@ A
nullA E
,E F
trueG K
)K L
.L M
WhereM R
(R S
eS T
=>U W
!X Y
eY Z
.Z [
IsDirectory[ f
)f g
.g h
Selecth n
(n o
eo p
=>q s
et u
.u v
Pathv z
)z {
;{ |
} 
else   
{!! 
paths"" 
="" 
new"" 
List""  
<""  !
string""! '
>""' (
(""( )
	mediaStep"") 2
.""2 3
	FilePaths""3 <
??""= ?
Array""@ E
.""E F
Empty""F K
<""K L
string""L R
>""R S
(""S T
)""T U
)""U V
.""V W
ToAsyncEnumerable""W h
(""h i
)""i j
;""j k
foreach$$ 
($$ 
var$$ 
directoryPath$$ *
in$$+ -
	mediaStep$$. 7
.$$7 8
DirectoryPaths$$8 F
??$$G I
Array$$J O
.$$O P
Empty$$P U
<$$U V
string$$V \
>$$\ ]
($$] ^
)$$^ _
)$$_ `
{%% 
paths&& 
=&& 
paths&& !
.&&! "
Concat&&" (
(&&( )
_mediaFileStore&&) 8
.&&8 9$
GetDirectoryContentAsync&&9 Q
(&&Q R
directoryPath&&R _
,&&_ `
true&&a e
)&&e f
.&&f g
Where&&g l
(&&l m
e&&m n
=>&&o q
!&&r s
e&&s t
.&&t u
IsDirectory	&&u €
)
&&€ 
.
&& ‚
Select
&&‚ ˆ
(
&&ˆ ‰
e
&&‰ Š
=>
&&‹ 
e
&& 
.
&& 
Path
&& ”
)
&&” •
)
&&• –
;
&&– —
}'' 
paths)) 
=)) 
paths)) 
.)) 
OrderBy)) %
())% &
p))& '
=>))( *
p))+ ,
))), -
;))- .
}** 
var,, 
output,, 
=,, 
await,, 
paths,, $
.,,$ %
Select,,% +
(,,+ ,
p,,, -
=>,,. 0
new,,1 4$
MediaDeploymentStepModel,,5 M
{,,N O

SourcePath,,P Z
=,,[ \
p,,] ^
,,,^ _

TargetPath,,` j
=,,k l
p,,m n
},,o p
),,p q
.,,q r
ToArrayAsync,,r ~
(,,~ 
)	,, €
;
,,€ 
foreach.. 
(.. 
var.. 
path.. 
in..  
output..! '
)..' (
{// 
var00 
stream00 
=00 
await00 "
_mediaFileStore00# 2
.002 3
GetFileStreamAsync003 E
(00E F
path00F J
.00J K

SourcePath00K U
)00U V
;00V W
await22 
result22 
.22 
FileBuilder22 (
.22( )
SetFileAsync22) 5
(225 6
path226 :
.22: ;

SourcePath22; E
,22E F
stream22G M
)22M N
;22N O
}33 
result66 
.66 
Steps66 
.66 
Add66 
(66 
new66  
JObject66! (
(66( )
new77 
	JProperty77 
(77 
$str77 $
,77$ %
$str77& -
)77- .
,77. /
new88 
	JProperty88 
(88 
$str88 %
,88% &
JArray88' -
.88- .

FromObject88. 8
(888 9
output889 ?
)88? @
)88@ A
)99 
)99 
;99 
}:: 	
private<< 
class<< $
MediaDeploymentStepModel<< .
{== 	
public>> 
string>> 

SourcePath>> $
{>>% &
get>>' *
;>>* +
set>>, /
;>>/ 0
}>>1 2
public?? 
string?? 

TargetPath?? $
{??% &
get??' *
;??* +
set??, /
;??/ 0
}??1 2
}@@ 	
}AA 
}BB ²	
“D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\MediaDeploymentStep.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{ 
public 

class 
MediaDeploymentStep $
:% &
DeploymentStep' 5
{		 
public

 
MediaDeploymentStep

 "
(

" #
)

# $
{ 	
Name 
= 
$str 
; 
} 	
public 
bool 

IncludeAll 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
true/ 3
;3 4
public 
string 
[ 
] 
	FilePaths !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
[ 
] 
DirectoryPaths &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} Ì4
™D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Deployment\MediaDeploymentStepDriver.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Deployment &
{ 
public 

class %
MediaDeploymentStepDriver *
:+ ,
DisplayDriver- :
<: ;
DeploymentStep; I
,I J
MediaDeploymentStepK ^
>^ _
{ 
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
public %
MediaDeploymentStepDriver (
(( )
IMediaFileStore) 8
mediaFileStore9 G
)G H
{ 	
_mediaFileStore 
= 
mediaFileStore ,
;, -
} 	
public 
override 
IDisplayResult &
Display' .
(. /
MediaDeploymentStep/ B
stepC G
)G H
{ 	
return 
Combine 
( 
View 
( 
$str =
,= >
step? C
)C D
.D E
LocationE M
(M N
$strN W
,W X
$strY b
)b c
,c d
View 
( 
$str ?
,? @
stepA E
)E F
.F G
LocationG O
(O P
$strP [
,[ \
$str] f
)f g
) 
; 
} 	
public   
override   
IDisplayResult   &
Edit  ' +
(  + ,
MediaDeploymentStep  , ?
step  @ D
)  D E
{!! 	
return"" 

Initialize"" 
<"" (
MediaDeploymentStepViewModel"" :
>"": ;
(""; <
$str""< ]
,""] ^
async""_ d
model""e j
=>""k m
{## 
model$$ 
.$$ 

IncludeAll$$  
=$$! "
step$$# '
.$$' (

IncludeAll$$( 2
;$$2 3
model%% 
.%% 
	FilePaths%% 
=%%  !
step%%" &
.%%& '
	FilePaths%%' 0
;%%0 1
model&& 
.&& 
DirectoryPaths&& $
=&&% &
step&&' +
.&&+ ,
DirectoryPaths&&, :
;&&: ;
model'' 
.'' 
Entries'' 
='' 
await''  % 
GetMediaStoreEntries''& :
('': ;
)''; <
;''< =
}(( 
)(( 
.(( 
Location(( 
((( 
$str(( !
)((! "
;((" #
})) 	
public++ 
override++ 
async++ 
Task++ "
<++" #
IDisplayResult++# 1
>++1 2
UpdateAsync++3 >
(++> ?
MediaDeploymentStep++? R
step++S W
,++W X
IUpdateModel++Y e
updater++f m
)++m n
{,, 	
step-- 
.-- 
	FilePaths-- 
=-- 
Array-- "
.--" #
Empty--# (
<--( )
string--) /
>--/ 0
(--0 1
)--1 2
;--2 3
step.. 
... 
DirectoryPaths.. 
=..  !
Array.." '
...' (
Empty..( -
<..- .
string... 4
>..4 5
(..5 6
)..6 7
;..7 8
await00 
updater00 
.00 
TryUpdateModelAsync00 -
(00- .
step00. 2
,002 3
Prefix11. 4
,114 5
x22. /
=>220 2
x223 4
.224 5
	FilePaths225 >
,22> ?
x33. /
=>330 2
x333 4
.334 5
DirectoryPaths335 C
,33C D
x44. /
=>440 2
x443 4
.444 5

IncludeAll445 ?
)44? @
;44@ A
if77 
(77 
step77 
.77 

IncludeAll77 
)77  
{88 
step99 
.99 
	FilePaths99 
=99  
Array99! &
.99& '
Empty99' ,
<99, -
string99- 3
>993 4
(994 5
)995 6
;996 7
step:: 
.:: 
DirectoryPaths:: #
=::$ %
Array::& +
.::+ ,
Empty::, 1
<::1 2
string::2 8
>::8 9
(::9 :
)::: ;
;::; <
};; 
return== 
Edit== 
(== 
step== 
)== 
;== 
}>> 	
private@@ 
async@@ 
Task@@ 
<@@ 
IList@@  
<@@  !$
MediaStoreEntryViewModel@@! 9
>@@9 :
>@@: ; 
GetMediaStoreEntries@@< P
(@@P Q
string@@Q W
path@@X \
=@@] ^
null@@_ c
,@@c d$
MediaStoreEntryViewModel@@e }
parent	@@~ „
=
@@… †
null
@@‡ ‹
)
@@‹ Œ
{AA 	
varBB 
mediaStoreEntriesBB !
=BB" #
awaitBB$ )
_mediaFileStoreBB* 9
.BB9 :$
GetDirectoryContentAsyncBB: R
(BBR S
pathBBS W
)BBW X
.CC 
SelectAwaitCC 
(CC 
asyncCC "
eCC# $
=>CC% '
{DD 
varEE 
mediaStoreEntryEE '
=EE( )
newEE* -$
MediaStoreEntryViewModelEE. F
{FF 
NameGG 
=GG 
eGG  
.GG  !
NameGG! %
,GG% &
PathHH 
=HH 
eHH  
.HH  !
PathHH! %
,HH% &
ParentII 
=II  
parentII! '
}JJ 
;JJ 
mediaStoreEntryLL #
.LL# $
EntriesLL$ +
=LL, -
eLL. /
.LL/ 0
IsDirectoryLL0 ;
?MM 
awaitMM  
GetMediaStoreEntriesMM  4
(MM4 5
eMM5 6
.MM6 7
PathMM7 ;
,MM; <
mediaStoreEntryMM= L
)MML M
:NN 
ArrayNN 
.NN  
EmptyNN  %
<NN% &$
MediaStoreEntryViewModelNN& >
>NN> ?
(NN? @
)NN@ A
;NNA B
returnPP 
mediaStoreEntryPP *
;PP* +
}QQ 
)QQ 
.QQ 
ToListAsyncQQ 
(QQ 
)QQ  
;QQ  !
returnSS 
mediaStoreEntriesSS $
;SS$ %
}TT 	
}UU 
}VV }
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Drivers\MediaFieldDriver.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Drivers #
{ 
public 

class #
MediaFieldDisplayDriver (
:) *%
ContentFieldDisplayDriver+ D
<D E

MediaFieldE O
>O P
{ 
private 
static 
readonly "
JsonSerializerSettings  6
Settings7 ?
=@ A
newB E"
JsonSerializerSettingsF \
{ 	
ContractResolver 
= 
new "2
&CamelCasePropertyNamesContractResolver# I
(I J
)J K
} 	
;	 

private 
readonly )
AttachedMediaFieldFileService 6*
_attachedMediaFieldFileService7 U
;U V
private 
readonly 
IStringLocalizer )
S* +
;+ ,
private 
readonly 
ILogger  
_logger! (
;( )
public!! #
MediaFieldDisplayDriver!! &
(!!& ')
AttachedMediaFieldFileService!!' D)
attachedMediaFieldFileService!!E b
,!!b c
IStringLocalizer"" 
<"" #
MediaFieldDisplayDriver"" 4
>""4 5
	localizer""6 ?
,""? @
ILogger## 
<## #
MediaFieldDisplayDriver## +
>##+ ,
logger##- 3
)##3 4
{$$ 	*
_attachedMediaFieldFileService%% *
=%%+ ,)
attachedMediaFieldFileService%%- J
;%%J K
S&& 
=&& 
	localizer&& 
;&& 
_logger'' 
='' 
logger'' 
;'' 
}(( 	
public** 
override** 
IDisplayResult** &
Display**' .
(**. /

MediaField**/ 9
field**: ?
,**? @$
BuildFieldDisplayContext**A Y
context**Z a
)**a b
{++ 	
return,, 

Initialize,, 
<,, &
DisplayMediaFieldViewModel,, 8
>,,8 9
(,,9 :
GetDisplayShapeType,,: M
(,,M N
context,,N U
),,U V
,,,V W
model,,X ]
=>,,^ `
{-- 
model.. 
... 
Field.. 
=.. 
field.. #
;..# $
model// 
.// 
Part// 
=// 
context// $
.//$ %
ContentPart//% 0
;//0 1
model00 
.00 
PartFieldDefinition00 )
=00* +
context00, 3
.003 4
PartFieldDefinition004 G
;00G H
}11 
)11 
.22 
Location22 
(22 
$str22 
,22 
$str22  )
)22) *
.33 
Location33 
(33 
$str33 
,33  
$str33! *
)33* +
;33+ ,
}44 	
public66 
override66 
IDisplayResult66 &
Edit66' +
(66+ ,

MediaField66, 6
field667 <
,66< =#
BuildFieldEditorContext66> U
context66V ]
)66] ^
{77 	
var88 
	itemPaths88 
=88 
field88 !
.88! "
Paths88" '
?88' (
.88( )
ToList88) /
(88/ 0
)880 1
.881 2
Select882 8
(888 9
p889 :
=>88; =
new88> A"
EditMediaFieldItemInfo88B X
{88Y Z
Path88[ _
=88` a
p88b c
}88d e
)88e f
.88f g
ToArray88g n
(88n o
)88o p
??88q s
Array88t y
.88y z
Empty88z 
<	88 €$
EditMediaFieldItemInfo
88€ –
>
88– —
(
88— ˜
)
88˜ ™
;
88™ š
return:: 

Initialize:: 
<:: #
EditMediaFieldViewModel:: 5
>::5 6
(::6 7
GetEditorShapeType::7 I
(::I J
context::J Q
)::Q R
,::R S
model::T Y
=>::Z \
{;; 
var<< 
settings<< 
=<< 
context<< &
.<<& '
PartFieldDefinition<<' :
.<<: ;
GetSettings<<; F
<<<F G
MediaFieldSettings<<G Y
><<Y Z
(<<Z [
)<<[ \
;<<\ ]
if== 
(== 
settings== 
.== 
AllowMediaText== +
)==+ ,
{>> 
if?? 
(?? 
field?? 
.?? 

MediaTexts?? (
!=??) +
null??, 0
)??0 1
{@@ 
forAA 
(AA 
varAA 
iAA  !
=AA" #
$numAA$ %
;AA% &
iAA' (
<AA) *
	itemPathsAA+ 4
.AA4 5
CountAA5 :
(AA: ;
)AA; <
;AA< =
iAA> ?
++AA? A
)AAA B
{BB 
ifCC 
(CC  
iCC  !
>=CC" $
$numCC% &
&&CC' )
iCC* +
<CC, -
fieldCC. 3
.CC3 4

MediaTextsCC4 >
.CC> ?
LengthCC? E
)CCE F
{DD 
	itemPathsEE  )
[EE) *
iEE* +
]EE+ ,
.EE, -
	MediaTextEE- 6
=EE7 8
fieldEE9 >
.EE> ?

MediaTextsEE? I
[EEI J
iEEJ K
]EEK L
;EEL M
}FF 
}GG 
}HH 
}II 
ifKK 
(KK 
settingsKK 
.KK 
AllowAnchorsKK )
)KK) *
{LL 
varMM 
anchorsMM 
=MM  !
fieldMM" '
.MM' (

GetAnchorsMM( 2
(MM2 3
)MM3 4
;MM4 5
ifNN 
(NN 
anchorsNN 
!=NN  "
nullNN# '
)NN' (
{OO 
forPP 
(PP 
varPP 
iPP  !
=PP" #
$numPP$ %
;PP% &
iPP' (
<PP) *
	itemPathsPP+ 4
.PP4 5
CountPP5 :
(PP: ;
)PP; <
;PP< =
iPP> ?
++PP? A
)PPA B
{QQ 
ifRR 
(RR  
iRR  !
>=RR" $
$numRR% &
&&RR' )
iRR* +
<RR, -
anchorsRR. 5
.RR5 6
LengthRR6 <
)RR< =
{SS 
	itemPathsTT  )
[TT) *
iTT* +
]TT+ ,
.TT, -
AnchorTT- 3
=TT4 5
anchorsTT6 =
[TT= >
iTT> ?
]TT? @
;TT@ A
}UU 
}VV 
}WW 
}XX 
modelZZ 
.ZZ 
PathsZZ 
=ZZ 
JsonConvertZZ )
.ZZ) *
SerializeObjectZZ* 9
(ZZ9 :
	itemPathsZZ: C
,ZZC D
SettingsZZE M
)ZZM N
;ZZN O
model[[ 
.[[ 
TempUploadFolder[[ &
=[[' (*
_attachedMediaFieldFileService[[) G
.[[G H$
MediaFieldsTempSubFolder[[H `
;[[` a
model\\ 
.\\ 
Field\\ 
=\\ 
field\\ #
;\\# $
model]] 
.]] 
Part]] 
=]] 
context]] $
.]]$ %
ContentPart]]% 0
;]]0 1
model^^ 
.^^ 
PartFieldDefinition^^ )
=^^* +
context^^, 3
.^^3 4
PartFieldDefinition^^4 G
;^^G H
model__ 
.__ 
AllowMediaText__ $
=__% &
settings__' /
.__/ 0
AllowMediaText__0 >
;__> ?
}`` 
)`` 
;`` 
}aa 	
publiccc 
overridecc 
asynccc 
Taskcc "
<cc" #
IDisplayResultcc# 1
>cc1 2
UpdateAsynccc3 >
(cc> ?

MediaFieldcc? I
fieldccJ O
,ccO P
IUpdateModelccQ ]
updatercc^ e
,cce f$
UpdateFieldEditorContextccg 
context
cc€ ‡
)
cc‡ ˆ
{dd 	
varee 
modelee 
=ee 
newee #
EditMediaFieldViewModelee 3
(ee3 4
)ee4 5
;ee5 6
ifgg 
(gg 
awaitgg 
updatergg 
.gg 
TryUpdateModelAsyncgg 1
(gg1 2
modelgg2 7
,gg7 8
Prefixgg9 ?
,gg? @
fggA B
=>ggC E
fggF G
.ggG H
PathsggH M
)ggM N
)ggN O
{hh 
varjj 
itemsjj 
=jj 
stringjj "
.jj" #
IsNullOrWhiteSpacejj# 5
(jj5 6
modeljj6 ;
.jj; <
Pathsjj< A
)jjA B
?kk 
newkk 
Listkk 
<kk "
EditMediaFieldItemInfokk 5
>kk5 6
(kk6 7
)kk7 8
:ll 
JsonConvertll !
.ll! "
DeserializeObjectll" 3
<ll3 4"
EditMediaFieldItemInfoll4 J
[llJ K
]llK L
>llL M
(llM N
modelllN S
.llS T
PathsllT Y
,llY Z
Settingsll[ c
)llc d
.lld e
ToListlle k
(llk l
)lll m
;llm n
ifoo 
(oo 
stringoo 
.oo 
Equalsoo !
(oo! "
contextoo" )
.oo) *
PartFieldDefinitionoo* =
.oo= >
Editoroo> D
(ooD E
)ooE F
,ooF G
$strooH R
,ooR S
StringComparisonooT d
.ood e
OrdinalIgnoreCaseooe v
)oov w
)oow x
{pp 
tryqq 
{rr 
awaitss *
_attachedMediaFieldFileServicess <
.ss< =)
HandleFilesOnFieldUpdateAsyncss= Z
(ssZ [
itemsss[ `
,ss` a
contextssb i
.ssi j
ContentPartssj u
.ssu v
ContentItem	ssv 
)
ss ‚
;
ss‚ ƒ
}tt 
catchuu 
(uu 
	Exceptionuu $
euu% &
)uu& '
{vv 
updaterww 
.ww  

ModelStateww  *
.ww* +
AddModelErrorww+ 8
(ww8 9
Prefixww9 ?
,ww? @
nameofwwA G
(wwG H
modelwwH M
.wwM N
PathswwN S
)wwS T
,wwT U
SwwV W
[wwW X
$str	wwX …
,
ww… †
context
ww‡ 
.
ww !
PartFieldDefinition
ww ¢
.
ww¢ £
DisplayName
ww£ ®
(
ww® ¯
)
ww¯ °
]
ww° ±
)
ww± ²
;
ww² ³
_loggerxx 
.xx  
LogErrorxx  (
(xx( )
exx) *
,xx* +
$strxx, e
,xxe f
contextxxg n
.xxn o 
PartFieldDefinition	xxo ‚
.
xx‚ ƒ
DisplayName
xxƒ 
(
xx 
)
xx 
)
xx ‘
;
xx‘ ’
}yy 
}zz 
field|| 
.|| 
Paths|| 
=|| 
items|| #
.||# $
Where||$ )
(||) *
p||* +
=>||, .
!||/ 0
p||0 1
.||1 2
	IsRemoved||2 ;
)||; <
.||< =
Select||= C
(||C D
p||D E
=>||F H
p||I J
.||J K
Path||K O
)||O P
.||P Q
ToArray||Q X
(||X Y
)||Y Z
??||[ ]
new||^ a
string||b h
[||h i
]||i j
{||k l
}||m n
;||n o
var~~ 
settings~~ 
=~~ 
context~~ &
.~~& '
PartFieldDefinition~~' :
.~~: ;
GetSettings~~; F
<~~F G
MediaFieldSettings~~G Y
>~~Y Z
(~~Z [
)~~[ \
;~~\ ]
if
€€ 
(
€€ 
settings
€€ 
.
€€ 
Required
€€ %
&&
€€& (
field
€€) .
.
€€. /
Paths
€€/ 4
.
€€4 5
Length
€€5 ;
<
€€< =
$num
€€> ?
)
€€? @
{
 
updater
‚‚ 
.
‚‚ 

ModelState
‚‚ &
.
‚‚& '
AddModelError
‚‚' 4
(
‚‚4 5
Prefix
‚‚5 ;
,
‚‚; <
nameof
‚‚= C
(
‚‚C D
model
‚‚D I
.
‚‚I J
Paths
‚‚J O
)
‚‚O P
,
‚‚P Q
S
‚‚R S
[
‚‚S T
$str
‚‚T o
,
‚‚o p
context
‚‚q x
.
‚‚x y"
PartFieldDefinition‚‚y Œ
.‚‚Œ 
DisplayName‚‚ ˜
(‚‚˜ ™
)‚‚™ š
]‚‚š ›
)‚‚› œ
;‚‚œ 
}
ƒƒ 
if
…… 
(
…… 
field
…… 
.
…… 
Paths
…… 
.
……  
Length
……  &
>
……' (
$num
……) *
&&
……+ -
!
……. /
settings
……/ 7
.
……7 8
Multiple
……8 @
)
……@ A
{
†† 
updater
‡‡ 
.
‡‡ 

ModelState
‡‡ &
.
‡‡& '
AddModelError
‡‡' 4
(
‡‡4 5
Prefix
‡‡5 ;
,
‡‡; <
nameof
‡‡= C
(
‡‡C D
model
‡‡D I
.
‡‡I J
Paths
‡‡J O
)
‡‡O P
,
‡‡P Q
S
‡‡R S
[
‡‡S T
$str‡‡T 
,‡‡ ‚
context‡‡ƒ Š
.‡‡Š ‹#
PartFieldDefinition‡‡‹ 
.‡‡ Ÿ
DisplayName‡‡Ÿ ª
(‡‡ª «
)‡‡« ¬
]‡‡¬ ­
)‡‡­ ®
;‡‡® ¯
}
ˆˆ 
if
ŠŠ 
(
ŠŠ 
settings
ŠŠ 
.
ŠŠ 
AllowMediaText
ŠŠ +
)
ŠŠ+ ,
{
‹‹ 
field
ŒŒ 
.
ŒŒ 

MediaTexts
ŒŒ $
=
ŒŒ% &
items
ŒŒ' ,
.
ŒŒ, -
Select
ŒŒ- 3
(
ŒŒ3 4
t
ŒŒ4 5
=>
ŒŒ6 8
t
ŒŒ9 :
.
ŒŒ: ;
	MediaText
ŒŒ; D
)
ŒŒD E
.
ŒŒE F
ToArray
ŒŒF M
(
ŒŒM N
)
ŒŒN O
;
ŒŒO P
}
 
else
 
{
 
field
 
.
 

MediaTexts
 $
=
% &
Array
' ,
.
, -
Empty
- 2
<
2 3
string
3 9
>
9 :
(
: ;
)
; <
;
< =
}
‘‘ 
if
““ 
(
““ 
settings
““ 
.
““ 
AllowAnchors
““ )
)
““) *
{
”” 
field
•• 
.
•• 

SetAnchors
•• $
(
••$ %
items
••% *
.
••* +
Select
••+ 1
(
••1 2
t
••2 3
=>
••4 6
t
••7 8
.
••8 9
Anchor
••9 ?
)
••? @
.
••@ A
ToArray
••A H
(
••H I
)
••I J
)
••J K
;
••K L
}
–– 
else
—— 
if
—— 
(
—— 
field
—— 
.
—— 
Content
—— &
.
——& '
ContainsKey
——' 2
(
——2 3
$str
——3 <
)
——< =
)
——= >
{
˜˜ 
field
™™ 
.
™™ 
Content
™™ !
.
™™! "
Remove
™™" (
(
™™( )
$str
™™) 2
)
™™2 3
;
™™3 4
}
šš 
}
œœ 
return
 
Edit
 
(
 
field
 
,
 
context
 &
)
& '
;
' (
}
ŸŸ 	
}
   
}¡¡ ó
‚D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Fields\Anchor.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Fields "
{ 
public		 

class		 
Anchor		 
{

 
public 
float 
X 
{ 
get 
; 
set !
;! "
}# $
=% &
$num' +
;+ ,
public 
float 
Y 
{ 
get 
; 
set !
;! "
}# $
=% &
$num' +
;+ ,
} 
} 
†D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Fields\MediaField.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Fields "
{ 
public 

class 

MediaField 
: 
ContentField *
{ 
public 
string 
[ 
] 
Paths 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
[ 
] 

MediaTexts "
{# $
get% (
;( )
set* -
;- .
}/ 0
}		 
}

 ®
–D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Fields\MediaFieldAnchorExtensions.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Fields "
{ 
public 

static 
class &
MediaFieldAnchorExtensions 2
{ 
public 
static 
Anchor 
[ 
] 

GetAnchors )
() *
this* .

MediaField/ 9

mediaField: D
)D E
{ 	
var 
anchors 
= 

mediaField $
.$ %
Content% ,
[, -
$str- 6
]6 7
as8 :
JArray; A
;A B
return 
anchors 
!= 
null "
?# $
anchors% ,
., -
ToObject- 5
<5 6
Anchor6 <
[< =
]= >
>> ?
(? @
)@ A
:B C
ArrayD I
.I J
EmptyJ O
<O P
AnchorP V
>V W
(W X
)X Y
;Y Z
} 	
public 
static 
void 

SetAnchors %
(% &
this& *

MediaField+ 5

mediaField6 @
,@ A
AnchorB H
[H I
]I J
anchorsK R
)R S
{ 	

mediaField 
. 
Content 
[ 
$str (
]( )
=* +
JArray, 2
.2 3

FromObject3 =
(= >
anchors> E
)E F
;F G
} 	
} 
} ¢€
‰D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Filters\MediaFilters.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Filters #
{ 
public 

class 
MediaUrlFilter 
:  !
ILiquidFilter" /
{ 
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
public 
MediaUrlFilter 
( 
IMediaFileStore -
mediaFileStore. <
)< =
{ 	
_mediaFileStore 
= 
mediaFileStore ,
;, -
} 	
public 
	ValueTask 
< 

FluidValue #
># $
ProcessAsync% 1
(1 2

FluidValue2 <
input= B
,B C
FilterArgumentsD S
	argumentsT ]
,] ^
TemplateContext_ n
ctxo r
)r s
{ 	
var 
url 
= 
input 
. 
ToStringValue )
() *
)* +
;+ ,
var 
imageUrl 
= 
_mediaFileStore *
.* +
MapPathToPublicUrl+ =
(= >
url> A
)A B
;B C
return   
new   
	ValueTask    
<    !

FluidValue  ! +
>  + ,
(  , -
new  - 0
StringValue  1 <
(  < =
imageUrl  = E
??  F H
url  I L
)  L M
)  M N
;  N O
}!! 	
}"" 
public$$ 

class$$ 
ImageTagFilter$$ 
:$$  !
ILiquidFilter$$" /
{%% 
public&& 
	ValueTask&& 
<&& 

FluidValue&& #
>&&# $
ProcessAsync&&% 1
(&&1 2

FluidValue&&2 <
input&&= B
,&&B C
FilterArguments&&D S
	arguments&&T ]
,&&] ^
TemplateContext&&_ n
ctx&&o r
)&&r s
{'' 	
var(( 
url(( 
=(( 
input(( 
.(( 
ToStringValue(( )
((() *
)((* +
;((+ ,
var** 
imgTag** 
=** 
$"** 
<img src=\"** &
{**& '
url**' *
}*** +
\"**+ -
"**- .
;**. /
foreach,, 
(,, 
var,, 
name,, 
in,,  
	arguments,,! *
.,,* +
Names,,+ 0
),,0 1
{-- 
imgTag.. 
+=.. 
$".. 
{.. 
name.. "
..." #
Replace..# *
(..* +
$char..+ .
,... /
$char..0 3
)..3 4
}..4 5
=\"..5 8
{..8 9
	arguments..9 B
[..B C
name..C G
]..G H
...H I
ToStringValue..I V
(..V W
)..W X
}..X Y
\"..Y [
"..[ \
;..\ ]
}// 
imgTag11 
+=11 
$str11 
;11 
return33 
new33 
	ValueTask33  
<33  !

FluidValue33! +
>33+ ,
(33, -
new33- 0
StringValue331 <
(33< =
imgTag33= C
)33C D
{33E F
Encode33G M
=33N O
false33P U
}33V W
)33W X
;33X Y
}44 	
}55 
public77 

class77 
ResizeUrlFilter77  
:77! "
ILiquidFilter77# 0
{88 
public99 
async99 
	ValueTask99 
<99 

FluidValue99 )
>99) *
ProcessAsync99+ 7
(997 8

FluidValue998 B
input99C H
,99H I
FilterArguments99J Y
	arguments99Z c
,99c d
TemplateContext99e t
ctx99u x
)99x y
{:: 	
var;; 
url;; 
=;; 
input;; 
.;; 
ToStringValue;; )
(;;) *
);;* +
;;;+ ,
IDictionary== 
<== 
string== 
,== 
string==  &
>==& '
queryStringParams==( 9
===: ;
null==< @
;==@ A
if>> 
(>> 
!>> 
ctx>> 
.>> 
AmbientValues>> "
.>>" #
TryGetValue>># .
(>>. /
$str>>/ 9
,>>9 :
out>>; >
var>>? B
services>>C K
)>>K L
)>>L M
{?? 
throw@@ 
new@@ 
ArgumentException@@ +
(@@+ ,
$str@@, Z
)@@Z [
;@@[ \
}AA 
varCC 
serviceProviderCC 
=CC  !
(CC" #
(CC# $
IServiceProviderCC$ 4
)CC4 5
servicesCC5 =
)CC= >
;CC> ?
varFF 
profileFF 
=FF 
	argumentsFF #
[FF# $
$strFF$ -
]FF- .
;FF. /
ifHH 
(HH 
!HH 
profileHH 
.HH 
IsNilHH 
(HH 
)HH  
)HH  !
{II 
varJJ 
mediaProfileServiceJJ '
=JJ( )
serviceProviderJJ* 9
.JJ9 :
GetRequiredServiceJJ: L
<JJL M 
IMediaProfileServiceJJM a
>JJa b
(JJb c
)JJc d
;JJd e
queryStringParamsKK !
=KK" #
awaitKK$ )
mediaProfileServiceKK* =
.KK= >#
GetMediaProfileCommandsKK> U
(KKU V
profileKKV ]
.KK] ^
ToStringValueKK^ k
(KKk l
)KKl m
)KKm n
;KKn o
varNN 
widthNN 
=NN 
	argumentsNN %
[NN% &
$strNN& -
]NN- .
;NN. /
varOO 
heightOO 
=OO 
	argumentsOO &
[OO& '
$strOO' /
]OO/ 0
;OO0 1
varPP 
modePP 
=PP 
	argumentsPP $
[PP$ %
$strPP% +
]PP+ ,
;PP, -
varQQ 
qualityQQ 
=QQ 
	argumentsQQ '
[QQ' (
$strQQ( 1
]QQ1 2
;QQ2 3
varRR 
formatRR 
=RR 
	argumentsRR &
[RR& '
$strRR' /
]RR/ 0
;RR0 1
varSS 
anchorSS 
=SS 
	argumentsSS &
[SS& '
$strSS' /
]SS/ 0
;SS0 1
varTT 
bgcolorTT 
=TT 
	argumentsTT '
[TT' (
$strTT( 1
]TT1 2
;TT2 3"
ApplyQueryStringParamsVV &
(VV& '
queryStringParamsVV' 8
,VV8 9
widthVV: ?
,VV? @
heightVVA G
,VVG H
modeVVI M
,VVM N
qualityVVO V
,VVV W
formatVVX ^
,VV^ _
anchorVV` f
,VVf g
bgcolorVVh o
)VVo p
;VVp q
}WW 
elseXX 
{YY 
queryStringParamsZZ !
=ZZ" #
newZZ$ '

DictionaryZZ( 2
<ZZ2 3
stringZZ3 9
,ZZ9 :
stringZZ; A
>ZZA B
(ZZB C
)ZZC D
;ZZD E
var\\ 
useNamed\\ 
=\\ 
	arguments\\ (
.\\( )
Names\\) .
.\\. /
Any\\/ 2
(\\2 3
)\\3 4
;\\4 5
var^^ 
width^^ 
=^^ 
useNamed^^ $
?^^% &
	arguments^^' 0
[^^0 1
$str^^1 8
]^^8 9
:^^: ;
	arguments^^< E
.^^E F
At^^F H
(^^H I
$num^^I J
)^^J K
;^^K L
var__ 
height__ 
=__ 
useNamed__ %
?__& '
	arguments__( 1
[__1 2
$str__2 :
]__: ;
:__< =
	arguments__> G
.__G H
At__H J
(__J K
$num__K L
)__L M
;__M N
var`` 
mode`` 
=`` 
useNamed`` #
?``$ %
	arguments``& /
[``/ 0
$str``0 6
]``6 7
:``8 9
	arguments``: C
.``C D
At``D F
(``F G
$num``G H
)``H I
;``I J
varaa 
qualityaa 
=aa 
useNamedaa &
?aa' (
	argumentsaa) 2
[aa2 3
$straa3 <
]aa< =
:aa> ?
	argumentsaa@ I
.aaI J
AtaaJ L
(aaL M
$numaaM N
)aaN O
;aaO P
varbb 
formatbb 
=bb 
useNamedbb %
?bb& '
	argumentsbb( 1
[bb1 2
$strbb2 :
]bb: ;
:bb< =
	argumentsbb> G
.bbG H
AtbbH J
(bbJ K
$numbbK L
)bbL M
;bbM N
varcc 
anchorcc 
=cc 
useNamedcc %
?cc& '
	argumentscc( 1
[cc1 2
$strcc2 :
]cc: ;
:cc< =
	argumentscc> G
.ccG H
AtccH J
(ccJ K
$numccK L
)ccL M
;ccM N
vardd 
bgcolordd 
=dd 
useNameddd &
?dd' (
	argumentsdd) 2
[dd2 3
$strdd3 <
]dd< =
:dd> ?
	argumentsdd@ I
.ddI J
AtddJ L
(ddL M
$numddM N
)ddN O
;ddO P"
ApplyQueryStringParamsff &
(ff& '
queryStringParamsff' 8
,ff8 9
widthff: ?
,ff? @
heightffA G
,ffG H
modeffI M
,ffM N
qualityffO V
,ffV W
formatffX ^
,ff^ _
anchorff` f
,fff g
bgcolorffh o
)ffo p
;ffp q
}gg 
varii 

resizedUrlii 
=ii 
QueryHelpersii )
.ii) *
AddQueryStringii* 8
(ii8 9
urlii9 <
,ii< =
queryStringParamsii> O
)iiO P
;iiP Q
varkk 
mediaOptionskk 
=kk 
serviceProviderkk .
.kk. /
GetRequiredServicekk/ A
<kkA B
IOptionskkB J
<kkJ K
MediaOptionskkK W
>kkW X
>kkX Y
(kkY Z
)kkZ [
.kk[ \
Valuekk\ a
;kka b
ifmm 
(mm 
mediaOptionsmm 
.mm #
UseTokenizedQueryStringmm 4
)mm4 5
{nn 
varoo 
mediaTokenServiceoo %
=oo& '
serviceProvideroo( 7
.oo7 8
GetRequiredServiceoo8 J
<ooJ K
IMediaTokenServiceooK ]
>oo] ^
(oo^ _
)oo_ `
;oo` a

resizedUrlpp 
=pp 
mediaTokenServicepp .
.pp. /
AddTokenToPathpp/ =
(pp= >

resizedUrlpp> H
)ppH I
;ppI J
}qq 
returnss 
newss 
StringValuess "
(ss" #

resizedUrlss# -
)ss- .
;ss. /
}tt 	
privatevv 
staticvv 
voidvv "
ApplyQueryStringParamsvv 2
(vv2 3
IDictionaryvv3 >
<vv> ?
stringvv? E
,vvE F
stringvvG M
>vvM N
queryStringParamsvvO `
,vv` a

FluidValuevvb l
widthvvm r
,vvr s

FluidValuevvt ~
height	vv …
,
vv… †

FluidValue
vv‡ ‘
mode
vv’ –
,
vv– —

FluidValue
vv˜ ¢
quality
vv£ ª
,
vvª «

FluidValue
vv¬ ¶
format
vv· ½
,
vv½ ¾

FluidValue
vv¿ É
anchorValue
vvÊ Õ
,
vvÕ Ö

FluidValue
vv× á
bgcolor
vvâ é
)
vvé ê
{ww 	
ifxx 
(xx 
!xx 
widthxx 
.xx 
IsNilxx 
(xx 
)xx 
)xx 
{yy 
queryStringParamszz !
[zz! "
$strzz" )
]zz) *
=zz+ ,
widthzz- 2
.zz2 3
ToStringValuezz3 @
(zz@ A
)zzA B
;zzB C
}{{ 
if}} 
(}} 
!}} 
height}} 
.}} 
IsNil}} 
(}} 
)}} 
)}}  
{~~ 
queryStringParams !
[! "
$str" *
]* +
=, -
height. 4
.4 5
ToStringValue5 B
(B C
)C D
;D E
}
€€ 
if
‚‚ 
(
‚‚ 
!
‚‚ 
mode
‚‚ 
.
‚‚ 
IsNil
‚‚ 
(
‚‚ 
)
‚‚ 
)
‚‚ 
{
ƒƒ 
queryStringParams
„„ !
[
„„! "
$str
„„" )
]
„„) *
=
„„+ ,
mode
„„- 1
.
„„1 2
ToStringValue
„„2 ?
(
„„? @
)
„„@ A
;
„„A B
}
…… 
if
‡‡ 
(
‡‡ 
!
‡‡ 
quality
‡‡ 
.
‡‡ 
IsNil
‡‡ 
(
‡‡ 
)
‡‡  
)
‡‡  !
{
ˆˆ 
queryStringParams
‰‰ !
[
‰‰! "
$str
‰‰" +
]
‰‰+ ,
=
‰‰- .
quality
‰‰/ 6
.
‰‰6 7
ToStringValue
‰‰7 D
(
‰‰D E
)
‰‰E F
;
‰‰F G
}
ŠŠ 
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
format
ŒŒ 
.
ŒŒ 
IsNil
ŒŒ 
(
ŒŒ 
)
ŒŒ 
)
ŒŒ  
{
 
queryStringParams
 !
[
! "
$str
" *
]
* +
=
, -
format
. 4
.
4 5
ToStringValue
5 B
(
B C
)
C D
;
D E
}
 
if
‘‘ 
(
‘‘ 
!
‘‘ 
anchorValue
‘‘ 
.
‘‘ 
IsNil
‘‘ "
(
‘‘" #
)
‘‘# $
)
‘‘$ %
{
’’ 
var
““ 
obj
““ 
=
““ 
anchorValue
““ %
.
““% &
ToObjectValue
““& 3
(
““3 4
)
““4 5
;
““5 6
if
•• 
(
•• 
!
•• 
(
•• 
obj
•• 
is
•• 
Anchor
•• #
anchor
••$ *
)
••* +
)
••+ ,
{
–– 
anchor
—— 
=
—— 
null
—— !
;
——! "
if
™™ 
(
™™ 
obj
™™ 
is
™™ 
JObject
™™ &
jObject
™™' .
)
™™. /
{
šš 
anchor
›› 
=
››  
jObject
››! (
.
››( )
ToObject
››) 1
<
››1 2
Anchor
››2 8
>
››8 9
(
››9 :
)
››: ;
;
››; <
}
œœ 
}
 
if
 
(
 
anchor
 
!=
 
null
 "
)
" #
{
ŸŸ 
queryStringParams
   %
[
  % &
$str
  & +
]
  + ,
=
  - .
anchor
  / 5
.
  5 6
X
  6 7
.
  7 8
ToString
  8 @
(
  @ A
CultureInfo
  A L
.
  L M
InvariantCulture
  M ]
)
  ] ^
+
  _ `
$char
  a d
+
  e f
anchor
  g m
.
  m n
Y
  n o
.
  o p
ToString
  p x
(
  x y
CultureInfo  y „
.  „ … 
InvariantCulture  … •
)  • –
;  – —
}
¡¡ 
}
¢¢ 
if
¤¤ 
(
¤¤ 
!
¤¤ 
bgcolor
¤¤ 
.
¤¤ 
IsNil
¤¤ 
(
¤¤ 
)
¤¤  
)
¤¤  !
{
¥¥ 
queryStringParams
¦¦ !
[
¦¦! "
$str
¦¦" +
]
¦¦+ ,
=
¦¦- .
bgcolor
¦¦/ 6
.
¦¦6 7
ToStringValue
¦¦7 D
(
¦¦D E
)
¦¦E F
;
¦¦F G
}
§§ 
}
¨¨ 	
}
©© 
}ªª ©
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\GraphQL\MediaAssetObjectType.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
GraphQL #
{ 
public 

class  
MediaAssetObjectType %
:& '
ObjectGraphType( 7
<7 8
IFileStoreEntry8 G
>G H
{		 
public

  
MediaAssetObjectType

 #
(

# $
)

$ %
{ 	
Name 
= 
$str 
;  
Field 
( 
file 
=> 
file 
. 
Name #
)# $
.$ %
Description% 0
(0 1
$str1 I
)I J
;J K
Field 
< 
StringGraphType !
>! "
(" #
)# $
. 
Name 
( 
$str 
) 
. 
Description 
( 
$str 4
)4 5
. 
Resolve 
( 
x 
=> 
{ 
var 
path 
= 
x  
.  !
Source! '
.' (
Path( ,
;, -
var 
context 
=  !
(" #
GraphQLContext# 1
)1 2
x2 3
.3 4
UserContext4 ?
;? @
var 
mediaFileStore &
=' (
context) 0
.0 1
ServiceProvider1 @
.@ A

GetServiceA K
<K L
IMediaFileStoreL [
>[ \
(\ ]
)] ^
;^ _
return 
mediaFileStore )
.) *
MapPathToPublicUrl* <
(< =
path= A
)A B
;B C
} 
) 
; 
Field 
( 
file 
=> 
file 
. 
Length %
)% &
.& '
Description' 2
(2 3
$str3 L
)L M
;M N
Field 
< 
DateTimeGraphType #
># $
($ %
$str% 6
,6 7
resolve8 ?
:? @
fileA E
=>F H
fileI M
.M N
SourceN T
.T U
LastModifiedUtcU d
,d e
descriptionf q
:q r
$str	s ¯
)
¯ °
;
° ±
} 	
} 
} ¼'
ŒD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\GraphQL\MediaAssetQuery.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
GraphQL #
{ 
public 

class 
MediaAssetQuery  
:! "
ISchemaBuilder# 1
{ 
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public 
MediaAssetQuery 
( 
IStringLocalizer /
</ 0
MediaAssetQuery0 ?
>? @
	localizerA J
)J K
{ 	
S 
= 
	localizer 
; 
} 	
public 
Task 
< 
string 
> 
GetIdentifierAsync .
(. /
)/ 0
=>1 3
Task4 8
.8 9

FromResult9 C
(C D
StringD J
.J K
EmptyK P
)P Q
;Q R
public 
Task 

BuildAsync 
( 
ISchema &
schema' -
)- .
{ 	
var 
field 
= 
new 
	FieldType %
{ 
Name 
= 
$str $
,$ %
Description 
= 
S 
[  
$str  ]
]] ^
,^ _
Type 
= 
typeof 
( 
ListGraphType +
<+ , 
MediaAssetObjectType, @
>@ A
)A B
,B C
	Arguments   
=   
new   
QueryArguments    .
(  . /
new!! 
QueryArgument!! %
<!!% &
StringGraphType!!& 5
>!!5 6
{"" 
Name## 
=## 
$str## %
,##% &
Description$$ #
=$$$ %
S$$& '
[$$' (
$str$$( ;
]$$; <
}%% 
,%% 
new&& 
QueryArgument&& %
<&&% &
BooleanGraphType&&& 6
>&&6 7
{'' 
Name(( 
=(( 
$str(( 6
,((6 7
Description)) #
=))$ %
S))& '
[))' (
$str	))( „
]
))„ …
}** 
)++ 
,++ 
Resolver,, 
=,, 
new,, $
LockedAsyncFieldResolver,, 7
<,,7 8
IEnumerable,,8 C
<,,C D
IFileStoreEntry,,D S
>,,S T
>,,T U
(,,U V
ResolveAsync,,V b
),,b c
}-- 
;-- 
schema// 
.// 
Query// 
.// 
AddField// !
(//! "
field//" '
)//' (
;//( )
return11 
Task11 
.11 
CompletedTask11 %
;11% &
}22 	
private44 
async44 
Task44 
<44 
IEnumerable44 &
<44& '
IFileStoreEntry44' 6
>446 7
>447 8
ResolveAsync449 E
(44E F
ResolveFieldContext44F Y
resolveContext44Z h
)44h i
{55 	
var66 
mediaFileStore66 
=66  
resolveContext66! /
.66/ 0"
ResolveServiceProvider660 F
(66F G
)66G H
.66H I

GetService66I S
<66S T
IMediaFileStore66T c
>66c d
(66d e
)66e f
;66f g
var88 
path88 
=88 
resolveContext88 %
.88% &
GetArgument88& 1
(881 2
$str882 8
,888 9
string88: @
.88@ A
Empty88A F
)88F G
;88G H
var99 !
includeSubDirectories99 %
=99& '
resolveContext99( 6
.996 7
GetArgument997 B
(99B C
$str99C Z
,99Z [
false99\ a
)99a b
;99b c
var;; 
allFiles;; 
=;; 
mediaFileStore;; )
.;;) *$
GetDirectoryContentAsync;;* B
(;;B C
path;;C G
,;;G H!
includeSubDirectories;;I ^
);;^ _
;;;_ `
if== 
(== !
includeSubDirectories== %
)==% &
{>> 
return?? 
await?? 
allFiles?? %
.??% &
ToListAsync??& 1
(??1 2
)??2 3
;??3 4
}@@ 
elseAA 
{BB 
returnCC 
awaitCC 
allFilesCC %
.CC% &
WhereCC& +
(CC+ ,
xCC, -
=>CC. 0
!CC1 2
xCC2 3
.CC3 4
IsDirectoryCC4 ?
)CC? @
.CC@ A
ToListAsyncCCA L
(CCL M
)CCM N
;CCN O
}DD 
}EE 	
}FF 
}GG 
–D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\GraphQL\MediaFieldQueryObjectType.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
GraphQL #
{		 
public

 

class

 %
MediaFieldQueryObjectType

 *
:

+ ,
ObjectGraphType

- <
<

< =

MediaField

= G
>

G H
{ 
public %
MediaFieldQueryObjectType (
(( )
)) *
{ 	
Name 
= 
nameof 
( 

MediaField $
)$ %
;% &
Field 
< 
ListGraphType 
<  
StringGraphType  /
>/ 0
,0 1
IEnumerable2 =
<= >
string> D
>D E
>E F
(F G
)G H
. 
Name 
( 
$str 
) 
. 
Description 
( 
$str .
). /
. 
PagingArguments  
(  !
)! "
. 
Resolve 
( 
x 
=> 
x 
.  
Page  $
($ %
x% &
.& '
Source' -
.- .
Paths. 3
)3 4
)4 5
;5 6
Field 
< 
ListGraphType 
<  
StringGraphType  /
>/ 0
,0 1
IEnumerable2 =
<= >
string> D
>D E
>E F
(F G
)G H
. 
Name 
( 
$str 
) 
. 
Description 
( 
$str C
)C D
. 
PagingArguments  
(  !
)! "
. 
Resolve 
( 
x 
=> 
{ 
var 
paths 
= 
x  !
.! "
Page" &
(& '
x' (
.( )
Source) /
./ 0
Paths0 5
)5 6
;6 7
var 
context 
=  !
(" #
GraphQLContext# 1
)1 2
x2 3
.3 4
UserContext4 ?
;? @
var 
mediaFileStore &
=' (
context) 0
.0 1
ServiceProvider1 @
.@ A

GetServiceA K
<K L
IMediaFileStoreL [
>[ \
(\ ]
)] ^
;^ _
return 
paths  
.  !
Select! '
(' (
p( )
=>* ,
mediaFileStore- ;
.; <
MapPathToPublicUrl< N
(N O
pO P
)P Q
)Q R
;R S
}   
)   
;   
}!! 	
}"" 
}## «

„D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\GraphQL\Startup.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
GraphQL #
{ 
[		 
RequireFeatures		 
(		 
$str		 /
)		/ 0
]		0 1
public

 

class

 
Startup

 
:

 
StartupBase

 &
{ 
public 
override 
void 
ConfigureServices .
(. /
IServiceCollection/ A
servicesB J
)J K
{ 	
services 
. 
AddSingleton !
<! "
ISchemaBuilder" 0
,0 1
MediaAssetQuery2 A
>A B
(B C
)C D
;D E
services 
. 
AddObjectGraphType '
<' (

MediaField( 2
,2 3%
MediaFieldQueryObjectType4 M
>M N
(N O
)O P
;P Q
services 
. 
AddTransient !
<! " 
MediaAssetObjectType" 6
>6 7
(7 8
)8 9
;9 :
} 	
} 
} û
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Handlers\AttachedMediaFieldContentHandler.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Handlers $
{ 
public

 

class

 ,
 AttachedMediaFieldContentHandler

 1
:

2 3
ContentHandlerBase

4 F
{ 
private 
readonly )
AttachedMediaFieldFileService 6*
_attachedMediaFieldFileService7 U
;U V
public ,
 AttachedMediaFieldContentHandler /
(/ 0)
AttachedMediaFieldFileService0 M)
attachedMediaFieldFileServiceN k
)k l
{ 	*
_attachedMediaFieldFileService *
=+ ,)
attachedMediaFieldFileService- J
;J K
} 	
public 
override 
async 
Task "
RemovedAsync# /
(/ 0 
RemoveContentContext0 D
contextE L
)L M
{ 	
if 
( 
context 
. 
NoActiveVersionLeft +
)+ ,
{ 
await *
_attachedMediaFieldFileService 4
.4 5(
DeleteContentItemFolderAsync5 Q
(Q R
contextR Y
.Y Z
ContentItemZ e
)e f
;f g
} 
} 	
} 
} Ã
}D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Manifest.cs
[ 
assembly 	
:	 

Module 
( 
Name 
=	 

$str 
, 
Author 

= 
ManifestConstants 
. 
OrchardCoreTeam .
,. /
Website 
= 
ManifestConstants 
.  
OrchardCoreWebsite  2
,2 3
Version 
= 
ManifestConstants 
.  
OrchardCoreVersion  2
) 
] 
[

 
assembly

 	
:

	 

Feature

 
(

 
Id 
= 
$str	 
, 
Name 
=	 

$str 
, 
Description 
= 
$str C
,C D
Dependencies 
= 
new 
[ 
] 
{ 
$str 5
}6 7
,7 8
Category 
= 
$str #
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	 "
," #
Name 
=	 

$str 
, 
Description 
= 
$str P
,P Q
Dependencies 
= 
new 
[ 
] 
{ 
$str 
} 
, 
Category 
= 
$str #
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	 $
,$ %
Name 
=	 

$str 
, 
Description   
=   
$str   g
,  g h
Dependencies!! 
=!! 
new!! 
[!! 
]!! 
{"" 
$str## 
}$$ 
,$$ 
Category%% 
=%% 
$str%% #
)&& 
]&& à
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\MediaOrchardHelperExtensions.cs
public 
static 
class (
MediaOrchardHelperExtensions 0
{		 
private

 
static

 
readonly

 
HashSet

 #
<

# $
string

$ *
>

* +
_imageExtensions

, <
=

= >
new

? B
HashSet

C J
<

J K
string

K Q
>

Q R
(

R S
StringComparer

S a
.

a b
OrdinalIgnoreCase

b s
)

s t
{

u v
$str

w }
,

} ~
$str	

 …
,


… †
$str


‡ 
,


 
$str


 –
,


– —
$str


˜ 
,


 Ÿ
$str


  §
,


§ ¨
$str


© °
}


± ²
;


² ³
public 

static 
bool 
IsImageFile "
(" #
this# '
IOrchardHelper( 6
orchardHelper7 D
,D E
stringF L
pathM Q
)Q R
{ 
return 
_imageExtensions 
.  
Contains  (
(( )
System) /
./ 0
IO0 2
.2 3
Path3 7
.7 8
GetExtension8 D
(D E
pathE I
)I J
)J K
;K L
} 
} ®	
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Migrations.cs
	namespace 	
OrchardCore
 
. 
Media 
{ 
public 

class 

Migrations 
: 
DataMigration +
{		 
private

 
readonly

 %
IContentDefinitionManager

 2%
_contentDefinitionManager

3 L
;

L M
public 

Migrations 
( %
IContentDefinitionManager 3$
contentDefinitionManager4 L
)L M
{ 	%
_contentDefinitionManager %
=& '$
contentDefinitionManager( @
;@ A
} 	
public 
int 
Create 
( 
) 
{ 	%
_contentDefinitionManager %
.% & 
MigrateFieldSettings& :
<: ;

MediaField; E
,E F
MediaFieldSettingsG Y
>Y Z
(Z [
)[ \
;\ ]
return 
$num 
; 
} 	
} 
} ²
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Models\MediaProfilesDocument.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Models "
{ 
public		 

class		 !
MediaProfilesDocument		 &
:		' (
Document		) 1
{

 
public 

Dictionary 
< 
string  
,  !
MediaProfile" .
>. /
MediaProfiles0 =
{> ?
get@ C
;C D
}E F
=G H
newI L

DictionaryM W
<W X
stringX ^
,^ _
MediaProfile` l
>l m
(m n
StringComparern |
.| }
OrdinalIgnoreCase	} 
)
 
;
 
} 
public 

class 
MediaProfile 
{ 
public 
string 
Hint 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
Width 
{ 
get 
; 
set  #
;# $
}% &
public 
int 
Height 
{ 
get 
;  
set! $
;$ %
}& '
public 

ResizeMode 
Mode 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Format 
Format 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
Quality 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
BackgroundColor %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} Æ+
€D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Permissions.cs
	namespace 	
OrchardCore
 
. 
Media 
{ 
public 

class 
Permissions 
: 
IPermissionProvider 2
{		 
public

 
static

 
readonly

 

Permission

 )
ManageMedia

* 5
=

6 7
new

8 ;

Permission

< F
(

F G
$str

G [
,

[ \
$str

] k
)

k l
;

l m
public 
static 
readonly 

Permission )+
ManageAttachedMediaFieldsFolder* I
=J K
newL O

PermissionP Z
(Z [
$str[ |
,| }
$str	~ £
)
£ ¤
;
¤ ¥
public 
static 
readonly 

Permission )
ManageMediaProfiles* =
=> ?
new@ C

PermissionD N
(N O
$strO d
,d e
$strf }
)} ~
;~ 
public 
static 
readonly 

Permission )
ViewMediaOptions* :
=; <
new= @

PermissionA K
(K L
$strL ^
,^ _
$str` t
)t u
;u v
public 
Task 
< 
IEnumerable 
<  

Permission  *
>* +
>+ ,
GetPermissionsAsync- @
(@ A
)A B
{ 	
return 
Task 
. 

FromResult "
(" #
new# &
[& '
]' (
{ 
ManageMedia 
, +
ManageAttachedMediaFieldsFolder /
,/ 0
ManageMediaProfiles #
,# $
ViewMediaOptions  
} 
. 
AsEnumerable 
( 
) 
) 
; 
} 	
public 
IEnumerable 
<  
PermissionStereotype /
>/ 0!
GetDefaultStereotypes1 F
(F G
)G H
{ 	
return 
new 
[ 
] 
{ 
new  
PermissionStereotype (
{   
Name!! 
=!! 
$str!! *
,!!* +
Permissions"" 
=""  !
new""" %
[""% &
]""& '
{""( )
ManageMedia""* 5
,""5 6+
ManageAttachedMediaFieldsFolder""7 V
,""V W
ManageMediaProfiles""X k
,""k l
ViewMediaOptions""m }
}""~ 
}## 
,## 
new$$  
PermissionStereotype$$ (
{%% 
Name&& 
=&& 
$str&& #
,&&# $
Permissions'' 
=''  !
new''" %
[''% &
]''& '
{''( )
ManageMedia''* 5
}''6 7
}(( 
,(( 
new))  
PermissionStereotype)) (
{** 
Name++ 
=++ 
$str++ &
,++& '
},, 
,,, 
new--  
PermissionStereotype-- (
{.. 
Name// 
=// 
$str// #
,//# $
Permissions00 
=00  !
new00" %
[00% &
]00& '
{00( )
ManageMedia00* 5
}006 7
}11 
,11 
new22  
PermissionStereotype22 (
{33 
Name44 
=44 
$str44 (
,44( )
Permissions55 
=55  !
new55" %
[55% &
]55& '
{55( )
ManageMedia55* 5
}556 7
}66 
,66 
}77 
;77 
}88 	
}99 
public;; 

class;; !
MediaCachePermissions;; &
:;;' (
IPermissionProvider;;) <
{<< 
public== 
static== 
readonly== 

Permission== )
ManageAssetCache==* :
===; <
new=== @

Permission==A K
(==K L
$str==L ^
,==^ _
$str==` {
)=={ |
;==| }
public?? 
Task?? 
<?? 
IEnumerable?? 
<??  

Permission??  *
>??* +
>??+ ,
GetPermissionsAsync??- @
(??@ A
)??A B
{@@ 	
returnAA 
TaskAA 
.AA 

FromResultAA "
(AA" #
newAA# &
[AA& '
]AA' (
{AA) *
ManageAssetCacheAA+ ;
}AA< =
.AA= >
AsEnumerableAA> J
(AAJ K
)AAK L
)AAL M
;AAM N
}BB 	
publicDD 
IEnumerableDD 
<DD  
PermissionStereotypeDD /
>DD/ 0!
GetDefaultStereotypesDD1 F
(DDF G
)DDG H
{EE 	
returnFF 
newFF 
[FF 
]FF 
{GG 
newHH  
PermissionStereotypeHH (
{II 
NameJJ 
=JJ 
$strJJ *
,JJ* +
PermissionsKK 
=KK  !
newKK" %
[KK% &
]KK& '
{KK( )
ManageAssetCacheKK* :
}KK; <
}LL 
}MM 
;MM 
}NN 	
}OO 
}PP ú/
–D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\ImageSharpUrlFormatter.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{ 
public		 

enum		 

ResizeMode		 
{

 
	Undefined 
, 
Max 
, 
Crop 
, 
Pad 
, 
BoxPad 
, 
Min 
, 
Stretch 
} 
public 

enum 
Format 
{ 
	Undefined 
, 
Bmp 
, 
Gif 
, 
Jpg 
, 
Png 
, 
Tga 
} 
internal 
class "
ImageSharpUrlFormatter )
{ 
public   
static   
string   
GetImageResizeUrl   .
(  . /
string  / 5
path  6 :
,  : ;
IDictionary  < G
<  G H
string  H N
,  N O
string  P V
>  V W
queryStringParams  X i
=  j k
null  l p
,  p q
int  r u
?  u v
width  w |
=  } ~
null	   ƒ
,
  ƒ „
int
  … ˆ
?
  ˆ ‰
height
  Š 
=
  ‘ ’
null
  “ —
,
  — ˜

ResizeMode
  ™ £

resizeMode
  ¤ ®
=
  ¯ °

ResizeMode
  ± »
.
  » ¼
	Undefined
  ¼ Å
,
  Å Æ
int
  Ç Ê
?
  Ê Ë
quality
  Ì Ó
=
  Ô Õ
null
  Ö Ú
,
  Ú Û
Format
  Ü â
format
  ã é
=
  ê ë
Format
  ì ò
.
  ò ó
	Undefined
  ó ü
,
  ü ı
Anchor
  ş „
anchor
  … ‹
=
  Œ 
null
   ’
,
  ’ “
string
  ” š
bgcolor
  › ¢
=
  £ ¤
null
  ¥ ©
)
  © ª
{!! 	
if"" 
("" 
string"" 
."" 
IsNullOrEmpty"" $
(""$ %
path""% )
)"") *
||""+ -
("". /
!""/ 0
width""0 5
.""5 6
HasValue""6 >
&&""? A
!""B C
height""C I
.""I J
HasValue""J R
&&""S U
queryStringParams""V g
==""h j
null""k o
)""o p
)""p q
{## 
return$$ 
path$$ 
;$$ 
}%% 
if'' 
('' 
queryStringParams'' !
==''" $
null''% )
)'') *
{(( 
queryStringParams)) !
=))" #
new))$ '

Dictionary))( 2
<))2 3
string))3 9
,))9 :
string)); A
>))A B
())B C
)))C D
;))D E
}** 
if,, 
(,, 
width,, 
.,, 
HasValue,, 
),, 
{-- 
queryStringParams.. !
[..! "
$str.." )
]..) *
=..+ ,
width..- 2
...2 3
ToString..3 ;
(..; <
)..< =
;..= >
}// 
if11 
(11 
height11 
.11 
HasValue11 
)11  
{22 
queryStringParams33 !
[33! "
$str33" *
]33* +
=33, -
height33. 4
.334 5
ToString335 =
(33= >
)33> ?
;33? @
}44 
if66 
(66 

resizeMode66 
!=66 

ResizeMode66 (
.66( )
	Undefined66) 2
)662 3
{77 
queryStringParams88 !
[88! "
$str88" )
]88) *
=88+ ,

resizeMode88- 7
.887 8
ToString888 @
(88@ A
)88A B
.88B C
ToLower88C J
(88J K
)88K L
;88L M
}99 
if;; 
(;; 
quality;; 
.;; 
HasValue;;  
);;  !
{<< 
queryStringParams== !
[==! "
$str==" +
]==+ ,
===- .
quality==/ 6
.==6 7
ToString==7 ?
(==? @
)==@ A
;==A B
}>> 
if@@ 
(@@ 
format@@ 
!=@@ 
Format@@  
.@@  !
	Undefined@@! *
)@@* +
{AA 
queryStringParamsBB !
[BB! "
$strBB" *
]BB* +
=BB, -
formatBB. 4
.BB4 5
ToStringBB5 =
(BB= >
)BB> ?
.BB? @
ToLowerBB@ G
(BBG H
)BBH I
;BBI J
}CC 
ifEE 
(EE 
anchorEE 
!=EE 
nullEE 
)EE 
{FF 
queryStringParamsGG !
[GG! "
$strGG" '
]GG' (
=GG) *
anchorGG+ 1
.GG1 2
XGG2 3
.GG3 4
ToStringGG4 <
(GG< =
CultureInfoGG= H
.GGH I
InvariantCultureGGI Y
)GGY Z
+GG[ \
$charGG] `
+GGa b
anchorGGc i
.GGi j
YGGj k
.GGk l
ToStringGGl t
(GGt u
CultureInfo	GGu €
.
GG€ 
InvariantCulture
GG ‘
)
GG‘ ’
;
GG’ “
}HH 
ifJJ 
(JJ 
!JJ 
StringJJ 
.JJ 
IsNullOrEmptyJJ %
(JJ% &
bgcolorJJ& -
)JJ- .
)JJ. /
{KK 
queryStringParamsLL !
[LL! "
$strLL" +
]LL+ ,
=LL- .
bgcolorLL/ 6
;LL6 7
}MM 
returnOO 
QueryHelpersOO 
.OO  
AddQueryStringOO  .
(OO. /
pathOO/ 3
,OO3 4
queryStringParamsOO5 F
)OOF G
;OOG H
}PP 	
}QQ 
}RR Ø

•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\ImageVersionProcessor.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{		 
public 

class !
ImageVersionProcessor &
:' (
IImageWebProcessor) ;
{ 
public 
const 
string 
VersionCommand *
=+ ,
$str- 0
;0 1
public 
IEnumerable 
< 
string !
>! "
Commands# +
=> 
new 
[ 
] 
{ 
VersionCommand %
}& '
;' (
public 
FormattedImage 
Process %
(% &
FormattedImage& 4
image5 :
,: ;
ILogger< C
loggerD J
,J K
IDictionaryL W
<W X
stringX ^
,^ _
string` f
>f g
commandsh p
,p q
CommandParserr 
parser
€ †
,
† ‡
CultureInfo
ˆ “
culture
” ›
)
› œ
=> 
image 
; 
} 
} İN
œD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaImageSharpConfiguration.cs
	namespace		 	
OrchardCore		
 
.		 
Media		 
.		 

Processing		 &
{

 
public 

class (
MediaImageSharpConfiguration -
:. /
IConfigureOptions0 A
<A B'
ImageSharpMiddlewareOptionsB ]
>] ^
{ 
private 
readonly 
MediaOptions %
_mediaOptions& 3
;3 4
public (
MediaImageSharpConfiguration +
(+ ,
IOptions, 4
<4 5
MediaOptions5 A
>A B
mediaOptionsC O
)O P
{ 	
_mediaOptions 
= 
mediaOptions (
.( )
Value) .
;. /
} 	
public 
void 
	Configure 
( '
ImageSharpMiddlewareOptions 9
options: A
)A B
{ 	
options 
. 
Configuration !
=" #
Configuration$ 1
.1 2
Default2 9
;9 :
options 
. 
BrowserMaxAge !
=" #
TimeSpan$ ,
., -
FromDays- 5
(5 6
_mediaOptions6 C
.C D
MaxBrowserCacheDaysD W
)W X
;X Y
options 
. 
CacheMaxAge 
=  !
TimeSpan" *
.* +
FromDays+ 3
(3 4
_mediaOptions4 A
.A B
MaxCacheDaysB N
)N O
;O P
options 
. 
CachedNameLength $
=% &
$num' )
;) *
options 
.  
OnParseCommandsAsync (
=) *
context+ 2
=>3 5
{ 
if 
( 
context 
. 
Commands $
.$ %
Count% *
==+ -
$num. /
)/ 0
{   
return!! 
Task!! 
.!!  
CompletedTask!!  -
;!!- .
}"" 
var$$ 
mediaOptions$$  
=$$! "
context$$# *
.$$* +
Context$$+ 2
.$$2 3
RequestServices$$3 B
.$$B C
GetRequiredService$$C U
<$$U V
IOptions$$V ^
<$$^ _
MediaOptions$$_ k
>$$k l
>$$l m
($$m n
)$$n o
.$$o p
Value$$p u
;$$u v
if%% 
(%% 
mediaOptions%%  
.%%  !#
UseTokenizedQueryString%%! 8
)%%8 9
{&& 
if'' 
('' 
context'' 
.''  
Commands''  (
.''( )
TryGetValue'') 4
(''4 5!
TokenCommandProcessor''5 J
.''J K
TokenCommand''K W
,''W X
out''Y \
var''] `
tokenString''a l
)''l m
)''m n
{(( 
var)) 
mediaTokenService)) -
=)). /
context))1 8
.))8 9
Context))9 @
.))@ A
RequestServices))A P
.))P Q
GetRequiredService))Q c
<))c d
IMediaTokenService))d v
>))v w
())w x
)))x y
;))y z
var,, 
token,, !
=,," #
context,,$ +
.,,+ ,
Commands,,, 4
[,,4 5
$str,,5 <
],,< =
;,,= >
context// 
.//  
Commands//  (
.//( )
Remove//) /
(/// 0!
TokenCommandProcessor//0 E
.//E F
TokenCommand//F R
)//R S
;//S T
if22 
(22 
!22 
mediaTokenService22 .
.22. /
TryValidateToken22/ ?
(22? @
context22@ G
.22G H
Commands22H P
,22P Q
token22R W
)22W X
)22X Y
{33 
context44 #
.44# $
Commands44$ ,
.44, -
Clear44- 2
(442 3
)443 4
;444 5
return66 "
Task66# '
.66' (
CompletedTask66( 5
;665 6
}77 
}:: 
else;; 
{<< %
ValidateTokenlessCommands== 1
(==1 2
context==2 9
,==9 :
mediaOptions==; G
)==G H
;==H I
}>> 
}?? 
else@@ 
{AA %
ValidateTokenlessCommandsBB -
(BB- .
contextBB. 5
,BB5 6
mediaOptionsBB7 C
)BBC D
;BBD E
}CC 
contextFF 
.FF 
CommandsFF  
.FF  !
RemoveFF! '
(FF' (
ResizeWebProcessorFF( :
.FF: ;
CompandFF; B
)FFB C
;FFC D
contextGG 
.GG 
CommandsGG  
.GG  !
RemoveGG! '
(GG' (
ResizeWebProcessorGG( :
.GG: ;
SamplerGG; B
)GGB C
;GGC D
contextHH 
.HH 
CommandsHH  
.HH  !
RemoveHH! '
(HH' (
ResizeWebProcessorHH( :
.HH: ;
AnchorHH; A
)HHA B
;HHB C
ifKK 
(KK 
contextKK 
.KK 
CommandsKK $
.KK$ %
CountKK% *
==KK+ -
$numKK. /
&&KK0 2
contextKK3 :
.KK: ;
CommandsKK; C
.KKC D
ContainsKeyKKD O
(KKO P!
ImageVersionProcessorKKP e
.KKe f
VersionCommandKKf t
)KKt u
)KKu v
{LL 
contextMM 
.MM 
CommandsMM $
.MM$ %
ClearMM% *
(MM* +
)MM+ ,
;MM, -
}NN 
elseOO 
ifOO 
(OO 
!OO 
contextOO !
.OO! "
CommandsOO" *
.OO* +
ContainsKeyOO+ 6
(OO6 7
ResizeWebProcessorOO7 I
.OOI J
ModeOOJ N
)OON O
)OOO P
{PP 
contextQQ 
.QQ 
CommandsQQ $
[QQ$ %
ResizeWebProcessorQQ% 7
.QQ7 8
ModeQQ8 <
]QQ< =
=QQ> ?
$strQQ@ E
;QQE F
}RR 
returnTT 
TaskTT 
.TT 
CompletedTaskTT )
;TT) *
}UU 
;UU 
}VV 	
privateXX 
staticXX 
voidXX %
ValidateTokenlessCommandsXX 5
(XX5 6
ImageCommandContextXX6 I
contextXXJ Q
,XXQ R
MediaOptionsXXS _
mediaOptionsXX` l
)XXl m
{YY 	
context[[ 
.[[ 
Commands[[ 
.[[ 
Remove[[ #
([[# $
ResizeWebProcessor[[$ 6
.[[6 7
Xy[[7 9
)[[9 :
;[[: ;
context\\ 
.\\ 
Commands\\ 
.\\ 
Remove\\ #
(\\# $!
ImageVersionProcessor\\$ 9
.\\9 :
VersionCommand\\: H
)\\H I
;\\I J
context]] 
.]] 
Commands]] 
.]] 
Remove]] #
(]]# $'
BackgroundColorWebProcessor]]$ ?
.]]? @
Color]]@ E
)]]E F
;]]F G
if`` 
(`` 
context`` 
.`` 
Commands``  
.``  !
TryGetValue``! ,
(``, -
ResizeWebProcessor``- ?
.``? @
Width``@ E
,``E F
out``G J
var``K N
widthString``O Z
)``Z [
)``[ \
{aa 
varbb 
widthbb 
=bb 
contextbb #
.bb# $
Parserbb$ *
.bb* +

ParseValuebb+ 5
<bb5 6
intbb6 9
>bb9 :
(bb: ;
widthStringbb; F
,bbF G
contextbbH O
.bbO P
CulturebbP W
)bbW X
;bbX Y
ifdd 
(dd 
Arraydd 
.dd 
BinarySearchdd &
<dd& '
intdd' *
>dd* +
(dd+ ,
mediaOptionsdd, 8
.dd8 9
SupportedSizesdd9 G
,ddG H
widthddI N
)ddN O
<ddP Q
$numddR S
)ddS T
{ee 
contextff 
.ff 
Commandsff $
.ff$ %
Removeff% +
(ff+ ,
ResizeWebProcessorff, >
.ff> ?
Widthff? D
)ffD E
;ffE F
}gg 
}hh 
ifjj 
(jj 
contextjj 
.jj 
Commandsjj  
.jj  !
TryGetValuejj! ,
(jj, -
ResizeWebProcessorjj- ?
.jj? @
Heightjj@ F
,jjF G
outjjH K
varjjL O
heightStringjjP \
)jj\ ]
)jj] ^
{kk 
varll 
heightll 
=ll 
contextll $
.ll$ %
Parserll% +
.ll+ ,

ParseValuell, 6
<ll6 7
intll7 :
>ll: ;
(ll; <
heightStringll< H
,llH I
contextllJ Q
.llQ R
CulturellR Y
)llY Z
;llZ [
ifnn 
(nn 
Arraynn 
.nn 
BinarySearchnn &
<nn& '
intnn' *
>nn* +
(nn+ ,
mediaOptionsnn, 8
.nn8 9
SupportedSizesnn9 G
,nnG H
heightnnI O
)nnO P
<nnQ R
$numnnS T
)nnT U
{oo 
contextpp 
.pp 
Commandspp $
.pp$ %
Removepp% +
(pp+ ,
ResizeWebProcessorpp, >
.pp> ?
Heightpp? E
)ppE F
;ppF G
}qq 
}rr 
}ss 	
}tt 
}uu ”+
™D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaResizingFileProvider.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{ 
public 

class %
MediaResizingFileProvider *
:+ ,
IImageProvider- ;
{ 
private 
readonly 
IMediaFileProvider +
_mediaFileProvider, >
;> ?
private 
readonly 
FormatUtilities (
_formatUtilities) 9
;9 :
private 
readonly 

PathString #
_assetsRequestPath$ 6
;6 7
private 
Func 
< 
HttpContext  
,  !
bool" &
>& '
_match( .
;. /
public %
MediaResizingFileProvider (
(( )
IMediaFileProvider 
mediaFileProvider 0
,0 1
CommandParser 
commandParser '
,' (
IOptions 
< '
ImageSharpMiddlewareOptions 0
>0 1
imageSharpOptions2 C
,C D
IOptions 
< 
MediaOptions !
>! "
mediaOptions# /
) 
{   	
_mediaFileProvider!! 
=!!  
mediaFileProvider!!! 2
;!!2 3
_formatUtilities"" 
="" 
new"" "
FormatUtilities""# 2
(""2 3
imageSharpOptions""3 D
)""D E
;""E F
_assetsRequestPath## 
=##  
mediaOptions##! -
.##- .
Value##. 3
.##3 4
AssetsRequestPath##4 E
;##E F
}$$ 	
public'' 
Func'' 
<'' 
HttpContext'' 
,''  
bool''! %
>''% &
Match''' ,
{(( 	
get)) 
=>)) 
_match)) 
??)) 
IsMatch)) $
;))$ %
set** 
=>** 
_match** 
=** 
value** !
;**! "
}++ 	
public-- 
ProcessingBehavior-- !
ProcessingBehavior--" 4
=>--5 7
ProcessingBehavior--8 J
.--J K
CommandOnly--K V
;--V W
public00 
bool00 
IsValidRequest00 "
(00" #
HttpContext00# .
context00/ 6
)006 7
{11 	
if22 
(22 
_formatUtilities22  
.22  !
GetExtensionFromUri22! 4
(224 5
context225 <
.22< =
Request22= D
.22D E
GetDisplayUrl22E R
(22R S
)22S T
)22T U
==22V X
null22Y ]
)22] ^
{33 
return44 
false44 
;44 
}55 
return77 
true77 
;77 
}88 	
public;; 
Task;; 
<;; 
IImageResolver;; "
>;;" #
GetAsync;;$ ,
(;;, -
HttpContext;;- 8
context;;9 @
);;@ A
{<< 	
var>> 
path>> 
=>> 
context>> 
.>> 
Request>> &
.>>& '
Path>>' +
.>>+ ,
Value>>, 1
.>>1 2
	Substring>>2 ;
(>>; <
_assetsRequestPath>>< N
.>>N O
Value>>O T
.>>T U
Length>>U [
)>>[ \
;>>\ ]
var@@ 
fileInfo@@ 
=@@ 
_mediaFileProvider@@ -
.@@- .
GetFileInfo@@. 9
(@@9 :
path@@: >
)@@> ?
;@@? @
ifCC 
(CC 
!CC 
fileInfoCC 
.CC 
ExistsCC  
)CC  !
{DD 
returnEE 
TaskEE 
.EE 

FromResultEE &
<EE& '
IImageResolverEE' 5
>EE5 6
(EE6 7
nullEE7 ;
)EE; <
;EE< =
}FF 
varII 
metadataII 
=II 
newII 
ImageMetadataII ,
(II, -
fileInfoII- 5
.II5 6
LastModifiedII6 B
.IIB C
UtcDateTimeIIC N
,IIN O
fileInfoIIP X
.IIX Y
LengthIIY _
)II_ `
;II` a
returnJJ 
TaskJJ 
.JJ 

FromResultJJ "
<JJ" #
IImageResolverJJ# 1
>JJ1 2
(JJ2 3
newJJ3 6&
PhysicalFileSystemResolverJJ7 Q
(JJQ R
fileInfoJJR Z
,JJZ [
metadataJJ\ d
)JJd e
)JJe f
;JJf g
}KK 	
privateMM 
boolMM 
IsMatchMM 
(MM 
HttpContextMM (
contextMM) 0
)MM0 1
{NN 	
ifOO 
(OO 
!OO 
contextOO 
.OO 
RequestOO  
.OO  !
PathOO! %
.OO% &(
StartsWithNormalizedSegmentsOO& B
(OOB C
_assetsRequestPathOOC U
,OOU V
StringComparisonOOW g
.OOg h
OrdinalIgnoreCaseOOh y
)OOy z
)OOz {
{PP 
returnQQ 
falseQQ 
;QQ 
}RR 
returnTT 
trueTT 
;TT 
}UU 	
}VV 
}WW À
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaTokenOptions.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{ 
public 

class 
MediaTokenOptions "
{ 
public 
byte 
[ 
] 
HashKey 
{ 
get  #
;# $
set% (
;( )
}* +
} 
}		 ‘
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaTokenOptionsConfiguration.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{ 
public 

class *
MediaTokenOptionsConfiguration /
:0 1
IConfigureOptions2 C
<C D
MediaTokenOptionsD U
>U V
{ 
private		 
readonly		 
ISiteService		 %
_siteService		& 2
;		2 3
public *
MediaTokenOptionsConfiguration -
(- .
ISiteService. :
siteService; F
)F G
{ 	
_siteService 
= 
siteService &
;& '
} 	
public 
void 
	Configure 
( 
MediaTokenOptions /
options0 7
)7 8
{ 	
options 
. 
HashKey 
= 
_siteService *
.* + 
GetSiteSettingsAsync+ ?
(? @
)@ A
. 

GetAwaiter 
( 
) 
. 
	GetResult '
(' (
)( )
. 
As 
< 
MediaTokenSettings &
>& '
(' (
)( )
. 
HashKey 
; 
} 	
} 
} ™H
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaTokenService.cs
	namespace

 	
OrchardCore


 
.

 
Media

 
.

 

Processing

 &
{ 
public 

class 
MediaTokenService "
:# $
IMediaTokenService% 7
{ 
private 
const 
string 
TokenCacheKeyPrefix 0
=1 2
$str3 @
;@ A
private 
readonly 
IMemoryCache %
_memoryCache& 2
;2 3
private 
readonly 
HashSet  
<  !
string! '
>' (
_knownCommands) 7
=8 9
new: =
HashSet> E
<E F
stringF L
>L M
(M N
)N O
;O P
private 
readonly 
byte 
[ 
] 
_hashKey  (
;( )
public 
MediaTokenService  
(  !
IMemoryCache 
memoryCache $
,$ %
IOptions 
< 
MediaTokenOptions &
>& '
options( /
,/ 0
IEnumerable 
< 
IImageWebProcessor *
>* +

processors, 6
)6 7
{ 	
_memoryCache 
= 
memoryCache &
;& '
foreach 
( 
var 
	processor "
in# %

processors& 0
)0 1
{ 
foreach 
( 
var 
command $
in% '
	processor( 1
.1 2
Commands2 :
): ;
{ 
_knownCommands "
." #
Add# &
(& '
command' .
). /
;/ 0
} 
}   
_hashKey"" 
="" 
options"" 
."" 
Value"" $
.""$ %
HashKey""% ,
;"", -
}## 	
public%% 
string%% 
AddTokenToPath%% $
(%%$ %
string%%% +
path%%, 0
)%%0 1
{&& 	
var'' 
	pathParts'' 
='' 
path''  
.''  !
Split''! &
(''& '
$char''' *
)''* +
;''+ ,
var)) 
parsed)) 
=)) 
QueryHelpers)) %
.))% &

ParseQuery))& 0
())0 1
	pathParts))1 :
.)): ;
Length)); A
>))B C
$num))D E
?))F G
	pathParts))H Q
[))Q R
$num))R S
]))S T
:))U V
string))W ]
.))] ^
Empty))^ c
)))c d
;))d e
if,, 
(,, 
parsed,, 
.,, 
Count,, 
==,, 
$num,,  !
||,," $
parsed,,% +
.,,+ ,
Count,,, 1
==,,2 4
$num,,5 6
&&,,7 9
parsed,,: @
.,,@ A
ContainsKey,,A L
(,,L M!
ImageVersionProcessor,,M b
.,,b c
VersionCommand,,c q
),,q r
),,r s
{-- 
return.. 
path.. 
;.. 
}// 
var11 
processingCommands11 "
=11# $
new11% (

Dictionary11) 3
<113 4
string114 :
,11: ;
string11< B
>11B C
(11C D
)11D E
;11E F

Dictionary22 
<22 
string22 
,22 
string22 %
>22% &
otherCommands22' 4
=225 6
null227 ;
;22; <
foreach44 
(44 
var44 
command44  
in44! #
parsed44$ *
)44* +
{55 
if66 
(66 
_knownCommands66 "
.66" #
Contains66# +
(66+ ,
command66, 3
.663 4
Key664 7
)667 8
)668 9
{77 
processingCommands88 &
[88& '
command88' .
.88. /
Key88/ 2
]882 3
=884 5
command886 =
.88= >
Value88> C
.88C D
ToString88D L
(88L M
)88M N
;88N O
}99 
else:: 
{;; 
otherCommands<< !
??=<<" %
new<<& )

Dictionary<<* 4
<<<4 5
string<<5 ;
,<<; <
string<<= C
><<C D
(<<D E
)<<E F
;<<F G
otherCommands== !
[==! "
command==" )
.==) *
Key==* -
]==- .
===/ 0
command==1 8
.==8 9
Value==9 >
.==> ?
ToString==? G
(==G H
)==H I
;==I J
}>> 
}?? 
varBB 
commandValuesBB 
=BB 
StringBB  &
.BB& '
ConcatBB' -
(BB- .
processingCommandsBB. @
.BB@ A
ValuesBBA G
)BBG H
;BBH I
varDD 
queryStringTokenKeyDD #
=DD$ %
TokenCacheKeyPrefixDD& 9
+DD: ;
commandValuesDD< I
;DDI J
varFF 
queryStringTokenFF  
=FF! "
GetHashFF# *
(FF* +
commandValuesFF+ 8
,FF8 9
queryStringTokenKeyFF: M
)FFM N
;FFN O
processingCommandsHH 
[HH 
$strHH &
]HH& '
=HH( )
queryStringTokenHH* :
;HH: ;
ifKK 
(KK 
otherCommandsKK 
!=KK  
nullKK! %
)KK% &
{LL 
foreachMM 
(MM 
varMM 
commandMM $
inMM% '
otherCommandsMM( 5
)MM5 6
{NN 
processingCommandsOO &
.OO& '
AddOO' *
(OO* +
commandOO+ 2
.OO2 3
KeyOO3 6
,OO6 7
commandOO8 ?
.OO? @
ValueOO@ E
)OOE F
;OOF G
}PP 
}QQ 
returnSS 
QueryHelpersSS 
.SS  
AddQueryStringSS  .
(SS. /
	pathPartsSS/ 8
[SS8 9
$numSS9 :
]SS: ;
,SS; <
processingCommandsSS= O
)SSO P
;SSP Q
}TT 	
publicVV 
boolVV 
TryValidateTokenVV $
(VV$ %
IDictionaryVV% 0
<VV0 1
stringVV1 7
,VV7 8
stringVV9 ?
>VV? @
commandsVVA I
,VVI J
stringVVK Q
tokenVVR W
)VVW X
{WW 	
varXX 
commandValuesXX 
=XX 
StringXX  &
.XX& '
ConcatXX' -
(XX- .
commandsXX. 6
.XX6 7
ValuesXX7 =
)XX= >
;XX> ?
varZZ 
queryStringTokenKeyZZ #
=ZZ$ %
TokenCacheKeyPrefixZZ& 9
+ZZ: ;
commandValuesZZ< I
;ZZI J
var]] 
queryStringToken]]  
=]]! "
GetHash]]# *
(]]* +
commandValues]]+ 8
,]]8 9
queryStringTokenKey]]: M
)]]M N
;]]N O
if__ 
(__ 
String__ 
.__ 
Equals__ 
(__ 
queryStringToken__ .
,__. /
token__0 5
,__5 6
StringComparison__7 G
.__G H
OrdinalIgnoreCase__H Y
)__Y Z
)__Z [
{`` 
returnaa 
trueaa 
;aa 
}bb 
returndd 
falsedd 
;dd 
}ee 	
privategg 
stringgg 
GetHashgg 
(gg 
stringgg %
commandValuesgg& 3
,gg3 4
stringgg5 ;
queryStringTokenKeygg< O
)ggO P
=>hh 
_memoryCachehh 
.hh 
GetOrCreatehh '
(hh' (
queryStringTokenKeyhh( ;
,hh; <
entryhh= B
=>hhC E
{ii 
entryjj 
.jj 
SlidingExpirationjj *
=jj+ ,
TimeSpanjj- 5
.jj5 6
	FromHoursjj6 ?
(jj? @
$numjj@ A
)jjA B
;jjB C
usingll 
varll 
hmacll !
=ll" #
newll$ '

HMACSHA256ll( 2
(ll2 3
_hashKeyll3 ;
)ll; <
;ll< =
varnn 
bytesnn 
=nn 
Encodingnn '
.nn' (
UTF8nn( ,
.nn, -
GetBytesnn- 5
(nn5 6
commandValuesnn6 C
)nnC D
;nnD E
varpp 
hashpp 
=pp 
hmacpp "
.pp" #
ComputeHashpp# .
(pp. /
bytespp/ 4
)pp4 5
;pp5 6
returnrr 
Convertrr !
.rr! "
ToBase64Stringrr" 0
(rr0 1
hashrr1 5
)rr5 6
;rr6 7
}ss 
)ss 
;ss 
}tt 
}uu Â
’D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaTokenSettings.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{ 
public 

class 
MediaTokenSettings #
{ 
public 
byte 
[ 
] 
HashKey 
{ 
get  #
;# $
set% (
;( )
}* +
} 
}		 ¨3
™D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\MediaTokenSettingsUpdater.cs
	namespace		 	
OrchardCore		
 
.		 
Media		 
.		 

Processing		 &
{

 
public 

class %
MediaTokenSettingsUpdater *
:+ ,
ModularTenantEvents- @
,@ A 
IFeatureEventHandlerB V
{ 
private 
readonly 
ISiteService %
_siteService& 2
;2 3
public %
MediaTokenSettingsUpdater (
(( )
ISiteService) 5
siteService6 A
)A B
{ 	
_siteService 
= 
siteService &
;& '
} 	
public 
override 
async 
Task "
ActivatedAsync# 1
(1 2
)2 3
{ 	
var 
mediaTokenSettings "
=# $
(% &
await& +
_siteService, 8
.8 9 
GetSiteSettingsAsync9 M
(M N
)N O
)O P
.P Q
AsQ S
<S T
MediaTokenSettingsT f
>f g
(g h
)h i
;i j
if 
( 
mediaTokenSettings "
." #
HashKey# *
==+ -
null. 2
)2 3
{ 
var 
siteSettings  
=! "
await# (
_siteService) 5
.5 6!
LoadSiteSettingsAsync6 K
(K L
)L M
;M N
var   
rng   
=   !
RandomNumberGenerator   /
.  / 0
Create  0 6
(  6 7
)  7 8
;  8 9
mediaTokenSettings"" "
.""" #
HashKey""# *
=""+ ,
new""- 0
byte""1 5
[""5 6
$num""6 8
]""8 9
;""9 :
rng## 
.## 
GetBytes## 
(## 
mediaTokenSettings## /
.##/ 0
HashKey##0 7
)##7 8
;##8 9
siteSettings$$ 
.$$ 
Put$$  
($$  !
mediaTokenSettings$$! 3
)$$3 4
;$$4 5
await&& 
_siteService&& "
.&&" ##
UpdateSiteSettingsAsync&&# :
(&&: ;
siteSettings&&; G
)&&G H
;&&H I
}'' 
}(( 	
Task**  
IFeatureEventHandler** !
.**! "
InstallingAsync**" 1
(**1 2
IFeatureInfo**2 >
feature**? F
)**F G
=>**H J
Task**K O
.**O P
CompletedTask**P ]
;**] ^
Task,,  
IFeatureEventHandler,, !
.,,! "
InstalledAsync,," 0
(,,0 1
IFeatureInfo,,1 =
feature,,> E
),,E F
=>,,G I
Task,,J N
.,,N O
CompletedTask,,O \
;,,\ ]
Task..  
IFeatureEventHandler.. !
...! "
EnablingAsync.." /
(../ 0
IFeatureInfo..0 <
feature..= D
)..D E
=>..F H
Task..I M
...M N
CompletedTask..N [
;..[ \
Task00  
IFeatureEventHandler00 !
.00! "
EnabledAsync00" .
(00. /
IFeatureInfo00/ ;
feature00< C
)00C D
=>00E G&
SetMediaTokenSettingsAsync00H b
(00b c
feature00c j
)00j k
;00k l
Task22  
IFeatureEventHandler22 !
.22! "
DisablingAsync22" 0
(220 1
IFeatureInfo221 =
feature22> E
)22E F
=>22G I
Task22J N
.22N O
CompletedTask22O \
;22\ ]
Task44  
IFeatureEventHandler44 !
.44! "
DisabledAsync44" /
(44/ 0
IFeatureInfo440 <
feature44= D
)44D E
=>44F H
Task44I M
.44M N
CompletedTask44N [
;44[ \
Task66  
IFeatureEventHandler66 !
.66! "
UninstallingAsync66" 3
(663 4
IFeatureInfo664 @
feature66A H
)66H I
=>66J L
Task66M Q
.66Q R
CompletedTask66R _
;66_ `
Task88  
IFeatureEventHandler88 !
.88! "
UninstalledAsync88" 2
(882 3
IFeatureInfo883 ?
feature88@ G
)88G H
=>88I K
Task88L P
.88P Q
CompletedTask88Q ^
;88^ _
private:: 
async:: 
Task:: &
SetMediaTokenSettingsAsync:: 5
(::5 6
IFeatureInfo::6 B
feature::C J
)::J K
{;; 	
if<< 
(<< 
feature<< 
.<< 
	Extension<< !
.<<! "
Id<<" $
!=<<% '
GetType<<( /
(<</ 0
)<<0 1
.<<1 2
Assembly<<2 :
.<<: ;
GetName<<; B
(<<B C
)<<C D
.<<D E
Name<<E I
)<<I J
{== 
return>> 
;>> 
}?? 
varAA 
siteSettingsAA 
=AA 
awaitAA $
_siteServiceAA% 1
.AA1 2!
LoadSiteSettingsAsyncAA2 G
(AAG H
)AAH I
;AAI J
varBB 
mediaTokenSettingsBB "
=BB# $
siteSettingsBB% 1
.BB1 2
AsBB2 4
<BB4 5
MediaTokenSettingsBB5 G
>BBG H
(BBH I
)BBI J
;BBJ K
varDD 
rngDD 
=DD !
RandomNumberGeneratorDD +
.DD+ ,
CreateDD, 2
(DD2 3
)DD3 4
;DD4 5
mediaTokenSettingsFF 
.FF 
HashKeyFF &
=FF' (
newFF) ,
byteFF- 1
[FF1 2
$numFF2 4
]FF4 5
;FF5 6
rngGG 
.GG 
GetBytesGG 
(GG 
mediaTokenSettingsGG +
.GG+ ,
HashKeyGG, 3
)GG3 4
;GG4 5
siteSettingsHH 
.HH 
PutHH 
(HH 
mediaTokenSettingsHH /
)HH/ 0
;HH0 1
awaitJJ 
_siteServiceJJ 
.JJ #
UpdateSiteSettingsAsyncJJ 6
(JJ6 7
siteSettingsJJ7 C
)JJC D
;JJD E
}KK 	
}LL 
}MM Ô

•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Processing\TokenCommandProcessor.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Processing &
{		 
public 

class !
TokenCommandProcessor &
:' (
IImageWebProcessor) ;
{ 
public 
const 
string 
TokenCommand (
=) *
$str+ 2
;2 3
public 
IEnumerable 
< 
string !
>! "
Commands# +
=> 
new 
[ 
] 
{ 
TokenCommand #
}$ %
;% &
public 
FormattedImage 
Process %
(% &
FormattedImage& 4
image5 :
,: ;
ILogger< C
loggerD J
,J K
IDictionaryL W
<W X
stringX ^
,^ _
string` f
>f g
commandsh p
,p q
CommandParserr 
parser
€ †
,
† ‡
CultureInfo
ˆ “
culture
” ›
)
› œ
=> 
image 
; 
} 
} µ`
—D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Razor\OrchardRazorHelperExtensions.cs
public 
static 
class (
OrchardRazorHelperExtensions 0
{ 
public 

static 
string 
AssetUrl !
(! "
this" &
IOrchardHelper' 5
orchardHelper6 C
,C D
stringE K
	assetPathL U
,U V
intW Z
?Z [
width\ a
=b c
nulld h
,h i
intj m
?m n
heighto u
=v w
nullx |
,| }

ResizeMode	~ ˆ

resizeMode
‰ “
=
” •

ResizeMode
–  
.
  ¡
	Undefined
¡ ª
,
ª «
bool
¬ °
appendVersion
± ¾
=
¿ À
false
Á Æ
,
Æ Ç
int
È Ë
?
Ë Ì
quality
Í Ô
=
Õ Ö
null
× Û
,
Û Ü
Format
İ ã
format
ä ê
=
ë ì
Format
í ó
.
ó ô
	Undefined
ô ı
,
ı ş
Anchor
ÿ …
anchor
† Œ
=
 
null
 “
,
“ ”
string
• ›
bgcolor
œ £
=
¤ ¥
null
¦ ª
)
ª «
{ 
var 
mediaFileStore 
= 
orchardHelper *
.* +
HttpContext+ 6
.6 7
RequestServices7 F
.F G

GetServiceG Q
<Q R
IMediaFileStoreR a
>a b
(b c
)c d
;d e
if 

( 
mediaFileStore 
== 
null "
)" #
{ 	
return 
	assetPath 
; 
} 	
var 
resolvedAssetPath 
= 
mediaFileStore  .
.. /
MapPathToPublicUrl/ A
(A B
	assetPathB K
)K L
;L M
if 

( 
appendVersion 
) 
{ 	
var 
fileVersionProvider #
=$ %
orchardHelper& 3
.3 4
HttpContext4 ?
.? @
RequestServices@ O
.O P

GetServiceP Z
<Z [ 
IFileVersionProvider[ o
>o p
(p q
)q r
;r s
resolvedAssetPath 
= 
fileVersionProvider  3
.3 4 
AddFileVersionToPath4 H
(H I
orchardHelperI V
.V W
HttpContextW b
.b c
Requestc j
.j k
PathBasek s
,s t
resolvedAssetPath	u †
)
† ‡
;
‡ ˆ
}   	
return"" 
orchardHelper"" 
."" 
ImageResizeUrl"" +
(""+ ,
resolvedAssetPath"", =
,""= >
width""? D
,""D E
height""F L
,""L M

resizeMode""N X
,""X Y
quality""Z a
,""a b
format""c i
,""i j
anchor""k q
,""q r
bgcolor""s z
)""z {
;""{ |
}## 
public(( 

static(( 
async(( 
Task(( 
<(( 
string(( #
>((# $ 
AssetProfileUrlAsync((% 9
(((9 :
this((: >
IOrchardHelper((? M
orchardHelper((N [
,(([ \
string((] c
	assetPath((d m
,((m n
string((o u
imageProfile	((v ‚
,
((‚ ƒ
int
((„ ‡
?
((‡ ˆ
width
((‰ 
=
(( 
null
((‘ •
,
((• –
int
((— š
?
((š ›
height
((œ ¢
=
((£ ¤
null
((¥ ©
,
((© ª

ResizeMode
((« µ

resizeMode
((¶ À
=
((Á Â

ResizeMode
((Ã Í
.
((Í Î
	Undefined
((Î ×
,
((× Ø
bool
((Ù İ
appendVersion
((Ş ë
=
((ì í
false
((î ó
,
((ó ô
int
((õ ø
?
((ø ù
quality
((ú 
=
((‚ ƒ
null
((„ ˆ
,
((ˆ ‰
Format
((Š 
format
((‘ —
=
((˜ ™
Format
((š  
.
((  ¡
	Undefined
((¡ ª
,
((ª «
Anchor
((¬ ²
anchor
((³ ¹
=
((º »
null
((¼ À
,
((À Á
string
((Â È
bgcolor
((É Ğ
=
((Ñ Ò
null
((Ó ×
)
((× Ø
{)) 
var** 
mediaFileStore** 
=** 
orchardHelper** *
.*** +
HttpContext**+ 6
.**6 7
RequestServices**7 F
.**F G

GetService**G Q
<**Q R
IMediaFileStore**R a
>**a b
(**b c
)**c d
;**d e
if,, 

(,, 
mediaFileStore,, 
==,, 
null,, "
),," #
{-- 	
return.. 
	assetPath.. 
;.. 
}// 	
var11 
resolvedAssetPath11 
=11 
mediaFileStore11  .
.11. /
MapPathToPublicUrl11/ A
(11A B
	assetPath11B K
)11K L
;11L M
if33 

(33 
appendVersion33 
)33 
{44 	
var55 
fileVersionProvider55 #
=55$ %
orchardHelper55& 3
.553 4
HttpContext554 ?
.55? @
RequestServices55@ O
.55O P

GetService55P Z
<55Z [ 
IFileVersionProvider55[ o
>55o p
(55p q
)55q r
;55r s
resolvedAssetPath77 
=77 
fileVersionProvider77  3
.773 4 
AddFileVersionToPath774 H
(77H I
orchardHelper77I V
.77V W
HttpContext77W b
.77b c
Request77c j
.77j k
PathBase77k s
,77s t
resolvedAssetPath	77u †
)
77† ‡
;
77‡ ˆ
}88 	
return:: 
await:: 
orchardHelper:: "
.::" #&
ImageProfileResizeUrlAsync::# =
(::= >
resolvedAssetPath::> O
,::O P
imageProfile::Q ]
,::] ^
width::_ d
,::d e
height::f l
,::l m

resizeMode::n x
,::x y
quality	::z 
,
:: ‚
format
::ƒ ‰
,
::‰ Š
anchor
::‹ ‘
,
::‘ ’
bgcolor
::“ š
)
::š ›
;
::› œ
};; 
public@@ 

static@@ 
string@@ 
ImageResizeUrl@@ '
(@@' (
this@@( ,
IOrchardHelper@@- ;
orchardHelper@@< I
,@@I J
string@@K Q
	imagePath@@R [
,@@[ \
int@@] `
?@@` a
width@@b g
=@@h i
null@@j n
,@@n o
int@@p s
?@@s t
height@@u {
=@@| }
null	@@~ ‚
,
@@‚ ƒ

ResizeMode
@@„ 

resizeMode
@@ ™
=
@@š ›

ResizeMode
@@œ ¦
.
@@¦ §
	Undefined
@@§ °
,
@@° ±
int
@@² µ
?
@@µ ¶
quality
@@· ¾
=
@@¿ À
null
@@Á Å
,
@@Å Æ
Format
@@Ç Í
format
@@Î Ô
=
@@Õ Ö
Format
@@× İ
.
@@İ Ş
	Undefined
@@Ş ç
,
@@ç è
Anchor
@@é ï
anchor
@@ğ ö
=
@@÷ ø
null
@@ù ı
,
@@ı ş
string
@@ÿ …
bgcolor
@@† 
=
@@ 
null
@@ ”
)
@@” •
{AA 
varBB 

resizedUrlBB 
=BB "
ImageSharpUrlFormatterBB /
.BB/ 0
GetImageResizeUrlBB0 A
(BBA B
	imagePathBBB K
,BBK L
nullBBM Q
,BBQ R
widthBBS X
,BBX Y
heightBBZ `
,BB` a

resizeModeBBb l
,BBl m
qualityBBn u
,BBu v
formatBBw }
,BB} ~
anchor	BB …
,
BB… †
bgcolor
BB‡ 
)
BB 
;
BB 
returnDD 
orchardHelperDD 
.DD 
TokenizeUrlDD (
(DD( )

resizedUrlDD) 3
)DD3 4
;DD4 5
}EE 
publicJJ 

staticJJ 
asyncJJ 
TaskJJ 
<JJ 
stringJJ #
>JJ# $&
ImageProfileResizeUrlAsyncJJ% ?
(JJ? @
thisJJ@ D
IOrchardHelperJJE S
orchardHelperJJT a
,JJa b
stringJJc i
	imagePathJJj s
,JJs t
stringJJu {
imageProfile	JJ| ˆ
,
JJˆ ‰
int
JJŠ 
?
JJ 
width
JJ ”
=
JJ• –
null
JJ— ›
,
JJ› œ
int
JJ  
?
JJ  ¡
height
JJ¢ ¨
=
JJ© ª
null
JJ« ¯
,
JJ¯ °

ResizeMode
JJ± »

resizeMode
JJ¼ Æ
=
JJÇ È

ResizeMode
JJÉ Ó
.
JJÓ Ô
	Undefined
JJÔ İ
,
JJİ Ş
int
JJß â
?
JJâ ã
quality
JJä ë
=
JJì í
null
JJî ò
,
JJò ó
Format
JJô ú
format
JJû 
=
JJ‚ ƒ
Format
JJ„ Š
.
JJŠ ‹
	Undefined
JJ‹ ”
,
JJ” •
Anchor
JJ– œ
anchor
JJ £
=
JJ¤ ¥
null
JJ¦ ª
,
JJª «
string
JJ¬ ²
bgcolor
JJ³ º
=
JJ» ¼
null
JJ½ Á
)
JJÁ Â
{KK 
varLL 
mediaProfileServiceLL 
=LL  !
orchardHelperLL" /
.LL/ 0
HttpContextLL0 ;
.LL; <
RequestServicesLL< K
.LLK L
GetRequiredServiceLLL ^
<LL^ _ 
IMediaProfileServiceLL_ s
>LLs t
(LLt u
)LLu v
;LLv w
varMM 
queryStringParamsMM 
=MM 
awaitMM  %
mediaProfileServiceMM& 9
.MM9 :#
GetMediaProfileCommandsMM: Q
(MMQ R
imageProfileMMR ^
)MM^ _
;MM_ `
varOO 

resizedUrlOO 
=OO "
ImageSharpUrlFormatterOO /
.OO/ 0
GetImageResizeUrlOO0 A
(OOA B
	imagePathOOB K
,OOK L
queryStringParamsOOM ^
,OO^ _
widthOO` e
,OOe f
heightOOg m
,OOm n

resizeModeOOo y
,OOy z
quality	OO{ ‚
,
OO‚ ƒ
format
OO„ Š
,
OOŠ ‹
anchor
OOŒ ’
,
OO’ “
bgcolor
OO” ›
)
OO› œ
;
OOœ 
returnQQ 
orchardHelperQQ 
.QQ 
TokenizeUrlQQ (
(QQ( )

resizedUrlQQ) 3
)QQ3 4
;QQ4 5
}RR 
privateTT 
staticTT 
stringTT 
TokenizeUrlTT %
(TT% &
thisTT& *
IOrchardHelperTT+ 9
orchardHelperTT: G
,TTG H
stringTTI O
urlTTP S
)TTS T
{UU 
varVV 
mediaOptionsVV 
=VV 
orchardHelperVV (
.VV( )
HttpContextVV) 4
.VV4 5
RequestServicesVV5 D
.VVD E

GetServiceVVE O
<VVO P
IOptionsVVP X
<VVX Y
MediaOptionsVVY e
>VVe f
>VVf g
(VVg h
)VVh i
.VVi j
ValueVVj o
;VVo p
ifWW 

(WW 
mediaOptionsWW 
.WW #
UseTokenizedQueryStringWW 0
)WW0 1
{XX 	
varYY 
mediaTokenServiceYY !
=YY" #
orchardHelperYY$ 1
.YY1 2
HttpContextYY2 =
.YY= >
RequestServicesYY> M
.YYM N

GetServiceYYN X
<YYX Y
IMediaTokenServiceYYY k
>YYk l
(YYl m
)YYm n
;YYn o
url[[ 
=[[ 
mediaTokenService[[ #
.[[# $
AddTokenToPath[[$ 2
([[2 3
url[[3 6
)[[6 7
;[[7 8
}\\ 	
return^^ 
url^^ 
;^^ 
}__ 
}`` Ú
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Recipes\MediaProfileStep.cs
	namespace		 	
OrchardCore		
 
.		 
Media		 
.		 
Recipes		 #
{

 
public 

class 
MediaProfileStep !
:" #
IRecipeStepHandler$ 6
{ 
private 
readonly  
MediaProfilesManager -!
_mediaProfilesManager. C
;C D
public 
MediaProfileStep 
(   
MediaProfilesManager  4 
mediaProfilesManager5 I
)I J
{ 	!
_mediaProfilesManager !
=" # 
mediaProfilesManager$ 8
;8 9
} 	
public 
async 
Task 
ExecuteAsync &
(& '"
RecipeExecutionContext' =
context> E
)E F
{ 	
if 
( 
! 
String 
. 
Equals 
( 
context &
.& '
Name' +
,+ ,
$str- <
,< =
StringComparison> N
.N O
OrdinalIgnoreCaseO `
)` a
)a b
{ 
return 
; 
} 
var 
model 
= 
context 
.  
Step  $
.$ %
ToObject% -
<- .!
MediaProfileStepModel. C
>C D
(D E
)E F
;F G
foreach   
(   
var   
mediaProfile   %
in  & (
model  ) .
.  . /
MediaProfiles  / <
)  < =
{!! 
await"" !
_mediaProfilesManager"" +
.""+ ,#
UpdateMediaProfileAsync"", C
(""C D
mediaProfile""D P
.""P Q
Key""Q T
,""T U
mediaProfile""V b
.""b c
Value""c h
)""h i
;""i j
}## 
}$$ 	
}%% 
public'' 

class'' !
MediaProfileStepModel'' &
{(( 
public)) 

Dictionary)) 
<)) 
string))  
,))  !
MediaProfile))" .
>)). /
MediaProfiles))0 =
{))> ?
get))@ C
;))C D
set))E H
;))H I
}))J K
}** 
}++ ¼0
†D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Recipes\MediaStep.cs
	namespace		 	
OrchardCore		
 
.		 
Media		 
.		 
Recipes		 #
{

 
public 

class 
	MediaStep 
: 
IRecipeStepHandler /
{ 
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly 
static 

HttpClient  *
_httpClient+ 6
=7 8
new9 <

HttpClient= G
(G H
)H I
;I J
public 
	MediaStep 
( 
IMediaFileStore (
mediaFileStore) 7
)7 8
{ 	
_mediaFileStore 
= 
mediaFileStore ,
;, -
} 	
public 
async 
Task 
ExecuteAsync &
(& '"
RecipeExecutionContext' =
context> E
)E F
{ 	
if 
( 
! 
String 
. 
Equals 
( 
context &
.& '
Name' +
,+ ,
$str- 4
,4 5
StringComparison6 F
.F G
OrdinalIgnoreCaseG X
)X Y
)Y Z
{ 
return 
; 
} 
var 
model 
= 
context 
.  
Step  $
.$ %
ToObject% -
<- .
MediaStepModel. <
>< =
(= >
)> ?
;? @
foreach!! 
(!! 
var!! 
file!! 
in!!  
model!!! &
.!!& '
Files!!' ,
)!!, -
{"" 
Stream## 
stream## 
=## 
null##  $
;##$ %
if%% 
(%% 
!%% 
String%% 
.%% 
IsNullOrWhiteSpace%% .
(%%. /
file%%/ 3
.%%3 4
Base64%%4 :
)%%: ;
)%%; <
{&& 
stream'' 
='' 
new''  
MemoryStream''! -
(''- .
Convert''. 5
.''5 6
FromBase64String''6 F
(''F G
file''G K
.''K L
Base64''L R
)''R S
)''S T
;''T U
}(( 
else)) 
if)) 
()) 
!)) 
String))  
.))  !
IsNullOrWhiteSpace))! 3
())3 4
file))4 8
.))8 9

SourcePath))9 C
)))C D
)))D E
{** 
var++ 
fileInfo++  
=++! "
context++# *
.++* +
RecipeDescriptor+++ ;
.++; <
FileProvider++< H
.++H I
GetRelativeFileInfo++I \
(++\ ]
context++] d
.++d e
RecipeDescriptor++e u
.++u v
BasePath++v ~
,++~ 
file
++€ „
.
++„ …

SourcePath
++… 
)
++ 
;
++ ‘
stream-- 
=-- 
fileInfo-- %
.--% &
CreateReadStream--& 6
(--6 7
)--7 8
;--8 9
}.. 
else// 
if// 
(// 
!// 
String//  
.//  !
IsNullOrWhiteSpace//! 3
(//3 4
file//4 8
.//8 9
	SourceUrl//9 B
)//B C
)//C D
{00 
var11 
response11  
=11! "
await11# (
_httpClient11) 4
.114 5
GetAsync115 =
(11= >
file11> B
.11B C
	SourceUrl11C L
)11L M
;11M N
if22 
(22 
response22  
.22  !
IsSuccessStatusCode22! 4
)224 5
{33 
stream44 
=44  
await44! &
response44' /
.44/ 0
Content440 7
.447 8
ReadAsStreamAsync448 I
(44I J
)44J K
;44K L
}55 
}66 
if88 
(88 
stream88 
!=88 
null88 "
)88" #
{99 
try:: 
{;; 
await<< 
_mediaFileStore<< -
.<<- .%
CreateFileFromStreamAsync<<. G
(<<G H
file<<H L
.<<L M

TargetPath<<M W
,<<W X
stream<<Y _
,<<_ `
true<<a e
)<<e f
;<<f g
}== 
finally>> 
{?? 
stream@@ 
?@@ 
.@@  
Dispose@@  '
(@@' (
)@@( )
;@@) *
}AA 
}BB 
}CC 
}DD 	
privateFF 
classFF 
MediaStepModelFF $
{GG 	
publicKK 
MediaStepFileKK  
[KK  !
]KK! "
FilesKK# (
{KK) *
getKK+ .
;KK. /
setKK0 3
;KK3 4
}KK5 6
}LL 	
privateNN 
classNN 
MediaStepFileNN #
{OO 	
publicTT 
stringTT 
PathTT 
{TT  
getTT! $
=>TT% '

TargetPathTT( 2
;TT2 3
setTT4 7
=>TT8 :

TargetPathTT; E
=TTF G
valueTTH M
;TTM N
}TTO P
publicZZ 
stringZZ 

TargetPathZZ $
{ZZ% &
getZZ' *
;ZZ* +
setZZ, /
;ZZ/ 0
}ZZ1 2
publicbb 
stringbb 
Base64bb  
{bb! "
getbb# &
;bb& '
setbb( +
;bb+ ,
}bb- .
publicjj 
stringjj 

SourcePathjj $
{jj% &
getjj' *
;jj* +
setjj, /
;jj/ 0
}jj1 2
publicrr 
stringrr 
	SourceUrlrr #
{rr$ %
getrr& )
;rr) *
setrr+ .
;rr. /
}rr0 1
}ss 	
}tt 
}uu Ş
›D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\RemotePublishing\MediaMetaWeblogDriver.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
RemotePublishing ,
{ 
public 

class !
MediaMetaWeblogDriver &
:' (
MetaWeblogDriver) 9
{ 
public 
override 
void 
SetCapabilities ,
(, -
Action- 3
<3 4
string4 :
,: ;
string< B
>B C
setCapabilityD Q
)Q R
{		 	
setCapability

 
(

 
$str

 .
,

. /
$str

0 5
)

5 6
;

6 7
} 	
} 
} É
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\RemotePublishing\Startup.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
RemotePublishing ,
{ 
[ 
RequireFeatures 
( 
$str 3
)3 4
]4 5
public 

class #
RemotePublishingStartup (
:) *
StartupBase+ 6
{		 
public

 
override

 
void

 
ConfigureServices

 .
(

. /
IServiceCollection

/ A
services

B J
)

J K
{ 	
services 
. 
	AddScoped 
< 
IMetaWeblogDriver 0
,0 1!
MediaMetaWeblogDriver2 G
>G H
(H I
)I J
;J K
} 	
} 
} İc
›D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\AttachedMediaFieldFileService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class )
AttachedMediaFieldFileService .
{ 
private 
readonly 
IMediaFileStore (

_fileStore) 3
;3 4
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly 
ILogger  
_logger! (
;( )
public )
AttachedMediaFieldFileService ,
(, -
IMediaFileStore 
	fileStore %
,% & 
IHttpContextAccessor  
httpContextAccessor! 4
,4 5
ILogger 
< )
AttachedMediaFieldFileService 1
>1 2
logger3 9
)9 :
{ 	

_fileStore 
= 
	fileStore "
;" # 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
_logger   
=   
logger   
;   
MediaFieldsFolder"" 
="" 
$str""  -
;""- .$
MediaFieldsTempSubFolder## $
=##% &

_fileStore##' 1
.##1 2
Combine##2 9
(##9 :
MediaFieldsFolder##: K
,##K L
$str##M S
)##S T
;##T U
}$$ 	
public&& 
string&& 
MediaFieldsFolder&& '
{&&( )
get&&* -
;&&- .
}&&/ 0
public'' 
string'' $
MediaFieldsTempSubFolder'' .
{''/ 0
get''1 4
;''4 5
}''6 7
public// 
Task// (
DeleteContentItemFolderAsync// 0
(//0 1
ContentItem//1 <
contentItem//= H
)//H I
{00 	
return11 

_fileStore11 
.11 #
TryDeleteDirectoryAsync11 5
(115 6 
GetContentItemFolder116 J
(11J K
contentItem11K V
)11V W
)11W X
;11X Y
}22 	
public77 
async77 
Task77 )
HandleFilesOnFieldUpdateAsync77 7
(777 8
List778 <
<77< ="
EditMediaFieldItemInfo77= S
>77S T
items77U Z
,77Z [
ContentItem77\ g
contentItem77h s
)77s t
{88 	
if99 
(99 
items99 
==99 
null99 
)99 
{:: 
throw;; 
new;; !
ArgumentNullException;; /
(;;/ 0
nameof;;0 6
(;;6 7
items;;7 <
);;< =
);;= >
;;;> ?
}<< 
if>> 
(>>  
_httpContextAccessor>> $
.>>$ %
HttpContext>>% 0
?>>0 1
.>>1 2
Features>>2 :
.>>: ;
Get>>; >
<>>> ?!
ContentPreviewFeature>>? T
>>>T U
(>>U V
)>>V W
?>>W X
.>>X Y

Previewing>>Y c
==>>d f
true>>g k
)>>k l
{?? 
return@@ 
;@@ 
}AA 
awaitCC (
EnsureGlobalDirectoriesAsyncCC .
(CC. /
)CC/ 0
;CC0 1
awaitEE  
RemoveTemporaryAsyncEE &
(EE& '
itemsEE' ,
)EE, -
;EE- .
awaitGG ;
/MoveNewFilesToContentItemDirAndUpdatePathsAsyncGG A
(GGA B
itemsGGB G
,GGG H
contentItemGGI T
)GGT U
;GGU V
}HH 	
privateJJ 
asyncJJ 
TaskJJ (
EnsureGlobalDirectoriesAsyncJJ 7
(JJ7 8
)JJ8 9
{KK 	
awaitLL 

_fileStoreLL 
.LL #
TryCreateDirectoryAsyncLL 4
(LL4 5
MediaFieldsFolderLL5 F
)LLF G
;LLG H
awaitMM 

_fileStoreMM 
.MM #
TryCreateDirectoryAsyncMM 4
(MM4 5$
MediaFieldsTempSubFolderMM5 M
)MMM N
;MMN O
}NN 	
privateQQ 
asyncQQ 
TaskQQ  
RemoveTemporaryAsyncQQ /
(QQ/ 0
ListQQ0 4
<QQ4 5"
EditMediaFieldItemInfoQQ5 K
>QQK L
itemsQQM R
)QQR S
{RR 	
foreachSS 
(SS 
varSS 
itemSS 
inSS  
itemsSS! &
.SS& '
WhereSS' ,
(SS, -
iSS- .
=>SS/ 1
iSS2 3
.SS3 4
	IsRemovedSS4 =
&&SS> @
iSSA B
.SSB C
IsNewSSC H
)SSH I
)SSI J
{TT 
awaitUU 

_fileStoreUU  
.UU  !
TryDeleteFileAsyncUU! 3
(UU3 4
itemUU4 8
.UU8 9
PathUU9 =
)UU= >
;UU> ?
}VV 
}WW 	
privateZZ 
asyncZZ 
TaskZZ ;
/MoveNewFilesToContentItemDirAndUpdatePathsAsyncZZ J
(ZZJ K
ListZZK O
<ZZO P"
EditMediaFieldItemInfoZZP f
>ZZf g
itemsZZh m
,ZZm n
ContentItemZZo z
contentItem	ZZ{ †
)
ZZ† ‡
{[[ 	
foreach\\ 
(\\ 
var\\ 
item\\ 
in\\  
items\\! &
.\\& '
Where\\' ,
(\\, -
i\\- .
=>\\/ 1
!\\2 3
i\\3 4
.\\4 5
	IsRemoved\\5 >
&&\\? A
!\\B C
String\\C I
.\\I J
IsNullOrEmpty\\J W
(\\W X
i\\X Y
.\\Y Z
Path\\Z ^
)\\^ _
)\\_ `
)\\` a
{]] 
var^^ 
fileInfo^^ 
=^^ 
await^^ $

_fileStore^^% /
.^^/ 0
GetFileInfoAsync^^0 @
(^^@ A
item^^A E
.^^E F
Path^^F J
)^^J K
;^^K L
if`` 
(`` 
fileInfo`` 
==`` 
null``  $
)``$ %
{aa 
_loggerbb 
.bb 
LogErrorbb $
(bb$ %
$strbb% T
,bbT U
itembbV Z
.bbZ [
Pathbb[ _
)bb_ `
;bb` a
returncc 
;cc 
}dd 
varff 
	targetDirff 
=ff  
GetContentItemFolderff  4
(ff4 5
contentItemff5 @
)ff@ A
;ffA B
vargg 
finalFileNamegg !
=gg" #
(gg$ %
awaitgg% *
GetFileHashAsyncgg+ ;
(gg; <
itemgg< @
.gg@ A
PathggA E
)ggE F
)ggF G
+ggH I
GetFileExtensionggJ Z
(ggZ [
itemgg[ _
.gg_ `
Pathgg` d
)ggd e
;gge f
varhh 
finalFilePathhh !
=hh" #

_fileStorehh$ .
.hh. /
Combinehh/ 6
(hh6 7
	targetDirhh7 @
,hh@ A
finalFileNamehhB O
)hhO P
;hhP Q
awaitjj 

_fileStorejj  
.jj  !#
TryCreateDirectoryAsyncjj! 8
(jj8 9
	targetDirjj9 B
)jjB C
;jjC D
varnn 
previousDirPathnn #
=nn$ %
fileInfonn& .
.nn. /
DirectoryPathnn/ <
;nn< =
ifqq 
(qq 
awaitqq 

_fileStoreqq $
.qq$ %
GetFileInfoAsyncqq% 5
(qq5 6
finalFilePathqq6 C
)qqC D
==qqE G
nullqqH L
)qqL M
{rr 
awaitss 

_fileStoress $
.ss$ %
MoveFileAsyncss% 2
(ss2 3
itemss3 7
.ss7 8
Pathss8 <
,ss< =
finalFilePathss> K
)ssK L
;ssL M
}tt 
itemvv 
.vv 
Pathvv 
=vv 
finalFilePathvv )
;vv) *
awaitxx !
DeleteDirIfEmptyAsyncxx +
(xx+ ,
previousDirPathxx, ;
)xx; <
;xx< =
}yy 
}zz 	
private|| 
string||  
GetContentItemFolder|| +
(||+ ,
ContentItem||, 7
contentItem||8 C
)||C D
{}} 	
return~~ 

_fileStore~~ 
.~~ 
Combine~~ %
(~~% &
MediaFieldsFolder~~& 7
,~~7 8
contentItem~~9 D
.~~D E
ContentType~~E P
,~~P Q
contentItem~~R ]
.~~] ^
ContentItemId~~^ k
)~~k l
;~~l m
} 	
private
 
async
 
Task
 
<
 
string
 !
>
! "
GetFileHashAsync
# 3
(
3 4
string
4 :
filePath
; C
)
C D
{
‚‚ 	
using
ƒƒ 
(
ƒƒ 
var
ƒƒ 
fs
ƒƒ 
=
ƒƒ 
await
ƒƒ !

_fileStore
ƒƒ" ,
.
ƒƒ, - 
GetFileStreamAsync
ƒƒ- ?
(
ƒƒ? @
filePath
ƒƒ@ H
)
ƒƒH I
)
ƒƒI J
using
„„ 
(
„„ 
HashAlgorithm
„„  
hashAlgorithm
„„! .
=
„„/ 0
MD5
„„1 4
.
„„4 5
Create
„„5 ;
(
„„; <
)
„„< =
)
„„= >
{
…… 
var
†† 
hash
†† 
=
†† 
hashAlgorithm
†† (
.
††( )
ComputeHash
††) 4
(
††4 5
fs
††5 7
)
††7 8
;
††8 9
return
‡‡ "
ByteArrayToHexString
‡‡ +
(
‡‡+ ,
hash
‡‡, 0
)
‡‡0 1
;
‡‡1 2
}
ˆˆ 
}
‰‰ 	
public
‹‹ 
string
‹‹ "
ByteArrayToHexString
‹‹ *
(
‹‹* +
byte
‹‹+ /
[
‹‹/ 0
]
‹‹0 1
bytes
‹‹2 7
)
‹‹7 8
{
ŒŒ 	
var
 
sb
 
=
 
new
 
StringBuilder
 &
(
& '
)
' (
;
( )
foreach
 
(
 
var
 
b
 
in
 
bytes
 #
)
# $
{
 
sb
 
.
 
Append
 
(
 
b
 
.
 
ToString
 $
(
$ %
$str
% )
)
) *
.
* +
ToLower
+ 2
(
2 3
)
3 4
)
4 5
;
5 6
}
‘‘ 
return
““ 
sb
““ 
.
““ 
ToString
““ 
(
““ 
)
““  
;
““  !
}
”” 	
private
–– 
string
–– 
GetFileExtension
–– '
(
––' (
string
––( .
path
––/ 3
)
––3 4
{
—— 	
var
˜˜ 
	lastPoint
˜˜ 
=
˜˜ 
path
˜˜  
.
˜˜  !
LastIndexOf
˜˜! ,
(
˜˜, -
$char
˜˜- 0
)
˜˜0 1
;
˜˜1 2
return
™™ 
	lastPoint
™™ 
>
™™ 
-
™™  
$num
™™  !
?
™™" #
path
™™$ (
.
™™( )
	Substring
™™) 2
(
™™2 3
	lastPoint
™™3 <
)
™™< =
:
™™> ?
$str
™™@ B
;
™™B C
}
šš 	
private
œœ 
async
œœ 
Task
œœ #
DeleteDirIfEmptyAsync
œœ 0
(
œœ0 1
string
œœ1 7
previousDirPath
œœ8 G
)
œœG H
{
 	
if
 
(
 
await
 

_fileStore
  
.
  !#
GetDirectoryInfoAsync
! 6
(
6 7
previousDirPath
7 F
)
F G
==
H J
null
K O
)
O P
{
ŸŸ 
return
   
;
   
}
¡¡ 
if
££ 
(
££ 
!
££ 
(
££ 
await
££ 

_fileStore
££ "
.
££" #&
GetDirectoryContentAsync
££# ;
(
££; <
previousDirPath
££< K
)
££K L
.
££L M
AnyAsync
££M U
(
££U V
)
££V W
)
££W X
)
££X Y
{
¤¤ 
await
¥¥ 

_fileStore
¥¥  
.
¥¥  !%
TryDeleteDirectoryAsync
¥¥! 8
(
¥¥8 9
previousDirPath
¥¥9 H
)
¥¥H I
;
¥¥I J
}
¦¦ 
}
§§ 	
}
¨¨ 
}©© ¬.
«D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\AttachedMediaFieldsFolderAuthorizationHandler.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{		 
public 

class 9
-AttachedMediaFieldsFolderAuthorizationHandler >
:? @ 
AuthorizationHandlerA U
<U V!
PermissionRequirementV k
>k l
{ 
private 
readonly 
IServiceProvider )
_serviceProvider* :
;: ;
private 
readonly )
AttachedMediaFieldFileService 6*
_attachedMediaFieldFileService7 U
;U V
private 
readonly 
IMediaFileStore (

_fileStore) 3
;3 4
private 
char 
_pathSeparator #
;# $
private 
string 
_mediaFieldsFolder )
;) *
public 9
-AttachedMediaFieldsFolderAuthorizationHandler <
(< =
IServiceProvider= M
serviceProviderN ]
,] ^)
AttachedMediaFieldFileService ))
attachedMediaFieldFileService* G
,G H
IMediaFileStore 
	fileStore %
)% &
{ 	
_serviceProvider 
= 
serviceProvider .
;. /*
_attachedMediaFieldFileService *
=+ ,)
attachedMediaFieldFileService- J
;J K

_fileStore 
= 
	fileStore "
;" #
} 	
	protected 
override 
async  
Task! %"
HandleRequirementAsync& <
(< ='
AuthorizationHandlerContext= X
contextY `
,` a!
PermissionRequirementb w
requirement	x ƒ
)
ƒ „
{   	
if!! 
(!! 
context!! 
.!! 
HasSucceeded!! $
)!!$ %
{"" 
return$$ 
;$$ 
}%% 
if'' 
('' 
requirement'' 
.'' 

Permission'' &
.''& '
Name''' +
!='', .
Permissions''/ :
.'': ;+
ManageAttachedMediaFieldsFolder''; Z
.''Z [
Name''[ _
)''_ `
{(( 
return)) 
;)) 
}** 
if,, 
(,, 
context,, 
.,, 
Resource,,  
==,,! #
null,,$ (
),,( )
{-- 
return.. 
;.. 
}// 
_pathSeparator11 
=11 

_fileStore11 '
.11' (
Combine11( /
(11/ 0
$str110 3
,113 4
$str115 8
)118 9
.119 :
Contains11: B
(11B C
$char11C F
)11F G
?11H I
$char11J M
:11N O
$char11P T
;11T U
_mediaFieldsFolder44 
=44  

_fileStore44! +
.44+ ,
NormalizePath44, 9
(449 :*
_attachedMediaFieldFileService44: X
.44X Y
MediaFieldsFolder44Y j
)44j k
.55  !
TrimEnd55! (
(55( )
_pathSeparator55) 7
)557 8
+559 :
_pathSeparator55; I
;55I J
var77 
path77 
=77 
context77 
.77 
Resource77 '
as77( *
string77+ 1
;771 2
if99 
(99 
IsMediaFieldsFolder99 #
(99# $
path99$ (
)99( )
||99* ,+
IsDescendantOfMediaFieldsFolder99- L
(99L M
path99M Q
)99Q R
)99R S
{:: 
return;; 
;;; 
}<< 
var??  
authorizationService?? $
=??% &
_serviceProvider??' 7
.??7 8

GetService??8 B
<??B C!
IAuthorizationService??C X
>??X Y
(??Y Z
)??Z [
;??[ \
if@@ 
(@@ 
await@@  
authorizationService@@ *
.@@* +
AuthorizeAsync@@+ 9
(@@9 :
context@@: A
.@@A B
User@@B F
,@@F G
Permissions@@H S
.@@S T
ManageMedia@@T _
)@@_ `
)@@` a
{AA 
contextBB 
.BB 
SucceedBB 
(BB  
requirementBB  +
)BB+ ,
;BB, -
}CC 
}DD 	
privateFF 
boolFF 
IsMediaFieldsFolderFF (
(FF( )
stringFF) /
	childPathFF0 9
)FF9 :
{GG 	
	childPathII 
=II 

_fileStoreII "
.II" #
NormalizePathII# 0
(II0 1
	childPathII1 :
)II: ;
.JJ 
TrimEndJJ  
(JJ  !
_pathSeparatorJJ! /
)JJ/ 0
+JJ1 2
_pathSeparatorJJ3 A
;JJA B
returnLL 
	childPathLL 
.LL 
EqualsLL #
(LL# $
_mediaFieldsFolderLL$ 6
)LL6 7
;LL7 8
}MM 	
privateOO 
boolOO +
IsDescendantOfMediaFieldsFolderOO 4
(OO4 5
stringOO5 ;
	childPathOO< E
)OOE F
{PP 	
	childPathQQ 
=QQ 

_fileStoreQQ "
.QQ" #
NormalizePathQQ# 0
(QQ0 1
	childPathQQ1 :
)QQ: ;
;QQ; <
returnRR 
	childPathRR 
.RR 

StartsWithRR '
(RR' (
_mediaFieldsFolderRR( :
,RR: ;
StringComparisonRR< L
.RRL M
OrdinalRRM T
)RRT U
;RRU V
}SS 	
}TT 
}UU ¥
’D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\IMediaProfileService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

	interface  
IMediaProfileService )
{ 
Task 
< 
IDictionary 
< 
string 
,  
string! '
>' (
>( )#
GetMediaProfileCommands* A
(A B
stringB H
nameI M
)M N
;N O
}		 
}

 Ö
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\MediaFileProvider.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class 
MediaFileProvider "
:# $ 
PhysicalFileProvider% 9
,9 :
IMediaFileProvider; M
{ 
public		 
MediaFileProvider		  
(		  !

PathString		! +
virtualPathBase		, ;
,		; <
string		= C
root		D H
)		H I
:		J K
base		L P
(		P Q
root		Q U
)		U V
{

 	
VirtualPathBase 
= 
virtualPathBase -
;- .
} 	
public 
MediaFileProvider  
(  !

PathString! +
virtualPathBase, ;
,; <
string= C
rootD H
,H I
ExclusionFiltersJ Z
filters[ b
)b c
:d e
basef j
(j k
rootk o
,o p
filtersq x
)x y
{ 	
VirtualPathBase 
= 
virtualPathBase -
;- .
} 	
public 

PathString 
VirtualPathBase )
{* +
get, /
;/ 0
}1 2
} 
} Ç:
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\MediaFileStoreResolverMiddleware.cs
	namespace

 	
OrchardCore


 
.

 
Media

 
.

 
Services

 $
{ 
public 

class ,
 MediaFileStoreResolverMiddleware 1
{ 
private 
readonly  
ConcurrentDictionary -
<- .
string. 4
,4 5
Lazy6 :
<: ;
Task; ?
>? @
>@ A
WorkersB I
=J K
newL O 
ConcurrentDictionaryP d
<d e
stringe k
,k l
Lazym q
<q r
Taskr v
>v w
>w x
(x y
StringComparer	y ‡
.
‡ ˆ
OrdinalIgnoreCase
ˆ ™
)
™ š
;
š ›
private 
readonly 
RequestDelegate (
_next) .
;. /
private 
readonly 
ILogger  
_logger! (
;( )
private 
readonly  
IMediaFileStoreCache - 
_mediaFileStoreCache. B
;B C
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly 

PathString #
_assetsRequestPath$ 6
;6 7
public ,
 MediaFileStoreResolverMiddleware /
(/ 0
RequestDelegate 
next  
,  !
ILogger 
< ,
 MediaFileStoreResolverMiddleware 4
>4 5
logger6 <
,< = 
IMediaFileStoreCache  
mediaFileStoreCache! 4
,4 5
IMediaFileStore 
mediaFileStore *
,* +
IOptions 
< 
MediaOptions !
>! "
mediaOptions# /
)   
{!! 	
_next"" 
="" 
next"" 
;"" 
_logger## 
=## 
logger## 
;##  
_mediaFileStoreCache$$  
=$$! "
mediaFileStoreCache$$# 6
;$$6 7
_mediaFileStore%% 
=%% 
mediaFileStore%% ,
;%%, -
_assetsRequestPath'' 
=''  
mediaOptions''! -
.''- .
Value''. 3
.''3 4
AssetsRequestPath''4 E
;''E F
}(( 	
public.. 
async.. 
Task.. 
Invoke..  
(..  !
HttpContext..! ,
context..- 4
)..4 5
{// 	
if11 
(11 
!11 
HttpMethods11 
.11 
IsGet11 "
(11" #
context11# *
.11* +
Request11+ 2
.112 3
Method113 9
)119 :
&&11; =
!11> ?
HttpMethods11? J
.11J K
IsHead11K Q
(11Q R
context11R Y
.11Y Z
Request11Z a
.11a b
Method11b h
)11h i
)11i j
{22 
await33 
_next33 
(33 
context33 #
)33# $
;33$ %
return44 
;44 
}55 
var77 
validatePath77 
=77 
context77 &
.77& '
Request77' .
.77. /
Path77/ 3
.773 4(
StartsWithNormalizedSegments774 P
(77P Q
_assetsRequestPath77Q c
,77c d
StringComparison77e u
.77u v
OrdinalIgnoreCase	77v ‡
,
77‡ ˆ
out
77‰ Œ
var
77 
subPath
77‘ ˜
)
77˜ ™
;
77™ š
if88 
(88 
!88 
validatePath88 
)88 
{99 
_logger:: 
.:: 
LogDebug::  
(::  !
$str::! k
,::k l
subPath::m t
,::t u
_assetsRequestPath	::v ˆ
)
::ˆ ‰
;
::‰ Š
await;; 
_next;; 
(;; 
context;; #
);;# $
;;;$ %
return<< 
;<< 
}== 
var@@ 
subPathValue@@ 
=@@ 
subPath@@ &
.@@& '
Value@@' ,
;@@, -
varBB 
isFileCachedBB 
=BB 
awaitBB $ 
_mediaFileStoreCacheBB% 9
.BB9 :
IsCachedAsyncBB: G
(BBG H
subPathValueBBH T
)BBT U
;BBU V
ifCC 
(CC 
isFileCachedCC 
)CC 
{DD 
ifGG 
(GG 
WorkersGG 
.GG 
TryGetValueGG '
(GG' (
subPathValueGG( 4
,GG4 5
outGG6 9
varGG: =
	writeTaskGG> G
)GGG H
)GGH I
{HH 
awaitII 
	writeTaskII #
.II# $
ValueII$ )
;II) *
}JJ 
awaitLL 
_nextLL 
(LL 
contextLL #
)LL# $
;LL$ %
returnMM 
;MM 
}NN 
awaitRR 
WorkersRR 
.RR 
GetOrAddRR "
(RR" #
subPathValueRR# /
,RR/ 0
xRR1 2
=>RR3 5
newRR6 9
LazyRR: >
<RR> ?
TaskRR? C
>RRC D
(RRD E
asyncRRE J
(RRK L
)RRL M
=>RRN P
{SS 
tryTT 
{UU 
varVV 
fileStoreEntryVV &
=VV' (
awaitVV) .
_mediaFileStoreVV/ >
.VV> ?
GetFileInfoAsyncVV? O
(VVO P
subPathValueVVP \
)VV\ ]
;VV] ^
ifXX 
(XX 
fileStoreEntryXX &
!=XX' )
nullXX* .
)XX. /
{YY 
usingZZ 
(ZZ 
varZZ "
streamZZ# )
=ZZ* +
awaitZZ, 1
_mediaFileStoreZZ2 A
.ZZA B
GetFileStreamAsyncZZB T
(ZZT U
fileStoreEntryZZU c
)ZZc d
)ZZd e
{[[ 
await\\ ! 
_mediaFileStoreCache\\" 6
.\\6 7
SetCacheAsync\\7 D
(\\D E
stream\\E K
,\\K L
fileStoreEntry\\M [
,\\[ \
context\\] d
.\\d e
RequestAborted\\e s
)\\s t
;\\t u
}]] 
}^^ 
}__ 
catch`` 
(`` 
	Exception``  
ex``! #
)``# $
{aa 
_loggeree 
.ee 
LogErroree $
(ee$ %
exee% '
,ee' (
$stree) n
,een o
subPathValueeep |
)ee| }
;ee} ~
}ff 
finallygg 
{hh 
Workersii 
.ii 
	TryRemoveii %
(ii% &
subPathValueii& 2
,ii2 3
outii4 7
varii8 ;
	writeTaskii< E
)iiE F
;iiF G
}jj 
}kk 
,kk  
LazyThreadSafetyModekk #
.kk# $#
ExecutionAndPublicationkk$ ;
)kk; <
)kk< =
.kk= >
Valuekk> C
;kkC D
awaitnn 
_nextnn 
(nn 
contextnn 
)nn  
;nn  !
returnoo 
;oo 
}pp 	
}qq 
}rr ÅE
—D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\MediaOptionsConfiguration.cs
	namespace

 	
OrchardCore


 
.

 
Media

 
.

 
Services

 $
{ 
public 

class %
MediaOptionsConfiguration *
:+ ,
IConfigureOptions- >
<> ?
MediaOptions? K
>K L
{ 
private 
static 
readonly 
int  #
[# $
]$ %!
DefaultSupportedSizes& ;
=< =
new> A
[A B
]B C
{D E
$numF H
,H I
$numJ L
,L M
$numN P
,P Q
$numR U
,U V
$numW Z
,Z [
$num\ _
,_ `
$numa d
,d e
$numf i
,i j
$numk o
,o p
$numq u
}v w
;w x
private 
static 
readonly 
string  &
[& '
]' ((
DefaultAllowedFileExtensions) E
=F G
newH K
stringL R
[R S
]S T
{U V
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str #
,# $
$str% ,
,, -
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str"" 
,"" 
$str## 
,## 
$str$$ 
,$$ 
$str%% 
,%% 
$str(( 
,(( 
$str(( 
,(( 
$str)) 
,)) 
$str** 
,** 
$str++ 
,++ 
$str,, 
,,, 
$str-- 
,-- 
$str.. 
,.. 
}// 	
;//	 

private11 
const11 
int11 &
DefaultMaxBrowserCacheDays11 4
=115 6
$num117 9
;119 :
private22 
const22 
int22 
DefaultMaxCacheDays22 -
=22. /
$num220 3
;223 4
private33 
const33 
int33 
DefaultMaxFileSize33 ,
=33- .
$num33/ 9
;339 :
private55 
const55 
string55 
DefaultAssetsPath55 .
=55/ 0
$str551 8
;558 9
private66 
const66 
string66 $
DefaultAssetsRequestPath66 5
=666 7
$str668 @
;66@ A
private88 
const88 
bool88 *
DefaultUseTokenizedQueryString88 9
=88: ;
true88< @
;88@ A
private<< 
const<< 
string<< (
DefaultContentSecurityPolicy<< 9
=<<: ;
$str<<< k
;<<k l
private>> 
readonly>> 
IShellConfiguration>> ,
_shellConfiguration>>- @
;>>@ A
public@@ %
MediaOptionsConfiguration@@ (
(@@( )
IShellConfiguration@@) <
shellConfiguration@@= O
)@@O P
{AA 	
_shellConfigurationBB 
=BB  !
shellConfigurationBB" 4
;BB4 5
}CC 	
publicEE 
voidEE 
	ConfigureEE 
(EE 
MediaOptionsEE *
optionsEE+ 2
)EE2 3
{FF 	
varGG 
sectionGG 
=GG 
_shellConfigurationGG -
.GG- .

GetSectionGG. 8
(GG8 9
$strGG9 L
)GGL M
;GGM N
optionsKK 
.KK 
SupportedSizesKK "
=KK# $
sectionKK% ,
.KK, -

GetSectionKK- 7
(KK7 8
$strKK8 H
)KKH I
.LL 
GetLL 
<LL 
intLL 
[LL 
]LL 
>LL 
(LL 
)LL 
?LL 
.LL 
OrderByLL &
(LL& '
sLL' (
=>LL) +
sLL, -
)LL- .
.LL. /
ToArrayLL/ 6
(LL6 7
)LL7 8
??LL9 ;!
DefaultSupportedSizesLL< Q
;LLQ R
optionsNN 
.NN !
AllowedFileExtensionsNN )
=NN* +
newNN, /
HashSetNN0 7
<NN7 8
stringNN8 >
>NN> ?
(NN? @
sectionOO 
.OO 

GetSectionOO "
(OO" #
$strOO# :
)OO: ;
.OO; <
GetOO< ?
<OO? @
stringOO@ F
[OOF G
]OOG H
>OOH I
(OOI J
)OOJ K
??OOL N(
DefaultAllowedFileExtensionsOOO k
,OOk l
StringComparerPP 
.PP 
OrdinalIgnoreCasePP 0
)PP0 1
;PP1 2
optionsRR 
.RR 
MaxBrowserCacheDaysRR '
=RR( )
sectionRR* 1
.RR1 2
GetValueRR2 :
(RR: ;
$strRR; P
,RRP Q&
DefaultMaxBrowserCacheDaysRRR l
)RRl m
;RRm n
optionsSS 
.SS 
MaxCacheDaysSS  
=SS! "
sectionSS# *
.SS* +
GetValueSS+ 3
(SS3 4
$strSS4 B
,SSB C
DefaultMaxCacheDaysSSD W
)SSW X
;SSX Y
optionsTT 
.TT 
MaxFileSizeTT 
=TT  !
sectionTT" )
.TT) *
GetValueTT* 2
(TT2 3
$strTT3 @
,TT@ A
DefaultMaxFileSizeTTB T
)TTT U
;TTU V
optionsUU 
.UU 

CdnBaseUrlUU 
=UU  
sectionUU! (
.UU( )
GetValueUU) 1
(UU1 2
$strUU2 >
,UU> ?
StringUU@ F
.UUF G
EmptyUUG L
)UUL M
.UUM N
TrimEndUUN U
(UUU V
$charUUV Y
)UUY Z
.UUZ [
ToLowerUU[ b
(UUb c
)UUc d
;UUd e
optionsVV 
.VV 
AssetsRequestPathVV %
=VV& '
sectionVV( /
.VV/ 0
GetValueVV0 8
(VV8 9
$strVV9 L
,VVL M$
DefaultAssetsRequestPathVVN f
)VVf g
;VVg h
optionsWW 
.WW 

AssetsPathWW 
=WW  
sectionWW! (
.WW( )
GetValueWW) 1
(WW1 2
$strWW2 >
,WW> ?
DefaultAssetsPathWW@ Q
)WWQ R
;WWR S
optionsXX 
.XX #
UseTokenizedQueryStringXX +
=XX, -
sectionXX. 5
.XX5 6
GetValueXX6 >
(XX> ?
$strXX? X
,XXX Y*
DefaultUseTokenizedQueryStringXXZ x
)XXx y
;XXy z
varZZ !
contentSecurityPolicyZZ %
=ZZ& '
sectionZZ( /
.ZZ/ 0
GetValueZZ0 8
(ZZ8 9
$strZZ9 P
,ZZP Q(
DefaultContentSecurityPolicyZZR n
)ZZn o
;ZZo p
var]] 
cacheControl]] 
=]] 
$str]] B
+]]C D
TimeSpan]]E M
.]]M N
FromDays]]N V
(]]V W
options]]W ^
.]]^ _
MaxBrowserCacheDays]]_ r
)]]r s
.]]s t
TotalSeconds	]]t €
.
]]€ 
ToString
]] ‰
(
]]‰ Š
)
]]Š ‹
;
]]‹ Œ
options__ 
.__ 
StaticFileOptions__ %
=__& '
new__( +
StaticFileOptions__, =
{`` 
RequestPathaa 
=aa 
optionsaa %
.aa% &
AssetsRequestPathaa& 7
,aa7 8!
ServeUnknownFileTypesbb %
=bb& '
truebb( ,
,bb, -
OnPrepareResponsecc !
=cc" #
ctxcc$ '
=>cc( *
{dd 
ctxee 
.ee 
Contextee 
.ee  
Responseee  (
.ee( )
Headersee) 0
[ee0 1
HeaderNamesee1 <
.ee< =
CacheControlee= I
]eeI J
=eeK L
cacheControleeM Y
;eeY Z
ctxff 
.ff 
Contextff 
.ff  
Responseff  (
.ff( )
Headersff) 0
[ff0 1
HeaderNamesff1 <
.ff< =!
ContentSecurityPolicyff= R
]ffR S
=ffT U!
contentSecurityPolicyffV k
;ffk l
}gg 
}hh 
;hh 
}ii 	
}jj 
}kk Û(
‘D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\MediaProfileService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class 
MediaProfileService $
:% & 
IMediaProfileService' ;
{		 
private

 
static

 
IDictionary

 "
<

" #
string

# )
,

) *
string

+ 1
>

1 2
NullProfile

3 >
=

? @
new

A D

Dictionary

E O
<

O P
string

P V
,

V W
string

X ^
>

^ _
(

_ `
)

` a
;

a b
private 
readonly  
MediaProfilesManager -!
_mediaProfilesManager. C
;C D
public 
MediaProfileService "
(" # 
MediaProfilesManager# 7 
mediaProfilesManager8 L
)L M
{ 	!
_mediaProfilesManager !
=" # 
mediaProfilesManager$ 8
;8 9
} 	
public 
async 
Task 
< 
IDictionary %
<% &
string& ,
,, -
string. 4
>4 5
>5 6#
GetMediaProfileCommands7 N
(N O
stringO U
nameV Z
)Z [
{ 	
var !
mediaProfilesDocument %
=& '
await( -!
_mediaProfilesManager. C
.C D)
GetMediaProfilesDocumentAsyncD a
(a b
)b c
;c d
if 
( !
mediaProfilesDocument %
.% &
MediaProfiles& 3
.3 4
TryGetValue4 ?
(? @
name@ D
,D E
outF I
varJ M
mediaProfileN Z
)Z [
)[ \
{ 
var 
commands 
= 
new "

Dictionary# -
<- .
string. 4
,4 5
string6 <
>< =
(= >
)> ?
;? @
if 
( 
mediaProfile  
.  !
Width! &
>' (
$num) *
)* +
{ 
commands 
[ 
$str $
]$ %
=& '
mediaProfile( 4
.4 5
Width5 :
.: ;
ToString; C
(C D
)D E
;E F
} 
if 
( 
mediaProfile  
.  !
Height! '
>( )
$num* +
)+ ,
{ 
commands   
[   
$str   %
]  % &
=  ' (
mediaProfile  ) 5
.  5 6
Height  6 <
.  < =
ToString  = E
(  E F
)  F G
;  G H
}!! 
if## 
(## 
mediaProfile##  
.##  !
Mode##! %
!=##& (

ResizeMode##) 3
.##3 4
	Undefined##4 =
)##= >
{$$ 
commands%% 
[%% 
$str%% $
]%%$ %
=%%& '
mediaProfile%%( 4
.%%4 5
Mode%%5 9
.%%9 :
ToString%%: B
(%%B C
)%%C D
.%%D E
ToLower%%E L
(%%L M
)%%M N
;%%N O
}&& 
if'' 
('' 
mediaProfile''  
.''  !
Quality''! (
>'') *
$num''+ ,
&&''- /
mediaProfile''0 <
.''< =
Quality''= D
<''E F
$num''G J
)''J K
{(( 
commands)) 
[)) 
$str)) &
]))& '
=))( )
mediaProfile))* 6
.))6 7
Quality))7 >
.))> ?
ToString))? G
())G H
)))H I
;))I J
}** 
if,, 
(,, 
mediaProfile,,  
.,,  !
Format,,! '
!=,,( *
Format,,+ 1
.,,1 2
	Undefined,,2 ;
),,; <
{-- 
commands.. 
[.. 
$str.. %
]..% &
=..' (
mediaProfile..) 5
...5 6
Format..6 <
...< =
ToString..= E
(..E F
)..F G
...G H
ToLower..H O
(..O P
)..P Q
;..Q R
}// 
if11 
(11 
!11 
String11 
.11 
IsNullOrEmpty11 )
(11) *
mediaProfile11* 6
.116 7
BackgroundColor117 F
)11F G
)11G H
{22 
commands33 
[33 
$str33 &
]33& '
=33( )
mediaProfile33* 6
.336 7
BackgroundColor337 F
;33F G
}44 
return66 
commands66 
;66  
}77 
else88 
{99 
return:: 
NullProfile:: "
;::" #
}<< 
}== 	
}>> 
}?? Ê
’D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\MediaProfilesManager.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class  
MediaProfilesManager %
{ 
private		 
readonly		 
IDocumentManager		 )
<		) *!
MediaProfilesDocument		* ?
>		? @
_documentManager		A Q
;		Q R
public  
MediaProfilesManager #
(# $
IDocumentManager$ 4
<4 5!
MediaProfilesDocument5 J
>J K
documentManagerL [
)[ \
=>] _
_documentManager` p
=q r
documentManager	s ‚
;
‚ ƒ
public 
Task 
< !
MediaProfilesDocument )
>) **
LoadMediaProfilesDocumentAsync+ I
(I J
)J K
=>L N
_documentManagerO _
._ `#
GetOrCreateMutableAsync` w
(w x
)x y
;y z
public 
Task 
< !
MediaProfilesDocument )
>) *)
GetMediaProfilesDocumentAsync+ H
(H I
)I J
=>K M
_documentManagerN ^
.^ _%
GetOrCreateImmutableAsync_ x
(x y
)y z
;z {
public 
async 
Task #
RemoveMediaProfileAsync 1
(1 2
string2 8
name9 =
)= >
{ 	
var 
document 
= 
await  *
LoadMediaProfilesDocumentAsync! ?
(? @
)@ A
;A B
document 
. 
MediaProfiles "
." #
Remove# )
() *
name* .
). /
;/ 0
await 
_documentManager "
." #
UpdateAsync# .
(. /
document/ 7
)7 8
;8 9
} 	
public 
async 
Task #
UpdateMediaProfileAsync 1
(1 2
string2 8
name9 =
,= >
MediaProfile? K
mediaProfileL X
)X Y
{ 	
var   
document   
=   
await    *
LoadMediaProfilesDocumentAsync  ! ?
(  ? @
)  @ A
;  A B
document!! 
.!! 
MediaProfiles!! "
[!!" #
name!!# '
.!!' (
ToLower!!( /
(!!/ 0
)!!0 1
]!!1 2
=!!3 4
mediaProfile!!5 A
;!!A B
await"" 
_documentManager"" "
.""" #
UpdateAsync""# .
("". /
document""/ 7
)""7 8
;""8 9
}## 	
}$$ 
}%% å
œD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\NullMediaNameNormalizerService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class *
NullMediaNameNormalizerService /
:0 1'
IMediaNameNormalizerService2 M
{ 
public 
string 
NormalizeFolderName )
() *
string* 0

folderName1 ;
); <
=>= ?

folderName@ J
;J K
public 
string 
NormalizeFileName '
(' (
string( .
fileName/ 7
)7 8
=>9 ;
fileName< D
;D E
} 
}		 ¾
ŸD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\SlugifyMediaNameNormalizerService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public 

class -
!SlugifyMediaNameNormalizerService 2
:3 4'
IMediaNameNormalizerService5 P
{ 
private 
readonly 
ISlugService %
_slugService& 2
;2 3
public

 -
!SlugifyMediaNameNormalizerService

 0
(

0 1
ISlugService

1 =
slugService

> I
)

I J
{ 	
_slugService 
= 
slugService &
;& '
} 	
public 
string 
NormalizeFolderName )
() *
string* 0

folderName1 ;
); <
{ 	
return 
_slugService 
.  
Slugify  '
(' (

folderName( 2
)2 3
;3 4
} 	
public 
string 
NormalizeFileName '
(' (
string( .
fileName/ 7
)7 8
{ 	
return 
_slugService 
.  
Slugify  '
(' (
Path( ,
., -'
GetFileNameWithoutExtension- H
(H I
fileNameI Q
)Q R
)R S
+T U
PathV Z
.Z [
GetExtension[ g
(g h
fileNameh p
)p q
;q r
} 	
} 
} Ü$
“D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Services\TempDirCleanerService.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Services $
{ 
public		 

class		 !
TempDirCleanerService		 &
:		' ( 
IModularTenantEvents		) =
{

 
private 
readonly 
IMediaFileStore (

_fileStore) 3
;3 4
private 
readonly )
AttachedMediaFieldFileService 6*
_attachedMediaFieldFileService7 U
;U V
private 
readonly 
ShellSettings &
_shellSettings' 5
;5 6
private 
readonly 
ILogger  
_logger! (
;( )
public !
TempDirCleanerService $
($ %
IMediaFileStore% 4
	fileStore5 >
,> ?)
AttachedMediaFieldFileService ))
attachedMediaFieldFileService* G
,G H
ShellSettings 
shellSettings '
,' (
ILogger 
< !
TempDirCleanerService )
>) *
logger+ 1
)1 2
{ 	

_fileStore 
= 
	fileStore "
;" #*
_attachedMediaFieldFileService *
=+ ,)
attachedMediaFieldFileService- J
;J K
_shellSettings 
= 
shellSettings *
;* +
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
ActivatedAsync (
(( )
)) *
{ 	
if 
( 
_shellSettings 
. 
State $
!=% '
Environment( 3
.3 4
Shell4 9
.9 :
Models: @
.@ A
TenantStateA L
.L M
UninitializedM Z
)Z [
{ 
try 
{   
var!! 
tempDir!! 
=!!  !*
_attachedMediaFieldFileService!!" @
.!!@ A$
MediaFieldsTempSubFolder!!A Y
;!!Y Z
if## 
(## 
await## 

_fileStore## (
.##( )!
GetDirectoryInfoAsync##) >
(##> ?
tempDir##? F
)##F G
==##H J
null##K O
)##O P
{$$ 
return%% 
;%% 
}&& 
await(( 
foreach(( !
(((! "
var((" %
c((& '
in((( *

_fileStore((+ 5
.((5 6$
GetDirectoryContentAsync((6 N
(((N O
tempDir((O V
)((V W
)((W X
{)) 
var** 
result** "
=**# $
c**% &
.**& '
IsDirectory**' 2
?**3 4
await++ !

_fileStore++" ,
.++, -#
TryDeleteDirectoryAsync++- D
(++D E
c++E F
.++F G
Path++G K
)++K L
:,, 
await,, #

_fileStore,,$ .
.,,. /
TryDeleteFileAsync,,/ A
(,,A B
c,,B C
.,,C D
Path,,D H
),,H I
;,,I J
if.. 
(.. 
!.. 
result.. #
)..# $
{// 
_logger00 #
.00# $

LogWarning00$ .
(00. /
$str00/ ]
,00] ^
c00_ `
.00` a
Path00a e
)00e f
;00f g
}11 
}22 
}33 
catch44 
(44 
	Exception44  
e44! "
)44" #
{55 
_logger66 
.66 
LogError66 $
(66$ %
e66% &
,66& '
$str66( b
)66b c
;66c d
}77 
}88 
}99 	
public;; 
Task;; 
ActivatingAsync;; #
(;;# $
);;$ %
{<< 	
return== 
Task== 
.== 
CompletedTask== %
;==% &
}>> 	
public@@ 
Task@@ 
TerminatedAsync@@ #
(@@# $
)@@$ %
{AA 	
returnBB 
TaskBB 
.BB 
CompletedTaskBB %
;BB% &
}CC 	
publicEE 
TaskEE 
TerminatingAsyncEE $
(EE$ %
)EE% &
{FF 	
returnGG 
TaskGG 
.GG 
CompletedTaskGG %
;GG% &
}HH 	
}II 
}JJ Á
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Settings\MediaFieldSettings.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Settings $
{ 
public 

class 
MediaFieldSettings #
{ 
public 
string 
Hint 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
Required 
{ 
get "
;" #
set$ '
;' (
}) *
[

 	
DefaultValue

	 
(

 
true

 
)

 
]

 
public 
bool 
Multiple 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
true- 1
;1 2
[ 	
DefaultValue	 
( 
true 
) 
] 
public 
bool 
AllowMediaText "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
true3 7
;7 8
public 
bool 
AllowAnchors  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} 
–D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Settings\MediaFieldSettingsDriver.cs
	namespace 	
OrchardCore
 
. 
Media 
. 
Settings $
{ 
public		 

class		 $
MediaFieldSettingsDriver		 )
:		* +3
'ContentPartFieldDefinitionDisplayDriver		, S
<		S T

MediaField		T ^
>		^ _
{

 
public 
override 
IDisplayResult &
Edit' +
(+ ,&
ContentPartFieldDefinition, F
partFieldDefinitionG Z
)Z [
{ 	
return 

Initialize 
< 
MediaFieldSettings 0
>0 1
(1 2
$str2 K
,K L
modelM R
=>S U
partFieldDefinitionV i
.i j
PopulateSettingsj z
(z {
model	{ €
)
€ 
)
 ‚
. 
Location 
( 
$str #
)# $
;$ %
} 	
public 
override 
async 
Task "
<" #
IDisplayResult# 1
>1 2
UpdateAsync3 >
(> ?&
ContentPartFieldDefinition? Y
partFieldDefinitionZ m
,m n)
UpdatePartFieldEditorContext	o ‹
context
Œ “
)
“ ”
{ 	
var 
model 
= 
new 
MediaFieldSettings .
(. /
)/ 0
;0 1
await 
context 
. 
Updater !
.! "
TryUpdateModelAsync" 5
(5 6
model6 ;
,; <
Prefix= C
)C D
;D E
context 
. 
Builder 
. 
WithSettings (
(( )
model) .
). /
;/ 0
return 
Edit 
( 
partFieldDefinition +
)+ ,
;, -
} 	
} 
} ¬S
–D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Shortcodes\ImageShortcodeProvider.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

Shortcodes &
{ 
public 

class "
ImageShortcodeProvider '
:( )
IShortcodeProvider* <
{ 
private 
static 
readonly 
	ValueTask  )
<) *
string* 0
>0 1
Null2 6
=7 8
new9 <
	ValueTask= F
<F G
stringG M
>M N
(N O
(O P
stringP V
)V W
nullW [
)[ \
;\ ]
private 
static 
readonly 
	ValueTask  )
<) *
string* 0
>0 1
ImageShortcode2 @
=A B
newC F
	ValueTaskG P
<P Q
stringQ W
>W X
(X Y
$strY b
)b c
;c d
private 
static 
readonly 
HashSet  '
<' (
string( .
>. /

Shortcodes0 :
=; <
new= @
HashSetA H
<H I
stringI O
>O P
(P Q
StringComparerQ _
._ `
OrdinalIgnoreCase` q
)q r
{ 	
$str 
, 
$str 
} 	
;	 

private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly !
IHtmlSanitizerService .!
_htmlSanitizerService/ D
;D E
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly %
ResourceManagementOptions 2
_options3 ;
;; <
public "
ImageShortcodeProvider %
(% &
IMediaFileStore 
mediaFileStore *
,* +!
IHtmlSanitizerService ! 
htmlSanitizerService" 6
,6 7 
IHttpContextAccessor  
httpContextAccessor! 4
,4 5
IOptions   
<   %
ResourceManagementOptions   .
>  . /
options  0 7
)  7 8
{!! 	
_mediaFileStore"" 
="" 
mediaFileStore"" ,
;"", -!
_htmlSanitizerService## !
=##" # 
htmlSanitizerService##$ 8
;##8 9 
_httpContextAccessor$$  
=$$! "
httpContextAccessor$$# 6
;$$6 7
_options%% 
=%% 
options%% 
.%% 
Value%% $
;%%$ %
}&& 	
public(( 
	ValueTask(( 
<(( 
string(( 
>((  
EvaluateAsync((! .
(((. /
string((/ 5

identifier((6 @
,((@ A
	Arguments((B K
	arguments((L U
,((U V
string((W ]
content((^ e
,((e f
Context((g n
context((o v
)((v w
{)) 	
if** 
(** 
!** 

Shortcodes** 
.** 
Contains** $
(**$ %

identifier**% /
)**/ 0
)**0 1
{++ 
return,, 
Null,, 
;,, 
}-- 
if00 
(00 
String00 
.00 
IsNullOrEmpty00 $
(00$ %
content00% ,
)00, -
)00- .
{11 
content22 
=22 
	arguments22 #
.22# $
NamedOrDefault22$ 2
(222 3
$str223 8
)228 9
;229 :
if33 
(33 
String33 
.33 
IsNullOrEmpty33 (
(33( )
content33) 0
)330 1
)331 2
{44 
return66 
ImageShortcode66 )
;66) *
}77 
}88 
if:: 
(:: 
!:: 
content:: 
.:: 

StartsWith:: #
(::# $
$str::$ (
,::( )
StringComparison::* :
.::: ;
Ordinal::; B
)::B C
&&::D F
!::G H
content::H O
.::O P

StartsWith::P Z
(::Z [
$str::[ a
,::a b
StringComparison::c s
.::s t
OrdinalIgnoreCase	::t …
)
::… †
)
::† ‡
{;; 
if== 
(== 
content== 
.== 

StartsWith== &
(==& '
$str==' +
,==+ ,
StringComparison==- =
.=== >
Ordinal==> E
)==E F
)==F G
{>> 
content?? 
=??  
_httpContextAccessor?? 2
.??2 3
HttpContext??3 >
.??> ?
Request??? F
.??F G
PathBase??G O
.??O P
Add??P S
(??S T
content??T [
.??[ \
	Substring??\ e
(??e f
$num??f g
)??g h
)??h i
.??i j
Value??j o
;??o p
if@@ 
(@@ 
!@@ 
String@@ 
.@@  
IsNullOrEmpty@@  -
(@@- .
_options@@. 6
.@@6 7

CdnBaseUrl@@7 A
)@@A B
)@@B C
{AA 
contentBB 
=BB  !
_optionsBB" *
.BB* +

CdnBaseUrlBB+ 5
+BB6 7
contentBB8 ?
;BB? @
}CC 
}DD 
elseEE 
{FF 
contentGG 
=GG 
_mediaFileStoreGG -
.GG- .
MapPathToPublicUrlGG. @
(GG@ A
contentGGA H
)GGH I
;GGI J
}HH 
}II 
varJJ 
	classNameJJ 
=JJ 
stringJJ "
.JJ" #
EmptyJJ# (
;JJ( )
varKK 
altTextKK 
=KK 
stringKK  
.KK  !
EmptyKK! &
;KK& '
ifLL 
(LL 
	argumentsLL 
.LL 
AnyLL 
(LL 
)LL 
)LL  
{MM 
varNN 
queryStringParamsNN %
=NN& '
newNN( +

DictionaryNN, 6
<NN6 7
stringNN7 =
,NN= >
stringNN? E
>NNE F
(NNF G
)NNG H
;NNH I
varPP 
widthPP 
=PP 
	argumentsPP %
.PP% &
NamedPP& +
(PP+ ,
$strPP, 3
)PP3 4
;PP4 5
varQQ 
heightQQ 
=QQ 
	argumentsQQ &
.QQ& '
NamedQQ' ,
(QQ, -
$strQQ- 5
)QQ5 6
;QQ6 7
varRR 
modeRR 
=RR 
	argumentsRR $
.RR$ %
NamedRR% *
(RR* +
$strRR+ 1
)RR1 2
;RR2 3
varSS 
qualitySS 
=SS 
	argumentsSS '
.SS' (
NamedSS( -
(SS- .
$strSS. 7
)SS7 8
;SS8 9
varTT 
formatTT 
=TT 
	argumentsTT &
.TT& '
NamedTT' ,
(TT, -
$strTT- 5
)TT5 6
;TT6 7
	classNameUU 
=UU 
	argumentsUU %
.UU% &
NamedUU& +
(UU+ ,
$strUU, 3
)UU3 4
;UU4 5
altTextVV 
=VV 
	argumentsVV #
.VV# $
NamedVV$ )
(VV) *
$strVV* /
)VV/ 0
;VV0 1
ifXX 
(XX 
widthXX 
!=XX 
nullXX !
)XX! "
{YY 
queryStringParamsZZ %
.ZZ% &
AddZZ& )
(ZZ) *
$strZZ* 1
,ZZ1 2
widthZZ3 8
)ZZ8 9
;ZZ9 :
}[[ 
if]] 
(]] 
height]] 
!=]] 
null]] "
)]]" #
{^^ 
queryStringParams__ %
.__% &
Add__& )
(__) *
$str__* 2
,__2 3
height__4 :
)__: ;
;__; <
}`` 
ifbb 
(bb 
modebb 
!=bb 
nullbb  
)bb  !
{cc 
queryStringParamsdd %
.dd% &
Adddd& )
(dd) *
$strdd* 1
,dd1 2
modedd3 7
)dd7 8
;dd8 9
}ee 
ifgg 
(gg 
qualitygg 
!=gg 
nullgg #
)gg# $
{hh 
queryStringParamsii %
.ii% &
Addii& )
(ii) *
$strii* 3
,ii3 4
qualityii5 <
)ii< =
;ii= >
}jj 
ifll 
(ll 
formatll 
!=ll 
nullll "
)ll" #
{mm 
queryStringParamsnn %
.nn% &
Addnn& )
(nn) *
$strnn* 2
,nn2 3
formatnn4 :
)nn: ;
;nn; <
}oo 
ifqq 
(qq 
	classNameqq 
!=qq  
nullqq! %
)qq% &
{rr 
	classNamess 
=ss 
$strss  *
+ss+ ,
	classNamess- 6
+ss7 8
$strss9 >
;ss> ?
}tt 
ifvv 
(vv 
altTextvv 
!=vv 
nullvv #
)vv# $
{ww 
altTextxx 
=xx 
$strxx &
+xx' (
altTextxx) 0
+xx1 2
$strxx3 8
;xx8 9
}yy 
content{{ 
={{ 
QueryHelpers{{ &
.{{& '
AddQueryString{{' 5
({{5 6
content{{6 =
,{{= >
queryStringParams{{? P
){{P Q
;{{Q R
}|| 
content~~ 
=~~ 
$str~~ 
+~~ 
altText~~  '
+~~( )
	className~~* 3
+~~4 5
$str~~6 >
+~~? @
content~~A H
+~~I J
$str~~K P
;~~P Q
content 
= !
_htmlSanitizerService +
.+ ,
Sanitize, 4
(4 5
content5 <
)< =
;= >
return
 
new
 
	ValueTask
  
<
  !
string
! '
>
' (
(
( )
content
) 0
)
0 1
;
1 2
}
‚‚ 	
}
ƒƒ 
}„„ ¢º
|D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\Startup.cs
	namespace33 	
OrchardCore33
 
.33 
Media33 
{44 
public55 

class55 
Startup55 
:55 
StartupBase55 &
{66 
private77 
readonly77 
AdminOptions77 %
_adminOptions77& 3
;773 4
public99 
Startup99 
(99 
IOptions99 
<99  
AdminOptions99  ,
>99, -
adminOptions99. :
)99: ;
{:: 	
_adminOptions;; 
=;; 
adminOptions;; (
.;;( )
Value;;) .
;;;. /
}<< 	
static>> 
Startup>> 
(>> 
)>> 
{?? 	
TemplateContext@@ 
.@@ &
GlobalMemberAccessStrategy@@ 6
.@@6 7
Register@@7 ?
<@@? @&
DisplayMediaFieldViewModel@@@ Z
>@@Z [
(@@[ \
)@@\ ]
;@@] ^
TemplateContextAA 
.AA &
GlobalMemberAccessStrategyAA 6
.AA6 7
RegisterAA7 ?
<AA? @
AnchorAA@ F
>AAF G
(AAG H
)AAH I
;AAI J
}BB 	
publicDD 
overrideDD 
voidDD 
ConfigureServicesDD .
(DD. /
IServiceCollectionDD/ A
servicesDDB J
)DDJ K
{EE 	
servicesFF 
.FF 
AddTransientFF !
<FF! "
IConfigureOptionsFF" 3
<FF3 4
MediaOptionsFF4 @
>FF@ A
,FFA B%
MediaOptionsConfigurationFFC \
>FF\ ]
(FF] ^
)FF^ _
;FF_ `
servicesHH 
.HH 
AddSingletonHH !
<HH! "
IMediaFileProviderHH" 4
>HH4 5
(HH5 6
serviceProviderHH6 E
=>HHF H
{II 
varJJ 
shellOptionsJJ  
=JJ! "
serviceProviderJJ# 2
.JJ2 3
GetRequiredServiceJJ3 E
<JJE F
IOptionsJJF N
<JJN O
ShellOptionsJJO [
>JJ[ \
>JJ\ ]
(JJ] ^
)JJ^ _
;JJ_ `
varKK 
shellSettingsKK !
=KK" #
serviceProviderKK$ 3
.KK3 4
GetRequiredServiceKK4 F
<KKF G
ShellSettingsKKG T
>KKT U
(KKU V
)KKV W
;KKW X
varLL 
optionsLL 
=LL 
serviceProviderLL -
.LL- .
GetRequiredServiceLL. @
<LL@ A
IOptionsLLA I
<LLI J
MediaOptionsLLJ V
>LLV W
>LLW X
(LLX Y
)LLY Z
.LLZ [
ValueLL[ `
;LL` a
varNN 
	mediaPathNN 
=NN 
GetMediaPathNN  ,
(NN, -
shellOptionsNN- 9
.NN9 :
ValueNN: ?
,NN? @
shellSettingsNNA N
,NNN O
optionsNNP W
.NNW X

AssetsPathNNX b
)NNb c
;NNc d
ifPP 
(PP 
!PP 
	DirectoryPP 
.PP 
ExistsPP %
(PP% &
	mediaPathPP& /
)PP/ 0
)PP0 1
{QQ 
	DirectoryRR 
.RR 
CreateDirectoryRR -
(RR- .
	mediaPathRR. 7
)RR7 8
;RR8 9
}SS 
returnTT 
newTT 
MediaFileProviderTT ,
(TT, -
optionsTT- 4
.TT4 5
AssetsRequestPathTT5 F
,TTF G
	mediaPathTTH Q
)TTQ R
;TTR S
}UU 
)UU 
;UU 
servicesWW 
.WW 
AddSingletonWW !
<WW! "
IStaticFileProviderWW" 5
,WW5 6
IMediaFileProviderWW7 I
>WWI J
(WWJ K
serviceProviderWWK Z
=>WW[ ]
serviceProviderXX 
.XX  
GetRequiredServiceXX  2
<XX2 3
IMediaFileProviderXX3 E
>XXE F
(XXF G
)XXG H
)YY 
;YY 
services[[ 
.[[ 
AddSingleton[[ !
<[[! "
IMediaFileStore[[" 1
>[[1 2
([[2 3
serviceProvider[[3 B
=>[[C E
{\\ 
var]] 
shellOptions]]  
=]]! "
serviceProvider]]# 2
.]]2 3
GetRequiredService]]3 E
<]]E F
IOptions]]F N
<]]N O
ShellOptions]]O [
>]][ \
>]]\ ]
(]]] ^
)]]^ _
;]]_ `
var^^ 
shellSettings^^ !
=^^" #
serviceProvider^^$ 3
.^^3 4
GetRequiredService^^4 F
<^^F G
ShellSettings^^G T
>^^T U
(^^U V
)^^V W
;^^W X
var__ 
mediaOptions__  
=__! "
serviceProvider__# 2
.__2 3
GetRequiredService__3 E
<__E F
IOptions__F N
<__N O
MediaOptions__O [
>__[ \
>__\ ]
(__] ^
)__^ _
.___ `
Value__` e
;__e f
var`` 
mediaEventHandlers`` &
=``' (
serviceProvider``) 8
.``8 9
GetServices``9 D
<``D E
IMediaEventHandler``E W
>``W X
(``X Y
)``Y Z
;``Z [
varaa &
mediaCreatingEventHandlersaa .
=aa/ 0
serviceProvideraa1 @
.aa@ A
GetServicesaaA L
<aaL M&
IMediaCreatingEventHandleraaM g
>aag h
(aah i
)aai j
;aaj k
varbb 
loggerbb 
=bb 
serviceProviderbb ,
.bb, -
GetRequiredServicebb- ?
<bb? @
ILoggerbb@ G
<bbG H!
DefaultMediaFileStorebbH ]
>bb] ^
>bb^ _
(bb_ `
)bb` a
;bba b
vardd 
	mediaPathdd 
=dd 
GetMediaPathdd  ,
(dd, -
shellOptionsdd- 9
.dd9 :
Valuedd: ?
,dd? @
shellSettingsddA N
,ddN O
mediaOptionsddP \
.dd\ ]

AssetsPathdd] g
)ddg h
;ddh i
varee 
	fileStoreee 
=ee 
newee  #
FileSystemStoreee$ 3
(ee3 4
	mediaPathee4 =
)ee= >
;ee> ?
vargg 
mediaUrlBasegg  
=gg! "
$strgg# &
+gg' (
	fileStoregg) 2
.gg2 3
Combinegg3 :
(gg: ;
shellSettingsgg; H
.ggH I
RequestUrlPrefixggI Y
,ggY Z
mediaOptionsgg[ g
.ggg h
AssetsRequestPathggh y
)ggy z
;ggz {
varii 
originalPathBaseii $
=ii% &
serviceProviderii' 6
.ii6 7
GetRequiredServiceii7 I
<iiI J 
IHttpContextAccessoriiJ ^
>ii^ _
(ii_ `
)ii` a
.jj 
HttpContextjj  
?jj  !
.jj! "
Featuresjj" *
.jj* +
Getjj+ .
<jj. /
ShellContextFeaturejj/ B
>jjB C
(jjC D
)jjD E
?jjE F
.jjF G
OriginalPathBasejjG W
??jjX Z
nulljj[ _
;jj_ `
ifll 
(ll 
originalPathBasell $
.ll$ %
HasValuell% -
)ll- .
{mm 
mediaUrlBasenn  
=nn! "
	fileStorenn# ,
.nn, -
Combinenn- 4
(nn4 5
originalPathBasenn5 E
.nnE F
ValuennF K
,nnK L
mediaUrlBasennM Y
)nnY Z
;nnZ [
}oo 
returnqq 
newqq !
DefaultMediaFileStoreqq 0
(qq0 1
	fileStoreqq1 :
,qq: ;
mediaUrlBaseqq< H
,qqH I
mediaOptionsqqJ V
.qqV W

CdnBaseUrlqqW a
,qqa b
mediaEventHandlersqqc u
,qqu v'
mediaCreatingEventHandlers	qqw ‘
,
qq‘ ’
logger
qq“ ™
)
qq™ š
;
qqš ›
}rr 
)rr 
;rr 
servicestt 
.tt 
	AddScopedtt 
<tt 
IPermissionProvidertt 2
,tt2 3
Permissionstt4 ?
>tt? @
(tt@ A
)ttA B
;ttB C
servicesuu 
.uu 
	AddScopeduu 
<uu !
IAuthorizationHandleruu 4
,uu4 59
-AttachedMediaFieldsFolderAuthorizationHandleruu6 c
>uuc d
(uud e
)uue f
;uuf g
servicesvv 
.vv 
	AddScopedvv 
<vv 
INavigationProvidervv 2
,vv2 3
	AdminMenuvv4 =
>vv= >
(vv> ?
)vv? @
;vv@ A
servicesxx 
.xx 
AddLiquidFilterxx $
<xx$ %
MediaUrlFilterxx% 3
>xx3 4
(xx4 5
$strxx5 @
)xx@ A
;xxA B
servicesyy 
.yy 
AddLiquidFilteryy $
<yy$ %
ResizeUrlFilteryy% 4
>yy4 5
(yy5 6
$stryy6 B
)yyB C
;yyC D
serviceszz 
.zz 
AddLiquidFilterzz $
<zz$ %
ImageTagFilterzz% 3
>zz3 4
(zz4 5
$strzz5 >
)zz> ?
;zz? @
services 
. 
AddTransient !
<! "
IConfigureOptions" 3
<3 4'
ImageSharpMiddlewareOptions4 O
>O P
,P Q(
MediaImageSharpConfigurationR n
>n o
(o p
)p q
;q r
services
 
.
 
AddImageSharp
 "
(
" #
)
# $
.
‚‚ 
RemoveProvider
‚‚ 
<
‚‚  (
PhysicalFileSystemProvider
‚‚  :
>
‚‚: ;
(
‚‚; <
)
‚‚< =
.
ƒƒ 
AddProvider
ƒƒ 
<
ƒƒ '
MediaResizingFileProvider
ƒƒ 6
>
ƒƒ6 7
(
ƒƒ7 8
)
ƒƒ8 9
.
„„ 
AddProcessor
„„ 
<
„„ #
ImageVersionProcessor
„„ 3
>
„„3 4
(
„„4 5
)
„„5 6
.
…… 
AddProcessor
…… 
<
…… #
TokenCommandProcessor
…… 3
>
……3 4
(
……4 5
)
……5 6
;
……6 7
services
‡‡ 
.
‡‡ 
	AddScoped
‡‡ 
<
‡‡ '
MediaTokenSettingsUpdater
‡‡ 8
>
‡‡8 9
(
‡‡9 :
)
‡‡: ;
;
‡‡; <
services
ˆˆ 
.
ˆˆ 
	AddScoped
ˆˆ 
<
ˆˆ  
IMediaTokenService
ˆˆ 1
,
ˆˆ1 2
MediaTokenService
ˆˆ3 D
>
ˆˆD E
(
ˆˆE F
)
ˆˆF G
;
ˆˆG H
services
‰‰ 
.
‰‰ 
AddTransient
‰‰ !
<
‰‰! "
IConfigureOptions
‰‰" 3
<
‰‰3 4
MediaTokenOptions
‰‰4 E
>
‰‰E F
,
‰‰F G,
MediaTokenOptionsConfiguration
‰‰H f
>
‰‰f g
(
‰‰g h
)
‰‰h i
;
‰‰i j
services
ŠŠ 
.
ŠŠ 
	AddScoped
ŠŠ 
<
ŠŠ "
IFeatureEventHandler
ŠŠ 3
>
ŠŠ3 4
(
ŠŠ4 5
sp
ŠŠ5 7
=>
ŠŠ8 :
sp
ŠŠ; =
.
ŠŠ= > 
GetRequiredService
ŠŠ> P
<
ŠŠP Q'
MediaTokenSettingsUpdater
ŠŠQ j
>
ŠŠj k
(
ŠŠk l
)
ŠŠl m
)
ŠŠm n
;
ŠŠn o
services
‹‹ 
.
‹‹ 
	AddScoped
‹‹ 
<
‹‹ "
IModularTenantEvents
‹‹ 3
>
‹‹3 4
(
‹‹4 5
sp
‹‹5 7
=>
‹‹8 :
sp
‹‹; =
.
‹‹= > 
GetRequiredService
‹‹> P
<
‹‹P Q'
MediaTokenSettingsUpdater
‹‹Q j
>
‹‹j k
(
‹‹k l
)
‹‹l m
)
‹‹m n
;
‹‹n o
services
 
.
 
AddContentField
 $
<
$ %

MediaField
% /
>
/ 0
(
0 1
)
1 2
.
 
UseDisplayDriver
 !
<
! "%
MediaFieldDisplayDriver
" 9
>
9 :
(
: ;
)
; <
;
< =
services
 
.
 
	AddScoped
 
<
 6
(IContentPartFieldDefinitionDisplayDriver
 G
,
G H&
MediaFieldSettingsDriver
I a
>
a b
(
b c
)
c d
;
d e
services
‘‘ 
.
‘‘ 
	AddScoped
‘‘ 
<
‘‘ +
AttachedMediaFieldFileService
‘‘ <
,
‘‘< =+
AttachedMediaFieldFileService
‘‘> [
>
‘‘[ \
(
‘‘\ ]
)
‘‘] ^
;
‘‘^ _
services
’’ 
.
’’ 
	AddScoped
’’ 
<
’’ 
IContentHandler
’’ .
,
’’. /.
 AttachedMediaFieldContentHandler
’’0 P
>
’’P Q
(
’’Q R
)
’’R S
;
’’S T
services
““ 
.
““ 
	AddScoped
““ 
<
““ "
IModularTenantEvents
““ 3
,
““3 4#
TempDirCleanerService
““5 J
>
““J K
(
““K L
)
““L M
;
““M N
services
”” 
.
”” 
	AddScoped
”” 
<
”” 
IDataMigration
”” -
,
””- .

Migrations
””/ 9
>
””9 :
(
””: ;
)
””; <
;
””< =
services
–– 
.
–– $
AddRecipeExecutionStep
–– +
<
––+ ,
	MediaStep
––, 5
>
––5 6
(
––6 7
)
––7 8
;
––8 9
services
™™ 
.
™™ 
TryAddSingleton
™™ $
<
™™$ %"
IContentTypeProvider
™™% 9
,
™™9 :.
 FileExtensionContentTypeProvider
™™; [
>
™™[ \
(
™™\ ]
)
™™] ^
;
™™^ _
services
›› 
.
›› 
AddTagHelpers
›› "
<
››" #
ImageTagHelper
››# 1
>
››1 2
(
››2 3
)
››3 4
;
››4 5
services
œœ 
.
œœ 
AddTagHelpers
œœ "
<
œœ" #"
ImageResizeTagHelper
œœ# 7
>
œœ7 8
(
œœ8 9
)
œœ9 :
;
œœ: ;
services
 
.
 
AddTagHelpers
 "
<
" #
AnchorTagHelper
# 2
>
2 3
(
3 4
)
4 5
;
5 6
services
   
.
   
	AddScoped
   
<
   "
MediaProfilesManager
   3
>
  3 4
(
  4 5
)
  5 6
;
  6 7
services
¡¡ 
.
¡¡ 
	AddScoped
¡¡ 
<
¡¡ "
IMediaProfileService
¡¡ 3
,
¡¡3 4!
MediaProfileService
¡¡5 H
>
¡¡H I
(
¡¡I J
)
¡¡J K
;
¡¡K L
services
¢¢ 
.
¢¢ $
AddRecipeExecutionStep
¢¢ +
<
¢¢+ ,
MediaProfileStep
¢¢, <
>
¢¢< =
(
¢¢= >
)
¢¢> ?
;
¢¢? @
services
¥¥ 
.
¥¥ 
	AddScoped
¥¥ 
<
¥¥ )
IMediaNameNormalizerService
¥¥ :
,
¥¥: ;,
NullMediaNameNormalizerService
¥¥< Z
>
¥¥Z [
(
¥¥[ \
)
¥¥\ ]
;
¥¥] ^
}
¦¦ 	
public
¨¨ 
override
¨¨ 
void
¨¨ 
	Configure
¨¨ &
(
¨¨& '!
IApplicationBuilder
¨¨' :
app
¨¨; >
,
¨¨> ?#
IEndpointRouteBuilder
¨¨@ U
routes
¨¨V \
,
¨¨\ ]
IServiceProvider
¨¨^ n
serviceProvider
¨¨o ~
)
¨¨~ 
{
©© 	
var
ªª 
mediaFileProvider
ªª !
=
ªª" #
serviceProvider
ªª$ 3
.
ªª3 4 
GetRequiredService
ªª4 F
<
ªªF G 
IMediaFileProvider
ªªG Y
>
ªªY Z
(
ªªZ [
)
ªª[ \
;
ªª\ ]
var
«« 
mediaOptions
«« 
=
«« 
serviceProvider
«« .
.
««. / 
GetRequiredService
««/ A
<
««A B
IOptions
««B J
<
««J K
MediaOptions
««K W
>
««W X
>
««X Y
(
««Y Z
)
««Z [
.
««[ \
Value
««\ a
;
««a b
var
¬¬ !
mediaFileStoreCache
¬¬ #
=
¬¬$ %
serviceProvider
¬¬& 5
.
¬¬5 6

GetService
¬¬6 @
<
¬¬@ A"
IMediaFileStoreCache
¬¬A U
>
¬¬U V
(
¬¬V W
)
¬¬W X
;
¬¬X Y
if
¯¯ 
(
¯¯ !
mediaFileStoreCache
¯¯ #
!=
¯¯$ &
null
¯¯' +
)
¯¯+ ,
{
°° 
app
±± 
.
±± 
UseMiddleware
±± !
<
±±! ".
 MediaFileStoreResolverMiddleware
±±" B
>
±±B C
(
±±C D
)
±±D E
;
±±E F
}
²² 
app
µµ 
.
µµ 
UseImageSharp
µµ 
(
µµ 
)
µµ 
;
µµ  
mediaOptions
¸¸ 
.
¸¸ 
StaticFileOptions
¸¸ *
.
¸¸* +
FileProvider
¸¸+ 7
=
¸¸8 9
mediaFileProvider
¸¸: K
;
¸¸K L
app
»» 
.
»» 
UseStaticFiles
»» 
(
»» 
mediaOptions
»» +
.
»»+ ,
StaticFileOptions
»», =
)
»»= >
;
»»> ?
var
½½ !
adminControllerName
½½ #
=
½½$ %
typeof
½½& ,
(
½½, -
AdminController
½½- <
)
½½< =
.
½½= >
ControllerName
½½> L
(
½½L M
)
½½M N
;
½½N O
routes
¿¿ 
.
¿¿ $
MapAreaControllerRoute
¿¿ )
(
¿¿) *
name
ÀÀ 
:
ÀÀ 
$str
ÀÀ #
,
ÀÀ# $
areaName
ÁÁ 
:
ÁÁ 
$str
ÁÁ -
,
ÁÁ- .
pattern
ÂÂ 
:
ÂÂ 
_adminOptions
ÂÂ &
.
ÂÂ& '
AdminUrlPrefix
ÂÂ' 5
+
ÂÂ6 7
$str
ÂÂ8 @
,
ÂÂ@ A
defaults
ÃÃ 
:
ÃÃ 
new
ÃÃ 
{
ÃÃ 

controller
ÃÃ  *
=
ÃÃ+ ,!
adminControllerName
ÃÃ- @
,
ÃÃ@ A
action
ÃÃB H
=
ÃÃI J
nameof
ÃÃK Q
(
ÃÃQ R
AdminController
ÃÃR a
.
ÃÃa b
Index
ÃÃb g
)
ÃÃg h
}
ÃÃi j
)
ÄÄ 
;
ÄÄ 
routes
ÆÆ 
.
ÆÆ $
MapAreaControllerRoute
ÆÆ )
(
ÆÆ) *
name
ÇÇ 
:
ÇÇ 
$str
ÇÇ .
,
ÇÇ. /
areaName
ÈÈ 
:
ÈÈ 
$str
ÈÈ -
,
ÈÈ- .
pattern
ÉÉ 
:
ÉÉ 
_adminOptions
ÉÉ &
.
ÉÉ& '
AdminUrlPrefix
ÉÉ' 5
+
ÉÉ6 7
$str
ÉÉ8 Q
,
ÉÉQ R
defaults
ÊÊ 
:
ÊÊ 
new
ÊÊ 
{
ÊÊ 

controller
ÊÊ  *
=
ÊÊ+ ,!
adminControllerName
ÊÊ- @
,
ÊÊ@ A
action
ÊÊB H
=
ÊÊI J
nameof
ÊÊK Q
(
ÊÊQ R
AdminController
ÊÊR a
.
ÊÊa b
MediaApplication
ÊÊb r
)
ÊÊr s
}
ÊÊt u
)
ËË 
;
ËË 
routes
ÍÍ 
.
ÍÍ $
MapAreaControllerRoute
ÍÍ )
(
ÍÍ) *
name
ÎÎ 
:
ÎÎ 
$str
ÎÎ (
,
ÎÎ( )
areaName
ÏÏ 
:
ÏÏ 
$str
ÏÏ -
,
ÏÏ- .
pattern
ĞĞ 
:
ĞĞ 
_adminOptions
ĞĞ &
.
ĞĞ& '
AdminUrlPrefix
ĞĞ' 5
+
ĞĞ6 7
$str
ĞĞ8 K
,
ĞĞK L
defaults
ÑÑ 
:
ÑÑ 
new
ÑÑ 
{
ÑÑ 

controller
ÑÑ  *
=
ÑÑ+ ,!
adminControllerName
ÑÑ- @
,
ÑÑ@ A
action
ÑÑB H
=
ÑÑI J
nameof
ÑÑK Q
(
ÑÑQ R
AdminController
ÑÑR a
.
ÑÑa b

GetFolders
ÑÑb l
)
ÑÑl m
}
ÑÑn o
)
ÒÒ 
;
ÒÒ 
routes
ÔÔ 
.
ÔÔ $
MapAreaControllerRoute
ÔÔ )
(
ÔÔ) *
name
ÕÕ 
:
ÕÕ 
$str
ÕÕ +
,
ÕÕ+ ,
areaName
ÖÖ 
:
ÖÖ 
$str
ÖÖ -
,
ÖÖ- .
pattern
×× 
:
×× 
_adminOptions
×× &
.
××& '
AdminUrlPrefix
××' 5
+
××6 7
$str
××8 N
,
××N O
defaults
ØØ 
:
ØØ 
new
ØØ 
{
ØØ 

controller
ØØ  *
=
ØØ+ ,!
adminControllerName
ØØ- @
,
ØØ@ A
action
ØØB H
=
ØØI J
nameof
ØØK Q
(
ØØQ R
AdminController
ØØR a
.
ØØa b
GetMediaItems
ØØb o
)
ØØo p
}
ØØq r
)
ÙÙ 
;
ÙÙ 
routes
ÛÛ 
.
ÛÛ $
MapAreaControllerRoute
ÛÛ )
(
ÛÛ) *
name
ÜÜ 
:
ÜÜ 
$str
ÜÜ *
,
ÜÜ* +
areaName
İİ 
:
İİ 
$str
İİ -
,
İİ- .
pattern
ŞŞ 
:
ŞŞ 
_adminOptions
ŞŞ &
.
ŞŞ& '
AdminUrlPrefix
ŞŞ' 5
+
ŞŞ6 7
$str
ŞŞ8 M
,
ŞŞM N
defaults
ßß 
:
ßß 
new
ßß 
{
ßß 

controller
ßß  *
=
ßß+ ,!
adminControllerName
ßß- @
,
ßß@ A
action
ßßB H
=
ßßI J
nameof
ßßK Q
(
ßßQ R
AdminController
ßßR a
.
ßßa b
GetMediaItem
ßßb n
)
ßßn o
}
ßßp q
)
àà 
;
àà 
routes
ââ 
.
ââ $
MapAreaControllerRoute
ââ )
(
ââ) *
name
ãã 
:
ãã 
$str
ãã $
,
ãã$ %
areaName
ää 
:
ää 
$str
ää -
,
ää- .
pattern
åå 
:
åå 
_adminOptions
åå &
.
åå& '
AdminUrlPrefix
åå' 5
+
åå6 7
$str
åå8 G
,
ååG H
defaults
ææ 
:
ææ 
new
ææ 
{
ææ 

controller
ææ  *
=
ææ+ ,!
adminControllerName
ææ- @
,
ææ@ A
action
ææB H
=
ææI J
nameof
ææK Q
(
ææQ R
AdminController
ææR a
.
ææa b
Upload
ææb h
)
ææh i
}
ææj k
)
çç 
;
çç 
routes
éé 
.
éé $
MapAreaControllerRoute
éé )
(
éé) *
name
êê 
:
êê 
$str
êê *
,
êê* +
areaName
ëë 
:
ëë 
$str
ëë -
,
ëë- .
pattern
ìì 
:
ìì 
_adminOptions
ìì &
.
ìì& '
AdminUrlPrefix
ìì' 5
+
ìì6 7
$str
ìì8 M
,
ììM N
defaults
íí 
:
íí 
new
íí 
{
íí 

controller
íí  *
=
íí+ ,!
adminControllerName
íí- @
,
íí@ A
action
ííB H
=
ííI J
nameof
ííK Q
(
ííQ R
AdminController
ííR a
.
íía b
DeleteFolder
ííb n
)
íín o
}
ííp q
)
îî 
;
îî 
routes
ğğ 
.
ğğ $
MapAreaControllerRoute
ğğ )
(
ğğ) *
name
ññ 
:
ññ 
$str
ññ )
,
ññ) *
areaName
òò 
:
òò 
$str
òò -
,
òò- .
pattern
óó 
:
óó 
_adminOptions
óó &
.
óó& '
AdminUrlPrefix
óó' 5
+
óó6 7
$str
óó8 L
,
óóL M
defaults
ôô 
:
ôô 
new
ôô 
{
ôô 

controller
ôô  *
=
ôô+ ,!
adminControllerName
ôô- @
,
ôô@ A
action
ôôB H
=
ôôI J
nameof
ôôK Q
(
ôôQ R
AdminController
ôôR a
.
ôôa b
DeleteMedia
ôôb m
)
ôôm n
}
ôôo p
)
õõ 
;
õõ 
routes
÷÷ 
.
÷÷ $
MapAreaControllerRoute
÷÷ )
(
÷÷) *
name
øø 
:
øø 
$str
øø '
,
øø' (
areaName
ùù 
:
ùù 
$str
ùù -
,
ùù- .
pattern
úú 
:
úú 
_adminOptions
úú &
.
úú& '
AdminUrlPrefix
úú' 5
+
úú6 7
$str
úú8 J
,
úúJ K
defaults
ûû 
:
ûû 
new
ûû 
{
ûû 

controller
ûû  *
=
ûû+ ,
typeof
ûû- 3
(
ûû3 4
AdminController
ûû4 C
)
ûûC D
.
ûûD E
ControllerName
ûûE S
(
ûûS T
)
ûûT U
,
ûûU V
action
ûûW ]
=
ûû^ _
nameof
ûû` f
(
ûûf g
AdminController
ûûg v
.
ûûv w
	MoveMediaûûw €
)ûû€ 
}ûû‚ ƒ
)
üü 
;
üü 
routes
şş 
.
şş $
MapAreaControllerRoute
şş )
(
şş) *
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ -
,
ÿÿ- .
areaName
€€ 
:
€€ 
$str
€€ -
,
€€- .
pattern
 
:
 
_adminOptions
 &
.
& '
AdminUrlPrefix
' 5
+
6 7
$str
8 P
,
P Q
defaults
‚‚ 
:
‚‚ 
new
‚‚ 
{
‚‚ 

controller
‚‚  *
=
‚‚+ ,!
adminControllerName
‚‚- @
,
‚‚@ A
action
‚‚B H
=
‚‚I J
nameof
‚‚K Q
(
‚‚Q R
AdminController
‚‚R a
.
‚‚a b
DeleteMediaList
‚‚b q
)
‚‚q r
}
‚‚s t
)
ƒƒ 
;
ƒƒ 
routes
…… 
.
…… $
MapAreaControllerRoute
…… )
(
……) *
name
†† 
:
†† 
$str
†† +
,
††+ ,
areaName
‡‡ 
:
‡‡ 
$str
‡‡ -
,
‡‡- .
pattern
ˆˆ 
:
ˆˆ 
_adminOptions
ˆˆ &
.
ˆˆ& '
AdminUrlPrefix
ˆˆ' 5
+
ˆˆ6 7
$str
ˆˆ8 N
,
ˆˆN O
defaults
‰‰ 
:
‰‰ 
new
‰‰ 
{
‰‰ 

controller
‰‰  *
=
‰‰+ ,!
adminControllerName
‰‰- @
,
‰‰@ A
action
‰‰B H
=
‰‰I J
nameof
‰‰K Q
(
‰‰Q R
AdminController
‰‰R a
.
‰‰a b
MoveMediaList
‰‰b o
)
‰‰o p
}
‰‰q r
)
ŠŠ 
;
ŠŠ 
routes
ŒŒ 
.
ŒŒ $
MapAreaControllerRoute
ŒŒ )
(
ŒŒ) *
name
 
:
 
$str
 *
,
* +
areaName
 
:
 
$str
 -
,
- .
pattern
 
:
 
_adminOptions
 &
.
& '
AdminUrlPrefix
' 5
+
6 7
$str
8 M
,
M N
defaults
 
:
 
new
 
{
 

controller
  *
=
+ ,!
adminControllerName
- @
,
@ A
action
B H
=
I J
nameof
K Q
(
Q R
AdminController
R a
.
a b
CreateFolder
b n
)
n o
}
p q
)
‘‘ 
;
‘‘ 
var
““ &
mediaCacheControllerName
““ (
=
““) *
typeof
““+ 1
(
““1 2"
MediaCacheController
““2 F
)
““F G
.
““G H
ControllerName
““H V
(
““V W
)
““W X
;
““X Y
routes
•• 
.
•• $
MapAreaControllerRoute
•• )
(
••) *
name
–– 
:
–– 
$str
–– (
,
––( )
areaName
—— 
:
—— 
$str
—— -
,
——- .
pattern
˜˜ 
:
˜˜ 
_adminOptions
˜˜ &
.
˜˜& '
AdminUrlPrefix
˜˜' 5
+
˜˜6 7
$str
˜˜8 E
,
˜˜E F
defaults
™™ 
:
™™ 
new
™™ 
{
™™ 

controller
™™  *
=
™™+ ,&
mediaCacheControllerName
™™- E
,
™™E F
action
™™G M
=
™™N O
nameof
™™P V
(
™™V W"
MediaCacheController
™™W k
.
™™k l
Index
™™l q
)
™™q r
}
™™s t
)
šš 
;
šš 
routes
œœ 
.
œœ $
MapAreaControllerRoute
œœ )
(
œœ) *
name
 
:
 
$str
 (
,
( )
areaName
 
:
 
$str
 -
,
- .
pattern
ŸŸ 
:
ŸŸ 
_adminOptions
ŸŸ &
.
ŸŸ& '
AdminUrlPrefix
ŸŸ' 5
+
ŸŸ6 7
$str
ŸŸ8 K
,
ŸŸK L
defaults
   
:
   
new
   
{
   

controller
    *
=
  + ,&
mediaCacheControllerName
  - E
,
  E F
action
  G M
=
  N O
nameof
  P V
(
  V W"
MediaCacheController
  W k
.
  k l
Purge
  l q
)
  q r
}
  s t
)
¡¡ 
;
¡¡ 
routes
££ 
.
££ $
MapAreaControllerRoute
££ )
(
££) *
name
¤¤ 
:
¤¤ 
$str
¤¤ %
,
¤¤% &
areaName
¥¥ 
:
¥¥ 
$str
¥¥ -
,
¥¥- .
pattern
¦¦ 
:
¦¦ 
_adminOptions
¦¦ &
.
¦¦& '
AdminUrlPrefix
¦¦' 5
+
¦¦6 7
$str
¦¦8 H
,
¦¦H I
defaults
§§ 
:
§§ 
new
§§ 
{
§§ 

controller
§§  *
=
§§+ ,!
adminControllerName
§§- @
,
§§@ A
action
§§B H
=
§§I J
nameof
§§K Q
(
§§Q R
AdminController
§§R a
.
§§a b
Options
§§b i
)
§§i j
}
§§k l
)
¨¨ 
;
¨¨ 
var
ªª )
mediaProfilesControllerName
ªª +
=
ªª, -
typeof
ªª. 4
(
ªª4 5%
MediaProfilesController
ªª5 L
)
ªªL M
.
ªªM N
ControllerName
ªªN \
(
ªª\ ]
)
ªª] ^
;
ªª^ _
routes
¬¬ 
.
¬¬ $
MapAreaControllerRoute
¬¬ )
(
¬¬) *
name
­­ 
:
­­ 
$str
­­ +
,
­­+ ,
areaName
®® 
:
®® 
$str
®® -
,
®®- .
pattern
¯¯ 
:
¯¯ 
_adminOptions
¯¯ &
.
¯¯& '
AdminUrlPrefix
¯¯' 5
+
¯¯6 7
$str
¯¯8 H
,
¯¯H I
defaults
°° 
:
°° 
new
°° 
{
°° 

controller
°°  *
=
°°+ ,)
mediaProfilesControllerName
°°- H
,
°°H I
action
°°J P
=
°°Q R
nameof
°°S Y
(
°°Y Z%
MediaProfilesController
°°Z q
.
°°q r
Index
°°r w
)
°°w x
}
°°y z
)
±± 
;
±± 
routes
³³ 
.
³³ $
MapAreaControllerRoute
³³ )
(
³³) *
name
´´ 
:
´´ 
$str
´´ ,
,
´´, -
areaName
µµ 
:
µµ 
$str
µµ -
,
µµ- .
pattern
¶¶ 
:
¶¶ 
_adminOptions
¶¶ &
.
¶¶& '
AdminUrlPrefix
¶¶' 5
+
¶¶6 7
$str
¶¶8 O
,
¶¶O P
defaults
·· 
:
·· 
new
·· 
{
·· 

controller
··  *
=
··+ ,)
mediaProfilesControllerName
··- H
,
··H I
action
··J P
=
··Q R
nameof
··S Y
(
··Y Z%
MediaProfilesController
··Z q
.
··q r
Create
··r x
)
··x y
}
··z {
)
¸¸ 
;
¸¸ 
routes
ºº 
.
ºº $
MapAreaControllerRoute
ºº )
(
ºº) *
name
»» 
:
»» 
$str
»» *
,
»»* +
areaName
¼¼ 
:
¼¼ 
$str
¼¼ -
,
¼¼- .
pattern
½½ 
:
½½ 
_adminOptions
½½ &
.
½½& '
AdminUrlPrefix
½½' 5
+
½½6 7
$str
½½8 M
,
½½M N
defaults
¾¾ 
:
¾¾ 
new
¾¾ 
{
¾¾ 

controller
¾¾  *
=
¾¾+ ,)
mediaProfilesControllerName
¾¾- H
,
¾¾H I
action
¾¾J P
=
¾¾Q R
nameof
¾¾S Y
(
¾¾Y Z%
MediaProfilesController
¾¾Z q
.
¾¾q r
Edit
¾¾r v
)
¾¾v w
}
¾¾x y
)
¿¿ 
;
¿¿ 
routes
ÁÁ 
.
ÁÁ $
MapAreaControllerRoute
ÁÁ )
(
ÁÁ) *
name
ÂÂ 
:
ÂÂ 
$str
ÂÂ ,
,
ÂÂ, -
areaName
ÃÃ 
:
ÃÃ 
$str
ÃÃ -
,
ÃÃ- .
pattern
ÄÄ 
:
ÄÄ 
_adminOptions
ÄÄ &
.
ÄÄ& '
AdminUrlPrefix
ÄÄ' 5
+
ÄÄ6 7
$str
ÄÄ8 O
,
ÄÄO P
defaults
ÅÅ 
:
ÅÅ 
new
ÅÅ 
{
ÅÅ 

controller
ÅÅ  *
=
ÅÅ+ ,)
mediaProfilesControllerName
ÅÅ- H
,
ÅÅH I
action
ÅÅJ P
=
ÅÅQ R
nameof
ÅÅS Y
(
ÅÅY Z%
MediaProfilesController
ÅÅZ q
.
ÅÅq r
Delete
ÅÅr x
)
ÅÅx y
}
ÅÅz {
)
ÆÆ 
;
ÆÆ 
}
ÇÇ 	
private
ÉÉ 
string
ÉÉ 
GetMediaPath
ÉÉ #
(
ÉÉ# $
ShellOptions
ÉÉ$ 0
shellOptions
ÉÉ1 =
,
ÉÉ= >
ShellSettings
ÉÉ? L
shellSettings
ÉÉM Z
,
ÉÉZ [
string
ÉÉ\ b

assetsPath
ÉÉc m
)
ÉÉm n
{
ÊÊ 	
return
ËË 
PathExtensions
ËË !
.
ËË! "
Combine
ËË" )
(
ËË) *
shellOptions
ËË* 6
.
ËË6 7'
ShellsApplicationDataPath
ËË7 P
,
ËËP Q
shellOptions
ËËR ^
.
ËË^ _!
ShellsContainerName
ËË_ r
,
ËËr s
shellSettingsËËt 
.ËË ‚
NameËË‚ †
,ËË† ‡

assetsPathËËˆ ’
)ËË’ “
;ËË“ ”
}
ÌÌ 	
}
ÍÍ 
[
ÏÏ 
Feature
ÏÏ 
(
ÏÏ 
$str
ÏÏ &
)
ÏÏ& '
]
ÏÏ' (
public
ĞĞ 

class
ĞĞ 
MediaCacheStartup
ĞĞ "
:
ĞĞ# $
StartupBase
ĞĞ% 0
{
ÑÑ 
public
ÒÒ 
override
ÒÒ 
void
ÒÒ 
ConfigureServices
ÒÒ .
(
ÒÒ. / 
IServiceCollection
ÒÒ/ A
services
ÒÒB J
)
ÒÒJ K
{
ÓÓ 	
services
ÔÔ 
.
ÔÔ 
	AddScoped
ÔÔ 
<
ÔÔ !
IPermissionProvider
ÔÔ 2
,
ÔÔ2 3#
MediaCachePermissions
ÔÔ4 I
>
ÔÔI J
(
ÔÔJ K
)
ÔÔK L
;
ÔÔL M
services
ÕÕ 
.
ÕÕ 
	AddScoped
ÕÕ 
<
ÕÕ !
INavigationProvider
ÕÕ 2
,
ÕÕ2 3!
MediaCacheAdminMenu
ÕÕ4 G
>
ÕÕG H
(
ÕÕH I
)
ÕÕI J
;
ÕÕJ K
}
ÖÖ 	
}
×× 
[
ÙÙ 
Feature
ÙÙ 
(
ÙÙ 
$str
ÙÙ (
)
ÙÙ( )
]
ÙÙ) *
public
ÚÚ 

class
ÚÚ !
MediaSlugifyStartup
ÚÚ $
:
ÚÚ% &
StartupBase
ÚÚ' 2
{
ÛÛ 
public
ÜÜ 
override
ÜÜ 
void
ÜÜ 
ConfigureServices
ÜÜ .
(
ÜÜ. / 
IServiceCollection
ÜÜ/ A
services
ÜÜB J
)
ÜÜJ K
{
İİ 	
services
ßß 
.
ßß 
	AddScoped
ßß 
<
ßß )
IMediaNameNormalizerService
ßß :
,
ßß: ;/
!SlugifyMediaNameNormalizerService
ßß< ]
>
ßß] ^
(
ßß^ _
)
ßß_ `
;
ßß` a
}
àà 	
}
áá 
[
ãã 
RequireFeatures
ãã 
(
ãã 
$str
ãã -
)
ãã- .
]
ãã. /
public
ää 

class
ää 
DeploymentStartup
ää "
:
ää# $
StartupBase
ää% 0
{
åå 
public
ææ 
override
ææ 
void
ææ 
ConfigureServices
ææ .
(
ææ. / 
IServiceCollection
ææ/ A
services
ææB J
)
ææJ K
{
çç 	
services
èè 
.
èè 
AddTransient
èè !
<
èè! "
IDeploymentSource
èè" 3
,
èè3 4#
MediaDeploymentSource
èè5 J
>
èèJ K
(
èèK L
)
èèL M
;
èèM N
services
éé 
.
éé 
AddSingleton
éé !
<
éé! "$
IDeploymentStepFactory
éé" 8
>
éé8 9
(
éé9 :
new
éé: =#
DeploymentStepFactory
éé> S
<
ééS T!
MediaDeploymentStep
ééT g
>
éég h
(
ééh i
)
ééi j
)
ééj k
;
éék l
services
êê 
.
êê 
	AddScoped
êê 
<
êê 
IDisplayDriver
êê -
<
êê- .
DeploymentStep
êê. <
>
êê< =
,
êê= >'
MediaDeploymentStepDriver
êê? X
>
êêX Y
(
êêY Z
)
êêZ [
;
êê[ \
services
ìì 
.
ìì 
AddTransient
ìì !
<
ìì! "
IDeploymentSource
ìì" 3
,
ìì3 4.
 AllMediaProfilesDeploymentSource
ìì5 U
>
ììU V
(
ììV W
)
ììW X
;
ììX Y
services
íí 
.
íí 
AddSingleton
íí !
<
íí! "$
IDeploymentStepFactory
íí" 8
>
íí8 9
(
íí9 :
new
íí: =#
DeploymentStepFactory
íí> S
<
ííS T,
AllMediaProfilesDeploymentStep
ííT r
>
íír s
(
íís t
)
íít u
)
ííu v
;
íív w
services
îî 
.
îî 
	AddScoped
îî 
<
îî 
IDisplayDriver
îî -
<
îî- .
DeploymentStep
îî. <
>
îî< =
,
îî= >2
$AllMediaProfilesDeploymentStepDriver
îî? c
>
îîc d
(
îîd e
)
îîe f
;
îîf g
}
ïï 	
}
ğğ 
[
òò 
RequireFeatures
òò 
(
òò 
$str
òò -
)
òò- .
]
òò. /
public
óó 

class
óó 
ShortcodesStartup
óó "
:
óó# $
StartupBase
óó% 0
{
ôô 
public
õõ 
override
õõ 
void
õõ 
ConfigureServices
õõ .
(
õõ. / 
IServiceCollection
õõ/ A
services
õõB J
)
õõJ K
{
öö 	
services
øø 
.
øø 
AddShortcode
øø !
<
øø! "$
ImageShortcodeProvider
øø" 8
>
øø8 9
(
øø9 :
$str
øø: A
,
øøA B
d
øøC D
=>
øøE G
{
ùù 
d
úú 
.
úú 
DefaultValue
úú 
=
úú  
$str
úú! 3
;
úú3 4
d
ûû 
.
ûû 
Hint
ûû 
=
ûû 
$str
ûû >
;
ûû> ?
d
üü 
.
üü 
Usage
üü 
=
üü 
$strı‡ 	
;
‡‡	 

d
ˆˆ 
.
ˆˆ 

Categories
ˆˆ 
=
ˆˆ 
new
ˆˆ "
string
ˆˆ# )
[
ˆˆ) *
]
ˆˆ* +
{
ˆˆ, -
$str
ˆˆ. <
,
ˆˆ< =
$str
ˆˆ> E
}
ˆˆF G
;
ˆˆG H
}
‰‰ 
)
‰‰ 
;
‰‰ 
}
ŠŠ 	
}
‹‹ 
}ŒŒ ´$
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\TagHelpers\AnchorTagHelper.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

TagHelpers &
{ 
[ 
HtmlTargetElement 
( 
AnchorTagName $
,$ %

Attributes& 0
=1 2"
AssetHrefAttributeName3 I
)I J
]J K
public		 

class		 
AnchorTagHelper		  
:		! "
	TagHelper		# ,
{

 
private 
const 
string "
AssetHrefAttributeName 3
=4 5
$str6 B
;B C
private 
const 
string 
AnchorTagName *
=+ ,
$str- 0
;0 1
private 
const 
string 
HrefAttributeName .
=/ 0
$str1 7
;7 8
private 
const 
string &
AppendVersionAttributeName 7
=8 9
$str: N
;N O
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly  
IFileVersionProvider - 
_fileVersionProvider. B
;B C
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public 
override 
int 
Order !
=>" $
-% &
$num& (
;( )
[ 	
HtmlAttributeName	 
( "
AssetHrefAttributeName 1
)1 2
]2 3
public 
string 
	AssetHref 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
HtmlAttributeName	 
( &
AppendVersionAttributeName 5
)5 6
]6 7
public   
bool   
AppendVersion   !
{  " #
get  $ '
;  ' (
set  ) ,
;  , -
}  . /
public"" 
AnchorTagHelper"" 
("" 
IMediaFileStore## 
mediaFileStore## *
,##* + 
IHttpContextAccessor$$  
httpContextAccessor$$! 4
,$$4 5 
IFileVersionProvider%%  
fileVersionProvider%%! 4
)&& 
{'' 	
_mediaFileStore(( 
=(( 
mediaFileStore(( ,
;((, - 
_httpContextAccessor))  
=))! "
httpContextAccessor))# 6
;))6 7 
_fileVersionProvider**  
=**! "
fileVersionProvider**# 6
;**6 7
}++ 	
public-- 
override-- 
void-- 
Process-- $
(--$ %
TagHelperContext--% 5
context--6 =
,--= >
TagHelperOutput--? N
output--O U
)--U V
{.. 	
if// 
(// 
String// 
.// 
IsNullOrEmpty// $
(//$ %
	AssetHref//% .
)//. /
)/// 0
{00 
return11 
;11 
}22 
var44 
resolvedUrl44 
=44 
_mediaFileStore44 -
!=44. 0
null441 5
?446 7
_mediaFileStore448 G
.44G H
MapPathToPublicUrl44H Z
(44Z [
	AssetHref44[ d
)44d e
:44f g
	AssetHref44h q
;44q r
if66 
(66 
AppendVersion66 
&&66   
_fileVersionProvider66! 5
!=666 8
null669 =
)66= >
{77 
output88 
.88 

Attributes88 !
.88! "
SetAttribute88" .
(88. /
HrefAttributeName88/ @
,88@ A 
_fileVersionProvider88B V
.88V W 
AddFileVersionToPath88W k
(88k l!
_httpContextAccessor	88l €
.
88€ 
HttpContext
88 Œ
.
88Œ 
Request
88 ”
.
88” •
PathBase
88• 
,
88 
resolvedUrl
88Ÿ ª
)
88ª «
)
88« ¬
;
88¬ ­
}99 
else:: 
{;; 
output<< 
.<< 

Attributes<< !
.<<! "
SetAttribute<<" .
(<<. /
HrefAttributeName<</ @
,<<@ A
resolvedUrl<<B M
)<<M N
;<<N O
}== 
}>> 	
}?? 
}@@ ªN
”D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\TagHelpers\ImageResizeTagHelper.cs
	namespace

 	
OrchardCore


 
.

 
Media

 
.

 

TagHelpers

 &
{ 
[ 
HtmlTargetElement 
( 
$str 
, 

Attributes (
=) *'
ImageSizeWidthAttributeName+ F
)F G
]G H
[ 
HtmlTargetElement 
( 
$str 
, 

Attributes (
=) *(
ImageSizeHeightAttributeName+ G
)G H
]H I
[ 
HtmlTargetElement 
( 
$str 
, 

Attributes (
=) *%
ImageProfileAttributeName+ D
)D E
]E F
[ 
HtmlTargetElement 
( 
$str 
, 

Attributes (
=) *'
ImageSizeWidthAttributeName+ F
+G H
$strI L
+M N&
ImageSizeModeAttributeNameO i
)i j
]j k
[ 
HtmlTargetElement 
( 
$str 
, 

Attributes (
=) *(
ImageSizeHeightAttributeName+ G
+H I
$strJ M
+N O&
ImageSizeModeAttributeNameP j
)j k
]k l
public 

class  
ImageResizeTagHelper %
:& '
	TagHelper( 1
{ 
private 
const 
string $
ImageSizeAttributePrefix 5
=6 7
$str8 >
;> ?
private 
const 
string '
ImageSizeWidthAttributeName 8
=9 :$
ImageSizeAttributePrefix; S
+T U
$strV ]
;] ^
private 
const 
string (
ImageSizeHeightAttributeName 9
=: ;$
ImageSizeAttributePrefix< T
+U V
$strW _
;_ `
private 
const 
string &
ImageSizeModeAttributeName 7
=8 9$
ImageSizeAttributePrefix: R
+S T
$strU b
;b c
private 
const 
string %
ImageQualityAttributeName 6
=7 8$
ImageSizeAttributePrefix9 Q
+R S
$strT ]
;] ^
private 
const 
string $
ImageFormatAttributeName 5
=6 7$
ImageSizeAttributePrefix8 P
+Q R
$strS [
;[ \
private 
const 
string %
ImageProfileAttributeName 6
=7 8$
ImageSizeAttributePrefix9 Q
+R S
$strT ]
;] ^
private 
const 
string $
ImageAnchorAttributeName 5
=6 7$
ImageSizeAttributePrefix8 P
+Q R
$strS [
;[ \
private 
const 
string -
!ImageBackgroundColorAttributeName >
=? @$
ImageSizeAttributePrefixA Y
+Z [
$str\ e
;e f
private 
readonly  
IMediaProfileService - 
_mediaProfileService. B
;B C
private 
readonly 
MediaOptions %
_mediaOptions& 3
;3 4
private 
readonly 
IMediaTokenService +
_mediaTokenService, >
;> ?
["" 	
HtmlAttributeName""	 
("" '
ImageSizeWidthAttributeName"" 6
)""6 7
]""7 8
public## 
int## 
?## 

ImageWidth## 
{##  
get##! $
;##$ %
set##& )
;##) *
}##+ ,
[%% 	
HtmlAttributeName%%	 
(%% (
ImageSizeHeightAttributeName%% 7
)%%7 8
]%%8 9
public&& 
int&& 
?&& 
ImageHeight&& 
{&&  !
get&&" %
;&&% &
set&&' *
;&&* +
}&&, -
[(( 	
HtmlAttributeName((	 
((( %
ImageQualityAttributeName(( 4
)((4 5
]((5 6
public)) 
int)) 
?)) 
ImageQuality))  
{))! "
get))# &
;))& '
set))( +
;))+ ,
}))- .
[++ 	
HtmlAttributeName++	 
(++ &
ImageSizeModeAttributeName++ 5
)++5 6
]++6 7
public,, 

ResizeMode,, 

ResizeMode,, $
{,,% &
get,,' *
;,,* +
set,,, /
;,,/ 0
},,1 2
[.. 	
HtmlAttributeName..	 
(.. $
ImageFormatAttributeName.. 3
)..3 4
]..4 5
public// 
Format// 
ImageFormat// !
{//" #
get//$ '
;//' (
set//) ,
;//, -
}//. /
[11 	
HtmlAttributeName11	 
(11 %
ImageProfileAttributeName11 4
)114 5
]115 6
public22 
string22 
ImageProfile22 "
{22# $
get22% (
;22( )
set22* -
;22- .
}22/ 0
[44 	
HtmlAttributeName44	 
(44 $
ImageAnchorAttributeName44 3
)443 4
]444 5
public55 
Anchor55 
ImageAnchor55 !
{55" #
get55$ '
;55' (
set55) ,
;55, -
}55. /
[77 	
HtmlAttributeName77	 
(77 -
!ImageBackgroundColorAttributeName77 <
)77< =
]77= >
public88 
string88  
ImageBackgroundColor88 *
{88+ ,
get88- 0
;880 1
set882 5
;885 6
}887 8
[:: 	
HtmlAttributeName::	 
(:: 
$str::  
)::  !
]::! "
public;; 
string;; 
Src;; 
{;; 
get;; 
;;;  
set;;! $
;;;$ %
};;& '
public==  
ImageResizeTagHelper== #
(==# $ 
IMediaProfileService>>  
mediaProfileService>>! 4
,>>4 5
IOptions?? 
<?? 
MediaOptions?? !
>??! "
mediaOptions??# /
,??/ 0
IMediaTokenService@@ 
mediaTokenService@@ 0
)@@0 1
{AA 	 
_mediaProfileServiceBB  
=BB! "
mediaProfileServiceBB# 6
;BB6 7
_mediaOptionsCC 
=CC 
mediaOptionsCC (
.CC( )
ValueCC) .
;CC. /
_mediaTokenServiceDD 
=DD  
mediaTokenServiceDD! 2
;DD2 3
}EE 	
publicGG 
overrideGG 
asyncGG 
TaskGG "
ProcessAsyncGG# /
(GG/ 0
TagHelperContextGG0 @
contextGGA H
,GGH I
TagHelperOutputGGJ Y
outputGGZ `
)GG` a
{HH 	
ifII 
(II 
!II 

ImageWidthII 
.II 
HasValueII $
&&II% '
!II( )
ImageHeightII) 4
.II4 5
HasValueII5 =
&&II> @
StringIIA G
.IIG H
IsNullOrEmptyIIH U
(IIU V
ImageProfileIIV b
)IIb c
)IIc d
{JJ 
returnKK 
;KK 
}LL 
varNN 
imgSrcNN 
=NN 
outputNN 
.NN  

AttributesNN  *
[NN* +
$strNN+ 0
]NN0 1
?NN1 2
.NN2 3
ValueNN3 8
.NN8 9
ToStringNN9 A
(NNA B
)NNB C
??NND F
SrcNNG J
;NNJ K
ifPP 
(PP 
stringPP 
.PP 
IsNullOrEmptyPP $
(PP$ %
imgSrcPP% +
)PP+ ,
)PP, -
{QQ 
returnRR 
;RR 
}SS 
IDictionaryUU 
<UU 
stringUU 
,UU 
stringUU  &
>UU& '
queryStringParamsUU( 9
=UU: ;
nullUU< @
;UU@ A
ifWW 
(WW 
!WW 
StringWW 
.WW 
IsNullOrEmptyWW %
(WW% &
ImageProfileWW& 2
)WW2 3
)WW3 4
{XX 
queryStringParamsYY !
=YY" #
awaitYY$ ) 
_mediaProfileServiceYY* >
.YY> ?#
GetMediaProfileCommandsYY? V
(YYV W
ImageProfileYYW c
)YYc d
;YYd e
}ZZ 
var\\ 

resizedSrc\\ 
=\\ "
ImageSharpUrlFormatter\\ 3
.\\3 4
GetImageResizeUrl\\4 E
(\\E F
imgSrc\\F L
,\\L M
queryStringParams\\N _
,\\_ `

ImageWidth\\a k
,\\k l
ImageHeight\\m x
,\\x y

ResizeMode	\\z „
,
\\„ …
ImageQuality
\\† ’
,
\\’ “
ImageFormat
\\” Ÿ
,
\\Ÿ  
ImageAnchor
\\¡ ¬
,
\\¬ ­"
ImageBackgroundColor
\\® Â
)
\\Â Ã
;
\\Ã Ä
if^^ 
(^^ 
_mediaOptions^^ 
.^^ #
UseTokenizedQueryString^^ 5
)^^5 6
{__ 

resizedSrc`` 
=`` 
_mediaTokenService`` /
.``/ 0
AddTokenToPath``0 >
(``> ?

resizedSrc``? I
)``I J
;``J K
}aa 
outputcc 
.cc 

Attributescc 
.cc 
SetAttributecc *
(cc* +
$strcc+ 0
,cc0 1

resizedSrccc2 <
)cc< =
;cc= >
}dd 	
}ee 
}ff ®$
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\TagHelpers\ImageTagHelper.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

TagHelpers &
{ 
[ 
HtmlTargetElement 
( 
ImageTagName #
,# $

Attributes% /
=0 1!
AssetSrcAttributeName2 G
)G H
]H I
public		 

class		 
ImageTagHelper		 
:		  !
	TagHelper		" +
{

 
private 
const 
string !
AssetSrcAttributeName 2
=3 4
$str5 @
;@ A
private 
const 
string 
ImageTagName )
=* +
$str, 1
;1 2
private 
const 
string 
SourceAttributeName 0
=1 2
$str3 8
;8 9
private 
const 
string &
AppendVersionAttributeName 7
=8 9
$str: N
;N O
private 
readonly 
IMediaFileStore (
_mediaFileStore) 8
;8 9
private 
readonly  
IFileVersionProvider - 
_fileVersionProvider. B
;B C
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public 
override 
int 
Order !
=>" $
-% &
$num& (
;( )
[ 	
HtmlAttributeName	 
( !
AssetSrcAttributeName 0
)0 1
]1 2
public 
string 
AssetSrc 
{  
get! $
;$ %
set& )
;) *
}+ ,
[$$ 	
HtmlAttributeName$$	 
($$ &
AppendVersionAttributeName$$ 5
)$$5 6
]$$6 7
public%% 
bool%% 
AppendVersion%% !
{%%" #
get%%$ '
;%%' (
set%%) ,
;%%, -
}%%. /
public'' 
ImageTagHelper'' 
('' 
IMediaFileStore(( 
mediaFileStore(( *
,((* + 
IHttpContextAccessor))  
httpContextAccessor))! 4
,))4 5 
IFileVersionProvider**  
fileVersionProvider**! 4
)++ 
{,, 	
_mediaFileStore-- 
=-- 
mediaFileStore-- ,
;--, - 
_httpContextAccessor..  
=..! "
httpContextAccessor..# 6
;..6 7 
_fileVersionProvider//  
=//! "
fileVersionProvider//# 6
;//6 7
}00 	
public22 
override22 
void22 
Process22 $
(22$ %
TagHelperContext22% 5
context226 =
,22= >
TagHelperOutput22? N
output22O U
)22U V
{33 	
if44 
(44 
String44 
.44 
IsNullOrEmpty44 $
(44$ %
AssetSrc44% -
)44- .
)44. /
{55 
return66 
;66 
}77 
var99 
resolvedUrl99 
=99 
_mediaFileStore99 -
!=99. 0
null991 5
?996 7
_mediaFileStore998 G
.99G H
MapPathToPublicUrl99H Z
(99Z [
AssetSrc99[ c
)99c d
:99e f
AssetSrc99g o
;99o p
if;; 
(;; 
AppendVersion;; 
&&;;   
_fileVersionProvider;;! 5
!=;;6 8
null;;9 =
);;= >
{<< 
output== 
.== 

Attributes== !
.==! "
SetAttribute==" .
(==. /
SourceAttributeName==/ B
,==B C 
_fileVersionProvider==D X
.==X Y 
AddFileVersionToPath==Y m
(==m n!
_httpContextAccessor	==n ‚
.
==‚ ƒ
HttpContext
==ƒ 
.
== 
Request
== –
.
==– —
PathBase
==— Ÿ
,
==Ÿ  
resolvedUrl
==¡ ¬
)
==¬ ­
)
==­ ®
;
==® ¯
}>> 
else?? 
{@@ 
outputAA 
.AA 

AttributesAA !
.AA! "
SetAttributeAA" .
(AA. /
SourceAttributeNameAA/ B
,AAB C
resolvedUrlAAD O
)AAO P
;AAP Q
}BB 
}CC 	
}DD 
}EE ½
šD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\DisplayMediaFieldViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class &
DisplayMediaFieldViewModel +
{ 
public		 
string		 
[		 
]		 
Paths		 
=>		  
Field		! &
.		& '
Paths		' ,
;		, -
public

 

MediaField

 
Field

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
ContentPart 
Part 
{  !
get" %
;% &
set' *
;* +
}, -
public &
ContentPartFieldDefinition )
PartFieldDefinition* =
{> ?
get@ C
;C D
setE H
;H I
}J K
} 
} 
—D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\EditMediaFieldViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public		 

class		 #
EditMediaFieldViewModel		 (
{

 
public 
string 
Paths 
{ 
get !
;! "
set# &
;& '
}( )
public 

MediaField 
Field 
{  !
get" %
;% &
set' *
;* +
}, -
public 
ContentPart 
Part 
{  !
get" %
;% &
set' *
;* +
}, -
public &
ContentPartFieldDefinition )
PartFieldDefinition* =
{> ?
get@ C
;C D
setE H
;H I
}J K
public 
string 
TempUploadFolder &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
bool 
AllowMediaText "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

MediaTexts  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
AllowAnchors  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
Anchor 
[ 
] 
Anchors 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
Array0 5
.5 6
Empty6 ;
<; <
Anchor< B
>B C
(C D
)D E
;E F
} 
public 

class "
EditMediaFieldItemInfo '
{ 
public   
string   
Path   
{   
get    
;    !
set  " %
;  % &
}  ' (
public## 
bool## 
IsNew## 
{## 
get## 
;##  
set##! $
;##$ %
}##& '
public&& 
bool&& 
	IsRemoved&& 
{&& 
get&&  #
;&&# $
set&&% (
;&&( )
}&&* +
public)) 
string)) 
	MediaText)) 
{))  !
get))" %
;))% &
set))' *
;))* +
})), -
=)). /
String))0 6
.))6 7
Empty))7 <
;))< =
public** 
Anchor** 
Anchor** 
{** 
get** "
;**" #
set**$ '
;**' (
}**) *
=**+ ,
new**- 0
Anchor**1 7
(**7 8
)**8 9
;**9 :
}++ 
},, «
“D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\MediaCacheViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class 
MediaCacheViewModel $
{ 
public 
bool 
IsConfigured  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} õ

œD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\MediaDeploymentStepViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class (
MediaDeploymentStepViewModel -
{ 
public 
bool 

IncludeAll 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
true/ 3
;3 4
public		 
string		 
[		 
]		 
	FilePaths		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public 
string 
[ 
] 
DirectoryPaths &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public $
MediaStoreEntryViewModel '
ParentEntry( 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
public 
IList 
< $
MediaStoreEntryViewModel -
>- .
Entries/ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
} 
} ¬
šD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\MediaProfileIndexViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class &
MediaProfileIndexViewModel +
{		 
public

 
IList

 
<

 
MediaProfileEntry

 &
>

& '
MediaProfiles

( 5
{

6 7
get

8 ;
;

; <
set

= @
;

@ A
}

B C
public 
dynamic 
Pager 
{ 
get "
;" #
set$ '
;' (
}) *
public 
ContentOptions 
Options %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
new6 9
ContentOptions: H
(H I
)I J
;J K
} 
public 

class 
MediaProfileEntry "
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
MediaProfile 
MediaProfile (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
bool 
	IsChecked 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public 

class 
ContentOptions 
{ 
public 
string 
Search 
{ 
get "
;" #
set$ '
;' (
}) *
public 
ContentsBulkAction !

BulkAction" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" #
ContentsBulkAction$ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
}!! 
public## 

enum## 
ContentsBulkAction## "
{$$ 
None%% 
,%% 
Remove&& 
}'' 
}(( “
•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\MediaProfileViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class !
MediaProfileViewModel &
{		 
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
string 
Hint 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
SelectedWidth  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
CustomWidth 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
SelectedHeight !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
CustomHeight 
{  !
get" %
;% &
set' *
;* +
}, -
public 

ResizeMode 
SelectedMode &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
Format 
SelectedFormat $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
Quality 
{ 
get  
;  !
set" %
;% &
}' (
=) *
$num+ .
;. /
public 
string 
BackgroundColor %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" #
AvailableWidths$ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
=B C
newD G
ListH L
<L M
SelectListItemM [
>[ \
(\ ]
)] ^
;^ _
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" #
AvailableHeights$ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" # 
AvailableResizeModes$ 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
=G H
newI L
ListM Q
<Q R
SelectListItemR `
>` a
(a b
)b c
;c d
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" #
AvailableFormats$ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
}   
}!! Ñ
˜D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Media\ViewModels\MediaStoreEntryViewModel.cs
	namespace 	
OrchardCore
 
. 
Media 
. 

ViewModels &
{ 
public 

class $
MediaStoreEntryViewModel )
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Path		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public $
MediaStoreEntryViewModel '
Parent( .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
IList 
< $
MediaStoreEntryViewModel -
>- .
Entries/ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
} 
} 