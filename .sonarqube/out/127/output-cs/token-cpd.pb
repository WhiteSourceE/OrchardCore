Â
}D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Manifest.cs
[ 
assembly 	
:	 

Module 
( 
Name 
=	 

$str 
, 
Author 

= 
ManifestConstants 
. 
OrchardCoreTeam .
,. /
Website 
= 
ManifestConstants 
.  
OrchardCoreWebsite  2
,2 3
Version 
= 
ManifestConstants 
.  
OrchardCoreVersion  2
) 
] 
[

 
assembly

 	
:

	 

Feature

 
(

 
Id 
= 
$str	 
, 
Name 
=	 

$str 
, 
Description 
= 
$str 0
,0 1
Category 
= 
$str 
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	 "
," #
Name 
=	 

$str 
, 
Description 
= 
$str 2
,2 3
Dependencies 
= 
new 
[ 
] 
{ 
$str .
}/ 0
,0 1
Category 
= 
$str 
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	  
,  !
Name 
=	 

$str 
, 
Description 
= 
$str 9
,9 :
Dependencies 
= 
new 
[ 
] 
{ 
$str .
}/ 0
,0 1
Category 
= 
$str 
) 
] 
[!! 
assembly!! 	
:!!	 

Feature!! 
(!! 
Id"" 
="" 
$str""	 !
,""! "
Name## 
=##	 

$str## 
,## 
Description$$ 
=$$ 
$str$$ 1
,$$1 2
Dependencies%% 
=%% 
new%% 
[%% 
]%% 
{%% 
$str%% .
}%%/ 0
,%%0 1
Category&& 
=&& 
$str&& 
)'' 
]'' 
[)) 
assembly)) 	
:))	 

Feature)) 
()) 
Id** 
=** 
$str**	 +
,**+ ,
Name++ 
=++	 

$str++ !
,++! "
Description,, 
=,, 
$str,, ;
,,,; <
Dependencies-- 
=-- 
new-- 
[-- 
]-- 
{-- 
$str-- .
}--/ 0
,--0 1
Category.. 
=.. 
$str.. 
)// 
]// Ñ
“D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Options\RedisCacheOptionsSetup.cs
	namespace 	
OrchardCore
 
. 
Redis 
. 
Options #
{ 
public 

class "
RedisCacheOptionsSetup '
:( )
IConfigureOptions* ;
<; <
RedisCacheOptions< M
>M N
{ 
private		 
readonly		 
string		 
_tenant		  '
;		' (
private

 
readonly

 
IOptions

 !
<

! "
RedisOptions

" .
>

. /
_redisOptions

0 =
;

= >
public "
RedisCacheOptionsSetup %
(% &
ShellSettings& 3
shellSettings4 A
,A B
IOptionsC K
<K L
RedisOptionsL X
>X Y
redisOptionsZ f
)f g
{ 	
_tenant 
= 
shellSettings #
.# $
Name$ (
;( )
_redisOptions 
= 
redisOptions (
;( )
} 	
public 
void 
	Configure 
( 
RedisCacheOptions /
options0 7
)7 8
{ 	
options 
. 
InstanceName  
=! "
_tenant# *
;* +
options 
.  
ConfigurationOptions (
=) *
_redisOptions+ 8
.8 9
Value9 >
.> ? 
ConfigurationOptions? S
;S T
} 	
} 
} °
›D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Options\RedisKeyManagementOptionsSetup.cs
	namespace 	
OrchardCore
 
. 
Redis 
. 
Options #
{ 
public 

class *
RedisKeyManagementOptionsSetup /
:0 1
IConfigureOptions2 C
<C D 
KeyManagementOptionsD X
>X Y
{		 
private

 
readonly

 
IRedisService

 &
_redis

' -
;

- .
private 
readonly 
string 
_tenant  '
;' (
public *
RedisKeyManagementOptionsSetup -
(- .
IRedisService. ;
redis< A
,A B
ShellSettingsC P
shellSettingsQ ^
)^ _
{ 	
_redis 
= 
redis 
; 
_tenant 
= 
shellSettings #
.# $
Name$ (
;( )
} 	
public 
void 
	Configure 
(  
KeyManagementOptions 2
options3 :
): ;
{ 	
var 
redis 
= 
_redis 
; 
options 
. 
XmlRepository !
=" #
new$ '
RedisXmlRepository( :
(: ;
(; <
)< =
=>> @
{ 
if 
( 
redis 
. 
Database "
==# %
null& *
)* +
{ 
redis 
. 
ConnectAsync &
(& '
)' (
.( )

GetAwaiter) 3
(3 4
)4 5
.5 6
	GetResult6 ?
(? @
)@ A
;A B
} 
return 
redis 
. 
Database %
;% &
} 
,   
_tenant   
+   
$str   .
)  . /
;  / 0
}!! 	
}"" 
}## ¿.
†D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Services\RedisBus.cs
	namespace

 	
OrchardCore


 
.

 
Redis

 
.

 
Services

 $
{ 
public 

class 
RedisBus 
: 
IMessageBus '
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
private 
readonly 
string 
	_hostName  )
;) *
private 
readonly 
string 
_channelPrefix  .
;. /
private 
readonly 
string 
_messagePrefix  .
;. /
private 
readonly 
ILogger  
_logger! (
;( )
public 
RedisBus 
( 
IRedisService %
redis& +
,+ ,
ShellSettings- :
shellSettings; H
,H I
ILoggerJ Q
<Q R
RedisBusR Z
>Z [
logger\ b
)b c
{ 	
_redis 
= 
redis 
; 
	_hostName 
= 
Dns 
. 
GetHostName '
(' (
)( )
+* +
$char, /
+0 1
Process2 9
.9 :
GetCurrentProcess: K
(K L
)L M
.M N
IdN P
;P Q
_channelPrefix 
= 
shellSettings *
.* +
Name+ /
+0 1
$char2 5
;5 6
_messagePrefix 
= 
	_hostName &
+' (
$char) ,
;, -
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
SubscribeAsync (
(( )
string) /
channel0 7
,7 8
Action9 ?
<? @
string@ F
,F G
stringH N
>N O
handlerP W
)W X
{ 	
if 
( 
_redis 
. 

Connection !
==" $
null% )
)) *
{   
await!! 
_redis!! 
.!! 
ConnectAsync!! )
(!!) *
)!!* +
;!!+ ,
}"" 
try$$ 
{%% 
var&& 

subscriber&& 
=&&  
_redis&&! '
.&&' (

Connection&&( 2
.&&2 3
GetSubscriber&&3 @
(&&@ A
)&&A B
;&&B C
await(( 

subscriber((  
.((  !
SubscribeAsync((! /
(((/ 0
_channelPrefix((0 >
+((? @
channel((A H
,((H I
(((J K
redisChannel((K W
,((W X

redisValue((Y c
)((c d
=>((e g
{)) 
var** 
tokens** 
=**  

redisValue**! +
.**+ ,
ToString**, 4
(**4 5
)**5 6
.**6 7
Split**7 <
(**< =
$char**= @
)**@ A
.**A B
ToArray**B I
(**I J
)**J K
;**K L
if,, 
(,, 
tokens,, 
.,, 
Length,, %
!=,,& (
$num,,) *
||,,+ -
tokens,,. 4
[,,4 5
$num,,5 6
],,6 7
.,,7 8
Length,,8 >
==,,? A
$num,,B C
||,,D F
tokens,,G M
[,,M N
$num,,N O
],,O P
.,,P Q
Equals,,Q W
(,,W X
	_hostName,,X a
,,,a b
StringComparison,,c s
.,,s t
OrdinalIgnoreCase	,,t …
)
,,… †
)
,,† ‡
{-- 
return.. 
;.. 
}// 
handler11 
(11 
channel11 #
,11# $
tokens11% +
[11+ ,
$num11, -
]11- .
)11. /
;11/ 0
}22 
)22 
;22 
}33 
catch44 
(44 
	Exception44 
e44 
)44 
{55 
_logger66 
.66 
LogError66  
(66  !
e66! "
,66" #
$str66$ Y
,66Y Z
_channelPrefix66[ i
+66j k
channel66l s
)66s t
;66t u
}77 
}88 	
public:: 
async:: 
Task:: 
PublishAsync:: &
(::& '
string::' -
channel::. 5
,::5 6
string::7 =
message::> E
)::E F
{;; 	
if<< 
(<< 
_redis<< 
.<< 

Connection<< !
==<<" $
null<<% )
)<<) *
{== 
await>> 
_redis>> 
.>> 
ConnectAsync>> )
(>>) *
)>>* +
;>>+ ,
}?? 
tryAA 
{BB 
awaitCC 
_redisCC 
.CC 

ConnectionCC '
.CC' (
GetSubscriberCC( 5
(CC5 6
)CC6 7
.CC7 8
PublishAsyncCC8 D
(CCD E
_channelPrefixCCE S
+CCT U
channelCCV ]
,CC] ^
_messagePrefixCC_ m
+CCn o
messageCCp w
)CCw x
;CCx y
}DD 
catchEE 
(EE 
	ExceptionEE 
eEE 
)EE 
{FF 
_loggerGG 
.GG 
LogErrorGG  
(GG  !
eGG! "
,GG" #
$strGG$ W
,GGW X
_channelPrefixGGY g
+GGh i
channelGGj q
)GGq r
;GGr s
}HH 
}II 	
}JJ 
}KK èh
‡D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Services\RedisLock.cs
	namespace 	
OrchardCore
 
. 
Redis 
. 
Services $
{ 
public 

class 
	RedisLock 
: 
IDistributedLock -
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
private 
readonly 
ILogger  
_logger! (
;( )
private 
readonly 
string 
	_hostName  )
;) *
private 
readonly 
string 
_prefix  '
;' (
public 
	RedisLock 
( 
IRedisService &
redis' ,
,, -
ShellSettings. ;
shellSettings< I
,I J
ILoggerK R
<R S
	RedisLockS \
>\ ]
logger^ d
)d e
{ 	
_redis 
= 
redis 
; 
	_hostName 
= 
Dns 
. 
GetHostName '
(' (
)( )
+* +
$char, /
+0 1
Process2 9
.9 :
GetCurrentProcess: K
(K L
)L M
.M N
IdN P
;P Q
_prefix 
= 
shellSettings #
.# $
Name$ (
+) *
$char+ .
;. /
_logger 
= 
logger 
; 
} 	
public%% 
async%% 
Task%% 
<%% 
ILocker%% !
>%%! "
AcquireLockAsync%%# 3
(%%3 4
string%%4 :
key%%; >
,%%> ?
TimeSpan%%@ H
?%%H I

expiration%%J T
=%%U V
null%%W [
)%%[ \
{&& 	
return'' 
('' 
await'' 
TryAcquireLockAsync'' -
(''- .
key''. 1
,''1 2
TimeSpan''3 ;
.''; <
MaxValue''< D
,''D E

expiration''F P
)''P Q
)''Q R
.''R S
locker''S Y
;''Y Z
}(( 	
public.. 
async.. 
Task.. 
<.. 
(.. 
ILocker.. "
locker..# )
,..) *
bool..+ /
locked..0 6
)..6 7
>..7 8
TryAcquireLockAsync..9 L
(..L M
string..M S
key..T W
,..W X
TimeSpan..Y a
timeout..b i
,..i j
TimeSpan..k s
?..s t

expiration..u 
=
..€ 
null
..‚ †
)
..† ‡
{// 	
using00 
(00 
var00 
cts00 
=00 
new00  #
CancellationTokenSource00! 8
(008 9
timeout009 @
!=00A C
TimeSpan00D L
.00L M
MaxValue00M U
?00V W
timeout00X _
:00` a
Timeout00b i
.00i j
InfiniteTimeSpan00j z
)00z {
)00{ |
{11 
var22 
retries22 
=22 
$num22 !
;22! "
while44 
(44 
!44 
cts44 
.44 #
IsCancellationRequested44 3
)443 4
{55 
var66 
locked66 
=66  
await66! &
	LockAsync66' 0
(660 1
key661 4
,664 5

expiration666 @
??66A C
TimeSpan66D L
.66L M
MaxValue66M U
)66U V
;66V W
if88 
(88 
locked88 
)88 
{99 
return:: 
(::  
new::  #
Locker::$ *
(::* +
this::+ /
,::/ 0
key::1 4
)::4 5
,::5 6
locked::7 =
)::= >
;::> ?
};; 
try== 
{>> 
await?? 
Task?? "
.??" #
Delay??# (
(??( )
GetDelay??) 1
(??1 2
++??2 4
retries??4 ;
)??; <
,??< =
cts??> A
.??A B
Token??B G
)??G H
;??H I
}@@ 
catchAA 
(AA !
TaskCanceledExceptionAA 0
)AA0 1
{BB 
ifCC 
(CC 
_loggerCC #
.CC# $
	IsEnabledCC$ -
(CC- .
LogLevelCC. 6
.CC6 7
DebugCC7 <
)CC< =
)CC= >
{DD 
_loggerEE #
.EE# $
LogDebugEE$ ,
(EE, -
$str	EE- “
,
EE“ ”
_prefixFF  '
+FF( )
keyFF* -
,FF- .
timeoutFF/ 6
.FF6 7
ToStringFF7 ?
(FF? @
)FF@ A
)FFA B
;FFB C
}GG 
}HH 
}II 
}JJ 
returnLL 
(LL 
nullLL 
,LL 
falseLL 
)LL  
;LL  !
}MM 	
publicOO 
asyncOO 
TaskOO 
<OO 
boolOO 
>OO 
IsLockAcquiredAsyncOO  3
(OO3 4
stringOO4 :
keyOO; >
)OO> ?
{PP 	
ifQQ 
(QQ 
_redisQQ 
.QQ 
DatabaseQQ 
==QQ  "
nullQQ# '
)QQ' (
{RR 
awaitSS 
_redisSS 
.SS 
ConnectAsyncSS )
(SS) *
)SS* +
;SS+ ,
}TT 
tryVV 
{WW 
returnXX 
(XX 
awaitXX 
_redisXX $
.XX$ %
DatabaseXX% -
.XX- .
LockQueryAsyncXX. <
(XX< =
_prefixXX= D
+XXE F
keyXXG J
)XXJ K
)XXK L
.XXL M
HasValueXXM U
;XXU V
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
eZZ 
)ZZ 
{[[ 
_logger\\ 
.\\ 
LogError\\  
(\\  !
e\\! "
,\\" #
$str\\$ m
,\\m n
_prefix\\o v
+\\w x
key\\y |
)\\| }
;\\} ~
}]] 
return__ 
false__ 
;__ 
}`` 	
privatebb 
asyncbb 
Taskbb 
<bb 
boolbb 
>bb  
	LockAsyncbb! *
(bb* +
stringbb+ 1
keybb2 5
,bb5 6
TimeSpanbb7 ?
expirybb@ F
)bbF G
{cc 	
ifdd 
(dd 
_redisdd 
.dd 
Databasedd 
==dd  "
nulldd# '
)dd' (
{ee 
awaitff 
_redisff 
.ff 
ConnectAsyncff )
(ff) *
)ff* +
;ff+ ,
}gg 
tryii 
{jj 
returnkk 
awaitkk 
_rediskk #
.kk# $
Databasekk$ ,
.kk, -
LockTakeAsynckk- :
(kk: ;
_prefixkk; B
+kkC D
keykkE H
,kkH I
	_hostNamekkJ S
,kkS T
expirykkU [
)kk[ \
;kk\ ]
}ll 
catchmm 
(mm 
	Exceptionmm 
emm 
)mm 
{nn 
_loggeroo 
.oo 
LogErroroo  
(oo  !
eoo! "
,oo" #
$stroo$ S
,ooS T
_prefixooU \
+oo] ^
keyoo_ b
)oob c
;ooc d
}pp 
returnrr 
falserr 
;rr 
}ss 	
privateuu 
asyncuu 
	ValueTaskuu 
ReleaseAsyncuu  ,
(uu, -
stringuu- 3
keyuu4 7
)uu7 8
{vv 	
ifww 
(ww 
_redisww 
.ww 
Databaseww 
==ww  "
nullww# '
)ww' (
{xx 
awaityy 
_redisyy 
.yy 
ConnectAsyncyy )
(yy) *
)yy* +
;yy+ ,
}zz 
try|| 
{}} 
await~~ 
_redis~~ 
.~~ 
Database~~ %
.~~% &
LockReleaseAsync~~& 6
(~~6 7
_prefix~~7 >
+~~? @
key~~A D
,~~D E
	_hostName~~F O
)~~O P
;~~P Q
} 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
 
_logger
‚‚ 
.
‚‚ 
LogError
‚‚  
(
‚‚  !
e
‚‚! "
,
‚‚" #
$str
‚‚$ S
,
‚‚S T
_prefix
‚‚U \
+
‚‚] ^
key
‚‚_ b
)
‚‚b c
;
‚‚c d
}
ƒƒ 
}
„„ 	
private
†† 
void
†† 
Release
†† 
(
†† 
string
†† #
key
††$ '
)
††' (
{
‡‡ 	
try
ˆˆ 
{
‰‰ 
_redis
ŠŠ 
.
ŠŠ 
Database
ŠŠ 
.
ŠŠ  
LockRelease
ŠŠ  +
(
ŠŠ+ ,
_prefix
ŠŠ, 3
+
ŠŠ4 5
key
ŠŠ6 9
,
ŠŠ9 :
	_hostName
ŠŠ; D
,
ŠŠD E
CommandFlags
ŠŠF R
.
ŠŠR S
FireAndForget
ŠŠS `
)
ŠŠ` a
;
ŠŠa b
}
‹‹ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
 
_logger
ŽŽ 
.
ŽŽ 
LogError
ŽŽ  
(
ŽŽ  !
e
ŽŽ! "
,
ŽŽ" #
$str
ŽŽ$ S
,
ŽŽS T
_prefix
ŽŽU \
+
ŽŽ] ^
key
ŽŽ_ b
)
ŽŽb c
;
ŽŽc d
}
 
}
 	
private
’’ 
class
’’ 
Locker
’’ 
:
’’ 
ILocker
’’ &
{
““ 	
private
”” 
readonly
”” 
	RedisLock
”” &
_lock
””' ,
;
””, -
private
•• 
readonly
•• 
string
•• #
_key
••$ (
;
••( )
private
–– 
bool
–– 
	_disposed
–– "
;
––" #
public
˜˜ 
Locker
˜˜ 
(
˜˜ 
	RedisLock
˜˜ #
	redislock
˜˜$ -
,
˜˜- .
string
˜˜/ 5
key
˜˜6 9
)
˜˜9 :
{
™™ 
_lock
šš 
=
šš 
	redislock
šš !
;
šš! "
_key
›› 
=
›› 
key
›› 
;
›› 
}
œœ 
public
žž 
	ValueTask
žž 
DisposeAsync
žž )
(
žž) *
)
žž* +
{
ŸŸ 
if
   
(
   
	_disposed
   
)
   
{
¡¡ 
return
¢¢ 
default
¢¢ "
;
¢¢" #
}
££ 
	_disposed
¥¥ 
=
¥¥ 
true
¥¥  
;
¥¥  !
return
§§ 
_lock
§§ 
.
§§ 
ReleaseAsync
§§ )
(
§§) *
_key
§§* .
)
§§. /
;
§§/ 0
}
¨¨ 
public
ªª 
void
ªª 
Dispose
ªª 
(
ªª  
)
ªª  !
{
«« 
if
¬¬ 
(
¬¬ 
	_disposed
¬¬ 
)
¬¬ 
{
­­ 
return
®® 
;
®® 
}
¯¯ 
	_disposed
±± 
=
±± 
true
±±  
;
±±  !
_lock
³³ 
.
³³ 
Release
³³ 
(
³³ 
_key
³³ "
)
³³" #
;
³³# $
}
´´ 
}
µµ 	
private
·· 
static
·· 
readonly
·· 
double
··  &

_baseDelay
··' 1
=
··2 3
$num
··4 7
;
··7 8
private
¸¸ 
static
¸¸ 
readonly
¸¸ 
double
¸¸  &
	_maxDelay
¸¸' 0
=
¸¸1 2
$num
¸¸3 8
;
¸¸8 9
private
ºº 
static
ºº 
TimeSpan
ºº 
GetDelay
ºº  (
(
ºº( )
double
ºº) /
retries
ºº0 7
)
ºº7 8
{
»» 	
var
¼¼ 
delay
¼¼ 
=
¼¼ 

_baseDelay
¼¼ "
*
½½ 
(
½½ 
$num
½½ 
+
½½ 
(
½½ 
(
½½ 
Math
½½ 
.
½½  
Pow
½½  #
(
½½# $
$num
½½$ '
,
½½' (
retries
½½) 0
-
½½1 2
$num
½½3 6
)
½½6 7
-
½½8 9
$num
½½: =
)
½½= >
*
¾¾ 
(
¾¾ 
$num
¾¾ 
+
¾¾ 
new
¾¾  
Random
¾¾! '
(
¾¾' (
)
¾¾( )
.
¾¾) *

NextDouble
¾¾* 4
(
¾¾4 5
)
¾¾5 6
*
¾¾7 8
$num
¾¾9 <
)
¾¾< =
)
¾¾= >
)
¾¾> ?
;
¾¾? @
return
ÀÀ 
TimeSpan
ÀÀ 
.
ÀÀ 
FromMilliseconds
ÀÀ ,
(
ÀÀ, -
Math
ÀÀ- 1
.
ÀÀ1 2
Min
ÀÀ2 5
(
ÀÀ5 6
delay
ÀÀ6 ;
,
ÀÀ; <
	_maxDelay
ÀÀ= F
)
ÀÀF G
)
ÀÀG H
;
ÀÀH I
}
ÎÎ 	
}
ÏÏ 
}ÐÐ Š
ŠD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Services\RedisService.cs
	namespace		 	
OrchardCore		
 
.		 
Redis		 
.		 
Services		 $
{

 
public 

class 
RedisService 
: 
ModularTenantEvents  3
,3 4
IRedisService5 B
,B C
IDisposableD O
{ 
private 
readonly 
IOptions !
<! "
RedisOptions" .
>. /
_options0 8
;8 9
private 
readonly 
ILogger  
_logger! (
;( )
private 
readonly 
SemaphoreSlim &

_semaphore' 1
=2 3
new4 7
SemaphoreSlim8 E
(E F
$numF G
)G H
;H I
public 
RedisService 
( 
IOptions $
<$ %
RedisOptions% 1
>1 2
options3 :
,: ;
ILogger< C
<C D
RedisServiceD P
>P Q
loggerR X
)X Y
{ 	
_options 
= 
options 
; 
_logger 
= 
logger 
; 
} 	
public "
IConnectionMultiplexer %

Connection& 0
{1 2
get3 6
;6 7
private8 ?
set@ C
;C D
}E F
public 
	IDatabase 
Database !
{" #
get$ '
;' (
private) 0
set1 4
;4 5
}6 7
public 
override 
Task 
ActivatingAsync ,
(, -
)- .
=>/ 1
ConnectAsync2 >
(> ?
)? @
;@ A
public 
async 
Task 
ConnectAsync &
(& '
)' (
{ 	
if 
( 
Database 
!= 
null  
)  !
{   
return!! 
;!! 
}"" 
await$$ 

_semaphore$$ 
.$$ 
	WaitAsync$$ &
($$& '
)$$' (
;$$( )
try&& 
{'' 
if(( 
((( 
Database(( 
==(( 
null((  $
)(($ %
{)) 

Connection** 
=**  
await**! &!
ConnectionMultiplexer**' <
.**< =
ConnectAsync**= I
(**I J
_options**J R
.**R S
Value**S X
.**X Y 
ConfigurationOptions**Y m
)**m n
;**n o
Database++ 
=++ 

Connection++ )
.++) *
GetDatabase++* 5
(++5 6
)++6 7
;++7 8
},, 
}-- 
catch.. 
(.. 
	Exception.. 
e.. 
).. 
{// 
_logger00 
.00 
LogError00  
(00  !
e00! "
,00" #
$str00$ A
)00A B
;00B C
}11 
finally22 
{33 

_semaphore44 
.44 
Release44 "
(44" #
)44# $
;44$ %
}55 
}66 	
public88 
void88 
Dispose88 
(88 
)88 
{99 	
if:: 
(:: 

Connection:: 
!=:: 
null:: "
)::" #
{;; 

Connection<< 
.<< 
Close<<  
(<<  !
)<<! "
;<<" #
}== 
}>> 	
}?? 
}@@ ¢0
‹D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Services\RedisTagCache.cs
	namespace		 	
OrchardCore		
 
.		 
Redis		 
.		 
Services		 $
{

 
public 

class 
RedisTagCache 
:  
	ITagCache! *
{ 
private 
readonly 
IRedisService &
_redis' -
;- .
private 
readonly 
string 
_prefix  '
;' (
private 
readonly 
IEnumerable $
<$ %#
ITagRemovedEventHandler% <
>< =$
_tagRemovedEventHandlers> V
;V W
private 
readonly 
ILogger  
_logger! (
;( )
public 
RedisTagCache 
( 
IRedisService 
redis 
,  
ShellSettings 
shellSettings '
,' (
IEnumerable 
< #
ITagRemovedEventHandler /
>/ 0#
tagRemovedEventHandlers1 H
,H I
ILogger 
< 
RedisTagCache !
>! "
logger# )
)) *
{ 	
_redis 
= 
redis 
; 
_prefix 
= 
shellSettings #
.# $
Name$ (
+) *
$str+ 2
;2 3$
_tagRemovedEventHandlers $
=% &#
tagRemovedEventHandlers' >
;> ?
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
TagAsync "
(" #
string# )
key* -
,- .
params/ 5
string6 <
[< =
]= >
tags? C
)C D
{ 	
if   
(   
_redis   
.   
Database   
==    "
null  # '
)  ' (
{!! 
await"" 
_redis"" 
."" 
ConnectAsync"" )
("") *
)""* +
;""+ ,
}## 
foreach%% 
(%% 
var%% 
tag%% 
in%% 
tags%%  $
)%%$ %
{&& 
await'' 
_redis'' 
.'' 
Database'' %
.''% &
SetAddAsync''& 1
(''1 2
_prefix''2 9
+'': ;
tag''< ?
,''? @
key''A D
)''D E
;''E F
}(( 
})) 	
public++ 
async++ 
Task++ 
<++ 
IEnumerable++ %
<++% &
string++& ,
>++, -
>++- .
GetTaggedItemsAsync++/ B
(++B C
string++C I
tag++J M
)++M N
{,, 	
if-- 
(-- 
_redis-- 
.-- 
Database-- 
==--  "
null--# '
)--' (
{.. 
await// 
_redis// 
.// 
ConnectAsync// )
(//) *
)//* +
;//+ ,
}00 
var22 
values22 
=22 
await22 
_redis22 %
.22% &
Database22& .
.22. /
SetMembersAsync22/ >
(22> ?
_prefix22? F
+22G H
tag22I L
)22L M
;22M N
if44 
(44 
values44 
==44 
null44 
||44 !
values44" (
.44( )
Length44) /
==440 2
$num443 4
)444 5
{55 
return66 

Enumerable66 !
.66! "
Empty66" '
<66' (
string66( .
>66. /
(66/ 0
)660 1
;661 2
}77 
return99 
values99 
.99 
Select99  
(99  !
v99! "
=>99# %
(99& '
string99' -
)99- .
v99. /
)99/ 0
.990 1
ToArray991 8
(998 9
)999 :
;99: ;
}:: 	
public<< 
async<< 
Task<< 
RemoveTagAsync<< (
(<<( )
string<<) /
tag<<0 3
)<<3 4
{== 	
if>> 
(>> 
_redis>> 
.>> 
Database>> 
==>>  "
null>># '
)>>' (
{?? 
await@@ 
_redis@@ 
.@@ 
ConnectAsync@@ )
(@@) *
)@@* +
;@@+ ,
}AA 
varCC 
valuesCC 
=CC 
awaitCC 
_redisCC %
.CC% &
DatabaseCC& .
.CC. /
SetMembersAsyncCC/ >
(CC> ?
_prefixCC? F
+CCG H
tagCCI L
)CCL M
;CCM N
ifEE 
(EE 
valuesEE 
==EE 
nullEE 
||EE !
valuesEE" (
.EE( )
LengthEE) /
==EE0 2
$numEE3 4
)EE4 5
{FF 
returnGG 
;GG 
}HH 
varJJ 
setJJ 
=JJ 
valuesJJ 
.JJ 
SelectJJ #
(JJ# $
vJJ$ %
=>JJ& (
(JJ) *
stringJJ* 0
)JJ0 1
vJJ1 2
)JJ2 3
.JJ3 4
ToArrayJJ4 ;
(JJ; <
)JJ< =
;JJ= >
awaitLL 
_redisLL 
.LL 
DatabaseLL !
.LL! "
KeyDeleteAsyncLL" 0
(LL0 1
_prefixLL1 8
+LL9 :
tagLL; >
)LL> ?
;LL? @
awaitNN $
_tagRemovedEventHandlersNN *
.NN* +
InvokeAsyncNN+ 6
(NN6 7
xNN7 8
=>NN9 ;
xNN< =
.NN= >
TagRemovedAsyncNN> M
(NNM N
tagNNN Q
,NNQ R
setNNS V
)NNV W
,NNW X
_loggerNNY `
)NN` a
;NNa b
}OO 	
}PP 
}QQ ˆ;
|D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Redis\Startup.cs
	namespace 	
OrchardCore
 
. 
Redis 
{ 
public 

class 
Startup 
: 
StartupBase &
{ 
private 
readonly 
string 
_tenant  '
;' (
private 
readonly 
IShellConfiguration ,
_configuration- ;
;; <
private 
readonly 
ILogger  
_logger! (
;( )
public 
Startup 
( 
ShellSettings $
shellSettings% 2
,2 3
IShellConfiguration4 G
configurationH U
,U V
ILoggerW ^
<^ _
Startup_ f
>f g
loggerh n
)n o
{ 	
_tenant 
= 
shellSettings #
.# $
Name$ (
;( )
_configuration 
= 
configuration *
;* +
_logger 
= 
logger 
; 
} 	
public!! 
override!! 
void!! 
ConfigureServices!! .
(!!. /
IServiceCollection!!/ A
services!!B J
)!!J K
{"" 	
try## 
{$$ 
var%%  
configurationOptions%% (
=%%) * 
ConfigurationOptions%%+ ?
.%%? @
Parse%%@ E
(%%E F
_configuration%%F T
[%%T U
$str%%U v
]%%v w
)%%w x
;%%x y
services&& 
.&& 
	Configure&& "
<&&" #
RedisOptions&&# /
>&&/ 0
(&&0 1
options&&1 8
=>&&9 ;
options&&< C
.&&C D 
ConfigurationOptions&&D X
=&&Y Z 
configurationOptions&&[ o
)&&o p
;&&p q
}'' 
catch(( 
((( 
	Exception(( 
e(( 
)(( 
{)) 
_logger** 
.** 
LogError**  
(**  !
$str	**! ‘
+
**’ “
e
**” •
.
**• –
Message
**– 
,
** ž
_tenant
**Ÿ ¦
)
**¦ §
;
**§ ¨
return++ 
;++ 
},, 
services.. 
... 
AddSingleton.. !
<..! "
IRedisService.." /
,../ 0
RedisService..1 =
>..= >
(..> ?
)..? @
;..@ A
services// 
.// 
AddSingleton// !
<//! " 
IModularTenantEvents//" 6
>//6 7
(//7 8
sp//8 :
=>//; =
sp//> @
.//@ A
GetRequiredService//A S
<//S T
IRedisService//T a
>//a b
(//b c
)//c d
)//d e
;//e f
}00 	
}11 
[33 
Feature33 
(33 
$str33 &
)33& '
]33' (
public44 

class44 
RedisCacheStartup44 "
:44# $
StartupBase44% 0
{55 
public66 
override66 
void66 
ConfigureServices66 .
(66. /
IServiceCollection66/ A
services66B J
)66J K
{77 	
if88 
(88 
services88 
.88 
Any88 
(88 
d88 
=>88 !
d88" #
.88# $
ServiceType88$ /
==880 2
typeof883 9
(889 :
IRedisService88: G
)88G H
)88H I
)88I J
{99 
services:: 
.:: &
AddStackExchangeRedisCache:: 3
(::3 4
o::4 5
=>::6 8
{::9 :
}::; <
)::< =
;::= >
services;; 
.;; 
AddTransient;; %
<;;% &
IConfigureOptions;;& 7
<;;7 8
RedisCacheOptions;;8 I
>;;I J
,;;J K"
RedisCacheOptionsSetup;;L b
>;;b c
(;;c d
);;d e
;;;e f
services<< 
.<< 
	AddScoped<< "
<<<" #
	ITagCache<<# ,
,<<, -
RedisTagCache<<. ;
><<; <
(<<< =
)<<= >
;<<> ?
}== 
}>> 	
}?? 
[AA 
FeatureAA 
(AA 
$strAA $
)AA$ %
]AA% &
publicBB 

classBB 
RedisBusStartupBB  
:BB! "
StartupBaseBB# .
{CC 
publicDD 
overrideDD 
voidDD 
ConfigureServicesDD .
(DD. /
IServiceCollectionDD/ A
servicesDDB J
)DDJ K
{EE 	
ifFF 
(FF 
servicesFF 
.FF 
AnyFF 
(FF 
dFF 
=>FF !
dFF" #
.FF# $
ServiceTypeFF$ /
==FF0 2
typeofFF3 9
(FF9 :
IRedisServiceFF: G
)FFG H
)FFH I
)FFI J
{GG 
servicesHH 
.HH 
AddSingletonHH %
<HH% &
IMessageBusHH& 1
,HH1 2
RedisBusHH3 ;
>HH; <
(HH< =
)HH= >
;HH> ?
}II 
}JJ 	
}KK 
[MM 
FeatureMM 
(MM 
$strMM %
)MM% &
]MM& '
publicNN 

classNN 
RedisLockStartupNN !
:NN" #
StartupBaseNN$ /
{OO 
publicPP 
overridePP 
voidPP 
ConfigureServicesPP .
(PP. /
IServiceCollectionPP/ A
servicesPPB J
)PPJ K
{QQ 	
ifRR 
(RR 
servicesRR 
.RR 
AnyRR 
(RR 
dRR 
=>RR !
dRR" #
.RR# $
ServiceTypeRR$ /
==RR0 2
typeofRR3 9
(RR9 :
IRedisServiceRR: G
)RRG H
)RRH I
)RRI J
{SS 
servicesTT 
.TT 
AddSingletonTT %
<TT% &
IDistributedLockTT& 6
,TT6 7
	RedisLockTT8 A
>TTA B
(TTB C
)TTC D
;TTD E
}UU 
}VV 	
}WW 
[YY 
FeatureYY 
(YY 
$strYY /
)YY/ 0
]YY0 1
publicZZ 

classZZ &
RedisDataProtectionStartupZZ +
:ZZ, -
StartupBaseZZ. 9
{[[ 
public\\ 
override\\ 
void\\ 
ConfigureServices\\ .
(\\. /
IServiceCollection\\/ A
services\\B J
)\\J K
{]] 	
if^^ 
(^^ 
services^^ 
.^^ 
Any^^ 
(^^ 
d^^ 
=>^^ !
d^^" #
.^^# $
ServiceType^^$ /
==^^0 2
typeof^^3 9
(^^9 :
IRedisService^^: G
)^^G H
)^^H I
)^^I J
{__ 
services`` 
.`` 
AddTransient`` %
<``% &
IConfigureOptions``& 7
<``7 8 
KeyManagementOptions``8 L
>``L M
,``M N*
RedisKeyManagementOptionsSetup``O m
>``m n
(``n o
)``o p
;``p q
}aa 
}bb 	
}cc 
}dd 