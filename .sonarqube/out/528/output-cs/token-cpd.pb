≠
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\AdminMenu.cs
	namespace 	
OrchardCore
 
. 
Layers 
{ 
public		 

class		 
	AdminMenu		 
:		 
INavigationProvider		 0
{

 
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public 
	AdminMenu 
( 
IStringLocalizer )
<) *
	AdminMenu* 3
>3 4
	localizer5 >
)> ?
{ 	
S 
= 
	localizer 
; 
} 	
public 
Task  
BuildNavigationAsync (
(( )
string) /
name0 4
,4 5
NavigationBuilder6 G
builderH O
)O P
{ 	
if 
( 
! 
String 
. 
Equals 
( 
name #
,# $
$str% ,
,, -
StringComparison. >
.> ?
OrdinalIgnoreCase? P
)P Q
)Q R
{ 
return 
Task 
. 
CompletedTask )
;) *
} 
builder 
. 
Add 
( 
S 
[ 
$str 
]  
,  !
design" (
=>) +
design, 2
. 
Add 
( 
S 
[ 
$str %
]% &
,& '
settings( 0
=>1 3
settings4 <
. 
Add 
( 
S 
[ 
$str &
]& '
,' (
S) *
[* +
$str+ 2
]2 3
.3 4
PrefixPosition4 B
(B C
)C D
,D E
zonesF K
=>L N
zonesO T
. 
Action #
(# $
$str$ +
,+ ,
$str- 4
,4 5
new6 9
{: ;
area< @
=A B
$strC Y
,Y Z
groupId[ b
=c d+
LayerSiteSettingsDisplayDriver	e É
.
É Ñ
GroupId
Ñ ã
}
å ç
)
ç é
. 

Permission '
(' (
Permissions( 3
.3 4
ManageLayers4 @
)@ A
. 
LocalNav %
(% &
)& '
)   
)   
.!! 
Add!! 
(!! 
S!! 
[!! 
$str!! $
]!!$ %
,!!% &
S!!' (
[!!( )
$str!!) 2
]!!2 3
.!!3 4
PrefixPosition!!4 B
(!!B C
)!!C D
,!!D E
widgets!!F M
=>!!N P
widgets!!Q X
."" 

Permission"" #
(""# $
Permissions""$ /
.""/ 0
ManageLayers""0 <
)""< =
.## 
Action## 
(##  
$str##  '
,##' (
$str##) 0
,##0 1
new##2 5
{##6 7
area##8 <
=##= >
$str##? S
}##T U
)##U V
.$$ 
LocalNav$$ !
($$! "
)$$" #
)%% 
)%% 
;%% 
return'' 
Task'' 
.'' 
CompletedTask'' %
;''% &
}(( 	
})) 
}** ≥Û
ëD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Controllers\AdminController.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Controllers (
{ 
public 

class 
AdminController  
:! "

Controller# -
{ 
private 
readonly 
IContentManager (
_contentManager) 8
;8 9
private 
readonly &
IContentItemDisplayManager 3&
_contentItemDisplayManager4 N
;N O
private 
readonly 
ISiteService %
_siteService& 2
;2 3
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private   
readonly   !
IAuthorizationService   .!
_authorizationService  / D
;  D E
private!! 
readonly!! 
ISession!! !
_session!!" *
;!!* +
private"" 
readonly""  
IUpdateModelAccessor"" - 
_updateModelAccessor"". B
;""B C
private## 
readonly## $
IVolatileDocumentManager## 1
<##1 2

LayerState##2 <
>##< =
_layerStateManager##> P
;##P Q
private$$ 
readonly$$ 
IDisplayManager$$ (
<$$( )
	Condition$$) 2
>$$2 3$
_conditionDisplayManager$$4 L
;$$L M
private%% 
readonly%% 
IDisplayManager%% (
<%%( )
Rule%%) -
>%%- .
_ruleDisplayManager%%/ B
;%%B C
private&& 
readonly&& !
IConditionIdGenerator&& .!
_conditionIdGenerator&&/ D
;&&D E
private'' 
readonly'' 
IEnumerable'' $
<''$ %
IConditionFactory''% 6
>''6 7
_conditionFactories''8 K
;''K L
private(( 
readonly(( 
IStringLocalizer(( )
S((* +
;((+ ,
private)) 
readonly)) 
IHtmlLocalizer)) '
H))( )
;))) *
private** 
readonly** 
	INotifier** "
	_notifier**# ,
;**, -
public,, 
AdminController,, 
(,, 
IContentManager-- 
contentManager-- *
,--* +&
IContentItemDisplayManager.. &%
contentItemDisplayManager..' @
,..@ A
ISiteService// 
siteService// $
,//$ %
ILayerService00 
layerService00 &
,00& '!
IAuthorizationService11 ! 
authorizationService11" 6
,116 7
ISession22 
session22 
,22  
IUpdateModelAccessor33  
updateModelAccessor33! 4
,334 5$
IVolatileDocumentManager44 $
<44$ %

LayerState44% /
>44/ 0
layerStateManager441 B
,44B C
IDisplayManager55 
<55 
	Condition55 %
>55% &#
conditionDisplayManager55' >
,55> ?
IDisplayManager66 
<66 
Rule66  
>66  !
ruleDisplayManager66" 4
,664 5!
IConditionIdGenerator77 ! 
conditionIdGenerator77" 6
,776 7
IEnumerable88 
<88 
IConditionFactory88 )
>88) *
conditionFactories88+ =
,88= >
IStringLocalizer99 
<99 
AdminController99 ,
>99, -
stringLocalizer99. =
,99= >
IHtmlLocalizer:: 
<:: 
AdminController:: *
>::* +
htmlLocalizer::, 9
,::9 :
	INotifier;; 
notifier;; 
);; 
{<< 	
_contentManager== 
=== 
contentManager== ,
;==, -&
_contentItemDisplayManager>> &
=>>' (%
contentItemDisplayManager>>) B
;>>B C
_siteService?? 
=?? 
siteService?? &
;??& '
_layerService@@ 
=@@ 
layerService@@ (
;@@( )!
_authorizationServiceAA !
=AA" # 
authorizationServiceAA$ 8
;AA8 9
_sessionBB 
=BB 
sessionBB 
;BB  
_updateModelAccessorCC  
=CC! "
updateModelAccessorCC# 6
;CC6 7
_layerStateManagerDD 
=DD  
layerStateManagerDD! 2
;DD2 3$
_conditionDisplayManagerEE $
=EE% &#
conditionDisplayManagerEE' >
;EE> ?
_ruleDisplayManagerFF 
=FF  !
ruleDisplayManagerFF" 4
;FF4 5!
_conditionIdGeneratorGG !
=GG" # 
conditionIdGeneratorGG$ 8
;GG8 9
_conditionFactoriesHH 
=HH  !
conditionFactoriesHH" 4
;HH4 5
	_notifierII 
=II 
notifierII  
;II  !
SJJ 
=JJ 
stringLocalizerJJ 
;JJ  
HKK 
=KK 
htmlLocalizerKK 
;KK 
}LL 	
publicNN 
asyncNN 
TaskNN 
<NN 
IActionResultNN '
>NN' (
IndexNN) .
(NN. /
)NN/ 0
{OO 	
ifPP 
(PP 
!PP 
awaitPP !
_authorizationServicePP ,
.PP, -
AuthorizeAsyncPP- ;
(PP; <
UserPP< @
,PP@ A
PermissionsPPB M
.PPM N
ManageLayersPPN Z
)PPZ [
)PP[ \
{QQ 
returnRR 
ForbidRR 
(RR 
)RR 
;RR  
}SS 
varUU 
layersUU 
=UU 
awaitUU 
_layerServiceUU ,
.UU, -
GetLayersAsyncUU- ;
(UU; <
)UU< =
;UU= >
varVV 
widgetsVV 
=VV 
awaitVV 
_layerServiceVV  -
.VV- .(
GetLayerWidgetsMetadataAsyncVV. J
(VVJ K
cVVK L
=>VVM O
cVVP Q
.VVQ R
LatestVVR X
==VVY [
trueVV\ `
)VV` a
;VVa b
varXX 
modelXX 
=XX 
newXX  
LayersIndexViewModelXX 0
{XX1 2
LayersXX3 9
=XX: ;
layersXX< B
.XXB C
LayersXXC I
.XXI J
ToListXXJ P
(XXP Q
)XXQ R
}XXS T
;XXT U
varZZ 
siteSettingsZZ 
=ZZ 
awaitZZ $
_siteServiceZZ% 1
.ZZ1 2 
GetSiteSettingsAsyncZZ2 F
(ZZF G
)ZZG H
;ZZH I
model\\ 
.\\ 
Zones\\ 
=\\ 
siteSettings\\ &
.\\& '
As\\' )
<\\) *
LayerSettings\\* 7
>\\7 8
(\\8 9
)\\9 :
.\\: ;
Zones\\; @
??\\A C
Array\\D I
.\\I J
Empty\\J O
<\\O P
string\\P V
>\\V W
(\\W X
)\\X Y
;\\Y Z
model]] 
.]] 
Widgets]] 
=]] 
new]] 

Dictionary]]  *
<]]* +
string]]+ 1
,]]1 2
List]]3 7
<]]7 8
dynamic]]8 ?
>]]? @
>]]@ A
(]]A B
)]]B C
;]]C D
foreach__ 
(__ 
var__ 
widget__ 
in__  "
widgets__# *
.__* +
OrderBy__+ 2
(__2 3
x__3 4
=>__5 7
x__8 9
.__9 :
Position__: B
)__B C
)__C D
{`` 
varaa 
zoneaa 
=aa 
widgetaa !
.aa! "
Zoneaa" &
;aa& '
Listbb 
<bb 
dynamicbb 
>bb 
listbb "
;bb" #
ifcc 
(cc 
!cc 
modelcc 
.cc 
Widgetscc "
.cc" #
TryGetValuecc# .
(cc. /
zonecc/ 3
,cc3 4
outcc5 8
listcc9 =
)cc= >
)cc> ?
{dd 
modelee 
.ee 
Widgetsee !
.ee! "
Addee" %
(ee% &
zoneee& *
,ee* +
listee, 0
=ee1 2
newee3 6
Listee7 ;
<ee; <
dynamicee< C
>eeC D
(eeD E
)eeE F
)eeF G
;eeG H
}ff 
listhh 
.hh 
Addhh 
(hh 
awaithh &
_contentItemDisplayManagerhh 9
.hh9 :
BuildDisplayAsynchh: K
(hhK L
widgethhL R
.hhR S
ContentItemhhS ^
,hh^ _ 
_updateModelAccessorhh` t
.hht u
ModelUpdater	hhu Å
,
hhÅ Ç
$str
hhÉ ë
)
hhë í
)
hhí ì
;
hhì î
}ii 
returnkk 
Viewkk 
(kk 
modelkk 
)kk 
;kk 
}ll 	
[nn 	
HttpPostnn	 
]nn 
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
Indexoo) .
(oo. / 
LayersIndexViewModeloo/ C
modelooD I
)ooI J
{pp 	
ifqq 
(qq 
!qq 
awaitqq !
_authorizationServiceqq ,
.qq, -
AuthorizeAsyncqq- ;
(qq; <
Userqq< @
,qq@ A
PermissionsqqB M
.qqM N
ManageLayersqqN Z
)qqZ [
)qq[ \
{rr 
returnss 
Forbidss 
(ss 
)ss 
;ss  
}tt 
returnvv 
RedirectToActionvv #
(vv# $
$strvv$ +
)vv+ ,
;vv, -
}ww 	
publicyy 
asyncyy 
Taskyy 
<yy 
IActionResultyy '
>yy' (
Createyy) /
(yy/ 0
)yy0 1
{zz 	
if{{ 
({{ 
!{{ 
await{{ !
_authorizationService{{ ,
.{{, -
AuthorizeAsync{{- ;
({{; <
User{{< @
,{{@ A
Permissions{{B M
.{{M N
ManageLayers{{N Z
){{Z [
){{[ \
{|| 
return}} 
Forbid}} 
(}} 
)}} 
;}}  
}~~ 
return
ÄÄ 
View
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
HttpPost
ÉÉ	 
,
ÉÉ 

ActionName
ÉÉ 
(
ÉÉ 
$str
ÉÉ &
)
ÉÉ& '
]
ÉÉ' (
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (

CreatePost
ÑÑ) 3
(
ÑÑ3 4 
LayerEditViewModel
ÑÑ4 F
model
ÑÑG L
)
ÑÑL M
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
await
ÜÜ #
_authorizationService
ÜÜ ,
.
ÜÜ, -
AuthorizeAsync
ÜÜ- ;
(
ÜÜ; <
User
ÜÜ< @
,
ÜÜ@ A
Permissions
ÜÜB M
.
ÜÜM N
ManageLayers
ÜÜN Z
)
ÜÜZ [
)
ÜÜ[ \
{
áá 
return
àà 
Forbid
àà 
(
àà 
)
àà 
;
àà  
}
ââ 
var
ãã 
layers
ãã 
=
ãã 
await
ãã 
_layerService
ãã ,
.
ãã, -
LoadLayersAsync
ãã- <
(
ãã< =
)
ãã= >
;
ãã> ?
ValidateViewModel
çç 
(
çç 
model
çç #
,
çç# $
layers
çç% +
,
çç+ ,
isNew
çç- 2
:
çç2 3
true
çç4 8
)
çç8 9
;
çç9 :
if
èè 
(
èè 

ModelState
èè 
.
èè 
IsValid
èè "
)
èè" #
{
êê 
var
ëë 
layer
ëë 
=
ëë 
new
ëë 
Layer
ëë  %
{
íí 
Name
ìì 
=
ìì 
model
ìì  
.
ìì  !
Name
ìì! %
,
ìì% &
Description
îî 
=
îî  !
model
îî" '
.
îî' (
Description
îî( 3
}
ïï 
;
ïï 
layer
óó 
.
óó 
	LayerRule
óó 
=
óó  !
new
óó" %
Rule
óó& *
(
óó* +
)
óó+ ,
;
óó, -#
_conditionIdGenerator
òò %
.
òò% &
GenerateUniqueId
òò& 6
(
òò6 7
layer
òò7 <
.
òò< =
	LayerRule
òò= F
)
òòF G
;
òòG H
layers
öö 
.
öö 
Layers
öö 
.
öö 
Add
öö !
(
öö! "
layer
öö" '
)
öö' (
;
öö( )
await
úú 
_layerService
úú #
.
úú# $
UpdateAsync
úú$ /
(
úú/ 0
layers
úú0 6
)
úú6 7
;
úú7 8
return
ûû 
RedirectToAction
ûû '
(
ûû' (
$str
ûû( /
)
ûû/ 0
;
ûû0 1
}
üü 
return
°° 
View
°° 
(
°° 
model
°° 
)
°° 
;
°° 
}
¢¢ 	
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
IActionResult
§§ '
>
§§' (
Edit
§§) -
(
§§- .
string
§§. 4
name
§§5 9
)
§§9 :
{
•• 	
if
¶¶ 
(
¶¶ 
!
¶¶ 
await
¶¶ #
_authorizationService
¶¶ ,
.
¶¶, -
AuthorizeAsync
¶¶- ;
(
¶¶; <
User
¶¶< @
,
¶¶@ A
Permissions
¶¶B M
.
¶¶M N
ManageLayers
¶¶N Z
)
¶¶Z [
)
¶¶[ \
{
ßß 
return
®® 
Forbid
®® 
(
®® 
)
®® 
;
®®  
}
©© 
var
´´ 
layers
´´ 
=
´´ 
await
´´ 
_layerService
´´ ,
.
´´, -
GetLayersAsync
´´- ;
(
´´; <
)
´´< =
;
´´= >
var
≠≠ 
layer
≠≠ 
=
≠≠ 
layers
≠≠ 
.
≠≠ 
Layers
≠≠ %
.
≠≠% &
FirstOrDefault
≠≠& 4
(
≠≠4 5
x
≠≠5 6
=>
≠≠7 9
String
≠≠: @
.
≠≠@ A
Equals
≠≠A G
(
≠≠G H
x
≠≠H I
.
≠≠I J
Name
≠≠J N
,
≠≠N O
name
≠≠P T
)
≠≠T U
)
≠≠U V
;
≠≠V W
if
ØØ 
(
ØØ 
layer
ØØ 
==
ØØ 
null
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
NotFound
±± 
(
±±  
)
±±  !
;
±±! "
}
≤≤ 
dynamic
¥¥ 
rule
¥¥ 
=
¥¥ 
await
¥¥  !
_ruleDisplayManager
¥¥! 4
.
¥¥4 5
BuildDisplayAsync
¥¥5 F
(
¥¥F G
layer
¥¥G L
.
¥¥L M
	LayerRule
¥¥M V
,
¥¥V W"
_updateModelAccessor
¥¥X l
.
¥¥l m
ModelUpdater
¥¥m y
,
¥¥y z
$str¥¥{ Ñ
)¥¥Ñ Ö
;¥¥Ö Ü
rule
µµ 
.
µµ 
ConditionId
µµ 
=
µµ 
layer
µµ $
.
µµ$ %
	LayerRule
µµ% .
.
µµ. /
ConditionId
µµ/ :
;
µµ: ;
var
∑∑ 

thumbnails
∑∑ 
=
∑∑ 
new
∑∑  

Dictionary
∑∑! +
<
∑∑+ ,
string
∑∑, 2
,
∑∑2 3
dynamic
∑∑4 ;
>
∑∑; <
(
∑∑< =
)
∑∑= >
;
∑∑> ?
foreach
∏∏ 
(
∏∏ 
var
∏∏ 
factory
∏∏  
in
∏∏! #!
_conditionFactories
∏∏$ 7
)
∏∏7 8
{
ππ 
var
∫∫ 
	condition
∫∫ 
=
∫∫ 
factory
∫∫  '
.
∫∫' (
Create
∫∫( .
(
∫∫. /
)
∫∫/ 0
;
∫∫0 1
dynamic
ªª 
	thumbnail
ªª !
=
ªª" #
await
ªª$ )&
_conditionDisplayManager
ªª* B
.
ªªB C
BuildDisplayAsync
ªªC T
(
ªªT U
	condition
ªªU ^
,
ªª^ _"
_updateModelAccessor
ªª` t
.
ªªt u
ModelUpdaterªªu Å
,ªªÅ Ç
$strªªÉ é
)ªªé è
;ªªè ê
	thumbnail
ºº 
.
ºº 
	Condition
ºº #
=
ºº$ %
	condition
ºº& /
;
ºº/ 0

thumbnails
ΩΩ 
.
ΩΩ 
Add
ΩΩ 
(
ΩΩ 
factory
ΩΩ &
.
ΩΩ& '
Name
ΩΩ' +
,
ΩΩ+ ,
	thumbnail
ΩΩ- 6
)
ΩΩ6 7
;
ΩΩ7 8
}
ææ 
var
¿¿ 
model
¿¿ 
=
¿¿ 
new
¿¿  
LayerEditViewModel
¿¿ .
{
¡¡ 
Name
¬¬ 
=
¬¬ 
layer
¬¬ 
.
¬¬ 
Name
¬¬ !
,
¬¬! "
Description
√√ 
=
√√ 
layer
√√ #
.
√√# $
Description
√√$ /
,
√√/ 0
	LayerRule
ƒƒ 
=
ƒƒ 
rule
ƒƒ  
,
ƒƒ  !

Thumbnails
≈≈ 
=
≈≈ 

thumbnails
≈≈ '
,
≈≈' (
}
∆∆ 
;
∆∆ 
return
»» 
View
»» 
(
»» 
model
»» 
)
»» 
;
»» 
}
…… 	
[
ÀÀ 	
HttpPost
ÀÀ	 
,
ÀÀ 

ActionName
ÀÀ 
(
ÀÀ 
$str
ÀÀ $
)
ÀÀ$ %
]
ÀÀ% &
public
ÃÃ 
async
ÃÃ 
Task
ÃÃ 
<
ÃÃ 
IActionResult
ÃÃ '
>
ÃÃ' (
EditPost
ÃÃ) 1
(
ÃÃ1 2 
LayerEditViewModel
ÃÃ2 D
model
ÃÃE J
)
ÃÃJ K
{
ÕÕ 	
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
await
ŒŒ #
_authorizationService
ŒŒ ,
.
ŒŒ, -
AuthorizeAsync
ŒŒ- ;
(
ŒŒ; <
User
ŒŒ< @
,
ŒŒ@ A
Permissions
ŒŒB M
.
ŒŒM N
ManageLayers
ŒŒN Z
)
ŒŒZ [
)
ŒŒ[ \
{
œœ 
return
–– 
Forbid
–– 
(
–– 
)
–– 
;
––  
}
—— 
var
”” 
layers
”” 
=
”” 
await
”” 
_layerService
”” ,
.
””, -
LoadLayersAsync
””- <
(
””< =
)
””= >
;
””> ?
ValidateViewModel
’’ 
(
’’ 
model
’’ #
,
’’# $
layers
’’% +
,
’’+ ,
isNew
’’- 2
:
’’2 3
false
’’4 9
)
’’9 :
;
’’: ;
if
◊◊ 
(
◊◊ 

ModelState
◊◊ 
.
◊◊ 
IsValid
◊◊ "
)
◊◊" #
{
ÿÿ 
var
ŸŸ 
layer
ŸŸ 
=
ŸŸ 
layers
ŸŸ "
.
ŸŸ" #
Layers
ŸŸ# )
.
ŸŸ) *
FirstOrDefault
ŸŸ* 8
(
ŸŸ8 9
x
ŸŸ9 :
=>
ŸŸ; =
String
ŸŸ> D
.
ŸŸD E
Equals
ŸŸE K
(
ŸŸK L
x
ŸŸL M
.
ŸŸM N
Name
ŸŸN R
,
ŸŸR S
model
ŸŸT Y
.
ŸŸY Z
Name
ŸŸZ ^
)
ŸŸ^ _
)
ŸŸ_ `
;
ŸŸ` a
if
€€ 
(
€€ 
layer
€€ 
==
€€ 
null
€€ !
)
€€! "
{
‹‹ 
return
›› 
NotFound
›› #
(
››# $
)
››$ %
;
››% &
}
ﬁﬁ 
layer
‡‡ 
.
‡‡ 
Name
‡‡ 
=
‡‡ 
model
‡‡ "
.
‡‡" #
Name
‡‡# '
;
‡‡' (
layer
·· 
.
·· 
Description
·· !
=
··" #
model
··$ )
.
··) *
Description
··* 5
;
··5 6
await
„„ 
_layerService
„„ #
.
„„# $
UpdateAsync
„„$ /
(
„„/ 0
layers
„„0 6
)
„„6 7
;
„„7 8
return
ÂÂ 
RedirectToAction
ÂÂ '
(
ÂÂ' (
$str
ÂÂ( /
)
ÂÂ/ 0
;
ÂÂ0 1
}
ÊÊ 
return
ËË 
View
ËË 
(
ËË 
model
ËË 
)
ËË 
;
ËË 
}
ÈÈ 	
[
ÎÎ 	
HttpPost
ÎÎ	 
]
ÎÎ 
public
ÏÏ 
async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
IActionResult
ÏÏ '
>
ÏÏ' (
Delete
ÏÏ) /
(
ÏÏ/ 0
string
ÏÏ0 6
name
ÏÏ7 ;
)
ÏÏ; <
{
ÌÌ 	
if
ÓÓ 
(
ÓÓ 
!
ÓÓ 
await
ÓÓ #
_authorizationService
ÓÓ ,
.
ÓÓ, -
AuthorizeAsync
ÓÓ- ;
(
ÓÓ; <
User
ÓÓ< @
,
ÓÓ@ A
Permissions
ÓÓB M
.
ÓÓM N
ManageLayers
ÓÓN Z
)
ÓÓZ [
)
ÓÓ[ \
{
ÔÔ 
return
 
Forbid
 
(
 
)
 
;
  
}
ÒÒ 
var
ÛÛ 
layers
ÛÛ 
=
ÛÛ 
await
ÛÛ 
_layerService
ÛÛ ,
.
ÛÛ, -
LoadLayersAsync
ÛÛ- <
(
ÛÛ< =
)
ÛÛ= >
;
ÛÛ> ?
var
ıı 
layer
ıı 
=
ıı 
layers
ıı 
.
ıı 
Layers
ıı %
.
ıı% &
FirstOrDefault
ıı& 4
(
ıı4 5
x
ıı5 6
=>
ıı7 9
String
ıı: @
.
ıı@ A
Equals
ııA G
(
ııG H
x
ııH I
.
ııI J
Name
ııJ N
,
ııN O
name
ııP T
)
ııT U
)
ııU V
;
ııV W
if
˜˜ 
(
˜˜ 
layer
˜˜ 
==
˜˜ 
null
˜˜ 
)
˜˜ 
{
¯¯ 
return
˘˘ 
NotFound
˘˘ 
(
˘˘  
)
˘˘  !
;
˘˘! "
}
˙˙ 
var
¸¸ 
widgets
¸¸ 
=
¸¸ 
await
¸¸ 
_layerService
¸¸  -
.
¸¸- .*
GetLayerWidgetsMetadataAsync
¸¸. J
(
¸¸J K
c
¸¸K L
=>
¸¸M O
c
¸¸P Q
.
¸¸Q R
Latest
¸¸R X
==
¸¸Y [
true
¸¸\ `
)
¸¸` a
;
¸¸a b
if
˛˛ 
(
˛˛ 
!
˛˛ 
widgets
˛˛ 
.
˛˛ 
Any
˛˛ 
(
˛˛ 
x
˛˛ 
=>
˛˛ !
String
˛˛" (
.
˛˛( )
Equals
˛˛) /
(
˛˛/ 0
x
˛˛0 1
.
˛˛1 2
Layer
˛˛2 7
,
˛˛7 8
name
˛˛9 =
,
˛˛= >
StringComparison
˛˛? O
.
˛˛O P
OrdinalIgnoreCase
˛˛P a
)
˛˛a b
)
˛˛b c
)
˛˛c d
{
ˇˇ 
layers
ÄÄ 
.
ÄÄ 
Layers
ÄÄ 
.
ÄÄ 
Remove
ÄÄ $
(
ÄÄ$ %
layer
ÄÄ% *
)
ÄÄ* +
;
ÄÄ+ ,
await
ÅÅ 
_layerService
ÅÅ #
.
ÅÅ# $
UpdateAsync
ÅÅ$ /
(
ÅÅ/ 0
layers
ÅÅ0 6
)
ÅÅ6 7
;
ÅÅ7 8
	_notifier
ÇÇ 
.
ÇÇ 
Success
ÇÇ !
(
ÇÇ! "
H
ÇÇ" #
[
ÇÇ# $
$str
ÇÇ$ A
]
ÇÇA B
)
ÇÇB C
;
ÇÇC D
}
ÉÉ 
else
ÑÑ 
{
ÖÖ 
	_notifier
ÜÜ 
.
ÜÜ 
Error
ÜÜ 
(
ÜÜ  
H
ÜÜ  !
[
ÜÜ! "
$str
ÜÜ" p
]
ÜÜp q
)
ÜÜq r
;
ÜÜr s
}
áá 
return
ââ 
RedirectToAction
ââ #
(
ââ# $
$str
ââ$ +
)
ââ+ ,
;
ââ, -
}
ää 	
[
åå 	
HttpPost
åå	 
]
åå 
public
çç 
async
çç 
Task
çç 
<
çç 
IActionResult
çç '
>
çç' (
UpdatePosition
çç) 7
(
çç7 8
string
çç8 >
contentItemId
çç? L
,
ççL M
double
ççN T
position
ççU ]
,
çç] ^
string
çç_ e
zone
ççf j
)
ççj k
{
éé 	
if
èè 
(
èè 
!
èè 
await
èè #
_authorizationService
èè ,
.
èè, -
AuthorizeAsync
èè- ;
(
èè; <
User
èè< @
,
èè@ A
Permissions
èèB M
.
èèM N
ManageLayers
èèN Z
)
èèZ [
)
èè[ \
{
êê 
return
ëë 

StatusCode
ëë !
(
ëë! "
$num
ëë" %
)
ëë% &
;
ëë& '
}
íí 
var
ïï 
contentItem
ïï 
=
ïï 
await
ïï #
_contentManager
ïï$ 3
.
ïï3 4
GetAsync
ïï4 <
(
ïï< =
contentItemId
ïï= J
,
ïïJ K
VersionOptions
ïïL Z
.
ïïZ [
Latest
ïï[ a
)
ïïa b
;
ïïb c
if
óó 
(
óó 
contentItem
óó 
==
óó 
null
óó #
)
óó# $
{
òò 
return
ôô 

StatusCode
ôô !
(
ôô! "
$num
ôô" %
)
ôô% &
;
ôô& '
}
öö 
var
úú 
layerMetadata
úú 
=
úú 
contentItem
úú  +
.
úú+ ,
As
úú, .
<
úú. /
LayerMetadata
úú/ <
>
úú< =
(
úú= >
)
úú> ?
;
úú? @
if
ûû 
(
ûû 
layerMetadata
ûû 
==
ûû  
null
ûû! %
)
ûû% &
{
üü 
return
†† 

StatusCode
†† !
(
††! "
$num
††" %
)
††% &
;
††& '
}
°° 
layerMetadata
££ 
.
££ 
Position
££ "
=
££# $
position
££% -
;
££- .
layerMetadata
§§ 
.
§§ 
Zone
§§ 
=
§§  
zone
§§! %
;
§§% &
contentItem
¶¶ 
.
¶¶ 
Apply
¶¶ 
(
¶¶ 
layerMetadata
¶¶ +
)
¶¶+ ,
;
¶¶, -
_session
®® 
.
®® 
Save
®® 
(
®® 
contentItem
®® %
)
®®% &
;
®®& '
if
¨¨ 
(
¨¨ 
contentItem
¨¨ 
.
¨¨ 
IsPublished
¨¨ '
(
¨¨' (
)
¨¨( )
==
¨¨* ,
false
¨¨- 2
)
¨¨2 3
{
≠≠ 
var
ÆÆ "
publishedContentItem
ÆÆ (
=
ÆÆ) *
await
ÆÆ+ 0
_contentManager
ÆÆ1 @
.
ÆÆ@ A
GetAsync
ÆÆA I
(
ÆÆI J
contentItemId
ÆÆJ W
,
ÆÆW X
VersionOptions
ÆÆY g
.
ÆÆg h
	Published
ÆÆh q
)
ÆÆq r
;
ÆÆr s
if
ØØ 
(
ØØ "
publishedContentItem
ØØ (
!=
ØØ) +
null
ØØ, 0
)
ØØ0 1
{
∞∞ 
layerMetadata
±± !
=
±±" #
contentItem
±±$ /
.
±±/ 0
As
±±0 2
<
±±2 3
LayerMetadata
±±3 @
>
±±@ A
(
±±A B
)
±±B C
;
±±C D
if
≥≥ 
(
≥≥ 
layerMetadata
≥≥ %
==
≥≥& (
null
≥≥) -
)
≥≥- .
{
¥¥ 
return
µµ 

StatusCode
µµ )
(
µµ) *
$num
µµ* -
)
µµ- .
;
µµ. /
}
∂∂ 
layerMetadata
∏∏ !
.
∏∏! "
Position
∏∏" *
=
∏∏+ ,
position
∏∏- 5
;
∏∏5 6
layerMetadata
ππ !
.
ππ! "
Zone
ππ" &
=
ππ' (
zone
ππ) -
;
ππ- ."
publishedContentItem
ªª (
.
ªª( )
Apply
ªª) .
(
ªª. /
layerMetadata
ªª/ <
)
ªª< =
;
ªª= >
_session
ΩΩ 
.
ΩΩ 
Save
ΩΩ !
(
ΩΩ! ""
publishedContentItem
ΩΩ" 6
)
ΩΩ6 7
;
ΩΩ7 8
}
ææ 
}
øø 
await
¬¬  
_layerStateManager
¬¬ $
.
¬¬$ %
UpdateAsync
¬¬% 0
(
¬¬0 1
new
¬¬1 4

LayerState
¬¬5 ?
(
¬¬? @
)
¬¬@ A
)
¬¬A B
;
¬¬B C
if
ƒƒ 
(
ƒƒ 
Request
ƒƒ 
.
ƒƒ 
Headers
ƒƒ 
!=
ƒƒ  "
null
ƒƒ# '
&&
ƒƒ( *
Request
ƒƒ+ 2
.
ƒƒ2 3
Headers
ƒƒ3 :
[
ƒƒ: ;
$str
ƒƒ; M
]
ƒƒM N
==
ƒƒO Q
$str
ƒƒR b
)
ƒƒb c
{
≈≈ 
return
∆∆ 

StatusCode
∆∆ !
(
∆∆! "
$num
∆∆" %
)
∆∆% &
;
∆∆& '
}
«« 
else
»» 
{
…… 
return
   
RedirectToAction
   '
(
  ' (
$str
  ( /
)
  / 0
;
  0 1
}
ÀÀ 
}
ÃÃ 	
private
ŒŒ 
void
ŒŒ 
ValidateViewModel
ŒŒ &
(
ŒŒ& ' 
LayerEditViewModel
ŒŒ' 9
model
ŒŒ: ?
,
ŒŒ? @
LayersDocument
ŒŒA O
layers
ŒŒP V
,
ŒŒV W
bool
ŒŒX \
isNew
ŒŒ] b
)
ŒŒb c
{
œœ 	
if
–– 
(
–– 
String
–– 
.
––  
IsNullOrWhiteSpace
–– )
(
––) *
model
––* /
.
––/ 0
Name
––0 4
)
––4 5
)
––5 6
{
—— 

ModelState
““ 
.
““ 
AddModelError
““ (
(
““( )
nameof
““) /
(
““/ 0 
LayerEditViewModel
““0 B
.
““B C
Name
““C G
)
““G H
,
““H I
S
““J K
[
““K L
$str
““L i
]
““i j
)
““j k
;
““k l
}
”” 
else
‘‘ 
if
‘‘ 
(
‘‘ 
isNew
‘‘ 
&&
‘‘ 
layers
‘‘ $
.
‘‘$ %
Layers
‘‘% +
.
‘‘+ ,
Any
‘‘, /
(
‘‘/ 0
x
‘‘0 1
=>
‘‘2 4
String
‘‘5 ;
.
‘‘; <
Equals
‘‘< B
(
‘‘B C
x
‘‘C D
.
‘‘D E
Name
‘‘E I
,
‘‘I J
model
‘‘K P
.
‘‘P Q
Name
‘‘Q U
,
‘‘U V
StringComparison
‘‘W g
.
‘‘g h
OrdinalIgnoreCase
‘‘h y
)
‘‘y z
)
‘‘z {
)
‘‘{ |
{
’’ 

ModelState
÷÷ 
.
÷÷ 
AddModelError
÷÷ (
(
÷÷( )
nameof
÷÷) /
(
÷÷/ 0 
LayerEditViewModel
÷÷0 B
.
÷÷B C
Name
÷÷C G
)
÷÷G H
,
÷÷H I
S
÷÷J K
[
÷÷K L
$str
÷÷L l
]
÷÷l m
)
÷÷m n
;
÷÷n o
}
◊◊ 
}
ÿÿ 	
}
ŸŸ 
}⁄⁄ °ı
ïD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Controllers\LayerRuleController.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Controllers (
{ 
[ 
Admin 

]
 
public 

class 
LayerRuleController $
:% &

Controller' 1
{ 
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly 
IDisplayManager (
<( )
	Condition) 2
>2 3
_displayManager4 C
;C D
private 
readonly 
IEnumerable $
<$ %
IConditionFactory% 6
>6 7

_factories8 B
;B C
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private 
readonly !
IConditionIdGenerator .!
_conditionIdGenerator/ D
;D E
private 
readonly 
ISiteService %
_siteService& 2
;2 3
private 
readonly 
	INotifier "
	_notifier# ,
;, -
private 
readonly  
IUpdateModelAccessor - 
_updateModelAccessor. B
;B C
private 
readonly 
IHtmlLocalizer '
H( )
;) *
private 
readonly 
dynamic  
New! $
;$ %
public!! 
LayerRuleController!! "
(!!" #!
IAuthorizationService"" ! 
authorizationService""" 6
,""6 7
IDisplayManager## 
<## 
	Condition## %
>##% &
displayManager##' 5
,##5 6
IEnumerable$$ 
<$$ 
IConditionFactory$$ )
>$$) *
	factories$$+ 4
,$$4 5
ILayerService%% 
layerService%% &
,%%& '!
IConditionIdGenerator&& ! 
conditionIdGenerator&&" 6
,&&6 7
ISiteService'' 
siteService'' $
,''$ %
IShapeFactory(( 
shapeFactory(( &
,((& '
IHtmlLocalizer)) 
<)) 
LayerRuleController)) .
>)). /
htmlLocalizer))0 =
,))= >
	INotifier** 
notifier** 
,**  
IUpdateModelAccessor++  
updateModelAccessor++! 4
)++4 5
{,, 	
_displayManager-- 
=-- 
displayManager-- ,
;--, -

_factories.. 
=.. 
	factories.. "
;.." #!
_authorizationService// !
=//" # 
authorizationService//$ 8
;//8 9
_layerService00 
=00 
layerService00 (
;00( )!
_conditionIdGenerator11 !
=11" # 
conditionIdGenerator11$ 8
;118 9
_siteService22 
=22 
siteService22 &
;22& '
	_notifier33 
=33 
notifier33  
;33  ! 
_updateModelAccessor44  
=44! "
updateModelAccessor44# 6
;446 7
New55 
=55 
shapeFactory55 
;55 
H66 
=66 
htmlLocalizer66 
;66 
}77 	
public99 
async99 
Task99 
<99 
IActionResult99 '
>99' (
Create99) /
(99/ 0
string990 6
	queryType997 @
,99@ A
string99B H
name99I M
,99M N
string99O U
type99V Z
,99Z [
string99\ b
conditionGroupId99c s
)99s t
{:: 	
if;; 
(;; 
!;; 
await;; !
_authorizationService;; ,
.;;, -
AuthorizeAsync;;- ;
(;;; <
User;;< @
,;;@ A
Permissions;;B M
.;;M N
ManageLayers;;N Z
);;Z [
);;[ \
{<< 
return== 
Forbid== 
(== 
)== 
;==  
}>> 
var@@ 
layers@@ 
=@@ 
await@@ 
_layerService@@ ,
.@@, -
GetLayersAsync@@- ;
(@@; <
)@@< =
;@@= >
varAA 
layerAA 
=AA 
layersAA 
.AA 
LayersAA %
.AA% &
FirstOrDefaultAA& 4
(AA4 5
xAA5 6
=>AA7 9
StringAA: @
.AA@ A
EqualsAAA G
(AAG H
xAAH I
.AAI J
NameAAJ N
,AAN O
nameAAP T
)AAT U
)AAU V
;AAV W
ifCC 
(CC 
layerCC 
==CC 
nullCC 
)CC 
{DD 
returnEE 
NotFoundEE 
(EE  
)EE  !
;EE! "
}FF 
varHH 
conditionGroupHH 
=HH  
FindConditionGroupHH! 3
(HH3 4
layerHH4 9
.HH9 :
	LayerRuleHH: C
,HHC D
conditionGroupIdHHE U
)HHU V
;HHV W
ifJJ 
(JJ 
conditionGroupJJ 
==JJ !
nullJJ" &
)JJ& '
{KK 
returnLL 
NotFoundLL 
(LL  
)LL  !
;LL! "
}MM 
varOO 
	conditionOO 
=OO 

_factoriesOO &
.OO& '
FirstOrDefaultOO' 5
(OO5 6
xOO6 7
=>OO8 :
xOO; <
.OO< =
NameOO= A
==OOB D
typeOOE I
)OOI J
?OOJ K
.OOK L
CreateOOL R
(OOR S
)OOS T
;OOT U
ifQQ 
(QQ 
	conditionQQ 
==QQ 
nullQQ !
)QQ! "
{RR 
returnSS 
NotFoundSS 
(SS  
)SS  !
;SS! "
}TT 
varVV 
modelVV 
=VV 
newVV $
LayerRuleCreateViewModelVV 4
{WW 
NameXX 
=XX 
nameXX 
,XX 
ConditionGroupIdYY  
=YY! "
conditionGroupYY# 1
.YY1 2
ConditionIdYY2 =
,YY= >
ConditionTypeZZ 
=ZZ 
typeZZ  $
,ZZ$ %
Editor[[ 
=[[ 
await[[ 
_displayManager[[ .
.[[. /
BuildEditorAsync[[/ ?
([[? @
	condition[[@ I
,[[I J
updater[[K R
:[[R S 
_updateModelAccessor[[T h
.[[h i
ModelUpdater[[i u
,[[u v
isNew[[w |
:[[| }
true	[[~ Ç
)
[[Ç É
}\\ 
;\\ 
return^^ 
View^^ 
(^^ 
model^^ 
)^^ 
;^^ 
}__ 	
[aa 	
HttpPostaa	 
]aa 
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
Createbb) /
(bb/ 0$
LayerRuleCreateViewModelbb0 H
modelbbI N
)bbN O
{cc 	
ifdd 
(dd 
!dd 
awaitdd !
_authorizationServicedd ,
.dd, -
AuthorizeAsyncdd- ;
(dd; <
Userdd< @
,dd@ A
PermissionsddB M
.ddM N
ManageLayersddN Z
)ddZ [
)dd[ \
{ee 
returnff 
Forbidff 
(ff 
)ff 
;ff  
}gg 
varii 
layersii 
=ii 
awaitii 
_layerServiceii ,
.ii, -
LoadLayersAsyncii- <
(ii< =
)ii= >
;ii> ?
varjj 
layerjj 
=jj 
layersjj 
.jj 
Layersjj %
.jj% &
FirstOrDefaultjj& 4
(jj4 5
xjj5 6
=>jj7 9
Stringjj: @
.jj@ A
EqualsjjA G
(jjG H
xjjH I
.jjI J
NamejjJ N
,jjN O
modeljjP U
.jjU V
NamejjV Z
)jjZ [
)jj[ \
;jj\ ]
ifll 
(ll 
layerll 
==ll 
nullll 
)ll 
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
varqq 
conditionGroupqq 
=qq  
FindConditionGroupqq! 3
(qq3 4
layerqq4 9
.qq9 :
	LayerRuleqq: C
,qqC D
modelqqE J
.qqJ K
ConditionGroupIdqqK [
)qq[ \
;qq\ ]
ifss 
(ss 
conditionGroupss 
==ss !
nullss" &
)ss& '
{tt 
returnuu 
NotFounduu 
(uu  
)uu  !
;uu! "
}vv 
varxx 
	conditionxx 
=xx 

_factoriesxx &
.xx& '
FirstOrDefaultxx' 5
(xx5 6
xxx6 7
=>xx8 :
xxx; <
.xx< =
Namexx= A
==xxB D
modelxxE J
.xxJ K
ConditionTypexxK X
)xxX Y
?xxY Z
.xxZ [
Createxx[ a
(xxa b
)xxb c
;xxc d
ifzz 
(zz 
	conditionzz 
==zz 
nullzz !
)zz! "
{{{ 
return|| 
NotFound|| 
(||  
)||  !
;||! "
}}} 
var 
editor 
= 
await 
_displayManager .
.. /
UpdateEditorAsync/ @
(@ A
	conditionA J
,J K
updaterL S
:S T 
_updateModelAccessorU i
.i j
ModelUpdaterj v
,v w
isNewx }
:} ~
true	 É
)
É Ñ
;
Ñ Ö
if
ÅÅ 
(
ÅÅ 

ModelState
ÅÅ 
.
ÅÅ 
IsValid
ÅÅ "
)
ÅÅ" #
{
ÇÇ #
_conditionIdGenerator
ÉÉ %
.
ÉÉ% &
GenerateUniqueId
ÉÉ& 6
(
ÉÉ6 7
	condition
ÉÉ7 @
)
ÉÉ@ A
;
ÉÉA B
conditionGroup
ÑÑ 
.
ÑÑ 

Conditions
ÑÑ )
.
ÑÑ) *
Add
ÑÑ* -
(
ÑÑ- .
	condition
ÑÑ. 7
)
ÑÑ7 8
;
ÑÑ8 9
await
ÖÖ 
_layerService
ÖÖ #
.
ÖÖ# $
UpdateAsync
ÖÖ$ /
(
ÖÖ/ 0
layers
ÖÖ0 6
)
ÖÖ6 7
;
ÖÖ7 8
	_notifier
ÜÜ 
.
ÜÜ 
Success
ÜÜ !
(
ÜÜ! "
H
ÜÜ" #
[
ÜÜ# $
$str
ÜÜ$ C
]
ÜÜC D
)
ÜÜD E
;
ÜÜE F
return
áá 
RedirectToAction
áá '
(
áá' (
$str
áá( .
,
áá. /
$str
áá0 7
,
áá7 8
new
áá9 <
{
áá= >
name
áá? C
=
ááD E
model
ááF K
.
ááK L
Name
ááL P
}
ááQ R
)
ááR S
;
ááS T
}
àà 
model
ää 
.
ää 
Editor
ää 
=
ää 
editor
ää !
;
ää! "
return
çç 
View
çç 
(
çç 
model
çç 
)
çç 
;
çç 
}
éé 	
public
êê 
async
êê 
Task
êê 
<
êê 
IActionResult
êê '
>
êê' (
Edit
êê) -
(
êê- .
string
êê. 4
name
êê5 9
,
êê9 :
string
êê; A
conditionId
êêB M
)
êêM N
{
ëë 	
if
íí 
(
íí 
!
íí 
await
íí #
_authorizationService
íí ,
.
íí, -
AuthorizeAsync
íí- ;
(
íí; <
User
íí< @
,
íí@ A
Permissions
ííB M
.
ííM N
ManageLayers
ííN Z
)
ííZ [
)
íí[ \
{
ìì 
return
îî 
Forbid
îî 
(
îî 
)
îî 
;
îî  
}
ïï 
var
óó 
layers
óó 
=
óó 
await
óó 
_layerService
óó ,
.
óó, -
GetLayersAsync
óó- ;
(
óó; <
)
óó< =
;
óó= >
var
òò 
layer
òò 
=
òò 
layers
òò 
.
òò 
Layers
òò %
.
òò% &
FirstOrDefault
òò& 4
(
òò4 5
x
òò5 6
=>
òò7 9
String
òò: @
.
òò@ A
Equals
òòA G
(
òòG H
x
òòH I
.
òòI J
Name
òòJ N
,
òòN O
name
òòP T
)
òòT U
)
òòU V
;
òòV W
if
öö 
(
öö 
layer
öö 
==
öö 
null
öö 
)
öö 
{
õõ 
return
úú 
NotFound
úú 
(
úú  
)
úú  !
;
úú! "
}
ùù 
var
üü 
	condition
üü 
=
üü 
FindCondition
üü )
(
üü) *
layer
üü* /
.
üü/ 0
	LayerRule
üü0 9
,
üü9 :
conditionId
üü; F
)
üüF G
;
üüG H
if
°° 
(
°° 
	condition
°° 
==
°° 
null
°° !
)
°°! "
{
¢¢ 
return
££ 
NotFound
££ 
(
££  
)
££  !
;
££! "
}
§§ 
var
¶¶ 
model
¶¶ 
=
¶¶ 
new
¶¶ $
LayerRuleEditViewModel
¶¶ 2
{
ßß 
Name
®® 
=
®® 
name
®® 
,
®® 
Editor
©© 
=
©© 
await
©© 
_displayManager
©© .
.
©©. /
BuildEditorAsync
©©/ ?
(
©©? @
	condition
©©@ I
,
©©I J
updater
©©K R
:
©©R S"
_updateModelAccessor
©©T h
.
©©h i
ModelUpdater
©©i u
,
©©u v
isNew
©©w |
:
©©| }
false©©~ É
)©©É Ñ
}
™™ 
;
™™ 
return
¨¨ 
View
¨¨ 
(
¨¨ 
model
¨¨ 
)
¨¨ 
;
¨¨ 
}
≠≠ 	
[
ØØ 	
HttpPost
ØØ	 
]
ØØ 
public
∞∞ 
async
∞∞ 
Task
∞∞ 
<
∞∞ 
IActionResult
∞∞ '
>
∞∞' (
Edit
∞∞) -
(
∞∞- .$
LayerRuleEditViewModel
∞∞. D
model
∞∞E J
)
∞∞J K
{
±± 	
if
≤≤ 
(
≤≤ 
!
≤≤ 
await
≤≤ #
_authorizationService
≤≤ ,
.
≤≤, -
AuthorizeAsync
≤≤- ;
(
≤≤; <
User
≤≤< @
,
≤≤@ A
Permissions
≤≤B M
.
≤≤M N
ManageLayers
≤≤N Z
)
≤≤Z [
)
≤≤[ \
{
≥≥ 
return
¥¥ 
Forbid
¥¥ 
(
¥¥ 
)
¥¥ 
;
¥¥  
}
µµ 
var
∑∑ 
layers
∑∑ 
=
∑∑ 
await
∑∑ 
_layerService
∑∑ ,
.
∑∑, -
LoadLayersAsync
∑∑- <
(
∑∑< =
)
∑∑= >
;
∑∑> ?
var
∏∏ 
layer
∏∏ 
=
∏∏ 
layers
∏∏ 
.
∏∏ 
Layers
∏∏ %
.
∏∏% &
FirstOrDefault
∏∏& 4
(
∏∏4 5
x
∏∏5 6
=>
∏∏7 9
String
∏∏: @
.
∏∏@ A
Equals
∏∏A G
(
∏∏G H
x
∏∏H I
.
∏∏I J
Name
∏∏J N
,
∏∏N O
model
∏∏P U
.
∏∏U V
Name
∏∏V Z
)
∏∏Z [
)
∏∏[ \
;
∏∏\ ]
if
∫∫ 
(
∫∫ 
layer
∫∫ 
==
∫∫ 
null
∫∫ 
)
∫∫ 
{
ªª 
return
ºº 
NotFound
ºº 
(
ºº  
)
ºº  !
;
ºº! "
}
ΩΩ 
var
øø 
	condition
øø 
=
øø 
FindCondition
øø )
(
øø) *
layer
øø* /
.
øø/ 0
	LayerRule
øø0 9
,
øø9 :
model
øø; @
.
øø@ A
ConditionId
øøA L
)
øøL M
;
øøM N
if
¡¡ 
(
¡¡ 
	condition
¡¡ 
==
¡¡ 
null
¡¡ !
)
¡¡! "
{
¬¬ 
return
√√ 
NotFound
√√ 
(
√√  
)
√√  !
;
√√! "
}
ƒƒ 
var
∆∆ 
editor
∆∆ 
=
∆∆ 
await
∆∆ 
_displayManager
∆∆ .
.
∆∆. /
UpdateEditorAsync
∆∆/ @
(
∆∆@ A
	condition
∆∆A J
,
∆∆J K
updater
∆∆L S
:
∆∆S T"
_updateModelAccessor
∆∆U i
.
∆∆i j
ModelUpdater
∆∆j v
,
∆∆v w
isNew
∆∆x }
:
∆∆} ~
false∆∆ Ñ
)∆∆Ñ Ö
;∆∆Ö Ü
if
»» 
(
»» 

ModelState
»» 
.
»» 
IsValid
»» "
)
»»" #
{
…… 
await
   
_layerService
   #
.
  # $
UpdateAsync
  $ /
(
  / 0
layers
  0 6
)
  6 7
;
  7 8
	_notifier
ÀÀ 
.
ÀÀ 
Success
ÀÀ !
(
ÀÀ! "
H
ÀÀ" #
[
ÀÀ# $
$str
ÀÀ$ E
]
ÀÀE F
)
ÀÀF G
;
ÀÀG H
return
ÃÃ 
RedirectToAction
ÃÃ '
(
ÃÃ' (
$str
ÃÃ( .
,
ÃÃ. /
$str
ÃÃ0 7
,
ÃÃ7 8
new
ÃÃ9 <
{
ÃÃ= >
name
ÃÃ? C
=
ÃÃD E
model
ÃÃF K
.
ÃÃK L
Name
ÃÃL P
}
ÃÃQ R
)
ÃÃR S
;
ÃÃS T
}
ÕÕ 
	_notifier
œœ 
.
œœ 
Error
œœ 
(
œœ 
H
œœ 
[
œœ 
$str
œœ D
]
œœD E
)
œœE F
;
œœF G
model
–– 
.
–– 
Editor
–– 
=
–– 
editor
–– !
;
––! "
return
”” 
View
”” 
(
”” 
model
”” 
)
”” 
;
”” 
}
‘‘ 	
[
÷÷ 	
HttpPost
÷÷	 
]
÷÷ 
public
◊◊ 
async
◊◊ 
Task
◊◊ 
<
◊◊ 
IActionResult
◊◊ '
>
◊◊' (
Delete
◊◊) /
(
◊◊/ 0
string
◊◊0 6
name
◊◊7 ;
,
◊◊; <
string
◊◊= C
conditionId
◊◊D O
)
◊◊O P
{
ÿÿ 	
if
ŸŸ 
(
ŸŸ 
!
ŸŸ 
await
ŸŸ #
_authorizationService
ŸŸ ,
.
ŸŸ, -
AuthorizeAsync
ŸŸ- ;
(
ŸŸ; <
User
ŸŸ< @
,
ŸŸ@ A
Permissions
ŸŸB M
.
ŸŸM N
ManageLayers
ŸŸN Z
)
ŸŸZ [
)
ŸŸ[ \
{
⁄⁄ 
return
€€ 
Forbid
€€ 
(
€€ 
)
€€ 
;
€€  
}
‹‹ 
var
ﬁﬁ 
layers
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ 
_layerService
ﬁﬁ ,
.
ﬁﬁ, -
LoadLayersAsync
ﬁﬁ- <
(
ﬁﬁ< =
)
ﬁﬁ= >
;
ﬁﬁ> ?
var
ﬂﬂ 
layer
ﬂﬂ 
=
ﬂﬂ 
layers
ﬂﬂ 
.
ﬂﬂ 
Layers
ﬂﬂ %
.
ﬂﬂ% &
FirstOrDefault
ﬂﬂ& 4
(
ﬂﬂ4 5
x
ﬂﬂ5 6
=>
ﬂﬂ7 9
String
ﬂﬂ: @
.
ﬂﬂ@ A
Equals
ﬂﬂA G
(
ﬂﬂG H
x
ﬂﬂH I
.
ﬂﬂI J
Name
ﬂﬂJ N
,
ﬂﬂN O
name
ﬂﬂP T
)
ﬂﬂT U
)
ﬂﬂU V
;
ﬂﬂV W
if
·· 
(
·· 
layer
·· 
==
·· 
null
·· 
)
·· 
{
‚‚ 
return
„„ 
NotFound
„„ 
(
„„  
)
„„  !
;
„„! "
}
‰‰ 
var
ÊÊ 
	condition
ÊÊ 
=
ÊÊ 
FindCondition
ÊÊ )
(
ÊÊ) *
layer
ÊÊ* /
.
ÊÊ/ 0
	LayerRule
ÊÊ0 9
,
ÊÊ9 :
conditionId
ÊÊ; F
)
ÊÊF G
;
ÊÊG H
var
ÁÁ 
conditionParent
ÁÁ 
=
ÁÁ  !!
FindConditionParent
ÁÁ" 5
(
ÁÁ5 6
layer
ÁÁ6 ;
.
ÁÁ; <
	LayerRule
ÁÁ< E
,
ÁÁE F
conditionId
ÁÁG R
)
ÁÁR S
;
ÁÁS T
if
ÈÈ 
(
ÈÈ 
	condition
ÈÈ 
==
ÈÈ 
null
ÈÈ !
||
ÈÈ" $
conditionParent
ÈÈ% 4
==
ÈÈ5 7
null
ÈÈ8 <
)
ÈÈ< =
{
ÍÍ 
return
ÎÎ 
NotFound
ÎÎ 
(
ÎÎ  
)
ÎÎ  !
;
ÎÎ! "
}
ÏÏ 
conditionParent
ÓÓ 
.
ÓÓ 

Conditions
ÓÓ &
.
ÓÓ& '
Remove
ÓÓ' -
(
ÓÓ- .
	condition
ÓÓ. 7
)
ÓÓ7 8
;
ÓÓ8 9
await
ÔÔ 
_layerService
ÔÔ 
.
ÔÔ  
UpdateAsync
ÔÔ  +
(
ÔÔ+ ,
layers
ÔÔ, 2
)
ÔÔ2 3
;
ÔÔ3 4
	_notifier
ÒÒ 
.
ÒÒ 
Success
ÒÒ 
(
ÒÒ 
H
ÒÒ 
[
ÒÒ  
$str
ÒÒ  A
]
ÒÒA B
)
ÒÒB C
;
ÒÒC D
return
ÛÛ 
RedirectToAction
ÛÛ #
(
ÛÛ# $
$str
ÛÛ$ *
,
ÛÛ* +
$str
ÛÛ, 3
,
ÛÛ3 4
new
ÛÛ5 8
{
ÛÛ9 :
name
ÛÛ; ?
=
ÛÛ@ A
name
ÛÛB F
}
ÛÛG H
)
ÛÛH I
;
ÛÛI J
}
ÙÙ 	
public
ˆˆ 
async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
IActionResult
ˆˆ '
>
ˆˆ' (
UpdateOrder
ˆˆ) 4
(
ˆˆ4 5
string
ˆˆ5 ;
name
ˆˆ< @
,
ˆˆ@ A
string
ˆˆB H
conditionId
ˆˆI T
,
ˆˆT U
string
ˆˆV \
toConditionId
ˆˆ] j
,
ˆˆj k
int
ˆˆl o

toPosition
ˆˆp z
)
ˆˆz {
{
˜˜ 	
if
¯¯ 
(
¯¯ 
!
¯¯ 
await
¯¯ #
_authorizationService
¯¯ ,
.
¯¯, -
AuthorizeAsync
¯¯- ;
(
¯¯; <
User
¯¯< @
,
¯¯@ A
Permissions
¯¯B M
.
¯¯M N
ManageLayers
¯¯N Z
)
¯¯Z [
)
¯¯[ \
{
˘˘ 
return
˙˙ 
Forbid
˙˙ 
(
˙˙ 
)
˙˙ 
;
˙˙  
}
˚˚ 
var
˝˝ 
layers
˝˝ 
=
˝˝ 
await
˝˝ 
_layerService
˝˝ ,
.
˝˝, -
LoadLayersAsync
˝˝- <
(
˝˝< =
)
˝˝= >
;
˝˝> ?
var
˛˛ 
layer
˛˛ 
=
˛˛ 
layers
˛˛ 
.
˛˛ 
Layers
˛˛ %
.
˛˛% &
FirstOrDefault
˛˛& 4
(
˛˛4 5
x
˛˛5 6
=>
˛˛7 9
String
˛˛: @
.
˛˛@ A
Equals
˛˛A G
(
˛˛G H
x
˛˛H I
.
˛˛I J
Name
˛˛J N
,
˛˛N O
name
˛˛P T
)
˛˛T U
)
˛˛U V
;
˛˛V W
if
ÄÄ 
(
ÄÄ 
layer
ÄÄ 
==
ÄÄ 
null
ÄÄ 
)
ÄÄ 
{
ÅÅ 
return
ÇÇ 
NotFound
ÇÇ 
(
ÇÇ  
)
ÇÇ  !
;
ÇÇ! "
}
ÉÉ 
var
ÖÖ 
	condition
ÖÖ 
=
ÖÖ 
FindCondition
ÖÖ )
(
ÖÖ) *
layer
ÖÖ* /
.
ÖÖ/ 0
	LayerRule
ÖÖ0 9
,
ÖÖ9 :
conditionId
ÖÖ; F
)
ÖÖF G
;
ÖÖG H
var
ÜÜ 
conditionParent
ÜÜ 
=
ÜÜ  !!
FindConditionParent
ÜÜ" 5
(
ÜÜ5 6
layer
ÜÜ6 ;
.
ÜÜ; <
	LayerRule
ÜÜ< E
,
ÜÜE F
conditionId
ÜÜG R
)
ÜÜR S
;
ÜÜS T
var
áá 
toCondition
áá 
=
áá 
FindCondition
áá +
(
áá+ ,
layer
áá, 1
.
áá1 2
	LayerRule
áá2 ;
,
áá; <
toConditionId
áá= J
)
ááJ K
;
ááK L
if
ââ 
(
ââ 
	condition
ââ 
==
ââ 
null
ââ !
||
ââ" $
conditionParent
ââ% 4
==
ââ5 7
null
ââ8 <
||
ââ= ?
toCondition
ââ@ K
==
ââL N
null
ââO S
||
ââT V
!
ââW X
(
ââX Y
toCondition
ââY d
is
ââe g
ConditionGroup
ââh v
toGroupConditionââw á
)ââá à
)ââà â
{
ää 
return
ãã 
NotFound
ãã 
(
ãã  
)
ãã  !
;
ãã! "
}
åå 
conditionParent
éé 
.
éé 

Conditions
éé &
.
éé& '
Remove
éé' -
(
éé- .
	condition
éé. 7
)
éé7 8
;
éé8 9
toGroupCondition
èè 
.
èè 

Conditions
èè '
.
èè' (
Insert
èè( .
(
èè. /

toPosition
èè/ 9
,
èè9 :
	condition
èè; D
)
èèD E
;
èèE F
await
ëë 
_layerService
ëë 
.
ëë  
UpdateAsync
ëë  +
(
ëë+ ,
layers
ëë, 2
)
ëë2 3
;
ëë3 4
return
ìì 
Ok
ìì 
(
ìì 
)
ìì 
;
ìì 
}
îî 	
private
ññ 
	Condition
ññ 
FindCondition
ññ '
(
ññ' (
	Condition
ññ( 1
	condition
ññ2 ;
,
ññ; <
string
ññ= C
conditionId
ññD O
)
ññO P
{
óó 	
if
òò 
(
òò 
String
òò 
.
òò 
Equals
òò 
(
òò 
	condition
òò '
.
òò' (
ConditionId
òò( 3
,
òò3 4
conditionId
òò5 @
,
òò@ A
StringComparison
òòB R
.
òòR S
OrdinalIgnoreCase
òòS d
)
òòd e
)
òòe f
{
ôô 
return
öö 
	condition
öö  
;
öö  !
}
õõ 
if
ùù 
(
ùù 
!
ùù 
(
ùù 
	condition
ùù 
is
ùù 
ConditionGroup
ùù -
conditionGroup
ùù. <
)
ùù< =
)
ùù= >
{
ûû 
return
üü 
null
üü 
;
üü 
}
†† 
if
¢¢ 
(
¢¢ 
!
¢¢ 
conditionGroup
¢¢ 
.
¢¢  

Conditions
¢¢  *
.
¢¢* +
Any
¢¢+ .
(
¢¢. /
)
¢¢/ 0
)
¢¢0 1
{
££ 
return
§§ 
null
§§ 
;
§§ 
}
•• 
	Condition
ßß 
result
ßß 
;
ßß 
foreach
©© 
(
©© 
var
©© 
nestedCondition
©© (
in
©©) +
conditionGroup
©©, :
.
©©: ;

Conditions
©©; E
)
©©E F
{
™™ 
result
¨¨ 
=
¨¨ 
FindCondition
¨¨ &
(
¨¨& '
nestedCondition
¨¨' 6
,
¨¨6 7
conditionId
¨¨8 C
)
¨¨C D
;
¨¨D E
if
ÆÆ 
(
ÆÆ 
result
ÆÆ 
!=
ÆÆ 
null
ÆÆ "
)
ÆÆ" #
{
ØØ 
return
∞∞ 
result
∞∞ !
;
∞∞! "
}
±± 
}
≤≤ 
return
¥¥ 
null
¥¥ 
;
¥¥ 
}
µµ 	
private
∑∑ 
ConditionGroup
∑∑  
FindConditionGroup
∑∑ 1
(
∑∑1 2
ConditionGroup
∑∑2 @
	condition
∑∑A J
,
∑∑J K
string
∑∑L R
groupconditionId
∑∑S c
)
∑∑c d
{
∏∏ 	
if
ππ 
(
ππ 
String
ππ 
.
ππ 
Equals
ππ 
(
ππ 
	condition
ππ '
.
ππ' (
ConditionId
ππ( 3
,
ππ3 4
groupconditionId
ππ5 E
,
ππE F
StringComparison
ππG W
.
ππW X
OrdinalIgnoreCase
ππX i
)
ππi j
)
ππj k
{
∫∫ 
return
ªª 
	condition
ªª  
;
ªª  !
}
ºº 
if
ææ 
(
ææ 
!
ææ 
	condition
ææ 
.
ææ 

Conditions
ææ %
.
ææ% &
Any
ææ& )
(
ææ) *
)
ææ* +
)
ææ+ ,
{
øø 
return
¿¿ 
null
¿¿ 
;
¿¿ 
}
¡¡ 
ConditionGroup
√√ 
result
√√ !
;
√√! "
foreach
≈≈ 
(
≈≈ 
var
≈≈ 
nestedCondition
≈≈ (
in
≈≈) +
	condition
≈≈, 5
.
≈≈5 6

Conditions
≈≈6 @
.
≈≈@ A
OfType
≈≈A G
<
≈≈G H
ConditionGroup
≈≈H V
>
≈≈V W
(
≈≈W X
)
≈≈X Y
)
≈≈Y Z
{
∆∆ 
result
»» 
=
»»  
FindConditionGroup
»» +
(
»»+ ,
nestedCondition
»», ;
,
»»; <
groupconditionId
»»= M
)
»»M N
;
»»N O
if
   
(
   
result
   
!=
   
null
   "
)
  " #
{
ÀÀ 
return
ÃÃ 
result
ÃÃ !
;
ÃÃ! "
}
ÕÕ 
}
ŒŒ 
return
–– 
null
–– 
;
–– 
}
—— 	
private
”” 
ConditionGroup
”” !
FindConditionParent
”” 2
(
””2 3
ConditionGroup
””3 A
	condition
””B K
,
””K L
string
””M S
conditionId
””T _
)
””_ `
{
‘‘ 	
ConditionGroup
’’ 
result
’’ !
;
’’! "
foreach
◊◊ 
(
◊◊ 
var
◊◊ 
nestedCondition
◊◊ (
in
◊◊) +
	condition
◊◊, 5
.
◊◊5 6

Conditions
◊◊6 @
)
◊◊@ A
{
ÿÿ 
if
ŸŸ 
(
ŸŸ 
String
ŸŸ 
.
ŸŸ 
Equals
ŸŸ !
(
ŸŸ! "
nestedCondition
ŸŸ" 1
.
ŸŸ1 2
ConditionId
ŸŸ2 =
,
ŸŸ= >
conditionId
ŸŸ? J
,
ŸŸJ K
StringComparison
ŸŸL \
.
ŸŸ\ ]
OrdinalIgnoreCase
ŸŸ] n
)
ŸŸn o
)
ŸŸo p
{
⁄⁄ 
return
€€ 
	condition
€€ $
;
€€$ %
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ 
nestedCondition
ﬁﬁ #
is
ﬁﬁ$ &
ConditionGroup
ﬁﬁ' 5"
nestedConditionGroup
ﬁﬁ6 J
)
ﬁﬁJ K
{
ﬂﬂ 
result
‡‡ 
=
‡‡ !
FindConditionParent
‡‡ 0
(
‡‡0 1"
nestedConditionGroup
‡‡1 E
,
‡‡E F
conditionId
‡‡G R
)
‡‡R S
;
‡‡S T
if
·· 
(
·· 
result
·· 
!=
·· !
null
··" &
)
··& '
{
‚‚ 
return
„„ 
result
„„ %
;
„„% &
}
‰‰ 
}
ÂÂ 
}
ÊÊ 
return
ËË 
null
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
}ÎÎ è
öD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Deployment\AllLayersDeploymentSource.cs
	namespace

 	
OrchardCore


 
.

 
Layers

 
.

 

Deployment

 '
{ 
public 

class %
AllLayersDeploymentSource *
:+ ,
IDeploymentSource- >
{ 
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private 
readonly 
ISiteService %
_siteService& 2
;2 3
public %
AllLayersDeploymentSource (
(( )
ILayerService) 6
layerService7 C
,C D
ISiteServiceE Q
siteServiceR ]
)] ^
{ 	
_layerService 
= 
layerService (
;( )
_siteService 
= 
siteService &
;& '
} 	
public 
async 
Task &
ProcessDeploymentStepAsync 4
(4 5
DeploymentStep5 C
stepD H
,H I 
DeploymentPlanResultJ ^
result_ e
)e f
{ 	
var 
allLayersStep 
= 
step  $
as% '#
AllLayersDeploymentStep( ?
;? @
if 
( 
allLayersStep 
==  
null! %
)% &
{ 
return 
; 
} 
var   
layers   
=   
await   
_layerService   ,
.  , -
GetLayersAsync  - ;
(  ; <
)  < =
;  = >
result"" 
."" 
Steps"" 
."" 
Add"" 
("" 
new""  
JObject""! (
(""( )
new## 
	JProperty## 
(## 
$str## $
,##$ %
$str##& .
)##. /
,##/ 0
new$$ 
	JProperty$$ 
($$ 
$str$$ &
,$$& '
layers$$( .
.$$. /
Layers$$/ 5
.$$5 6
Select$$6 <
($$< =
JObject$$= D
.$$D E

FromObject$$E O
)$$O P
)$$P Q
)%% 
)%% 
;%% 
var'' 
siteSettings'' 
='' 
await'' $
_siteService''% 1
.''1 2 
GetSiteSettingsAsync''2 F
(''F G
)''G H
;''H I
result** 
.** 
Steps** 
.** 
Add** 
(** 
new**  
JObject**! (
(**( )
new++ 
	JProperty++ 
(++ 
$str++ $
,++$ %
$str++& 0
)++0 1
,++1 2
new,, 
	JProperty,, 
(,, 
$str,, -
,,,- .
JObject,,/ 6
.,,6 7

FromObject,,7 A
(,,A B
siteSettings,,B N
.,,N O
As,,O Q
<,,Q R
LayerSettings,,R _
>,,_ `
(,,` a
),,a b
),,b c
),,c d
)-- 
)-- 
;-- 
}.. 	
}// 
}00 ˘
òD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Deployment\AllLayersDeploymentStep.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

Deployment '
{ 
public 

class #
AllLayersDeploymentStep (
:) *
DeploymentStep+ 9
{		 
public

 #
AllLayersDeploymentStep

 &
(

& '
)

' (
{ 	
Name 
= 
$str 
; 
} 	
} 
} ∆
ûD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Deployment\AllLayersDeploymentStepDriver.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

Deployment '
{ 
public 

class )
AllLayersDeploymentStepDriver .
:/ 0
DisplayDriver1 >
<> ?
DeploymentStep? M
,M N#
AllLayersDeploymentStepO f
>f g
{ 
public		 
override		 
IDisplayResult		 &
Display		' .
(		. /#
AllLayersDeploymentStep		/ F
step		G K
)		K L
{

 	
return 
Combine 
( 
View 
( 
$str :
,: ;
step< @
)@ A
.A B
LocationB J
(J K
$strK T
,T U
$strV _
)_ `
,` a
View 
( 
$str <
,< =
step> B
)B C
.C D
LocationD L
(L M
$strM X
,X Y
$strZ c
)c d
) 
; 
} 	
public 
override 
IDisplayResult &
Edit' +
(+ ,#
AllLayersDeploymentStep, C
stepD H
)H I
{ 	
return 
View 
( 
$str 6
,6 7
step8 <
)< =
.= >
Location> F
(F G
$strG P
)P Q
;Q R
} 	
} 
} î8
ëD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Drivers\LayerMetadataWelder.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Drivers $
{ 
public 

class 
LayerMetadataWelder $
:% & 
ContentDisplayDriver' ;
{ 
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public 
LayerMetadataWelder "
(" #
ILayerService# 0
layerService1 =
,= >
IStringLocalizer? O
<O P
LayerMetadataWelderP c
>c d
stringLocalizere t
)t u
{ 	
_layerService 
= 
layerService (
;( )
S 
= 
stringLocalizer 
;  
} 	
	protected 
override 
void 
BuildPrefix  +
(+ ,
ContentItem, 7
model8 =
,= >
string? E
htmlFieldPrefixF U
)U V
{ 	
base 
. 
BuildPrefix 
( 
model "
," #
htmlFieldPrefix$ 3
)3 4
;4 5
if 
( 
string 
. 
IsNullOrWhiteSpace )
() *
htmlFieldPrefix* 9
)9 :
): ;
{ 
Prefix 
= 
$str (
;( )
}   
}!! 	
public## 
override## 
async## 
Task## "
<##" #
IDisplayResult### 1
>##1 2
	EditAsync##3 <
(##< =
ContentItem##= H
model##I N
,##N O
BuildEditorContext##P b
context##c j
)##j k
{$$ 	
var%% 
layerMetadata%% 
=%% 
model%%  %
.%%% &
As%%& (
<%%( )
LayerMetadata%%) 6
>%%6 7
(%%7 8
)%%8 9
;%%9 :
if'' 
('' 
layerMetadata'' 
==''  
null''! %
)''% &
{(( 
layerMetadata)) 
=)) 
new))  #
LayerMetadata))$ 1
())1 2
)))2 3
;))3 4
if,, 
(,, 
await,, 
context,, !
.,,! "
Updater,," )
.,,) *
TryUpdateModelAsync,,* =
(,,= >
layerMetadata,,> K
,,,K L
Prefix,,M S
,,,S T
m,,U V
=>,,W Y
m,,Z [
.,,[ \
Zone,,\ `
,,,` a
m,,b c
=>,,d f
m,,g h
.,,h i
Position,,i q
),,q r
&&-- 
!-- 
String-- 
.-- 
IsNullOrEmpty-- ,
(--, -
layerMetadata--- :
.--: ;
Zone--; ?
)--? @
)--@ A
{.. 
model// 
.// 
Weld// 
(// 
layerMetadata// ,
)//, -
;//- .
}00 
else11 
{22 
return33 
null33 
;33  
}44 
}55 
return77 

Initialize77 
<77 &
LayerMetadataEditViewModel77 8
>778 9
(779 :
$str77: N
,77N O
async77P U
shape77V [
=>77\ ^
{88 
shape99 
.99 
Title99 
=99 
model99 #
.99# $
DisplayText99$ /
;99/ 0
shape:: 
.:: 
LayerMetadata:: #
=::$ %
layerMetadata::& 3
;::3 4
shape;; 
.;; 
Layers;; 
=;; 
(;;  
await;;  %
_layerService;;& 3
.;;3 4
GetLayersAsync;;4 B
(;;B C
);;C D
);;D E
.;;E F
Layers;;F L
;;;L M
}<< 
)<< 
.== 
Location== 
(== 
$str== &
)==& '
;==' (
}>> 	
public@@ 
override@@ 
async@@ 
Task@@ "
<@@" #
IDisplayResult@@# 1
>@@1 2
UpdateAsync@@3 >
(@@> ?
ContentItem@@? J
model@@K P
,@@P Q
UpdateEditorContext@@R e
context@@f m
)@@m n
{AA 	
varBB 
	viewModelBB 
=BB 
newBB &
LayerMetadataEditViewModelBB  :
(BB: ;
)BB; <
;BB< =
awaitDD 
contextDD 
.DD 
UpdaterDD !
.DD! "
TryUpdateModelAsyncDD" 5
(DD5 6
	viewModelDD6 ?
,DD? @
PrefixDDA G
)DDG H
;DDH I
ifFF 
(FF 
	viewModelFF 
.FF 
LayerMetadataFF '
==FF( *
nullFF+ /
)FF/ 0
{GG 
returnHH 
nullHH 
;HH 
}II 
ifKK 
(KK 
StringKK 
.KK 
IsNullOrEmptyKK $
(KK$ %
	viewModelKK% .
.KK. /
LayerMetadataKK/ <
.KK< =
ZoneKK= A
)KKA B
)KKB C
{LL 
contextMM 
.MM 
UpdaterMM 
.MM  

ModelStateMM  *
.MM* +
AddModelErrorMM+ 8
(MM8 9
PrefixMM9 ?
,MM? @
$strMMA U
,MMU V
SMMW X
[MMX Y
$strMMY j
]MMj k
)MMk l
;MMl m
}NN 
ifPP 
(PP 
StringPP 
.PP 
IsNullOrEmptyPP $
(PP$ %
	viewModelPP% .
.PP. /
LayerMetadataPP/ <
.PP< =
LayerPP= B
)PPB C
)PPC D
{QQ 
contextRR 
.RR 
UpdaterRR 
.RR  

ModelStateRR  *
.RR* +
AddModelErrorRR+ 8
(RR8 9
PrefixRR9 ?
,RR? @
$strRRA V
,RRV W
SRRX Y
[RRY Z
$strRRZ l
]RRl m
)RRm n
;RRn o
}SS 
ifUU 
(UU 
contextUU 
.UU 
UpdaterUU 
.UU  

ModelStateUU  *
.UU* +
IsValidUU+ 2
)UU2 3
{VV 
modelWW 
.WW 
ApplyWW 
(WW 
	viewModelWW %
.WW% &
LayerMetadataWW& 3
)WW3 4
;WW4 5
}XX 
modelZZ 
.ZZ 
DisplayTextZZ 
=ZZ 
	viewModelZZ  )
.ZZ) *
TitleZZ* /
;ZZ/ 0
return\\ 
await\\ 
	EditAsync\\ "
(\\" #
model\\# (
,\\( )
context\\* 1
)\\1 2
;\\2 3
}]] 	
}^^ 
}__ ˘'
úD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Drivers\LayerSiteSettingsDisplayDriver.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Drivers $
{ 
public 

class *
LayerSiteSettingsDisplayDriver /
:0 1 
SectionDisplayDriver2 F
<F G
ISiteG L
,L M
LayerSettingsN [
>[ \
{ 
public 
const 
string 
GroupId #
=$ %
$str& -
;- .
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
public *
LayerSiteSettingsDisplayDriver -
(- . 
IHttpContextAccessor  
httpContextAccessor! 4
,4 5!
IAuthorizationService ! 
authorizationService" 6
)6 7
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_authorizationService !
=" # 
authorizationService$ 8
;8 9
} 	
public 
override 
async 
Task "
<" #
IDisplayResult# 1
>1 2
	EditAsync3 <
(< =
LayerSettings= J
settingsK S
,S T
BuildEditorContextU g
contexth o
)o p
{ 	
var 
user 
=  
_httpContextAccessor +
.+ ,
HttpContext, 7
?7 8
.8 9
User9 =
;= >
if   
(   
!   
await   !
_authorizationService   ,
.  , -
AuthorizeAsync  - ;
(  ; <
user  < @
,  @ A
Permissions  B M
.  M N
ManageLayers  N Z
)  Z [
)  [ \
{!! 
return"" 
null"" 
;"" 
}## 
return%% 

Initialize%% 
<%% "
LayerSettingsViewModel%% 4
>%%4 5
(%%5 6
$str%%6 J
,%%J K
model%%L Q
=>%%R T
{&& 
model'' 
.'' 
Zones'' 
=''  !
String''" (
.''( )
Join'') -
(''- .
$str''. 2
,''2 3
settings''4 <
.''< =
Zones''= B
)''B C
;''C D
}(( 
)(( 
.(( 
Location(( 
((( 
$str(( '
)((' (
.((( )
OnGroup(() 0
(((0 1
GroupId((1 8
)((8 9
;((9 :
})) 	
public++ 
override++ 
async++ 
Task++ "
<++" #
IDisplayResult++# 1
>++1 2
UpdateAsync++3 >
(++> ?
LayerSettings++? L
settings++M U
,++U V
BuildEditorContext++W i
context++j q
)++q r
{,, 	
var-- 
user-- 
=--  
_httpContextAccessor-- +
.--+ ,
HttpContext--, 7
?--7 8
.--8 9
User--9 =
;--= >
if// 
(// 
!// 
await// !
_authorizationService// ,
.//, -
AuthorizeAsync//- ;
(//; <
user//< @
,//@ A
Permissions//B M
.//M N
ManageLayers//N Z
)//Z [
)//[ \
{00 
return11 
null11 
;11 
}22 
if44 
(44 
context44 
.44 
GroupId44 
==44  "
GroupId44# *
)44* +
{55 
var66 
model66 
=66 
new66 "
LayerSettingsViewModel66  6
(666 7
)667 8
;668 9
await88 
context88 
.88 
Updater88 %
.88% &
TryUpdateModelAsync88& 9
(889 :
model88: ?
,88? @
Prefix88A G
)88G H
;88H I
settings:: 
.:: 
Zones:: 
=::  
(::! "
model::" '
.::' (
Zones::( -
??::. 0
String::1 7
.::7 8
Empty::8 =
)::= >
.::> ?
Split::? D
(::D E
new::E H
[::H I
]::I J
{::K L
$char::M P
,::P Q
$char::R U
}::V W
,::W X
StringSplitOptions::Y k
.::k l
RemoveEmptyEntries::l ~
)::~ 
;	:: Ä
};; 
return== 
await== 
	EditAsync== "
(==" #
settings==# +
,==+ ,
context==- 4
)==4 5
;==5 6
}>> 	
}?? 
}@@ ›0
íD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\GraphQL\LayerQueryObjectType.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
GraphQL $
{ 
public 

class  
LayerQueryObjectType %
:& '
ObjectGraphType( 7
<7 8
Layer8 =
>= >
{ 
public  
LayerQueryObjectType #
(# $
)$ %
{ 	
Name 
= 
$str 
; 
Field 
( 
layer 
=> 
layer  
.  !
Name! %
)% &
.& '
Description' 2
(2 3
$str3 K
)K L
;L M
Field 
( 
layer 
=> 
layer  
.  !
Rule! %
)% &
.& '
Description' 2
(2 3
$str3 c
)c d
;d e
Field 
< 
ListGraphType 
<  
StringGraphType  /
>/ 0
,0 1
IEnumerable2 =
<= >
	Condition> G
>G H
>H I
(I J
)J K
. 
Name 
( 
$str !
)! "
. 
Description 
( 
$str A
)A B
. 
Resolve 
( 
ctx 
=> 
ctx  #
.# $
Source$ *
.* +
	LayerRule+ 4
.4 5

Conditions5 ?
)? @
;@ A
Field 
( 
layer 
=> 
layer  
.  !
Description! ,
), -
.- .
Description. 9
(9 :
$str: Y
)Y Z
;Z [
Field   
<   
ListGraphType   
<    &
LayerWidgetQueryObjectType    :
>  : ;
,  ; <
IEnumerable  = H
<  H I
ContentItem  I T
>  T U
>  U V
(  V W
)  W X
.!! 
Name!! 
(!! 
$str!! 
)!!  
."" 
Description"" 
("" 
$str"" :
)"": ;
.## 
Argument## 
<## &
PublicationStatusGraphType## 4
,##4 5!
PublicationStatusEnum##6 K
>##K L
(##L M
$str##M U
,##U V
$str##W z
)##z {
.$$ 
ResolveLockedAsync$$ #
($$# $
async$$$ )
ctx$$* -
=>$$. 0
{%% 
var&& 
context&& 
=&&  !
(&&" #
GraphQLContext&&# 1
)&&1 2
ctx&&2 5
.&&5 6
UserContext&&6 A
;&&A B
var'' 
layerService'' $
=''% &
context''' .
.''. /
ServiceProvider''/ >
.''> ?

GetService''? I
<''I J
ILayerService''J W
>''W X
(''X Y
)''Y Z
;''Z [
var)) 
filter)) 
=))  
GetVersionFilter))! 1
())1 2
ctx))2 5
.))5 6
GetArgument))6 A
<))A B!
PublicationStatusEnum))B W
>))W X
())X Y
$str))Y a
)))a b
)))b c
;))c d
var** 
widgets** 
=**  !
await**" '
layerService**( 4
.**4 5 
GetLayerWidgetsAsync**5 I
(**I J
filter**J P
)**P Q
;**Q R
var,, 
layerWidgets,, $
=,,% &
widgets,,' .
?,,. /
.,,/ 0
Where,,0 5
(,,5 6
item,,6 :
=>,,; =
{-- 
var.. 
metadata.. $
=..% &
item..' +
...+ ,
As.., .
<... /
LayerMetadata../ <
>..< =
(..= >
)..> ?
;..? @
if// 
(// 
metadata// $
==//% '
null//( ,
)//, -
return//. 4
false//5 :
;//: ;
return00 
metadata00 '
.00' (
Layer00( -
==00. 0
ctx001 4
.004 5
Source005 ;
.00; <
Name00< @
;00@ A
}11 
)11 
;11 
return33 
layerWidgets33 '
;33' (
}44 
)44 
;44 
}55 	
private77 

Expression77 
<77 
Func77 
<77  
ContentItemIndex77  0
,770 1
bool772 6
>776 7
>777 8
GetVersionFilter779 I
(77I J!
PublicationStatusEnum77J _
status77` f
)77f g
{88 	
switch99 
(99 
status99 
)99 
{:: 
case;; !
PublicationStatusEnum;; *
.;;* +
	Published;;+ 4
:;;4 5
return;;6 <
x;;= >
=>;;? A
x;;B C
.;;C D
	Published;;D M
;;;M N
case<< !
PublicationStatusEnum<< *
.<<* +
Draft<<+ 0
:<<0 1
return<<2 8
x<<9 :
=><<; =
x<<> ?
.<<? @
Latest<<@ F
&&<<G I
!<<J K
x<<K L
.<<L M
	Published<<M V
;<<V W
case== !
PublicationStatusEnum== *
.==* +
Latest==+ 1
:==1 2
return==3 9
x==: ;
=>==< >
x==? @
.==@ A
Latest==A G
;==G H
case>> !
PublicationStatusEnum>> *
.>>* +
All>>+ .
:>>. /
return>>0 6
x>>7 8
=>>>9 ;
true>>< @
;>>@ A
default?? 
:?? 
return?? 
x??  !
=>??" $
x??% &
.??& '
	Published??' 0
;??0 1
}@@ 
}AA 	
}BB 
}CC ∞
òD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\GraphQL\LayerWidgetQueryObjectType.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
GraphQL $
{ 
public 

class &
LayerWidgetQueryObjectType +
:, -
ObjectGraphType. =
<= >
ContentItem> I
>I J
{		 
public

 &
LayerWidgetQueryObjectType

 )
(

) *
)

* +
{ 	
Name 
= 
$str  
;  !
Field 
< 
StringGraphType !
>! "
(" #
$str 
, 
$str 0
,0 1
resolve 
: 
context  
=>! #
context$ +
.+ ,
Source, 2
.2 3
As3 5
<5 6
LayerMetadata6 C
>C D
(D E
)E F
?F G
.G H
ZoneH L
)L M
;M N
Field 
< 
DecimalGraphType "
>" #
(# $
$str 
, 
$str 9
,9 :
resolve 
: 
context  
=>! #
context$ +
.+ ,
Source, 2
.2 3
As3 5
<5 6
LayerMetadata6 C
>C D
(D E
)E F
?F G
.G H
PositionH P
)P Q
;Q R
Field 
< 
BooleanGraphType "
>" #
(# $
$str 
, 
$str 7
,7 8
resolve 
: 
context  
=>! #
context$ +
.+ ,
Source, 2
.2 3
As3 5
<5 6
LayerMetadata6 C
>C D
(D E
)E F
?F G
.G H
RenderTitleH S
)S T
;T U
Field 
<  
ContentItemInterface &
>& '
(' (
$str 
, 
$str )
,) *
resolve   
:   
context    
=>  ! #
context  $ +
.  + ,
Source  , 2
)  2 3
;  3 4
}!! 	
}"" 
}## é
çD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\GraphQL\SiteLayersQuery.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
GraphQL $
{ 
public 

class 
SiteLayersQuery  
:! "
ISchemaBuilder# 1
{ 
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public 
SiteLayersQuery 
( 
IStringLocalizer /
</ 0
SiteLayersQuery0 ?
>? @
	localizerA J
)J K
{ 	
S 
= 
	localizer 
; 
} 	
public 
Task 
< 
string 
> 
GetIdentifierAsync .
(. /
)/ 0
=>1 3
Task4 8
.8 9

FromResult9 C
(C D
StringD J
.J K
EmptyK P
)P Q
;Q R
public 
Task 

BuildAsync 
( 
ISchema &
schema' -
)- .
{ 	
var 
field 
= 
new 
	FieldType %
{ 
Name 
= 
$str #
,# $
Description 
= 
S 
[  
$str  ^
]^ _
,_ `
Type 
= 
typeof 
( 
ListGraphType +
<+ , 
LayerQueryObjectType, @
>@ A
)A B
,B C
Resolver   
=   
new   $
LockedAsyncFieldResolver   7
<  7 8
IEnumerable  8 C
<  C D
Layer  D I
>  I J
>  J K
(  K L
ResolveAsync  L X
)  X Y
}!! 
;!! 
schema## 
.## 
Query## 
.## 
AddField## !
(##! "
field##" '
)##' (
;##( )
return%% 
Task%% 
.%% 
CompletedTask%% %
;%%% &
}&& 	
private(( 
async(( 
Task(( 
<(( 
IEnumerable(( &
<((& '
Layer((' ,
>((, -
>((- .
ResolveAsync((/ ;
(((; <
ResolveFieldContext((< O
resolveContext((P ^
)((^ _
{)) 	
var** 
layerService** 
=** 
resolveContext** -
.**- ."
ResolveServiceProvider**. D
(**D E
)**E F
.**F G

GetService**G Q
<**Q R
ILayerService**R _
>**_ `
(**` a
)**a b
;**b c
var++ 
	allLayers++ 
=++ 
await++ !
layerService++" .
.++. /
GetLayersAsync++/ =
(++= >
)++> ?
;++? @
return,, 
	allLayers,, 
.,, 
Layers,, #
;,,# $
}-- 	
}.. 
}// Å

ÖD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\GraphQL\Startup.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
GraphQL $
{ 
[ 
RequireFeatures 
( 
$str /
)/ 0
]0 1
public 

class 
Startup 
: 
StartupBase &
{		 
public

 
override

 
void

 
ConfigureServices

 .
(

. /
IServiceCollection

/ A
services

B J
)

J K
{ 	
services 
. 
AddSingleton !
<! "
ISchemaBuilder" 0
,0 1
SiteLayersQuery2 A
>A B
(B C
)C D
;D E
services 
. 
AddTransient !
<! " 
LayerQueryObjectType" 6
>6 7
(7 8
)8 9
;9 :
services 
. 
AddTransient !
<! "&
LayerWidgetQueryObjectType" <
>< =
(= >
)> ?
;? @
} 	
} 
} ø
ìD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Handlers\LayerMetadataHandler.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Handlers %
{		 
public

 

class

  
LayerMetadataHandler

 %
:

& '
ContentHandlerBase

( :
{ 
private 
readonly $
IVolatileDocumentManager 1
<1 2

LayerState2 <
>< =
_layerStateManager> P
;P Q
public  
LayerMetadataHandler #
(# $$
IVolatileDocumentManager$ <
<< =

LayerState= G
>G H
layerStateManagerI Z
)Z [
{ 	
_layerStateManager 
=  
layerStateManager! 2
;2 3
} 	
public 
override 
Task 
PublishedAsync +
(+ ,!
PublishContentContext, A
contextB I
)I J
=>K M
UpdateAsyncN Y
(Y Z
contextZ a
.a b
ContentItemb m
)m n
;n o
public 
override 
Task 
RemovedAsync )
() * 
RemoveContentContext* >
context? F
)F G
=>H J
UpdateAsyncK V
(V W
contextW ^
.^ _
ContentItem_ j
)j k
;k l
public 
override 
Task 
UnpublishedAsync -
(- .!
PublishContentContext. C
contextD K
)K L
=>M O
UpdateAsyncP [
([ \
context\ c
.c d
ContentItemd o
)o p
;p q
private 
Task 
UpdateAsync  
(  !
ContentItem! ,
contentItem- 8
)8 9
{ 	
var 
layerMetadata 
= 
contentItem  +
.+ ,
As, .
<. /
LayerMetadata/ <
>< =
(= >
)> ?
;? @
if 
( 
layerMetadata 
==  
null! %
)% &
{ 
return 
Task 
. 
CompletedTask )
;) *
}   
return## 
_layerStateManager## %
.##% &
UpdateAsync##& 1
(##1 2
new##2 5

LayerState##6 @
(##@ A
)##A B
)##B C
;##C D
}$$ 	
}%% 
public'' 

class'' 

LayerState'' 
:'' 
Document'' &
{(( 
})) 
}** õ
êD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Indexes\LayerMetadataIndex.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Indexes $
{ 
public 

class 
LayerMetadataIndex #
:$ %
MapIndex& .
{ 
public		 
string		 
Zone		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
}

 
public 

class &
LayerMetadataIndexProvider +
:, -
IndexProvider. ;
<; <
ContentItem< G
>G H
{ 
public 
override 
void 
Describe %
(% &
DescribeContext& 5
<5 6
ContentItem6 A
>A B
contextC J
)J K
{ 	
context 
. 
For 
< 
LayerMetadataIndex *
>* +
(+ ,
), -
. 
When 
( 
contentItem !
=>" $
contentItem% 0
.0 1
Has1 4
<4 5
LayerMetadata5 B
>B C
(C D
)D E
)E F
. 
Map 
( 
contentItem  
=>! #
{ 
var 
layerMetadata %
=& '
contentItem( 3
.3 4
As4 6
<6 7
LayerMetadata7 D
>D E
(E F
)F G
;G H
if 
( 
layerMetadata %
==& (
null) -
)- .
{ 
return 
null #
;# $
} 
return 
new 
LayerMetadataIndex 1
{ 
Zone 
= 
layerMetadata ,
., -
Zone- 1
,1 2
} 
; 
} 
) 
; 
} 	
}   
}!! 	
~D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Manifest.cs
[ 
assembly 	
:	 

Module 
( 
Name 
=	 

$str 
, 
Author 

= 
ManifestConstants 
. 
OrchardCoreTeam .
,. /
Website 
= 
ManifestConstants 
.  
OrchardCoreWebsite  2
,2 3
Version 
= 
ManifestConstants 
.  
OrchardCoreVersion  2
) 
] 
[

 
assembly

 	
:

	 

Feature

 
(

 
Id 
= 
$str	 
, 
Name 
=	 

$str 
, 
Description 
= 
$str a
,a b
Dependencies 
= 
new 
[ 
] 
{ 
$str 
, 
$str 
,  
$str 
} 
, 
Category 
= 
$str 
) 
] Õ+
ÄD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Migrations.cs
	namespace 	
OrchardCore
 
. 
Layers 
{ 
public 

class 

Migrations 
: 
DataMigration +
{ 
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private 
readonly !
IConditionIdGenerator .!
_conditionIdGenerator/ D
;D E
private 
readonly 
IRuleMigrator &
_ruleMigrator' 4
;4 5
private 
readonly !
IShellFeaturesManager .!
_shellFeaturesManager/ D
;D E
private 
readonly  
ITypeFeatureProvider - 
_typeFeatureProvider. B
;B C
public 

Migrations 
( 
ILayerService 
layerService &
,& '!
IConditionIdGenerator ! 
conditionIdGenerator" 6
,6 7
IRuleMigrator 
ruleMigrator &
,& '!
IShellFeaturesManager ! 
shellFeaturesManager" 6
,6 7 
ITypeFeatureProvider  
typeFeatureProvider! 4
)4 5
{ 	
_layerService 
= 
layerService (
;( )!
_conditionIdGenerator !
=" # 
conditionIdGenerator$ 8
;8 9
_ruleMigrator 
= 
ruleMigrator (
;( )!
_shellFeaturesManager !
=" # 
shellFeaturesManager$ 8
;8 9 
_typeFeatureProvider    
=  ! "
typeFeatureProvider  # 6
;  6 7
}!! 	
public## 
int## 
Create## 
(## 
)## 
{$$ 	
SchemaBuilder%% 
.%% 
CreateMapIndexTable%% -
<%%- .
LayerMetadataIndex%%. @
>%%@ A
(%%A B
table%%B G
=>%%H J
table%%K P
.&& 
Column&& 
<&& 
string&& 
>&& 
(&& 
$str&& %
,&&% &
c&&' (
=>&&) +
c&&, -
.&&- .

WithLength&&. 8
(&&8 9
$num&&9 ;
)&&; <
)&&< =
)'' 
;'' 
SchemaBuilder)) 
.)) 
AlterIndexTable)) )
<))) *
LayerMetadataIndex))* <
>))< =
())= >
table))> C
=>))D F
table))G L
.** 
CreateIndex** 
(** 
$str** @
,**@ A
$str**B N
,**N O
$str**P V
)**V W
)++ 
;++ 
return.. 
$num.. 
;.. 
}// 	
public22 
int22 
UpdateFrom122 
(22 
)22  
{33 	
SchemaBuilder44 
.44 
AlterIndexTable44 )
<44) *
LayerMetadataIndex44* <
>44< =
(44= >
table44> C
=>44D F
table44G L
.55 
CreateIndex55 
(55 
$str55 @
,55@ A
$str55B N
,55N O
$str55P V
)55V W
)66 
;66 
return88 
$num88 
;88 
}99 	
public;; 
async;; 
Task;; 
<;; 
int;; 
>;; 
UpdateFrom2Async;; /
(;;/ 0
);;0 1
{<< 	
var== 
layers== 
=== 
await== 
_layerService== ,
.==, -
LoadLayersAsync==- <
(==< =
)=== >
;==> ?
foreach>> 
(>> 
var>> 
layer>> 
in>> !
layers>>" (
.>>( )
Layers>>) /
)>>/ 0
{?? 
layer@@ 
.@@ 
	LayerRule@@ 
=@@  !
new@@" %
Rule@@& *
(@@* +
)@@+ ,
;@@, -!
_conditionIdGeneratorAA %
.AA% &
GenerateUniqueIdAA& 6
(AA6 7
layerAA7 <
.AA< =
	LayerRuleAA= F
)AAF G
;AAG H
_ruleMigratorDD 
.DD 
MigrateDD %
(DD% &
layerDD& +
.DD+ ,
RuleDD, 0
,DD0 1
layerDD2 7
.DD7 8
	LayerRuleDD8 A
)DDA B
;DDB C
layerFF 
.FF 
RuleFF 
=FF 
StringFF #
.FF# $
EmptyFF$ )
;FF) *
}HH 
awaitJJ 
_layerServiceJJ 
.JJ  
UpdateAsyncJJ  +
(JJ+ ,
layersJJ, 2
)JJ2 3
;JJ3 4
varLL 
layerFeatureLL 
=LL  
_typeFeatureProviderLL 3
.LL3 4#
GetFeatureForDependencyLL4 K
(LLK L
GetTypeLLL S
(LLS T
)LLT U
)LLU V
;LLV W
awaitNN !
_shellFeaturesManagerNN '
.NN' (
EnableFeaturesAsyncNN( ;
(NN; <
newNN< ?
[NN? @
]NN@ A
{NNB C
layerFeatureNND P
}NNQ R
,NNR S
forceNNT Y
:NNY Z
trueNN[ _
)NN_ `
;NN` a
returnPP 
$numPP 
;PP 
}QQ 	
}RR 
}SS π
ÇD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Models\Layer.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Models #
{ 
public 

class 
Layer 
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Obsolete	 
( 
$str W
)W X
]X Y
public 
string 
Rule 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
Rule 
	LayerRule 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ç
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Models\LayerMetadata.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Models #
{ 
public 

class 
LayerMetadata 
:  
ContentPart! ,
{ 
public 
bool 
RenderTitle 
{  !
get" %
;% &
set' *
;* +
}, -
public 
double 
Position 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Zone		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public

 
string

 
Layer

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} 
} ˚
ãD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Models\LayersDocument.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Models #
{ 
public 

class 
LayersDocument 
:  !
Document" *
{ 
public 
List 
< 
Layer 
> 
Layers !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
new2 5
List6 :
<: ;
Layer; @
>@ A
(A B
)B C
;C D
}		 
}

 ’
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Models\LayerSettings.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Models #
{ 
public 

class 
LayerSettings 
{ 
public 
string 
[ 
] 
Zones 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
Array. 3
.3 4
Empty4 9
<9 :
string: @
>@ A
(A B
)B C
;C D
} 
}		 ˚
ÅD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Permissions.cs
	namespace 	
OrchardCore
 
. 
Layers 
{ 
public 

class 
Permissions 
: 
IPermissionProvider 2
{		 
public

 
static

 
readonly

 

Permission

 )
ManageLayers

* 6
=

7 8
new

9 <

Permission

= G
(

G H
$str

H V
,

V W
$str

X g
)

g h
;

h i
public 
Task 
< 
IEnumerable 
<  

Permission  *
>* +
>+ ,
GetPermissionsAsync- @
(@ A
)A B
{ 	
return 
Task 
. 

FromResult "
(" #
new# &
[& '
]' (
{) *
ManageLayers+ 7
}8 9
.9 :
AsEnumerable: F
(F G
)G H
)H I
;I J
} 	
public 
IEnumerable 
<  
PermissionStereotype /
>/ 0!
GetDefaultStereotypes1 F
(F G
)G H
{ 	
return 
new 
[ 
] 
{ 
new  
PermissionStereotype (
{ 
Name 
= 
$str *
,* +
Permissions 
=  !
new" %
[% &
]& '
{( )
ManageLayers* 6
}7 8
} 
} 
; 
} 	
} 
} çN
áD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Recipes\LayerStep.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Recipes $
{ 
public 

class 
	LayerStep 
: 
IRecipeStepHandler /
{ 
private 
readonly 
ILayerService &
_layerService' 4
;4 5
private 
readonly 
IRuleMigrator &
_ruleMigrator' 4
;4 5
private 
readonly !
IConditionIdGenerator .!
_conditionIdGenerator/ D
;D E
private 
readonly 
IEnumerable $
<$ %
IConditionFactory% 6
>6 7

_factories8 B
;B C
public 
	LayerStep 
( 
ILayerService 
layerService &
,& '
IRuleMigrator 
ruleMigrator &
,& '!
IConditionIdGenerator ! 
conditionIdGenerator" 6
,6 7
IEnumerable 
< 
IConditionFactory )
>) *
	factories+ 4
)4 5
{ 	
_layerService 
= 
layerService (
;( )
_ruleMigrator 
= 
ruleMigrator (
;( )!
_conditionIdGenerator   !
=  " # 
conditionIdGenerator  $ 8
;  8 9

_factories!! 
=!! 
	factories!! "
;!!" #
}"" 	
public$$ 
async$$ 
Task$$ 
ExecuteAsync$$ &
($$& '"
RecipeExecutionContext$$' =
context$$> E
)$$E F
{%% 	
if&& 
(&& 
!&& 
String&& 
.&& 
Equals&& 
(&& 
context&& &
.&&& '
Name&&' +
,&&+ ,
$str&&- 5
,&&5 6
StringComparison&&7 G
.&&G H
OrdinalIgnoreCase&&H Y
)&&Y Z
)&&Z [
{'' 
return(( 
;(( 
})) 
var++ 
model++ 
=++ 
context++ 
.++  
Step++  $
.++$ %
ToObject++% -
<++- .
LayerStepModel++. <
>++< =
(++= >
)++> ?
;++? @
var-- 
	allLayers-- 
=-- 
await-- !
_layerService--" /
.--/ 0
LoadLayersAsync--0 ?
(--? @
)--@ A
;--A B
var// 
unknownTypes// 
=// 
new// "
List//# '
<//' (
string//( .
>//. /
(/// 0
)//0 1
;//1 2
var00 
	factories00 
=00 

_factories00 &
.00& '
ToDictionary00' 3
(003 4
x004 5
=>006 8
x009 :
.00: ;
Name00; ?
)00? @
;00@ A
foreach22 
(22 
var22 
	layerStep22 "
in22# %
model22& +
.22+ ,
Layers22, 2
)222 3
{33 
var44 
layer44 
=44 
	allLayers44 %
.44% &
Layers44& ,
.44, -
FirstOrDefault44- ;
(44; <
x44< =
=>44> @
String44A G
.44G H
Equals44H N
(44N O
x44O P
.44P Q
Name44Q U
,44U V
	layerStep44W `
.44` a
Name44a e
,44e f
StringComparison44g w
.44w x
OrdinalIgnoreCase	44x â
)
44â ä
)
44ä ã
;
44ã å
if66 
(66 
layer66 
==66 
null66 !
)66! "
{77 
layer88 
=88 
new88 
Layer88  %
(88% &
)88& '
;88' (
	allLayers99 
.99 
Layers99 $
.99$ %
Add99% (
(99( )
layer99) .
)99. /
;99/ 0
}:: 
if== 
(== 
layer== 
.== 
	LayerRule== #
====$ &
null==' +
)==+ ,
{>> 
layer?? 
.?? 
	LayerRule?? #
=??$ %
new??& )
Rule??* .
(??. /
)??/ 0
;??0 1!
_conditionIdGenerator@@ )
.@@) *
GenerateUniqueId@@* :
(@@: ;
layer@@; @
.@@@ A
	LayerRule@@A J
)@@J K
;@@K L
}AA 
ifDD 
(DD 
!DD 
StringDD 
.DD 
IsNullOrEmptyDD )
(DD) *
	layerStepDD* 3
.DD3 4
NameDD4 8
)DD8 9
)DD9 :
{EE 
layerFF 
.FF 
NameFF 
=FF  
	layerStepFF! *
.FF* +
NameFF+ /
;FF/ 0
}GG 
elseHH 
{II 
throwJJ 
newJJ !
ArgumentNullExceptionJJ 3
(JJ3 4
$"JJ4 6
{JJ6 7
nameofJJ7 =
(JJ= >
layerJJ> C
.JJC D
NameJJD H
)JJH I
}JJI J
 is requiredJJJ V
"JJV W
)JJW X
;JJX Y
}KK 
ifMM 
(MM 
	layerStepMM 
.MM 
	LayerRuleMM '
!=MM( *
nullMM+ /
)MM/ 0
{NN 
ifOO 
(OO 
!OO 
StringOO 
.OO  
IsNullOrEmptyOO  -
(OO- .
	layerStepOO. 7
.OO7 8
	LayerRuleOO8 A
.OOA B
ConditionIdOOB M
)OOM N
)OON O
{PP 
layerQQ 
.QQ 
	LayerRuleQQ '
.QQ' (
ConditionIdQQ( 3
=QQ4 5
	layerStepQQ6 ?
.QQ? @
	LayerRuleQQ@ I
.QQI J
ConditionIdQQJ U
;QQU V
}RR 
layerUU 
.UU 
	LayerRuleUU #
.UU# $

ConditionsUU$ .
.UU. /
ClearUU/ 4
(UU4 5
)UU5 6
;UU6 7
foreachVV 
(VV 
varVV  
	conditionVV! *
inVV+ -
	layerStepVV. 7
.VV7 8
	LayerRuleVV8 A
.VVA B

ConditionsVVB L
)VVL M
{WW 
ifXX 
(XX 
	factoriesXX %
.XX% &
TryGetValueXX& 1
(XX1 2
	conditionXX2 ;
.XX; <
NameXX< @
,XX@ A
outXXB E
varXXF I
factoryXXJ Q
)XXQ R
)XXR S
{YY 
varZZ 

jConditionZZ  *
=ZZ+ ,
JObjectZZ- 4
.ZZ4 5

FromObjectZZ5 ?
(ZZ? @
	conditionZZ@ I
)ZZI J
;ZZJ K
var[[ 
factoryCondition[[  0
=[[1 2
([[3 4
	Condition[[4 =
)[[= >

jCondition[[> H
.[[H I
ToObject[[I Q
([[Q R
factory[[R Y
.[[Y Z
Create[[Z `
([[` a
)[[a b
.[[b c
GetType[[c j
([[j k
)[[k l
)[[l m
;[[m n
layer]] !
.]]! "
	LayerRule]]" +
.]]+ ,

Conditions]], 6
.]]6 7
Add]]7 :
(]]: ;
factoryCondition]]; K
)]]K L
;]]L M
}^^ 
else__ 
{`` 
unknownTypesaa )
.aa) *
Addaa* -
(aa- .
	conditionaa. 7
.aa7 8
Nameaa8 <
)aa< =
;aa= >
}bb 
}cc 
}dd 
ifii 
(ii 
!ii 
Stringii 
.ii 
IsNullOrEmptyii )
(ii) *
	layerStepii* 3
.ii3 4
Ruleii4 8
)ii8 9
)ii9 :
{jj 
_ruleMigratorkk !
.kk! "
Migratekk" )
(kk) *
	layerStepkk* 3
.kk3 4
Rulekk4 8
,kk8 9
layerkk: ?
.kk? @
	LayerRulekk@ I
)kkI J
;kkJ K
}ll 
ifoo 
(oo 
!oo 
Stringoo 
.oo 
IsNullOrEmptyoo )
(oo) *
	layerStepoo* 3
.oo3 4
Descriptionoo4 ?
)oo? @
)oo@ A
{pp 
layerqq 
.qq 
Descriptionqq %
=qq& '
	layerStepqq( 1
.qq1 2
Descriptionqq2 =
;qq= >
}rr 
}ss 
ifuu 
(uu 
unknownTypesuu 
.uu 
Countuu "
!=uu# %
$numuu& '
)uu' (
{vv 
varww 
prefixww 
=ww 
$strww l
;wwl m
varxx 
suffixxx 
=xx 
$strxx t
;xxt u
throwzz 
newzz %
InvalidOperationExceptionzz 3
(zz3 4
$"zz4 6
{zz6 7
prefixzz7 =
}zz= >
{zz? @
Stringzz@ F
.zzF G
JoinzzG K
(zzK L
$strzzL P
,zzP Q
unknownTypeszzR ^
)zz^ _
}zz_ `
. zz` b
{zzb c
suffixzzc i
}zzi j
"zzj k
)zzk l
;zzl m
}{{ 
await}} 
_layerService}} 
.}}  
UpdateAsync}}  +
(}}+ ,
	allLayers}}, 5
)}}5 6
;}}6 7
}~~ 	
} 
public
ÅÅ 

class
ÅÅ 
LayerStepModel
ÅÅ 
{
ÇÇ 
public
ÉÉ 
Layer
ÉÉ 
[
ÉÉ 
]
ÉÉ 
Layers
ÉÉ 
{
ÉÉ 
get
ÉÉ  #
;
ÉÉ# $
set
ÉÉ% (
;
ÉÉ( )
}
ÉÉ* +
}
ÑÑ 
}ÖÖ ûS
öD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Services\DefaultLayersMethodProvider.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Services %
{ 
public 

class '
DefaultLayersMethodProvider ,
:- .!
IGlobalMethodProvider/ D
{ 
private 
readonly 
GlobalMethod %
_isHomepage& 1
;1 2
private 
readonly 
GlobalMethod %
_isAnonymous& 2
;2 3
private 
readonly 
GlobalMethod %
_isAuthenticated& 6
;6 7
private 
readonly 
GlobalMethod %
	_isInRole& /
;/ 0
private 
readonly 
GlobalMethod %
_url& *
;* +
private 
readonly 
GlobalMethod %
_culture& .
;. /
private 
readonly 
GlobalMethod %
[% &
]& '
_allMethods( 3
;3 4
public '
DefaultLayersMethodProvider *
(* +
)+ ,
{ 	
_isHomepage 
= 
new 
GlobalMethod *
{ 
Name 
= 
$str #
,# $
Method 
= 
serviceProvider (
=>) +
(, -
Func- 1
<1 2
bool2 6
>6 7
)7 8
(8 9
(9 :
): ;
=>< >
{ 
var 
httpContext #
=$ %
serviceProvider& 5
.5 6
GetRequiredService6 H
<H I 
IHttpContextAccessorI ]
>] ^
(^ _
)_ `
.` a
HttpContexta l
;l m
var   
requestPath   #
=  $ %
httpContext  & 1
.  1 2
Request  2 9
.  9 :
Path  : >
.  > ?
Value  ? D
;  D E
return!! 
requestPath!! &
==!!' )
$str!!* -
||!!. 0
string!!1 7
.!!7 8
IsNullOrEmpty!!8 E
(!!E F
requestPath!!F Q
)!!Q R
;!!R S
}"" 
)"" 
}## 
;## 
_isAnonymous%% 
=%% 
new%% 
GlobalMethod%% +
{&& 
Name'' 
='' 
$str'' $
,''$ %
Method(( 
=(( 
serviceProvider(( (
=>(() +
(((, -
Func((- 1
<((1 2
bool((2 6
>((6 7
)((7 8
(((8 9
(((9 :
)((: ;
=>((< >
{)) 
var** 
httpContext** #
=**$ %
serviceProvider**& 5
.**5 6
GetRequiredService**6 H
<**H I 
IHttpContextAccessor**I ]
>**] ^
(**^ _
)**_ `
.**` a
HttpContext**a l
;**l m
return++ 
httpContext++ &
.++& '
User++' +
?+++ ,
.++, -
Identity++- 5
.++5 6
IsAuthenticated++6 E
!=++F H
true++I M
;++M N
},, 
),, 
}-- 
;-- 
_isAuthenticated// 
=// 
new// "
GlobalMethod//# /
{00 
Name11 
=11 
$str11 (
,11( )
Method22 
=22 
serviceProvider22 (
=>22) +
(22, -
Func22- 1
<221 2
bool222 6
>226 7
)227 8
(228 9
(229 :
)22: ;
=>22< >
{33 
var44 
httpContext44 #
=44$ %
serviceProvider44& 5
.445 6
GetRequiredService446 H
<44H I 
IHttpContextAccessor44I ]
>44] ^
(44^ _
)44_ `
.44` a
HttpContext44a l
;44l m
return55 
httpContext55 &
.55& '
User55' +
?55+ ,
.55, -
Identity55- 5
.555 6
IsAuthenticated556 E
==55F H
true55I M
;55M N
}66 
)66 
}77 
;77 
	_isInRole99 
=99 
new99 
GlobalMethod99 (
{:: 
Name;; 
=;; 
$str;; !
,;;! "
Method<< 
=<< 
serviceProvider<< (
=><<) +
(<<, -
Func<<- 1
<<<1 2
string<<2 8
,<<8 9
bool<<: >
><<> ?
)<<? @
(<<A B
role<<B F
=><<G I
{== 
var>> 
httpContext>> #
=>>$ %
serviceProvider>>& 5
.>>5 6
GetRequiredService>>6 H
<>>H I 
IHttpContextAccessor>>I ]
>>>] ^
(>>^ _
)>>_ `
.>>` a
HttpContext>>a l
;>>l m
var?? 
optionsAccessor?? '
=??( )
serviceProvider??* 9
.??9 :
GetRequiredService??: L
<??L M
IOptions??M U
<??U V
IdentityOptions??V e
>??e f
>??f g
(??g h
)??h i
;??i j
var@@ 
roleClaimType@@ %
=@@& '
optionsAccessor@@( 7
.@@7 8
Value@@8 =
.@@= >
ClaimsIdentity@@> L
.@@L M
RoleClaimType@@M Z
;@@Z [
returnAA 
httpContextAA &
.AA& '
UserAA' +
?AA+ ,
.AA, -
ClaimsAA- 3
.AA3 4
AnyAA4 7
(AA7 8
claimAA8 =
=>AA> @
claimAAA F
.AAF G
TypeAAG K
==AAL N
roleClaimTypeAAO \
&&AA] _
claimAA` e
.AAe f
ValueAAf k
.AAk l
EqualsAAl r
(AAr s
roleAAs w
,AAw x
StringComparison	AAy â
.
AAâ ä
OrdinalIgnoreCase
AAä õ
)
AAõ ú
)
AAú ù
==
AAû †
true
AA° •
;
AA• ¶
}BB 
)BB 
}CC 
;CC 
_urlEE 
=EE 
newEE 
GlobalMethodEE #
{FF 
NameGG 
=GG 
$strGG 
,GG 
MethodHH 
=HH 
serviceProviderHH (
=>HH) +
(HH, -
FuncHH- 1
<HH1 2
stringHH2 8
,HH8 9
boolHH: >
>HH> ?
)HH? @
(HH@ A
urlHHA D
=>HHE G
{II 
ifJJ 
(JJ 
urlJJ 
.JJ 

StartsWithJJ &
(JJ& '
$strJJ' +
,JJ+ ,
StringComparisonJJ- =
.JJ= >
OrdinalJJ> E
)JJE F
)JJF G
{KK 
urlLL 
=LL 
urlLL !
.LL! "
	SubstringLL" +
(LL+ ,
$numLL, -
)LL- .
;LL. /
}MM 
varOO 
httpContextOO #
=OO$ %
serviceProviderOO& 5
.OO5 6
GetRequiredServiceOO6 H
<OOH I 
IHttpContextAccessorOOI ]
>OO] ^
(OO^ _
)OO_ `
.OO` a
HttpContextOOa l
;OOl m
stringPP 
requestPathPP &
=PP' (
httpContextPP) 4
.PP4 5
RequestPP5 <
.PP< =
PathPP= A
.PPA B
ValuePPB G
;PPG H
ifTT 
(TT 
stringTT 
.TT 
IsNullOrEmptyTT ,
(TT, -
requestPathTT- 8
)TT8 9
)TT9 :
{UU 
requestPathVV #
=VV$ %
$strVV& )
;VV) *
}WW 
returnYY 
urlYY 
.YY 
EndsWithYY '
(YY' (
$charYY( +
)YY+ ,
?ZZ 
requestPathZZ %
.ZZ% &

StartsWithZZ& 0
(ZZ0 1
urlZZ1 4
.ZZ4 5
TrimEndZZ5 <
(ZZ< =
$charZZ= @
)ZZ@ A
,ZZA B
StringComparisonZZC S
.ZZS T
OrdinalIgnoreCaseZZT e
)ZZe f
:[[ 
string[[  
.[[  !
Equals[[! '
([[' (
requestPath[[( 3
,[[3 4
url[[5 8
,[[8 9
StringComparison[[: J
.[[J K
OrdinalIgnoreCase[[K \
)[[\ ]
;[[] ^
}\\ 
)\\ 
}]] 
;]] 
_culture__ 
=__ 
new__ 
GlobalMethod__ '
{`` 
Nameaa 
=aa 
$straa  
,aa  !
Methodbb 
=bb 
serviceProviderbb (
=>bb) +
(bb, -
Funcbb- 1
<bb1 2
stringbb2 8
,bb8 9
boolbb: >
>bb> ?
)bb? @
(bb@ A
culturebbA H
=>bbI K
{cc 
vardd 
currentCulturedd &
=dd' (
CultureInfodd) 4
.dd4 5
CurrentCulturedd5 C
;ddC D
returnff 
stringff !
.ff! "
Equalsff" (
(ff( )
cultureff) 0
,ff0 1
currentCultureff2 @
.ff@ A
NameffA E
,ffE F
StringComparisonffG W
.ffW X
OrdinalIgnoreCaseffX i
)ffi j
||ffk m
stringgg 
.gg 
Equalsgg %
(gg% &
culturegg& -
,gg- .
currentCulturegg/ =
.gg= >
Parentgg> D
.ggD E
NameggE I
,ggI J
StringComparisonggK [
.gg[ \
OrdinalIgnoreCasegg\ m
)ggm n
;ggn o
}hh 
)hh 
}ii 
;ii 
_allMethodskk 
=kk 
newkk 
[kk 
]kk 
{kk  !
_isAnonymouskk" .
,kk. /
_isAuthenticatedkk0 @
,kk@ A
	_isInRolekkB K
,kkK L
_isHomepagekkM X
,kkX Y
_urlkkZ ^
,kk^ _
_culturekk` h
}kki j
;kkj k
}ll 	
publicnn 
IEnumerablenn 
<nn 
GlobalMethodnn '
>nn' (

GetMethodsnn) 3
(nn3 4
)nn4 5
{oo 	
returnpp 
_allMethodspp 
;pp 
}qq 	
}rr 
}ss ÷
åD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Services\ILayerService.cs
	namespace		 	
OrchardCore		
 
.		 
Layers		 
.		 
Services		 %
{

 
public 

	interface 
ILayerService "
{ 
Task 
< 
LayersDocument 
> 
LoadLayersAsync ,
(, -
)- .
;. /
Task 
< 
LayersDocument 
> 
GetLayersAsync +
(+ ,
), -
;- .
Task 
< 
IEnumerable 
< 
ContentItem $
>$ %
>% & 
GetLayerWidgetsAsync' ;
(; <

Expression< F
<F G
FuncG K
<K L
ContentItemIndexL \
,\ ]
bool^ b
>b c
>c d
	predicatee n
)n o
;o p
Task 
< 
IEnumerable 
< 
LayerMetadata &
>& '
>' ((
GetLayerWidgetsMetadataAsync) E
(E F

ExpressionF P
<P Q
FuncQ U
<U V
ContentItemIndexV f
,f g
boolh l
>l m
>m n
	predicateo x
)x y
;y z
Task 
UpdateAsync 
( 
LayersDocument '
layers( .
). /
;/ 0
} 
} µ^
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Services\LayerFilter.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Services %
{ 
public 

class 
LayerFilter 
: 
IAsyncResultFilter 1
{ 
private 
const 
string 

WidgetsKey '
=( )
$str* U
;U V
private 
readonly 
ILayoutAccessor (
_layoutAccessor) 8
;8 9
private   
readonly   &
IContentItemDisplayManager   3&
_contentItemDisplayManager  4 N
;  N O
private!! 
readonly!!  
IUpdateModelAccessor!! -!
_modelUpdaterAccessor!!. C
;!!C D
private"" 
readonly"" 
IRuleService"" %
_ruleService""& 2
;""2 3
private## 
readonly## 
IMemoryCache## %
_memoryCache##& 2
;##2 3
private$$ 
readonly$$ 
IThemeManager$$ &
_themeManager$$' 4
;$$4 5
private%% 
readonly%% 
IAdminThemeService%% +
_adminThemeService%%, >
;%%> ?
private&& 
readonly&& 
ILayerService&& &
_layerService&&' 4
;&&4 5
private'' 
readonly'' $
IVolatileDocumentManager'' 1
<''1 2

LayerState''2 <
>''< =
_layerStateManager''> P
;''P Q
public)) 
LayerFilter)) 
()) 
ILayerService** 
layerService** &
,**& '
ILayoutAccessor++ 
layoutAccessor++ *
,++* +&
IContentItemDisplayManager,, &%
contentItemDisplayManager,,' @
,,,@ A 
IUpdateModelAccessor--   
modelUpdaterAccessor--! 5
,--5 6
IRuleService.. 
ruleService.. $
,..$ %
IMemoryCache// 
memoryCache// $
,//$ %
IThemeManager00 
themeManager00 &
,00& '
IAdminThemeService11 
adminThemeService11 0
,110 1$
IVolatileDocumentManager22 $
<22$ %

LayerState22% /
>22/ 0
layerStateManager221 B
)22B C
{33 	
_layerService44 
=44 
layerService44 (
;44( )
_layoutAccessor55 
=55 
layoutAccessor55 ,
;55, -&
_contentItemDisplayManager66 &
=66' (%
contentItemDisplayManager66) B
;66B C!
_modelUpdaterAccessor77 !
=77" # 
modelUpdaterAccessor77$ 8
;778 9
_ruleService88 
=88 
ruleService88 &
;88& '
_memoryCache99 
=99 
memoryCache99 &
;99& '
_themeManager:: 
=:: 
themeManager:: (
;::( )
_adminThemeService;; 
=;;  
adminThemeService;;! 2
;;;2 3
_layerStateManager<< 
=<<  
layerStateManager<<! 2
;<<2 3
}== 	
public?? 
async?? 
Task?? "
OnResultExecutionAsync?? 0
(??0 1"
ResultExecutingContext??1 G
context??H O
,??O P#
ResultExecutionDelegate??Q h
next??i m
)??m n
{@@ 	
ifBB 
(BB 
(BB 
contextBB 
.BB 
ResultBB 
isBB  "

ViewResultBB# -
||BB. 0
contextBB1 8
.BB8 9
ResultBB9 ?
isBB@ B

PageResultBBC M
)BBM N
&&BBO Q
!CC 
AdminAttributeCC 
.CC  
	IsAppliedCC  )
(CC) *
contextCC* 1
.CC1 2
HttpContextCC2 =
)CC= >
)CC> ?
{DD 
varGG 
selectedThemeGG !
=GG" #
(GG$ %
awaitGG% *
_themeManagerGG+ 8
.GG8 9
GetThemeAsyncGG9 F
(GGF G
)GGG H
)GGH I
?GGI J
.GGJ K
IdGGK M
;GGM N
varHH 

adminThemeHH 
=HH  
awaitHH! &
_adminThemeServiceHH' 9
.HH9 :"
GetAdminThemeNameAsyncHH: P
(HHP Q
)HHQ R
;HHR S
ifII 
(II 
selectedThemeII !
==II" $

adminThemeII% /
)II/ 0
{JJ 
awaitKK 
nextKK 
.KK 
InvokeKK %
(KK% &
)KK& '
;KK' (
returnLL 
;LL 
}MM 
varOO 

layerStateOO 
=OO  
awaitOO! &
_layerStateManagerOO' 9
.OO9 :%
GetOrCreateImmutableAsyncOO: S
(OOS T
)OOT U
;OOU V
ifQQ 
(QQ 
!QQ 
_memoryCacheQQ !
.QQ! "
TryGetValueQQ" -
<QQ- .

CacheEntryQQ. 8
>QQ8 9
(QQ9 :

WidgetsKeyQQ: D
,QQD E
outQQF I
varQQJ M

cacheEntryQQN X
)QQX Y
||QQZ \

cacheEntryQQ] g
.QQg h

IdentifierQQh r
!=QQs u

layerState	QQv Ä
.
QQÄ Å

Identifier
QQÅ ã
)
QQã å
{RR 

cacheEntrySS 
=SS  
newSS! $

CacheEntrySS% /
(SS/ 0
)SS0 1
{TT 

IdentifierUU "
=UU# $

layerStateUU% /
.UU/ 0

IdentifierUU0 :
,UU: ;
WidgetsVV 
=VV  !
awaitVV" '
_layerServiceVV( 5
.VV5 6(
GetLayerWidgetsMetadataAsyncVV6 R
(VVR S
xVVS T
=>VVU W
xVVX Y
.VVY Z
	PublishedVVZ c
)VVc d
}WW 
;WW 
_memoryCacheYY  
.YY  !
SetYY! $
(YY$ %

WidgetsKeyYY% /
,YY/ 0

cacheEntryYY1 ;
)YY; <
;YY< =
}ZZ 
var\\ 
widgets\\ 
=\\ 

cacheEntry\\ (
.\\( )
Widgets\\) 0
;\\0 1
var^^ 
layers^^ 
=^^ 
(^^ 
await^^ #
_layerService^^$ 1
.^^1 2
GetLayersAsync^^2 @
(^^@ A
)^^A B
)^^B C
.^^C D
Layers^^D J
.^^J K
ToDictionary^^K W
(^^W X
x^^X Y
=>^^Z \
x^^] ^
.^^^ _
Name^^_ c
)^^c d
;^^d e
dynamic`` 
layout`` 
=``  
await``! &
_layoutAccessor``' 6
.``6 7
GetLayoutAsync``7 E
(``E F
)``F G
;``G H
varaa 
updateraa 
=aa !
_modelUpdaterAccessoraa 3
.aa3 4
ModelUpdateraa4 @
;aa@ A
varcc 
layersCachecc 
=cc  !
newcc" %

Dictionarycc& 0
<cc0 1
stringcc1 7
,cc7 8
boolcc9 =
>cc= >
(cc> ?
)cc? @
;cc@ A
foreachee 
(ee 
varee 
widgetee #
inee$ &
widgetsee' .
)ee. /
{ff 
vargg 
layergg 
=gg 
widgetgg  &
.gg& '
Layergg' ,
!=gg- /
nullgg0 4
?gg5 6
layersgg7 =
[gg= >
widgetgg> D
.ggD E
LayerggE J
]ggJ K
:ggL M
nullggN R
;ggR S
ifii 
(ii 
layerii 
==ii  
nullii! %
)ii% &
{jj 
continuekk  
;kk  !
}ll 
boolnn 
displaynn  
;nn  !
ifoo 
(oo 
!oo 
layersCacheoo $
.oo$ %
TryGetValueoo% 0
(oo0 1
layeroo1 6
.oo6 7
Nameoo7 ;
,oo; <
outoo= @
displayooA H
)ooH I
)ooI J
{pp 
displayqq 
=qq  !
awaitqq" '
_ruleServiceqq( 4
.qq4 5
EvaluateAsyncqq5 B
(qqB C
layerqqC H
.qqH I
	LayerRuleqqI R
)qqR S
;qqS T
layersCachess #
[ss# $
layerss$ )
.ss) *
Namess* .
]ss. /
=ss0 1
displayss2 9
;ss9 :
}tt 
ifvv 
(vv 
!vv 
displayvv  
)vv  !
{ww 
continuexx  
;xx  !
}yy 
var{{ 
widgetContent{{ %
={{& '
await{{( -&
_contentItemDisplayManager{{. H
.{{H I
BuildDisplayAsync{{I Z
({{Z [
widget{{[ a
.{{a b
ContentItem{{b m
,{{m n
updater{{o v
){{v w
;{{w x
widgetContent}} !
.}}! "
Classes}}" )
.}}) *
Add}}* -
(}}- .
$str}}. 6
)}}6 7
;}}7 8
widgetContent~~ !
.~~! "
Classes~~" )
.~~) *
Add~~* -
(~~- .
$str~~. 7
+~~8 9
widget~~: @
.~~@ A
ContentItem~~A L
.~~L M
ContentType~~M X
.~~X Y
HtmlClassify~~Y e
(~~e f
)~~f g
)~~g h
;~~h i
var
ÄÄ 
wrapper
ÄÄ 
=
ÄÄ  !
new
ÄÄ" %
WidgetWrapper
ÄÄ& 3
{
ÅÅ 
Widget
ÇÇ 
=
ÇÇ  
widget
ÇÇ! '
.
ÇÇ' (
ContentItem
ÇÇ( 3
,
ÇÇ3 4
Content
ÉÉ 
=
ÉÉ  !
widgetContent
ÉÉ" /
}
ÑÑ 
;
ÑÑ 
wrapper
ÜÜ 
.
ÜÜ 
Metadata
ÜÜ $
.
ÜÜ$ %

Alternates
ÜÜ% /
.
ÜÜ/ 0
Add
ÜÜ0 3
(
ÜÜ3 4
$str
ÜÜ4 F
+
ÜÜG H
widget
ÜÜI O
.
ÜÜO P
ContentItem
ÜÜP [
.
ÜÜ[ \
ContentType
ÜÜ\ g
)
ÜÜg h
;
ÜÜh i
wrapper
áá 
.
áá 
Metadata
áá $
.
áá$ %

Alternates
áá% /
.
áá/ 0
Add
áá0 3
(
áá3 4
$str
áá4 L
+
ááM N
widget
ááO U
.
ááU V
Zone
ááV Z
)
ááZ [
;
áá[ \
var
ââ 
contentZone
ââ #
=
ââ$ %
layout
ââ& ,
.
ââ, -
Zones
ââ- 2
[
ââ2 3
widget
ââ3 9
.
ââ9 :
Zone
ââ: >
]
ââ> ?
;
ââ? @
if
ãã 
(
ãã 
contentZone
ãã #
is
ãã$ &
ZoneOnDemand
ãã' 3
zoneOnDemand
ãã4 @
)
ãã@ A
{
åå 
await
çç 
zoneOnDemand
çç *
.
çç* +
AddAsync
çç+ 3
(
çç3 4
wrapper
çç4 ;
)
çç; <
;
çç< =
}
éé 
else
èè 
if
èè 
(
èè 
contentZone
èè (
is
èè) +
Shape
èè, 1
shape
èè2 7
)
èè7 8
{
êê 
shape
ëë 
.
ëë 
Add
ëë !
(
ëë! "
wrapper
ëë" )
)
ëë) *
;
ëë* +
}
íí 
}
ìì 
}
îî 
await
ññ 
next
ññ 
.
ññ 
Invoke
ññ 
(
ññ 
)
ññ 
;
ññ  
}
óó 	
internal
ôô 
class
ôô 

CacheEntry
ôô !
:
ôô" #
Document
ôô$ ,
{
öö 	
public
õõ 
IEnumerable
õõ 
<
õõ 
LayerMetadata
õõ ,
>
õõ, -
Widgets
õõ. 5
{
õõ6 7
get
õõ8 ;
;
õõ; <
set
õõ= @
;
õõ@ A
}
õõB C
}
úú 	
}
ùù 
}ûû ï#
ãD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Services\LayerService.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 
Services %
{ 
public 

class 
LayerService 
: 
ILayerService  -
{ 
private 
readonly 
ISession !
_session" *
;* +
private 
readonly 
IDocumentManager )
<) *
LayersDocument* 8
>8 9
_documentManager: J
;J K
public 
LayerService 
( 
ISession $
session% ,
,, -
IDocumentManager. >
<> ?
LayersDocument? M
>M N
documentManagerO ^
)^ _
{ 	
_session 
= 
session 
; 
_documentManager 
= 
documentManager .
;. /
} 	
public 
Task 
< 
LayersDocument "
>" #
LoadLayersAsync$ 3
(3 4
)4 5
=>6 8
_documentManager9 I
.I J#
GetOrCreateMutableAsyncJ a
(a b
)b c
;c d
public"" 
Task"" 
<"" 
LayersDocument"" "
>""" #
GetLayersAsync""$ 2
(""2 3
)""3 4
=>""5 7
_documentManager""8 H
.""H I%
GetOrCreateImmutableAsync""I b
(""b c
)""c d
;""d e
public$$ 
async$$ 
Task$$ 
<$$ 
IEnumerable$$ %
<$$% &
ContentItem$$& 1
>$$1 2
>$$2 3 
GetLayerWidgetsAsync$$4 H
($$H I

Expression%% 
<%% 
Func%% 
<%% 
ContentItemIndex%% ,
,%%, -
bool%%. 2
>%%2 3
>%%3 4
	predicate%%5 >
)%%> ?
{&& 	
return'' 
await'' 
_session'' !
.(( 
Query(( 
<(( 
ContentItem(( "
,((" #
LayerMetadataIndex(($ 6
>((6 7
(((7 8
)((8 9
.)) 
With)) 
()) 
	predicate)) 
)))  
.** 
	ListAsync** 
(** 
)** 
;** 
}++ 	
public-- 
async-- 
Task-- 
<-- 
IEnumerable-- %
<--% &
LayerMetadata--& 3
>--3 4
>--4 5(
GetLayerWidgetsMetadataAsync--6 R
(--R S

Expression.. 
<.. 
Func.. 
<.. 
ContentItemIndex.. ,
,.., -
bool... 2
>..2 3
>..3 4
	predicate..5 >
)..> ?
{// 	
var00 

allWidgets00 
=00 
await00 " 
GetLayerWidgetsAsync00# 7
(007 8
	predicate008 A
)00A B
;00B C
return22 

allWidgets22 
.33 
Select33 
(33 
x33 
=>33 
x33 
.33 
As33 !
<33! "
LayerMetadata33" /
>33/ 0
(330 1
)331 2
)332 3
.44 
Where44 
(44 
x44 
=>44 
x44 
!=44  
null44! %
)44% &
.55 
OrderBy55 
(55 
x55 
=>55 
x55 
.55  
Position55  (
)55( )
.66 
ToList66 
(66 
)66 
;66 
}77 	
public<< 
async<< 
Task<< 
UpdateAsync<< %
(<<% &
LayersDocument<<& 4
layers<<5 ;
)<<; <
{== 	
var>> 
existing>> 
=>> 
await>>  
LoadLayersAsync>>! 0
(>>0 1
)>>1 2
;>>2 3
existing?? 
.?? 
Layers?? 
=?? 
layers?? $
.??$ %
Layers??% +
;??+ ,
await@@ 
_documentManager@@ "
.@@" #
UpdateAsync@@# .
(@@. /
layers@@/ 5
)@@5 6
;@@6 7
}AA 	
}BB 
}CC ˇW
}D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\Startup.cs
	namespace   	
OrchardCore  
 
.   
Layers   
{!! 
public"" 

class"" 
Startup"" 
:"" 
StartupBase"" &
{## 
private$$ 
readonly$$ 
AdminOptions$$ %
_adminOptions$$& 3
;$$3 4
public&& 
Startup&& 
(&& 
IOptions&& 
<&&  
AdminOptions&&  ,
>&&, -
adminOptions&&. :
)&&: ;
{'' 	
_adminOptions(( 
=(( 
adminOptions(( (
.((( )
Value(() .
;((. /
})) 	
public++ 
override++ 
void++ 
ConfigureServices++ .
(++. /
IServiceCollection++/ A
services++B J
)++J K
{,, 	
services-- 
.-- 
	Configure-- 
<-- 

MvcOptions-- )
>--) *
(--* +
(--+ ,
options--, 3
)--3 4
=>--5 7
{.. 
options// 
.// 
Filters// 
.//  
Add//  #
(//# $
typeof//$ *
(//* +
LayerFilter//+ 6
)//6 7
)//7 8
;//8 9
}00 
)00 
;00 
services22 
.22 
	AddScoped22 
<22 
IDisplayDriver22 -
<22- .
ISite22. 3
>223 4
,224 5*
LayerSiteSettingsDisplayDriver226 T
>22T U
(22U V
)22V W
;22W X
services33 
.33 
AddContentPart33 #
<33# $
LayerMetadata33$ 1
>331 2
(332 3
)333 4
;334 5
services44 
.44 
	AddScoped44 
<44 !
IContentDisplayDriver44 4
,444 5
LayerMetadataWelder446 I
>44I J
(44J K
)44K L
;44L M
services55 
.55 
	AddScoped55 
<55 
INavigationProvider55 2
,552 3
	AdminMenu554 =
>55= >
(55> ?
)55? @
;55@ A
services66 
.66 
	AddScoped66 
<66 
ILayerService66 ,
,66, -
LayerService66. :
>66: ;
(66; <
)66< =
;66= >
services77 
.77 
	AddScoped77 
<77 
IContentHandler77 .
,77. / 
LayerMetadataHandler770 D
>77D E
(77E F
)77F G
;77G H
services88 
.88 
AddSingleton88 !
<88! "
IIndexProvider88" 0
,880 1&
LayerMetadataIndexProvider882 L
>88L M
(88M N
)88N O
;88O P
services99 
.99 
	AddScoped99 
<99 
IDataMigration99 -
,99- .

Migrations99/ 9
>999 :
(99: ;
)99; <
;99< =
services:: 
.:: 
	AddScoped:: 
<:: 
IPermissionProvider:: 2
,::2 3
Permissions::4 ?
>::? @
(::@ A
)::A B
;::B C
services;; 
.;; "
AddRecipeExecutionStep;; +
<;;+ ,
	LayerStep;;, 5
>;;5 6
(;;6 7
);;7 8
;;;8 9
services== 
.== 
AddTransient== !
<==! "
IDeploymentSource==" 3
,==3 4%
AllLayersDeploymentSource==5 N
>==N O
(==O P
)==P Q
;==Q R
services>> 
.>> 
AddSingleton>> !
<>>! ""
IDeploymentStepFactory>>" 8
>>>8 9
(>>9 :
new>>: =!
DeploymentStepFactory>>> S
<>>S T#
AllLayersDeploymentStep>>T k
>>>k l
(>>l m
)>>m n
)>>n o
;>>o p
services?? 
.?? 
	AddScoped?? 
<?? 
IDisplayDriver?? -
<??- .
DeploymentStep??. <
>??< =
,??= >)
AllLayersDeploymentStepDriver??? \
>??\ ]
(??] ^
)??^ _
;??_ `
services@@ 
.@@ 
AddSingleton@@ !
<@@! "!
IGlobalMethodProvider@@" 7
,@@7 8'
DefaultLayersMethodProvider@@9 T
>@@T U
(@@U V
)@@V W
;@@W X
}AA 	
publicCC 
overrideCC 
voidCC 
	ConfigureCC &
(CC& '
IApplicationBuilderCC' :
builderCC; B
,CCB C!
IEndpointRouteBuilderCCD Y
routesCCZ `
,CC` a
IServiceProviderCCb r
serviceProvider	CCs Ç
)
CCÇ É
{DD 	
varEE 
adminControllerNameEE #
=EE$ %
typeofEE& ,
(EE, -
AdminControllerEE- <
)EE< =
.EE= >
ControllerNameEE> L
(EEL M
)EEM N
;EEN O
routesGG 
.GG "
MapAreaControllerRouteGG )
(GG) *
nameHH 
:HH 
$strHH $
,HH$ %
areaNameII 
:II 
$strII .
,II. /
patternJJ 
:JJ 
_adminOptionsJJ &
.JJ& '
AdminUrlPrefixJJ' 5
+JJ6 7
$strJJ8 A
,JJA B
defaultsKK 
:KK 
newKK 
{KK 

controllerKK  *
=KK+ ,
adminControllerNameKK- @
,KK@ A
actionKKB H
=KKI J
nameofKKK Q
(KKQ R
AdminControllerKKR a
.KKa b
IndexKKb g
)KKg h
}KKi j
)LL 
;LL 
routesNN 
.NN "
MapAreaControllerRouteNN )
(NN) *
nameOO 
:OO 
$strOO %
,OO% &
areaNamePP 
:PP 
$strPP .
,PP. /
patternQQ 
:QQ 
_adminOptionsQQ &
.QQ& '
AdminUrlPrefixQQ' 5
+QQ6 7
$strQQ8 H
,QQH I
defaultsRR 
:RR 
newRR 
{RR 

controllerRR  *
=RR+ ,
adminControllerNameRR- @
,RR@ A
actionRRB H
=RRI J
nameofRRK Q
(RRQ R
AdminControllerRRR a
.RRa b
CreateRRb h
)RRh i
}RRj k
)SS 
;SS 
routesUU 
.UU "
MapAreaControllerRouteUU )
(UU) *
nameVV 
:VV 
$strVV %
,VV% &
areaNameWW 
:WW 
$strWW .
,WW. /
patternXX 
:XX 
_adminOptionsXX &
.XX& '
AdminUrlPrefixXX' 5
+XX6 7
$strXX8 H
,XXH I
defaultsYY 
:YY 
newYY 
{YY 

controllerYY  *
=YY+ ,
adminControllerNameYY- @
,YY@ A
actionYYB H
=YYI J
nameofYYK Q
(YYQ R
AdminControllerYYR a
.YYa b
DeleteYYb h
)YYh i
}YYj k
)ZZ 
;ZZ 
routes\\ 
.\\ "
MapAreaControllerRoute\\ )
(\\) *
name]] 
:]] 
$str]] #
,]]# $
areaName^^ 
:^^ 
$str^^ .
,^^. /
pattern__ 
:__ 
_adminOptions__ &
.__& '
AdminUrlPrefix__' 5
+__6 7
$str__8 F
,__F G
defaults`` 
:`` 
new`` 
{`` 

controller``  *
=``+ ,
adminControllerName``- @
,``@ A
action``B H
=``I J
nameof``K Q
(``Q R
AdminController``R a
.``a b
Edit``b f
)``f g
}``h i
)aa 
;aa 
varcc #
layerRuleControllerNamecc '
=cc( )
typeofcc* 0
(cc0 1
LayerRuleControllercc1 D
)ccD E
.ccE F
ControllerNameccF T
(ccT U
)ccU V
;ccV W
routesee 
.ee "
MapAreaControllerRouteee )
(ee) *
nameff 
:ff 
$strff +
,ff+ ,
areaNamegg 
:gg 
$strgg .
,gg. /
patternhh 
:hh 
_adminOptionshh &
.hh& '
AdminUrlPrefixhh' 5
+hh6 7
$strhh8 N
,hhN O
defaultsii 
:ii 
newii 
{ii 

controllerii  *
=ii+ ,#
layerRuleControllerNameii- D
,iiD E
actioniiF L
=iiM N
nameofiiO U
(iiU V
LayerRuleControlleriiV i
.iii j
Createiij p
)iip q
}iir s
)jj 
;jj 
routesll 
.ll "
MapAreaControllerRoutell )
(ll) *
namemm 
:mm 
$strmm +
,mm+ ,
areaNamenn 
:nn 
$strnn .
,nn. /
patternoo 
:oo 
_adminOptionsoo &
.oo& '
AdminUrlPrefixoo' 5
+oo6 7
$stroo8 N
,ooN O
defaultspp 
:pp 
newpp 
{pp 

controllerpp  *
=pp+ ,#
layerRuleControllerNamepp- D
,ppD E
actionppF L
=ppM N
nameofppO U
(ppU V
LayerRuleControllerppV i
.ppi j
Deleteppj p
)ppp q
}ppr s
)qq 
;qq 
routesss 
.ss "
MapAreaControllerRoutess )
(ss) *
namett 
:tt 
$strtt )
,tt) *
areaNameuu 
:uu 
$struu .
,uu. /
patternvv 
:vv 
_adminOptionsvv &
.vv& '
AdminUrlPrefixvv' 5
+vv6 7
$strvv8 L
,vvL M
defaultsww 
:ww 
newww 
{ww 

controllerww  *
=ww+ ,#
layerRuleControllerNameww- D
,wwD E
actionwwF L
=wwM N
nameofwwO U
(wwU V
LayerRuleControllerwwV i
.wwi j
Editwwj n
)wwn o
}wwp q
)xx 
;xx 
routeszz 
.zz "
MapAreaControllerRoutezz )
(zz) *
name{{ 
:{{ 
$str{{ *
,{{* +
areaName|| 
:|| 
$str|| .
,||. /
pattern}} 
:}} 
_adminOptions}} &
.}}& '
AdminUrlPrefix}}' 5
+}}6 7
$str}}8 M
,}}M N
defaults~~ 
:~~ 
new~~ 
{~~ 

controller~~  *
=~~+ ,#
layerRuleControllerName~~- D
,~~D E
action~~F L
=~~M N
nameof~~O U
(~~U V
LayerRuleController~~V i
.~~i j
UpdateOrder~~j u
)~~u v
}~~w x
) 
; 
}
ÄÄ 	
}
ÅÅ 
}ÇÇ ⁄
ìD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayerEditViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class 
LayerEditViewModel #
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Description		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public

 
dynamic

 
	LayerRule

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 

Dictionary 
< 
string  
,  !
dynamic" )
>) *

Thumbnails+ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
} 
} ß
õD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayerMetadataEditViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class &
LayerMetadataEditViewModel +
{ 
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
public		 
LayerMetadata		 
LayerMetadata		 *
{		+ ,
get		- 0
;		0 1
set		2 5
;		5 6
}		7 8
public

 
List

 
<

 
Layer

 
>

 
Layers

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
} 
} ë
ôD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayerRuleCreateViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class $
LayerRuleCreateViewModel )
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
ConditionGroupId &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
ConditionType #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
dynamic 
Editor 
{ 
get  #
;# $
set% (
;( )
}* +
}		 
}

 ¨	
óD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayerRuleEditViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class "
LayerRuleEditViewModel '
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
ConditionGroupId &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
ConditionId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
ConditionType #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public		 
dynamic		 
Editor		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
}

 
} Æ
óD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayerSettingsViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class "
LayerSettingsViewModel '
{ 
public 
string 
Zones 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ¿
ïD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\LayersIndexViewModel.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class  
LayersIndexViewModel %
{ 
[		 	
	BindNever			 
]		 
public

 
string

 
[

 
]

 
Zones

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 	
	BindNever	 
] 
public 

Dictionary 
< 
string  
,  !
List" &
<& '
dynamic' .
>. /
>/ 0
Widgets1 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
=G H
newI L

DictionaryM W
<W X
stringX ^
,^ _
List` d
<d e
dynamice l
>l m
>m n
(n o
)o p
;p q
[ 	
	BindNever	 
] 
public 
List 
< 
Layer 
> 
Layers !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} §
éD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Layers\ViewModels\WidgetWrapper.cs
	namespace 	
OrchardCore
 
. 
Layers 
. 

ViewModels '
{ 
public 

class 
WidgetWrapper 
:  
ShapeViewModel! /
{ 
public		 
WidgetWrapper		 
(		 
)		 
:		  
base		! %
(		% &
$str		& 6
)		6 7
{

 	
} 	
public 
ContentItem 
Widget !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
IShape 
Content 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} 