√
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobDirectory.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

class 
BlobDirectory 
:  
IFileStoreEntry! 0
{ 
private 
readonly 
string 
_path  %
;% &
private 
readonly 
DateTime !
_lastModifiedUtc" 2
;2 3
private		 
readonly		 
string		 
_name		  %
;		% &
private

 
readonly

 
string

 
_directoryPath

  .
;

. /
public 
BlobDirectory 
( 
string #
path$ (
,( )
DateTime* 2
lastModifiedUtc3 B
)B C
{ 	
_path 
= 
path 
; 
_lastModifiedUtc 
= 
lastModifiedUtc .
;. /
_name 
= 
System 
. 
IO 
. 
Path "
." #
GetFileName# .
(. /
path/ 3
)3 4
;4 5
_directoryPath 
= 
_path "
." #
Length# )
>* +
_name, 1
.1 2
Length2 8
?9 :
_path; @
.@ A
	SubstringA J
(J K
$numK L
,L M
_pathN S
.S T
LengthT Z
-[ \
_name] b
.b c
Lengthc i
-j k
$numl m
)m n
:o p
$strq s
;s t
} 	
public 
string 
Path 
=> 
_path #
;# $
public 
string 
Name 
=> 
_name #
;# $
public 
string 
DirectoryPath #
=>$ &
_directoryPath' 5
;5 6
public 
long 
Length 
=> 
$num 
;  
public 
DateTime 
LastModifiedUtc '
=>( *
_lastModifiedUtc+ ;
;; <
public 
bool 
IsDirectory 
=>  "
true# '
;' (
}   
}!! ‚
ÖD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobFile.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

class 
BlobFile 
: 
IFileStoreEntry +
{ 
private 
readonly 
string 
_path  %
;% &
private 
readonly 
string 
_name  %
;% &
private		 
readonly		 
string		 
_directoryPath		  .
;		. /
private

 
readonly

 
long

 
?

 
_length

 &
;

& '
private 
readonly 
DateTimeOffset '
?' (
_lastModified) 6
;6 7
public 
BlobFile 
( 
string 
path #
,# $
long% )
?) *
length+ 1
,1 2
DateTimeOffset3 A
?A B
lastModifiedC O
)O P
{ 	
_path 
= 
path 
; 
_name 
= 
System 
. 
IO 
. 
Path "
." #
GetFileName# .
(. /
_path/ 4
)4 5
;5 6
if 
( 
_name 
== 
_path 
) 
{ 
_directoryPath 
=  
$str! #
;# $
} 
else 
{ 
_directoryPath 
=  
_path! &
.& '
	Substring' 0
(0 1
$num1 2
,2 3
_path4 9
.9 :
Length: @
-A B
_nameC H
.H I
LengthI O
-P Q
$numR S
)S T
;T U
} 
_length 
= 
length 
; 
_lastModified 
= 
lastModified (
;( )
} 	
public 
string 
Path 
=> 
_path #
;# $
public!! 
string!! 
Name!! 
=>!! 
_name!! #
;!!# $
public## 
string## 
DirectoryPath## #
=>##$ &
_directoryPath##' 5
;##5 6
public%% 
long%% 
Length%% 
=>%% 
_length%% %
.%%% &
GetValueOrDefault%%& 7
(%%7 8
)%%8 9
;%%9 :
public'' 
DateTime'' 
LastModifiedUtc'' '
=>''( *
_lastModified''+ 8
.''8 9
GetValueOrDefault''9 J
(''J K
)''K L
.''L M
UtcDateTime''M X
;''X Y
public)) 
bool)) 
IsDirectory)) 
=>))  "
false))# (
;))( )
}** 
}++ èˆ
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobFileStore.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public&& 

class&& 
BlobFileStore&& 
:&&  

IFileStore&&! +
{'' 
private(( 
const(( 
string(( $
_directoryMarkerFileName(( 5
=((6 7
$str((8 O
;((O P
private** 
readonly** 
BlobStorageOptions** +
_options**, 4
;**4 5
private++ 
readonly++ 
IClock++ 
_clock++  &
;++& '
private,, 
readonly,, 
BlobContainerClient,, ,
_blobContainer,,- ;
;,,; <
private-- 
readonly--  
IContentTypeProvider-- - 
_contentTypeProvider--. B
;--B C
private.. 
readonly.. 
string.. 
_basePrefix..  +
=.., -
null... 2
;..2 3
public00 
BlobFileStore00 
(00 
BlobStorageOptions00 /
options000 7
,007 8
IClock009 ?
clock00@ E
,00E F 
IContentTypeProvider00G [
contentTypeProvider00\ o
)00o p
{11 	
_options22 
=22 
options22 
;22 
_clock33 
=33 
clock33 
;33  
_contentTypeProvider44  
=44! "
contentTypeProvider44# 6
;446 7
_blobContainer66 
=66 
new66  
BlobContainerClient66! 4
(664 5
_options665 =
.66= >
ConnectionString66> N
,66N O
_options66P X
.66X Y
ContainerName66Y f
)66f g
;66g h
if88 
(88 
!88 
String88 
.88 
IsNullOrEmpty88 %
(88% &
_options88& .
.88. /
BasePath88/ 7
)887 8
)888 9
{99 
_basePrefix:: 
=:: 
NormalizePrefix:: -
(::- .
_options::. 6
.::6 7
BasePath::7 ?
)::? @
;::@ A
};; 
}<< 	
public>> 
async>> 
Task>> 
<>> 
IFileStoreEntry>> )
>>>) *
GetFileInfoAsync>>+ ;
(>>; <
string>>< B
path>>C G
)>>G H
{?? 	
var@@ 
blob@@ 
=@@ 
GetBlobReference@@ '
(@@' (
path@@( ,
)@@, -
;@@- .
ifBB 
(BB 
!BB 
awaitBB 
blobBB 
.BB 
ExistsAsyncBB '
(BB' (
)BB( )
)BB) *
{CC 
returnDD 
nullDD 
;DD 
}EE 
varGG 

propertiesGG 
=GG 
awaitGG "
blobGG# '
.GG' (
GetPropertiesAsyncGG( :
(GG: ;
)GG; <
;GG< =
returnII 
newII 
BlobFileII 
(II  
pathII  $
,II$ %

propertiesII& 0
.II0 1
ValueII1 6
.II6 7
ContentLengthII7 D
,IID E

propertiesIIF P
.IIP Q
ValueIIQ V
.IIV W
LastModifiedIIW c
)IIc d
;IId e
}JJ 	
publicLL 
asyncLL 
TaskLL 
<LL 
IFileStoreEntryLL )
>LL) *!
GetDirectoryInfoAsyncLL+ @
(LL@ A
stringLLA G
pathLLH L
)LLL M
{MM 	
ifNN 
(NN 
pathNN 
==NN 
StringNN 
.NN 
EmptyNN $
)NN$ %
{OO 
returnPP 
newPP 
BlobDirectoryPP (
(PP( )
pathPP) -
,PP- .
_clockPP/ 5
.PP5 6
UtcNowPP6 <
)PP< =
;PP= >
}QQ 
varSS 
blobDirectorySS 
=SS 
awaitSS  %%
GetBlobDirectoryReferenceSS& ?
(SS? @
pathSS@ D
)SSD E
;SSE F
ifUU 
(UU 
blobDirectoryUU 
!=UU  
nullUU! %
)UU% &
{VV 
returnWW 
newWW 
BlobDirectoryWW (
(WW( )
pathWW) -
,WW- .
_clockWW/ 5
.WW5 6
UtcNowWW6 <
)WW< =
;WW= >
}XX 
returnZZ 
nullZZ 
;ZZ 
}[[ 	
public\\ 
IAsyncEnumerable\\ 
<\\  
IFileStoreEntry\\  /
>\\/ 0$
GetDirectoryContentAsync\\1 I
(\\I J
string\\J P
path\\Q U
=\\V W
null\\X \
,\\\ ]
bool\\^ b!
includeSubDirectories\\c x
=\\y z
false	\\{ Ä
)
\\Ä Å
{]] 	
if^^ 
(^^ !
includeSubDirectories^^ %
)^^% &
{__ 
return`` (
GetDirectoryContentFlatAsync`` 3
(``3 4
path``4 8
)``8 9
;``9 :
}aa 
elsebb 
{cc 
returndd /
#GetDirectoryContentByHierarchyAsyncdd :
(dd: ;
pathdd; ?
)dd? @
;dd@ A
}ee 
}ff 	
privatehh 
asynchh 
IAsyncEnumerablehh &
<hh& '
IFileStoreEntryhh' 6
>hh6 7/
#GetDirectoryContentByHierarchyAsynchh8 [
(hh[ \
stringhh\ b
pathhhc g
=hhh i
nullhhj n
)hhn o
{ii 	
varjj 
prefixjj 
=jj 
thisjj 
.jj 
Combinejj %
(jj% &
_basePrefixjj& 1
,jj1 2
pathjj3 7
)jj7 8
;jj8 9
prefixkk 
=kk 
NormalizePrefixkk $
(kk$ %
prefixkk% +
)kk+ ,
;kk, -
varmm 
pagemm 
=mm 
_blobContainermm %
.mm% &$
GetBlobsByHierarchyAsyncmm& >
(mm> ?

BlobTraitsmm? I
.mmI J
MetadatammJ R
,mmR S

BlobStatesmmT ^
.mm^ _
Nonemm_ c
,mmc d
$strmme h
,mmh i
prefixmmj p
)mmp q
;mmq r
awaitoo 
foreachoo 
(oo 
varoo 
bloboo #
inoo$ &
pageoo' +
)oo+ ,
{pp 
ifqq 
(qq 
blobqq 
.qq 
IsPrefixqq !
)qq! "
{rr 
varss 

folderPathss "
=ss# $
blobss% )
.ss) *
Prefixss* 0
;ss0 1
iftt 
(tt 
!tt 
Stringtt 
.tt  
IsNullOrEmptytt  -
(tt- .
_basePrefixtt. 9
)tt9 :
)tt: ;
{uu 

folderPathvv "
=vv# $

folderPathvv% /
.vv/ 0
	Substringvv0 9
(vv9 :
_basePrefixvv: E
.vvE F
LengthvvF L
-vvM N
$numvvO P
)vvP Q
;vvQ R
}ww 

folderPathyy 
=yy  

folderPathyy! +
.yy+ ,
Trimyy, 0
(yy0 1
$charyy1 4
)yy4 5
;yy5 6
yieldzz 
returnzz  
newzz! $
BlobDirectoryzz% 2
(zz2 3

folderPathzz3 =
,zz= >
_clockzz? E
.zzE F
UtcNowzzF L
)zzL M
;zzM N
}{{ 
else|| 
{}} 
var~~ 
itemName~~  
=~~! "
Path~~# '
.~~' (
GetFileName~~( 3
(~~3 4

WebUtility~~4 >
.~~> ?
	UrlDecode~~? H
(~~H I
blob~~I M
.~~M N
Blob~~N R
.~~R S
Name~~S W
)~~W X
)~~X Y
.~~Y Z
Trim~~Z ^
(~~^ _
$char~~_ b
)~~b c
;~~c d
if
ÄÄ 
(
ÄÄ 
itemName
ÄÄ  
!=
ÄÄ! #&
_directoryMarkerFileName
ÄÄ$ <
)
ÄÄ< =
{
ÅÅ 
var
ÇÇ 
itemPath
ÇÇ $
=
ÇÇ% &
this
ÇÇ' +
.
ÇÇ+ ,
Combine
ÇÇ, 3
(
ÇÇ3 4
path
ÇÇ4 8
?
ÇÇ8 9
.
ÇÇ9 :
Trim
ÇÇ: >
(
ÇÇ> ?
$char
ÇÇ? B
)
ÇÇB C
,
ÇÇC D
itemName
ÇÇE M
)
ÇÇM N
;
ÇÇN O
yield
ÉÉ 
return
ÉÉ $
new
ÉÉ% (
BlobFile
ÉÉ) 1
(
ÉÉ1 2
itemPath
ÉÉ2 :
,
ÉÉ: ;
blob
ÉÉ< @
.
ÉÉ@ A
Blob
ÉÉA E
.
ÉÉE F

Properties
ÉÉF P
.
ÉÉP Q
ContentLength
ÉÉQ ^
,
ÉÉ^ _
blob
ÉÉ` d
.
ÉÉd e
Blob
ÉÉe i
.
ÉÉi j

Properties
ÉÉj t
.
ÉÉt u
LastModifiedÉÉu Å
)ÉÉÅ Ç
;ÉÉÇ É
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 
}
áá 	
private
ââ 
async
ââ 
IAsyncEnumerable
ââ &
<
ââ& '
IFileStoreEntry
ââ' 6
>
ââ6 7*
GetDirectoryContentFlatAsync
ââ8 T
(
ââT U
string
ââU [
path
ââ\ `
=
ââa b
null
ââc g
)
ââg h
{
ää 	
var
åå 
directories
åå 
=
åå 
new
åå !
HashSet
åå" )
<
åå) *
string
åå* 0
>
åå0 1
(
åå1 2
)
åå2 3
;
åå3 4
var
éé 
prefix
éé 
=
éé 
this
éé 
.
éé 
Combine
éé %
(
éé% &
_basePrefix
éé& 1
,
éé1 2
path
éé3 7
)
éé7 8
;
éé8 9
prefix
èè 
=
èè 
NormalizePrefix
èè $
(
èè$ %
prefix
èè% +
)
èè+ ,
;
èè, -
var
ëë 
page
ëë 
=
ëë 
_blobContainer
ëë %
.
ëë% &
GetBlobsAsync
ëë& 3
(
ëë3 4

BlobTraits
ëë4 >
.
ëë> ?
Metadata
ëë? G
,
ëëG H

BlobStates
ëëI S
.
ëëS T
None
ëëT X
,
ëëX Y
prefix
ëëZ `
)
ëë` a
;
ëëa b
await
íí 
foreach
íí 
(
íí 
var
íí 
blob
íí #
in
íí$ &
page
íí' +
)
íí+ ,
{
ìì 
var
îî 
name
îî 
=
îî 

WebUtility
îî %
.
îî% &
	UrlDecode
îî& /
(
îî/ 0
blob
îî0 4
.
îî4 5
Name
îî5 9
)
îî9 :
;
îî: ;
var
ôô 
	directory
ôô 
=
ôô 
Path
ôô  $
.
ôô$ %
GetDirectoryName
ôô% 5
(
ôô5 6
name
ôô6 :
)
ôô: ;
;
ôô; <
if
õõ 
(
õõ 
!
õõ 
String
õõ 
.
õõ 
IsNullOrEmpty
õõ )
(
õõ) *
_basePrefix
õõ* 5
)
õõ5 6
)
õõ6 7
{
úú 
	directory
ùù 
=
ùù 
	directory
ùù  )
.
ùù) *
	Substring
ùù* 3
(
ùù3 4
_basePrefix
ùù4 ?
.
ùù? @
Length
ùù@ F
-
ùùG H
$num
ùùI J
)
ùùJ K
;
ùùK L
}
ûû 
if
†† 
(
†† 
!
†† 
String
†† 
.
†† 
IsNullOrEmpty
†† )
(
††) *
	directory
††* 3
)
††3 4
&&
††5 7
!
††8 9
directories
††9 D
.
††D E
Contains
††E M
(
††M N
	directory
††N W
)
††W X
&&
††Y [
(
††\ ]
String
††] c
.
††c d
IsNullOrEmpty
††d q
(
††q r
path
††r v
)
††v w
?
††x y
true
††z ~
:†† Ä
!††Å Ç
	directory††Ç ã
.††ã å
EndsWith††å î
(††î ï
path††ï ô
)††ô ö
)††ö õ
)††õ ú
{
°° 
directories
¢¢ 
.
¢¢  
Add
¢¢  #
(
¢¢# $
	directory
¢¢$ -
)
¢¢- .
;
¢¢. /
yield
££ 
return
££  
new
££! $
BlobDirectory
££% 2
(
££2 3
	directory
££3 <
,
££< =
_clock
££> D
.
££D E
UtcNow
££E K
)
££K L
;
££L M
}
§§ 
if
ßß 
(
ßß 
!
ßß 
name
ßß 
.
ßß 
EndsWith
ßß "
(
ßß" #&
_directoryMarkerFileName
ßß# ;
)
ßß; <
)
ßß< =
{
®® 
if
©© 
(
©© 
!
©© 
String
©© 
.
©©  
IsNullOrEmpty
©©  -
(
©©- .
_basePrefix
©©. 9
)
©©9 :
)
©©: ;
{
™™ 
name
´´ 
=
´´ 
name
´´ #
.
´´# $
	Substring
´´$ -
(
´´- .
_basePrefix
´´. 9
.
´´9 :
Length
´´: @
-
´´A B
$num
´´C D
)
´´D E
;
´´E F
}
¨¨ 
yield
≠≠ 
return
≠≠  
new
≠≠! $
BlobFile
≠≠% -
(
≠≠- .
name
≠≠. 2
.
≠≠2 3
Trim
≠≠3 7
(
≠≠7 8
$char
≠≠8 ;
)
≠≠; <
,
≠≠< =
blob
≠≠> B
.
≠≠B C

Properties
≠≠C M
.
≠≠M N
ContentLength
≠≠N [
,
≠≠[ \
blob
≠≠] a
.
≠≠a b

Properties
≠≠b l
.
≠≠l m
LastModified
≠≠m y
)
≠≠y z
;
≠≠z {
}
ÆÆ 
}
ØØ 
}
∞∞ 	
public
≤≤ 
async
≤≤ 
Task
≤≤ 
<
≤≤ 
bool
≤≤ 
>
≤≤ %
TryCreateDirectoryAsync
≤≤  7
(
≤≤7 8
string
≤≤8 >
path
≤≤? C
)
≤≤C D
{
≥≥ 	
var
∏∏ 
blobFile
∏∏ 
=
∏∏ 
GetBlobReference
∏∏ +
(
∏∏+ ,
path
∏∏, 0
)
∏∏0 1
;
∏∏1 2
if
∫∫ 
(
∫∫ 
await
∫∫ 
blobFile
∫∫ 
.
∫∫ 
ExistsAsync
∫∫ *
(
∫∫* +
)
∫∫+ ,
)
∫∫, -
{
ªª 
throw
ºº 
new
ºº  
FileStoreException
ºº ,
(
ºº, -
$"
ºº- /8
*Cannot create directory because the path '
ºº/ Y
{
ººY Z
path
ººZ ^
}
ºº^ _-
' already exists and is a file.
ºº_ ~
"
ºº~ 
)ºº Ä
;ººÄ Å
}
ΩΩ 
var
øø 
blobDirectory
øø 
=
øø 
await
øø  %'
GetBlobDirectoryReference
øø& ?
(
øø? @
path
øø@ D
)
øøD E
;
øøE F
if
¿¿ 
(
¿¿ 
blobDirectory
¿¿ 
==
¿¿  
null
¿¿! %
)
¿¿% &
{
¡¡ 
await
¬¬ "
CreateDirectoryAsync
¬¬ *
(
¬¬* +
path
¬¬+ /
)
¬¬/ 0
;
¬¬0 1
}
√√ 
return
≈≈ 
true
≈≈ 
;
≈≈ 
}
∆∆ 	
public
»» 
async
»» 
Task
»» 
<
»» 
bool
»» 
>
»»  
TryDeleteFileAsync
»»  2
(
»»2 3
string
»»3 9
path
»»: >
)
»»> ?
{
…… 	
var
   
blob
   
=
   
GetBlobReference
   '
(
  ' (
path
  ( ,
)
  , -
;
  - .
return
ÃÃ 
await
ÃÃ 
blob
ÃÃ 
.
ÃÃ !
DeleteIfExistsAsync
ÃÃ 1
(
ÃÃ1 2
)
ÃÃ2 3
;
ÃÃ3 4
}
ÕÕ 	
public
œœ 
async
œœ 
Task
œœ 
<
œœ 
bool
œœ 
>
œœ %
TryDeleteDirectoryAsync
œœ  7
(
œœ7 8
string
œœ8 >
path
œœ? C
)
œœC D
{
–– 	
if
—— 
(
—— 
String
—— 
.
—— 
IsNullOrEmpty
—— $
(
——$ %
path
——% )
)
——) *
)
——* +
{
““ 
throw
”” 
new
””  
FileStoreException
”” ,
(
””, -
$str
””- P
)
””P Q
;
””Q R
}
‘‘ 
var
÷÷ 
blobsWereDeleted
÷÷  
=
÷÷! "
false
÷÷# (
;
÷÷( )
var
◊◊ 
prefix
◊◊ 
=
◊◊ 
this
◊◊ 
.
◊◊ 
Combine
◊◊ %
(
◊◊% &
_basePrefix
◊◊& 1
,
◊◊1 2
path
◊◊3 7
)
◊◊7 8
;
◊◊8 9
prefix
ÿÿ 
=
ÿÿ 
this
ÿÿ 
.
ÿÿ 
NormalizePrefix
ÿÿ )
(
ÿÿ) *
prefix
ÿÿ* 0
)
ÿÿ0 1
;
ÿÿ1 2
var
⁄⁄ 
page
⁄⁄ 
=
⁄⁄ 
_blobContainer
⁄⁄ %
.
⁄⁄% &
GetBlobsAsync
⁄⁄& 3
(
⁄⁄3 4

BlobTraits
⁄⁄4 >
.
⁄⁄> ?
Metadata
⁄⁄? G
,
⁄⁄G H

BlobStates
⁄⁄I S
.
⁄⁄S T
None
⁄⁄T X
,
⁄⁄X Y
prefix
⁄⁄Z `
)
⁄⁄` a
;
⁄⁄a b
await
€€ 
foreach
€€ 
(
€€ 
var
€€ 
blob
€€ #
in
€€$ &
page
€€' +
)
€€+ ,
{
‹‹ 
var
›› 
blobReference
›› !
=
››" #
_blobContainer
››$ 2
.
››2 3
GetBlobClient
››3 @
(
››@ A
blob
››A E
.
››E F
Name
››F J
)
››J K
;
››K L
await
ﬁﬁ 
blobReference
ﬁﬁ #
.
ﬁﬁ# $!
DeleteIfExistsAsync
ﬁﬁ$ 7
(
ﬁﬁ7 8#
DeleteSnapshotsOption
ﬁﬁ8 M
.
ﬁﬁM N
IncludeSnapshots
ﬁﬁN ^
)
ﬁﬁ^ _
;
ﬁﬁ_ `
blobsWereDeleted
ﬂﬂ  
=
ﬂﬂ! "
true
ﬂﬂ# '
;
ﬂﬂ' (
}
‡‡ 
return
‚‚ 
blobsWereDeleted
‚‚ #
;
‚‚# $
}
„„ 	
public
ÂÂ 
async
ÂÂ 
Task
ÂÂ 
MoveFileAsync
ÂÂ '
(
ÂÂ' (
string
ÂÂ( .
oldPath
ÂÂ/ 6
,
ÂÂ6 7
string
ÂÂ8 >
newPath
ÂÂ? F
)
ÂÂF G
{
ÊÊ 	
await
ÁÁ 
CopyFileAsync
ÁÁ 
(
ÁÁ  
oldPath
ÁÁ  '
,
ÁÁ' (
newPath
ÁÁ) 0
)
ÁÁ0 1
;
ÁÁ1 2
await
ËË  
TryDeleteFileAsync
ËË $
(
ËË$ %
oldPath
ËË% ,
)
ËË, -
;
ËË- .
}
ÈÈ 	
public
ÎÎ 
async
ÎÎ 
Task
ÎÎ 
CopyFileAsync
ÎÎ '
(
ÎÎ' (
string
ÎÎ( .
srcPath
ÎÎ/ 6
,
ÎÎ6 7
string
ÎÎ8 >
dstPath
ÎÎ? F
)
ÎÎF G
{
ÏÏ 	
if
ÌÌ 
(
ÌÌ 
srcPath
ÌÌ 
==
ÌÌ 
dstPath
ÌÌ "
)
ÌÌ" #
{
ÓÓ 
throw
ÔÔ 
new
ÔÔ 
ArgumentException
ÔÔ +
(
ÔÔ+ ,
$"
ÔÔ, .
The values for 
ÔÔ. =
{
ÔÔ= >
nameof
ÔÔ> D
(
ÔÔD E
srcPath
ÔÔE L
)
ÔÔL M
}
ÔÔM N
 and 
ÔÔN S
{
ÔÔS T
nameof
ÔÔT Z
(
ÔÔZ [
dstPath
ÔÔ[ b
)
ÔÔb c
}
ÔÔc d$
 must not be the same.
ÔÔd z
"
ÔÔz {
)
ÔÔ{ |
;
ÔÔ| }
}
 
var
ÚÚ 
oldBlob
ÚÚ 
=
ÚÚ 
GetBlobReference
ÚÚ *
(
ÚÚ* +
srcPath
ÚÚ+ 2
)
ÚÚ2 3
;
ÚÚ3 4
var
ÛÛ 
newBlob
ÛÛ 
=
ÛÛ 
GetBlobReference
ÛÛ *
(
ÛÛ* +
dstPath
ÛÛ+ 2
)
ÛÛ2 3
;
ÛÛ3 4
if
ıı 
(
ıı 
!
ıı 
await
ıı 
oldBlob
ıı 
.
ıı 
ExistsAsync
ıı *
(
ıı* +
)
ıı+ ,
)
ıı, -
{
ˆˆ 
throw
˜˜ 
new
˜˜  
FileStoreException
˜˜ ,
(
˜˜, -
$"
˜˜- / 
Cannot copy file '
˜˜/ A
{
˜˜A B
srcPath
˜˜B I
}
˜˜I J*
' because it does not exist.
˜˜J f
"
˜˜f g
)
˜˜g h
;
˜˜h i
}
¯¯ 
if
˙˙ 
(
˙˙ 
await
˙˙ 
newBlob
˙˙ 
.
˙˙ 
ExistsAsync
˙˙ )
(
˙˙) *
)
˙˙* +
)
˙˙+ ,
{
˚˚ 
throw
¸¸ 
new
¸¸  
FileStoreException
¸¸ ,
(
¸¸, -
$"
¸¸- / 
Cannot copy file '
¸¸/ A
{
¸¸A B
srcPath
¸¸B I
}
¸¸I J?
1' because a file already exists in the new path '
¸¸J {
{
¸¸{ |
dstPath¸¸| É
}¸¸É Ñ
'.¸¸Ñ Ü
"¸¸Ü á
)¸¸á à
;¸¸à â
}
˝˝ 
await
ˇˇ 
newBlob
ˇˇ 
.
ˇˇ #
StartCopyFromUriAsync
ˇˇ /
(
ˇˇ/ 0
oldBlob
ˇˇ0 7
.
ˇˇ7 8
Uri
ˇˇ8 ;
)
ˇˇ; <
;
ˇˇ< =
await
ÅÅ 
Task
ÅÅ 
.
ÅÅ 
Delay
ÅÅ 
(
ÅÅ 
$num
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
var
ÇÇ 

properties
ÇÇ 
=
ÇÇ 
await
ÇÇ "
newBlob
ÇÇ# *
.
ÇÇ* + 
GetPropertiesAsync
ÇÇ+ =
(
ÇÇ= >
)
ÇÇ> ?
;
ÇÇ? @
while
ÑÑ 
(
ÑÑ 

properties
ÑÑ 
.
ÑÑ 
Value
ÑÑ #
.
ÑÑ# $

CopyStatus
ÑÑ$ .
==
ÑÑ/ 1

CopyStatus
ÑÑ2 <
.
ÑÑ< =
Pending
ÑÑ= D
)
ÑÑD E
{
ÖÖ 
await
ÜÜ 
Task
ÜÜ 
.
ÜÜ 
Delay
ÜÜ  
(
ÜÜ  !
$num
ÜÜ! $
)
ÜÜ$ %
;
ÜÜ% &

properties
àà 
=
àà 
await
àà "
newBlob
àà# *
.
àà* + 
GetPropertiesAsync
àà+ =
(
àà= >
)
àà> ?
;
àà? @
}
ââ 
if
ãã 
(
ãã 

properties
ãã 
.
ãã 
Value
ãã  
.
ãã  !

CopyStatus
ãã! +
!=
ãã, .

CopyStatus
ãã/ 9
.
ãã9 :
Success
ãã: A
)
ããA B
{
åå 
throw
çç 
new
çç  
FileStoreException
çç ,
(
çç, -
$"
çç- /(
Error while copying file '
çç/ I
{
ççI J
srcPath
ççJ Q
}
ççQ R3
%'; copy operation failed with status 
ççR w
{
ççw x

propertiesççx Ç
.ççÇ É
ValueççÉ à
.ççà â

CopyStatusççâ ì
}ççì î!
 and description ççî •
{çç• ¶

propertiesçç¶ ∞
.çç∞ ±
Valueçç± ∂
.çç∂ ∑%
CopyStatusDescriptionçç∑ Ã
}ççÃ Õ
.ççÕ Œ
"ççŒ œ
)ççœ –
;çç– —
}
éé 
}
èè 	
public
ëë 
async
ëë 
Task
ëë 
<
ëë 
Stream
ëë  
>
ëë  ! 
GetFileStreamAsync
ëë" 4
(
ëë4 5
string
ëë5 ;
path
ëë< @
)
ëë@ A
{
íí 	
var
ìì 
blob
ìì 
=
ìì 
GetBlobReference
ìì '
(
ìì' (
path
ìì( ,
)
ìì, -
;
ìì- .
if
ïï 
(
ïï 
!
ïï 
await
ïï 
blob
ïï 
.
ïï 
ExistsAsync
ïï '
(
ïï' (
)
ïï( )
)
ïï) *
{
ññ 
throw
óó 
new
óó  
FileStoreException
óó ,
(
óó, -
$"
óó- /7
)Cannot get file stream because the file '
óó/ X
{
óóX Y
path
óóY ]
}
óó] ^
' does not exist.
óó^ o
"
óóo p
)
óóp q
;
óóq r
}
òò 
return
öö 
(
öö 
await
öö 
blob
öö 
.
öö 
DownloadAsync
öö ,
(
öö, -
)
öö- .
)
öö. /
.
öö/ 0
Value
öö0 5
.
öö5 6
Content
öö6 =
;
öö= >
}
õõ 	
public
üü 
Task
üü 
<
üü 
Stream
üü 
>
üü  
GetFileStreamAsync
üü .
(
üü. /
IFileStoreEntry
üü/ >
fileStoreEntry
üü? M
)
üüM N
{
†† 	
return
°°  
GetFileStreamAsync
°° %
(
°°% &
fileStoreEntry
°°& 4
.
°°4 5
Path
°°5 9
)
°°9 :
;
°°: ;
}
¢¢ 	
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
string
§§  
>
§§  !'
CreateFileFromStreamAsync
§§" ;
(
§§; <
string
§§< B
path
§§C G
,
§§G H
Stream
§§I O
inputStream
§§P [
,
§§[ \
bool
§§] a
	overwrite
§§b k
=
§§l m
false
§§n s
)
§§s t
{
•• 	
var
¶¶ 
blob
¶¶ 
=
¶¶ 
GetBlobReference
¶¶ '
(
¶¶' (
path
¶¶( ,
)
¶¶, -
;
¶¶- .
if
®® 
(
®® 
!
®® 
	overwrite
®® 
&&
®® 
await
®® #
blob
®®$ (
.
®®( )
ExistsAsync
®®) 4
(
®®4 5
)
®®5 6
)
®®6 7
{
©© 
throw
™™ 
new
™™  
FileStoreException
™™ ,
(
™™, -
$"
™™- /"
Cannot create file '
™™/ C
{
™™C D
path
™™D H
}
™™H I*
' because it already exists.
™™I e
"
™™e f
)
™™f g
;
™™g h
}
´´ "
_contentTypeProvider
≠≠  
.
≠≠  !
TryGetContentType
≠≠! 2
(
≠≠2 3
path
≠≠3 7
,
≠≠7 8
out
≠≠9 <
var
≠≠= @
contentType
≠≠A L
)
≠≠L M
;
≠≠M N
var
ØØ 
headers
ØØ 
=
ØØ 
new
ØØ 
BlobHttpHeaders
ØØ -
{
∞∞ 
ContentType
±± 
=
±± 
contentType
±± )
??
±±* ,
$str
±±- G
}
≤≤ 
;
≤≤ 
await
¥¥ 
blob
¥¥ 
.
¥¥ 
UploadAsync
¥¥ "
(
¥¥" #
inputStream
¥¥# .
,
¥¥. /
headers
¥¥0 7
)
¥¥7 8
;
¥¥8 9
return
∂∂ 
path
∂∂ 
;
∂∂ 
}
∑∑ 	
private
ππ 

BlobClient
ππ 
GetBlobReference
ππ +
(
ππ+ ,
string
ππ, 2
path
ππ3 7
)
ππ7 8
{
∫∫ 	
var
ªª 
blobPath
ªª 
=
ªª 
this
ªª 
.
ªª  
Combine
ªª  '
(
ªª' (
_options
ªª( 0
.
ªª0 1
BasePath
ªª1 9
,
ªª9 :
path
ªª; ?
)
ªª? @
;
ªª@ A
var
ºº 
blob
ºº 
=
ºº 
_blobContainer
ºº %
.
ºº% &
GetBlobClient
ºº& 3
(
ºº3 4
blobPath
ºº4 <
)
ºº< =
;
ºº= >
return
ææ 
blob
ææ 
;
ææ 
}
øø 	
private
¡¡ 
async
¡¡ 
Task
¡¡ 
<
¡¡ 
BlobHierarchyItem
¡¡ ,
>
¡¡, -'
GetBlobDirectoryReference
¡¡. G
(
¡¡G H
string
¡¡H N
path
¡¡O S
)
¡¡S T
{
¬¬ 	
var
√√ 
prefix
√√ 
=
√√ 
this
√√ 
.
√√ 
Combine
√√ %
(
√√% &
_basePrefix
√√& 1
,
√√1 2
path
√√3 7
)
√√7 8
;
√√8 9
prefix
ƒƒ 
=
ƒƒ 
NormalizePrefix
ƒƒ $
(
ƒƒ$ %
prefix
ƒƒ% +
)
ƒƒ+ ,
;
ƒƒ, -
var
«« 
page
«« 
=
«« 
_blobContainer
«« %
.
««% &&
GetBlobsByHierarchyAsync
««& >
(
««> ?

BlobTraits
««? I
.
««I J
Metadata
««J R
,
««R S

BlobStates
««T ^
.
««^ _
None
««_ c
,
««c d
$str
««e h
,
««h i
prefix
««j p
)
««p q
;
««q r
var
…… 

enumerator
…… 
=
…… 
page
…… !
.
……! " 
GetAsyncEnumerator
……" 4
(
……4 5
)
……5 6
;
……6 7
var
ÀÀ 
result
ÀÀ 
=
ÀÀ 
await
ÀÀ 

enumerator
ÀÀ )
.
ÀÀ) *
MoveNextAsync
ÀÀ* 7
(
ÀÀ7 8
)
ÀÀ8 9
;
ÀÀ9 :
if
ÃÃ 
(
ÃÃ 
result
ÃÃ 
)
ÃÃ 
{
ÕÕ 
return
ŒŒ 

enumerator
ŒŒ !
.
ŒŒ! "
Current
ŒŒ" )
;
ŒŒ) *
}
œœ 
return
—— 
null
—— 
;
—— 
}
““ 	
private
‘‘ 
async
‘‘ 
Task
‘‘ "
CreateDirectoryAsync
‘‘ /
(
‘‘/ 0
string
‘‘0 6
path
‘‘7 ;
)
‘‘; <
{
’’ 	
var
÷÷ 
placeholderBlob
÷÷ 
=
÷÷  !
GetBlobReference
÷÷" 2
(
÷÷2 3
this
÷÷3 7
.
÷÷7 8
Combine
÷÷8 ?
(
÷÷? @
path
÷÷@ D
,
÷÷D E&
_directoryMarkerFileName
÷÷F ^
)
÷÷^ _
)
÷÷_ `
;
÷÷` a
using
ŸŸ 
(
ŸŸ 
var
ŸŸ 
stream
ŸŸ 
=
ŸŸ 
new
ŸŸ  #
MemoryStream
ŸŸ$ 0
(
ŸŸ0 1
Encoding
ŸŸ1 9
.
ŸŸ9 :
UTF8
ŸŸ: >
.
ŸŸ> ?
GetBytes
ŸŸ? G
(
ŸŸG H
$strŸŸH õ
)ŸŸõ ú
)ŸŸú ù
)ŸŸù û
{
⁄⁄ 
await
€€ 
placeholderBlob
€€ %
.
€€% &
UploadAsync
€€& 1
(
€€1 2
stream
€€2 8
)
€€8 9
;
€€9 :
}
‹‹ 
}
›› 	
private
‚‚ 
string
‚‚ 
NormalizePrefix
‚‚ &
(
‚‚& '
string
‚‚' -
prefix
‚‚. 4
)
‚‚4 5
{
„„ 	
prefix
‰‰ 
=
‰‰ 
prefix
‰‰ 
.
‰‰ 
Trim
‰‰  
(
‰‰  !
$char
‰‰! $
)
‰‰$ %
+
‰‰& '
$char
‰‰( +
;
‰‰+ ,
if
ÂÂ 
(
ÂÂ 
prefix
ÂÂ 
.
ÂÂ 
Length
ÂÂ 
==
ÂÂ  
$num
ÂÂ! "
)
ÂÂ" #
{
ÊÊ 
return
ÁÁ 
String
ÁÁ 
.
ÁÁ 
Empty
ÁÁ #
;
ÁÁ# $
}
ËË 
else
ÈÈ 
{
ÍÍ 
return
ÎÎ 
prefix
ÎÎ 
;
ÎÎ 
}
ÏÏ 
}
ÌÌ 	
}
ÓÓ 
}ÔÔ Ñ
èD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore\OrchardCore.FileStorage.AzureBlob\BlobStorageOptions.cs
	namespace 	
OrchardCore
 
. 
FileStorage !
.! "
	AzureBlob" +
{ 
public 

abstract 
class 
BlobStorageOptions ,
{ 
public 
string 
ConnectionString &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
ContainerName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
BasePath 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 