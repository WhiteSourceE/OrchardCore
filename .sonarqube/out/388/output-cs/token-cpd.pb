ú'
D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\AdminMenu.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public		 

class		 
	AdminMenu		 
:		 
INavigationProvider		 0
{

 
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public 
	AdminMenu 
( 
IStringLocalizer )
<) *
	AdminMenu* 3
>3 4
	localizer5 >
)> ?
{ 	
S 
= 
	localizer 
; 
} 	
public 
Task  
BuildNavigationAsync (
(( )
string) /
name0 4
,4 5
NavigationBuilder6 G
builderH O
)O P
{ 	
if 
( 
! 
String 
. 
Equals 
( 
name #
,# $
$str% ,
,, -
StringComparison. >
.> ?
OrdinalIgnoreCase? P
)P Q
)Q R
{ 
return 
Task 
. 
CompletedTask )
;) *
} 
builder 
. 
Add 
( 
S 
[ 
$str 
]  
,  !
NavigationConstants" 5
.5 6#
AdminMenuSearchPosition6 M
,M N
searchO U
=>V X
searchY _
. 
AddClass 
( 
$str &
)& '
.' (
Id( *
(* +
$str+ 3
)3 4
. 
Add 
( 
S 
[ 
$str %
]% &
,& '
S( )
[) *
$str* 4
]4 5
.5 6
PrefixPosition6 D
(D E
)E F
,F G
importH N
=>O Q
importR X
. 
Add 
( 
S 
[ 
$str /
]/ 0
,0 1
S2 3
[3 4
$str4 D
]D E
.E F
PrefixPositionF T
(T U
)U V
,V W
indexesX _
=>` b
indexesc j
. 
Action #
(# $
$str$ +
,+ ,
$str- 4
,4 5
new6 9
{: ;
area< @
=A B
$strC W
}X Y
)Y Z
. 

Permission '
(' (
Permissions( 3
.3 4
ManageIndexes4 A
)A B
.   
LocalNav   %
(  % &
)  & '
)  ' (
.!! 
Add!! 
(!! 
S!! 
[!! 
$str!! 1
]!!1 2
,!!2 3
S!!4 5
[!!5 6
$str!!6 H
]!!H I
.!!I J
PrefixPosition!!J X
(!!X Y
)!!Y Z
,!!Z [
queries!!\ c
=>!!d f
queries!!g n
."" 
Action"" #
(""# $
$str""$ +
,""+ ,
$str""- 4
,""4 5
new""6 9
{"": ;
area""< @
=""A B
$str""C W
}""X Y
)""Y Z
.## 

Permission## '
(##' (
Permissions##( 3
.##3 4
ManageIndexes##4 A
)##A B
.$$ 
LocalNav$$ %
($$% &
)$$& '
)$$' (
)$$( )
.%% 
Add%% 
(%% 
S%% 
[%% 
$str%% %
]%%% &
,%%& '
settings%%( 0
=>%%1 3
settings%%4 <
.&& 
Add&& 
(&& 
S&& 
[&& 
$str&& '
]&&' (
,&&( )
S&&* +
[&&+ ,
$str&&, 4
]&&4 5
.&&5 6
PrefixPosition&&6 D
(&&D E
)&&E F
,&&F G
entry&&H M
=>&&N P
entry&&Q V
.'' 
Action'' $
(''$ %
$str''% ,
,'', -
$str''. 5
,''5 6
new''7 :
{''; <
area''= A
=''B C
$str''D Z
,''Z [
groupId''\ c
=''d e(
LuceneSettingsDisplayDriver	''f Å
.
''Å Ç
GroupId
''Ç â
}
''ä ã
)
''ã å
.(( 

Permission(( (
(((( )
Permissions(() 4
.((4 5
ManageIndexes((5 B
)((B C
.)) 
LocalNav)) &
())& '
)))' (
)** 
)** 
)** 
;** 
return,, 
Task,, 
.,, 
CompletedTask,, %
;,,% &
}-- 	
}.. 
}// ÎÇ
ëD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Controllers\AdminController.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Controllers (
{   
public!! 

class!! 
AdminController!!  
:!!! "

Controller!!# -
{"" 
private## 
readonly## 
ISession## !
_session##" *
;##* +
private$$ 
readonly$$ 
LuceneIndexManager$$ +
_luceneIndexManager$$, ?
;$$? @
private%% 
readonly%% !
LuceneIndexingService%% ."
_luceneIndexingService%%/ E
;%%E F
private&& 
readonly&& !
IAuthorizationService&& .!
_authorizationService&&/ D
;&&D E
private'' 
readonly'' 
	INotifier'' "
	_notifier''# ,
;'', -
private(( 
readonly(( !
LuceneAnalyzerManager(( ."
_luceneAnalyzerManager((/ E
;((E F
private)) 
readonly)) &
LuceneIndexSettingsService)) 3'
_luceneIndexSettingsService))4 O
;))O P
private** 
readonly** 
ILuceneQueryService** ,
_queryService**- :
;**: ;
private++ 
readonly++ "
ILiquidTemplateManager++ /"
_liquidTemplateManager++0 F
;++F G
private,, 
readonly,, %
IContentDefinitionManager,, 2%
_contentDefinitionManager,,3 L
;,,L M
private-- 
readonly-- 
ISiteService-- %
_siteService--& 2
;--2 3
private.. 
readonly.. 
dynamic..  
New..! $
;..$ %
private// 
readonly// 
JavaScriptEncoder// *
_javaScriptEncoder//+ =
;//= >
private00 
readonly00 
IStringLocalizer00 )
S00* +
;00+ ,
private11 
readonly11 
IHtmlLocalizer11 '
H11( )
;11) *
private22 
readonly22 
ILogger22  
_logger22! (
;22( )
public44 
AdminController44 
(44 
ISession55 
session55 
,55 %
IContentDefinitionManager66 %$
contentDefinitionManager66& >
,66> ?
LuceneIndexManager77 
luceneIndexManager77 1
,771 2!
LuceneIndexingService88 !!
luceneIndexingService88" 7
,887 8!
IAuthorizationService99 ! 
authorizationService99" 6
,996 7!
LuceneAnalyzerManager:: !!
luceneAnalyzerManager::" 7
,::7 8&
LuceneIndexSettingsService;; &&
luceneIndexSettingsService;;' A
,;;A B
ILuceneQueryService<< 
queryService<<  ,
,<<, -"
ILiquidTemplateManager== "!
liquidTemplateManager==# 8
,==8 9
	INotifier>> 
notifier>> 
,>> 
ISiteService?? 
siteService?? $
,??$ %
IShapeFactory@@ 
shapeFactory@@ &
,@@& '
JavaScriptEncoderAA 
javaScriptEncoderAA /
,AA/ 0
IStringLocalizerBB 
<BB 
AdminControllerBB ,
>BB, -
stringLocalizerBB. =
,BB= >
IHtmlLocalizerCC 
<CC 
AdminControllerCC *
>CC* +
htmlLocalizerCC, 9
,CC9 :
ILoggerDD 
<DD 
AdminControllerDD #
>DD# $
loggerDD% +
)DD+ ,
{EE 	
_sessionFF 
=FF 
sessionFF 
;FF 
_luceneIndexManagerGG 
=GG  !
luceneIndexManagerGG" 4
;GG4 5"
_luceneIndexingServiceHH "
=HH# $!
luceneIndexingServiceHH% :
;HH: ;!
_authorizationServiceII !
=II" # 
authorizationServiceII$ 8
;II8 9"
_luceneAnalyzerManagerJJ "
=JJ# $!
luceneAnalyzerManagerJJ% :
;JJ: ;'
_luceneIndexSettingsServiceKK '
=KK( )&
luceneIndexSettingsServiceKK* D
;KKD E
_queryServiceLL 
=LL 
queryServiceLL (
;LL( )"
_liquidTemplateManagerMM "
=MM# $!
liquidTemplateManagerMM% :
;MM: ;%
_contentDefinitionManagerNN %
=NN& '$
contentDefinitionManagerNN( @
;NN@ A
	_notifierOO 
=OO 
notifierOO  
;OO  !
_siteServicePP 
=PP 
siteServicePP &
;PP& '
NewRR 
=RR 
shapeFactoryRR 
;RR 
_javaScriptEncoderSS 
=SS  
javaScriptEncoderSS! 2
;SS2 3
STT 
=TT 
stringLocalizerTT 
;TT  
HUU 
=UU 
htmlLocalizerUU 
;UU 
_loggerVV 
=VV 
loggerVV 
;VV 
}WW 	
publicYY 
asyncYY 
TaskYY 
<YY 
IActionResultYY '
>YY' (
IndexYY) .
(YY. /
ContentOptionsYY/ =
optionsYY> E
,YYE F
PagerParametersYYG V
pagerParametersYYW f
)YYf g
{ZZ 	
if[[ 
([[ 
![[ 
await[[ !
_authorizationService[[ ,
.[[, -
AuthorizeAsync[[- ;
([[; <
User[[< @
,[[@ A
Permissions[[B M
.[[M N
ManageIndexes[[N [
)[[[ \
)[[\ ]
{\\ 
return]] 
Forbid]] 
(]] 
)]] 
;]]  
}^^ 
var`` 
indexes`` 
=`` 
(`` 
await``  '
_luceneIndexSettingsService``! <
.``< =
GetSettingsAsync``= M
(``M N
)``N O
)``O P
.``P Q
Select``Q W
(``W X
i``X Y
=>``Z \
new``] `
IndexViewModel``a o
{``p q
Name``r v
=``w x
i``y z
.``z {
	IndexName	``{ Ñ
}
``Ö Ü
)
``Ü á
;
``á à
varbb 
siteSettingsbb 
=bb 
awaitbb $
_siteServicebb% 1
.bb1 2 
GetSiteSettingsAsyncbb2 F
(bbF G
)bbG H
;bbH I
varcc 
pagercc 
=cc 
newcc 
Pagercc !
(cc! "
pagerParameterscc" 1
,cc1 2
siteSettingscc3 ?
.cc? @
PageSizecc@ H
)ccH I
;ccI J
vardd 
countdd 
=dd 
indexesdd 
.dd  
Countdd  %
(dd% &
)dd& '
;dd' (
varee 
resultsee 
=ee 
indexesee !
;ee! "
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrWhiteSpacegg *
(gg* +
optionsgg+ 2
.gg2 3
Searchgg3 9
)gg9 :
)gg: ;
{hh 
resultsii 
=ii 
resultsii !
.ii! "
Whereii" '
(ii' (
qii( )
=>ii* ,
qii- .
.ii. /
Nameii/ 3
.ii3 4
IndexOfii4 ;
(ii; <
optionsii< C
.iiC D
SearchiiD J
,iiJ K
StringComparisoniiL \
.ii\ ]
OrdinalIgnoreCaseii] n
)iin o
>=iip r
$numiis t
)iit u
;iiu v
}jj 
resultsll 
=ll 
resultsll 
.mm 
Skipmm 
(mm 
pagermm 
.mm 
GetStartIndexmm )
(mm) *
)mm* +
)mm+ ,
.nn 
Takenn 
(nn 
pagernn 
.nn 
PageSizenn $
)nn$ %
.nn% &
ToListnn& ,
(nn, -
)nn- .
;nn. /
varqq 
	routeDataqq 
=qq 
newqq 
	RouteDataqq  )
(qq) *
)qq* +
;qq+ ,
varrr 

pagerShaperr 
=rr 
(rr 
awaitrr #
Newrr$ '
.rr' (
Pagerrr( -
(rr- .
pagerrr. 3
)rr3 4
)rr4 5
.rr5 6
TotalItemCountrr6 D
(rrD E
countrrE J
)rrJ K
.rrK L
	RouteDatarrL U
(rrU V
	routeDatarrV _
)rr_ `
;rr` a
vartt 
modeltt 
=tt 
newtt 
AdminIndexViewModeltt /
{uu 
Indexesvv 
=vv 
resultsvv !
,vv! "
Optionsww 
=ww 
optionsww !
,ww! "
Pagerxx 
=xx 

pagerShapexx "
}yy 
;yy 
model{{ 
.{{ 
Options{{ 
.{{ 
ContentsBulkAction{{ ,
={{- .
new{{/ 2
List{{3 7
<{{7 8
SelectListItem{{8 F
>{{F G
({{G H
){{H I
{{{J K
new|| 
SelectListItem|| "
(||" #
)||# $
{||% &
Text||' +
=||, -
S||. /
[||/ 0
$str||0 7
]||7 8
,||8 9
Value||: ?
=||@ A
nameof||B H
(||H I
ContentsBulkAction||I [
.||[ \
Reset||\ a
)||a b
}||c d
,||d e
new}} 
SelectListItem}} "
(}}" #
)}}# $
{}}% &
Text}}' +
=}}, -
S}}. /
[}}/ 0
$str}}0 9
]}}9 :
,}}: ;
Value}}< A
=}}B C
nameof}}D J
(}}J K
ContentsBulkAction}}K ]
.}}] ^
Rebuild}}^ e
)}}e f
}}}g h
,}}h i
new~~ 
SelectListItem~~ "
(~~" #
)~~# $
{~~% &
Text~~' +
=~~, -
S~~. /
[~~/ 0
$str~~0 8
]~~8 9
,~~9 :
Value~~; @
=~~A B
nameof~~C I
(~~I J
ContentsBulkAction~~J \
.~~\ ]
Remove~~] c
)~~c d
}~~e f
} 
; 
return
ÅÅ 
View
ÅÅ 
(
ÅÅ 
model
ÅÅ 
)
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
[
ÑÑ 	
HttpPost
ÑÑ	 
,
ÑÑ 

ActionName
ÑÑ 
(
ÑÑ 
$str
ÑÑ %
)
ÑÑ% &
]
ÑÑ& '
[
ÖÖ 	
FormValueRequired
ÖÖ	 
(
ÖÖ 
$str
ÖÖ *
)
ÖÖ* +
]
ÖÖ+ ,
public
ÜÜ 
ActionResult
ÜÜ 
IndexFilterPOST
ÜÜ +
(
ÜÜ+ ,!
AdminIndexViewModel
ÜÜ, ?
model
ÜÜ@ E
)
ÜÜE F
{
áá 	
return
àà 
RedirectToAction
àà #
(
àà# $
$str
àà$ +
,
àà+ ,
new
àà- 0"
RouteValueDictionary
àà1 E
{
ààF G
{
ââ 
$str
ââ "
,
ââ" #
model
ââ$ )
.
ââ) *
Options
ââ* 1
.
ââ1 2
Search
ââ2 8
}
ââ9 :
}
ää 
)
ää 
;
ää 
}
ãã 	
public
çç 
async
çç 
Task
çç 
<
çç 
ActionResult
çç &
>
çç& '
Edit
çç( ,
(
çç, -
string
çç- 3
	indexName
çç4 =
=
çç> ?
null
çç@ D
)
ççD E
{
éé 	
var
èè 
IsCreate
èè 
=
èè 
String
èè !
.
èè! " 
IsNullOrWhiteSpace
èè" 4
(
èè4 5
	indexName
èè5 >
)
èè> ?
;
èè? @
var
êê 
settings
êê 
=
êê 
new
êê !
LuceneIndexSettings
êê 2
(
êê2 3
)
êê3 4
;
êê4 5
if
íí 
(
íí 
!
íí 
await
íí #
_authorizationService
íí ,
.
íí, -
AuthorizeAsync
íí- ;
(
íí; <
User
íí< @
,
íí@ A
Permissions
ííB M
.
ííM N
ManageIndexes
ííN [
)
íí[ \
)
íí\ ]
{
ìì 
return
îî 
Forbid
îî 
(
îî 
)
îî 
;
îî  
}
ïï 
if
óó 
(
óó 
!
óó 
IsCreate
óó 
)
óó 
{
òò 
settings
ôô 
=
ôô 
await
ôô  )
_luceneIndexSettingsService
ôô! <
.
ôô< =
GetSettingsAsync
ôô= M
(
ôôM N
	indexName
ôôN W
)
ôôW X
;
ôôX Y
if
õõ 
(
õõ 
settings
õõ 
==
õõ 
null
õõ  $
)
õõ$ %
{
úú 
return
ùù 
NotFound
ùù #
(
ùù# $
)
ùù$ %
;
ùù% &
}
ûû 
}
üü 
var
°° 
model
°° 
=
°° 
new
°° *
LuceneIndexSettingsViewModel
°° 8
{
¢¢ 
IsCreate
££ 
=
££ 
IsCreate
££ #
,
££# $
	IndexName
§§ 
=
§§ 
IsCreate
§§ $
?
§§% &
$str
§§' )
:
§§* +
settings
§§, 4
.
§§4 5
	IndexName
§§5 >
,
§§> ?
AnalyzerName
•• 
=
•• 
IsCreate
•• '
?
••( )
$str
••* <
:
••= >
settings
••? G
.
••G H
AnalyzerName
••H T
,
••T U
IndexLatest
¶¶ 
=
¶¶ 
settings
¶¶ &
.
¶¶& '
IndexLatest
¶¶' 2
,
¶¶2 3
Culture
ßß 
=
ßß 
settings
ßß "
.
ßß" #
Culture
ßß# *
,
ßß* +
Cultures
®® 
=
®® 
CultureInfo
®® &
.
®®& '
GetCultures
®®' 2
(
®®2 3
CultureTypes
®®3 ?
.
®®? @
AllCultures
®®@ K
)
®®K L
.
©© 
Select
©© 
(
©© 
x
©© 
=>
©©  
new
©©! $
SelectListItem
©©% 3
{
©©4 5
Text
©©6 :
=
©©; <
x
©©= >
.
©©> ?
Name
©©? C
+
©©D E
$str
©©F J
+
©©K L
x
©©M N
.
©©N O
DisplayName
©©O Z
+
©©[ \
$str
©©] `
,
©©` a
Value
©©b g
=
©©h i
x
©©j k
.
©©k l
Name
©©l p
}
©©q r
)
©©r s
.
©©s t
Prepend
©©t {
(
©©{ |
new
©©| 
SelectListItem©©Ä é
{©©è ê
Text©©ë ï
=©©ñ ó
S©©ò ô
[©©ô ö
$str©©ö ß
]©©ß ®
,©©® ©
Value©©™ Ø
=©©∞ ±
$str©©≤ ∑
}©©∏ π
)©©π ∫
,©©∫ ª
	Analyzers
™™ 
=
™™ $
_luceneAnalyzerManager
™™ 2
.
™™2 3
GetAnalyzers
™™3 ?
(
™™? @
)
™™@ A
.
´´ 
Select
´´ 
(
´´ 
x
´´ 
=>
´´  
new
´´! $
SelectListItem
´´% 3
{
´´4 5
Text
´´6 :
=
´´; <
x
´´= >
.
´´> ?
Name
´´? C
,
´´C D
Value
´´E J
=
´´K L
x
´´M N
.
´´N O
Name
´´O S
}
´´T U
)
´´U V
,
´´V W!
IndexedContentTypes
¨¨ #
=
¨¨$ %
IsCreate
¨¨& .
?
¨¨/ 0'
_contentDefinitionManager
¨¨1 J
.
¨¨J K!
ListTypeDefinitions
¨¨K ^
(
¨¨^ _
)
¨¨_ `
.
≠≠ 
Select
≠≠ 
(
≠≠ 
x
≠≠ 
=>
≠≠  
x
≠≠! "
.
≠≠" #
Name
≠≠# '
)
≠≠' (
.
≠≠( )
ToArray
≠≠) 0
(
≠≠0 1
)
≠≠1 2
:
≠≠3 4
settings
≠≠5 =
.
≠≠= >!
IndexedContentTypes
≠≠> Q
}
ÆÆ 
;
ÆÆ 
return
∞∞ 
View
∞∞ 
(
∞∞ 
model
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 	
[
≥≥ 	
HttpPost
≥≥	 
,
≥≥ 

ActionName
≥≥ 
(
≥≥ 
$str
≥≥ $
)
≥≥$ %
]
≥≥% &
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 
ActionResult
¥¥ &
>
¥¥& '
EditPost
¥¥( 0
(
¥¥0 1*
LuceneIndexSettingsViewModel
¥¥1 M
model
¥¥N S
,
¥¥S T
string
¥¥U [
[
¥¥[ \
]
¥¥\ ]!
indexedContentTypes
¥¥^ q
)
¥¥q r
{
µµ 	
if
∂∂ 
(
∂∂ 
!
∂∂ 
await
∂∂ #
_authorizationService
∂∂ ,
.
∂∂, -
AuthorizeAsync
∂∂- ;
(
∂∂; <
User
∂∂< @
,
∂∂@ A
Permissions
∂∂B M
.
∂∂M N
ManageIndexes
∂∂N [
)
∂∂[ \
)
∂∂\ ]
{
∑∑ 
return
∏∏ 
Forbid
∏∏ 
(
∏∏ 
)
∏∏ 
;
∏∏  
}
ππ 
ValidateModel
ªª 
(
ªª 
model
ªª 
)
ªª  
;
ªª  !
if
ΩΩ 
(
ΩΩ 
model
ΩΩ 
.
ΩΩ 
IsCreate
ΩΩ 
)
ΩΩ 
{
ææ 
if
øø 
(
øø !
_luceneIndexManager
øø '
.
øø' (
Exists
øø( .
(
øø. /
model
øø/ 4
.
øø4 5
	IndexName
øø5 >
)
øø> ?
)
øø? @
{
¿¿ 

ModelState
¡¡ 
.
¡¡ 
AddModelError
¡¡ ,
(
¡¡, -
nameof
¡¡- 3
(
¡¡3 4*
LuceneIndexSettingsViewModel
¡¡4 P
.
¡¡P Q
	IndexName
¡¡Q Z
)
¡¡Z [
,
¡¡[ \
S
¡¡] ^
[
¡¡^ _
$str¡¡_ É
,¡¡É Ñ
model¡¡Ö ä
.¡¡ä ã
	IndexName¡¡ã î
]¡¡î ï
)¡¡ï ñ
;¡¡ñ ó
}
¬¬ 
}
√√ 
else
ƒƒ 
{
≈≈ 
if
∆∆ 
(
∆∆ 
!
∆∆ !
_luceneIndexManager
∆∆ (
.
∆∆( )
Exists
∆∆) /
(
∆∆/ 0
model
∆∆0 5
.
∆∆5 6
	IndexName
∆∆6 ?
)
∆∆? @
)
∆∆@ A
{
«« 

ModelState
»» 
.
»» 
AddModelError
»» ,
(
»», -
nameof
»»- 3
(
»»3 4*
LuceneIndexSettingsViewModel
»»4 P
.
»»P Q
	IndexName
»»Q Z
)
»»Z [
,
»»[ \
S
»»] ^
[
»»^ _
$str»»_ Ç
,»»Ç É
model»»Ñ â
.»»â ä
	IndexName»»ä ì
]»»ì î
)»»î ï
;»»ï ñ
}
…… 
}
   
if
ÃÃ 
(
ÃÃ 
!
ÃÃ 

ModelState
ÃÃ 
.
ÃÃ 
IsValid
ÃÃ #
)
ÃÃ# $
{
ÕÕ 
model
ŒŒ 
.
ŒŒ 
Cultures
ŒŒ 
=
ŒŒ  
CultureInfo
ŒŒ! ,
.
ŒŒ, -
GetCultures
ŒŒ- 8
(
ŒŒ8 9
CultureTypes
ŒŒ9 E
.
ŒŒE F
AllCultures
ŒŒF Q
)
ŒŒQ R
.
œœ 
Select
œœ 
(
œœ 
x
œœ 
=>
œœ  
new
œœ! $
SelectListItem
œœ% 3
{
œœ4 5
Text
œœ6 :
=
œœ; <
x
œœ= >
.
œœ> ?
Name
œœ? C
+
œœD E
$str
œœF J
+
œœK L
x
œœM N
.
œœN O
DisplayName
œœO Z
+
œœ[ \
$str
œœ] `
,
œœ` a
Value
œœb g
=
œœh i
x
œœj k
.
œœk l
Name
œœl p
}
œœq r
)
œœr s
.
œœs t
Prepend
œœt {
(
œœ{ |
new
œœ| 
SelectListItemœœÄ é
{œœè ê
Textœœë ï
=œœñ ó
Sœœò ô
[œœô ö
$strœœö ß
]œœß ®
,œœ® ©
Valueœœ™ Ø
=œœ∞ ±
$strœœ≤ ∑
}œœ∏ π
)œœπ ∫
;œœ∫ ª
model
–– 
.
–– 
	Analyzers
–– 
=
––  !$
_luceneAnalyzerManager
––" 8
.
––8 9
GetAnalyzers
––9 E
(
––E F
)
––F G
.
—— 
Select
—— 
(
—— 
x
—— 
=>
——  
new
——! $
SelectListItem
——% 3
{
——4 5
Text
——6 :
=
——; <
x
——= >
.
——> ?
Name
——? C
,
——C D
Value
——E J
=
——K L
x
——M N
.
——N O
Name
——O S
}
——T U
)
——U V
;
——V W
return
““ 
View
““ 
(
““ 
model
““ !
)
““! "
;
““" #
}
”” 
if
’’ 
(
’’ 
model
’’ 
.
’’ 
IsCreate
’’ 
)
’’ 
{
÷÷ 
try
◊◊ 
{
ÿÿ 
var
ŸŸ 
settings
ŸŸ  
=
ŸŸ! "
new
ŸŸ# &!
LuceneIndexSettings
ŸŸ' :
{
ŸŸ; <
	IndexName
ŸŸ= F
=
ŸŸG H
model
ŸŸI N
.
ŸŸN O
	IndexName
ŸŸO X
,
ŸŸX Y
AnalyzerName
ŸŸZ f
=
ŸŸg h
model
ŸŸi n
.
ŸŸn o
AnalyzerName
ŸŸo {
,
ŸŸ{ |
IndexLatestŸŸ} à
=ŸŸâ ä
modelŸŸã ê
.ŸŸê ë
IndexLatestŸŸë ú
,ŸŸú ù#
IndexedContentTypesŸŸû ±
=ŸŸ≤ ≥#
indexedContentTypesŸŸ¥ «
,ŸŸ« »
CultureŸŸ… –
=ŸŸ— “
modelŸŸ” ÿ
.ŸŸÿ Ÿ
CultureŸŸŸ ‡
??ŸŸ· „
$strŸŸ‰ Ê
}ŸŸÁ Ë
;ŸŸË È
await
›› $
_luceneIndexingService
›› 0
.
››0 1
CreateIndexAsync
››1 A
(
››A B
settings
››B J
)
››J K
;
››K L
}
ﬁﬁ 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ  
e
ﬂﬂ! "
)
ﬂﬂ" #
{
‡‡ 
	_notifier
·· 
.
·· 
Error
·· #
(
··# $
H
··$ %
[
··% &
$str
··& S
]
··S T
)
··T U
;
··U V
_logger
‚‚ 
.
‚‚ 
LogError
‚‚ $
(
‚‚$ %
e
‚‚% &
,
‚‚& '
$str
‚‚( T
)
‚‚T U
;
‚‚U V
return
„„ 
View
„„ 
(
„„  
model
„„  %
)
„„% &
;
„„& '
}
‰‰ 
	_notifier
ÊÊ 
.
ÊÊ 
Success
ÊÊ !
(
ÊÊ! "
H
ÊÊ" #
[
ÊÊ# $
$str
ÊÊ$ N
,
ÊÊN O
model
ÊÊP U
.
ÊÊU V
	IndexName
ÊÊV _
]
ÊÊ_ `
)
ÊÊ` a
;
ÊÊa b
}
ÁÁ 
else
ËË 
{
ÈÈ 
try
ÍÍ 
{
ÎÎ 
var
ÏÏ 
settings
ÏÏ  
=
ÏÏ! "
new
ÏÏ# &!
LuceneIndexSettings
ÏÏ' :
{
ÏÏ; <
	IndexName
ÏÏ= F
=
ÏÏG H
model
ÏÏI N
.
ÏÏN O
	IndexName
ÏÏO X
,
ÏÏX Y
AnalyzerName
ÏÏZ f
=
ÏÏg h
model
ÏÏi n
.
ÏÏn o
AnalyzerName
ÏÏo {
,
ÏÏ{ |
IndexLatestÏÏ} à
=ÏÏâ ä
modelÏÏã ê
.ÏÏê ë
IndexLatestÏÏë ú
,ÏÏú ù#
IndexedContentTypesÏÏû ±
=ÏÏ≤ ≥#
indexedContentTypesÏÏ¥ «
,ÏÏ« »
CultureÏÏ… –
=ÏÏ— “
modelÏÏ” ÿ
.ÏÏÿ Ÿ
CultureÏÏŸ ‡
??ÏÏ· „
$strÏÏ‰ Ê
}ÏÏÁ Ë
;ÏÏË È
await
ÓÓ $
_luceneIndexingService
ÓÓ 0
.
ÓÓ0 1
UpdateIndexAsync
ÓÓ1 A
(
ÓÓA B
settings
ÓÓB J
)
ÓÓJ K
;
ÓÓK L
}
ÔÔ 
catch
 
(
 
	Exception
  
e
! "
)
" #
{
ÒÒ 
	_notifier
ÚÚ 
.
ÚÚ 
Error
ÚÚ #
(
ÚÚ# $
H
ÚÚ$ %
[
ÚÚ% &
$str
ÚÚ& R
]
ÚÚR S
)
ÚÚS T
;
ÚÚT U
_logger
ÛÛ 
.
ÛÛ 
LogError
ÛÛ $
(
ÛÛ$ %
e
ÛÛ% &
,
ÛÛ& '
$str
ÛÛ( S
)
ÛÛS T
;
ÛÛT U
return
ÙÙ 
View
ÙÙ 
(
ÙÙ  
model
ÙÙ  %
)
ÙÙ% &
;
ÙÙ& '
}
ıı 
	_notifier
˜˜ 
.
˜˜ 
Success
˜˜ !
(
˜˜! "
H
˜˜" #
[
˜˜# $
$str˜˜$ é
,˜˜é è
model˜˜ê ï
.˜˜ï ñ
	IndexName˜˜ñ ü
]˜˜ü †
)˜˜† °
;˜˜° ¢
}
¯¯ 
return
˙˙ 
RedirectToAction
˙˙ #
(
˙˙# $
$str
˙˙$ +
)
˙˙+ ,
;
˙˙, -
}
˚˚ 	
[
˝˝ 	
HttpPost
˝˝	 
]
˝˝ 
public
˛˛ 
async
˛˛ 
Task
˛˛ 
<
˛˛ 
ActionResult
˛˛ &
>
˛˛& '
Reset
˛˛( -
(
˛˛- .
string
˛˛. 4
id
˛˛5 7
)
˛˛7 8
{
ˇˇ 	
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
await
ÄÄ #
_authorizationService
ÄÄ ,
.
ÄÄ, -
AuthorizeAsync
ÄÄ- ;
(
ÄÄ; <
User
ÄÄ< @
,
ÄÄ@ A
Permissions
ÄÄB M
.
ÄÄM N
ManageIndexes
ÄÄN [
)
ÄÄ[ \
)
ÄÄ\ ]
{
ÅÅ 
return
ÇÇ 
Forbid
ÇÇ 
(
ÇÇ 
)
ÇÇ 
;
ÇÇ  
}
ÉÉ 
if
ÖÖ 
(
ÖÖ 
!
ÖÖ !
_luceneIndexManager
ÖÖ $
.
ÖÖ$ %
Exists
ÖÖ% +
(
ÖÖ+ ,
id
ÖÖ, .
)
ÖÖ. /
)
ÖÖ/ 0
{
ÜÜ 
return
áá 
NotFound
áá 
(
áá  
)
áá  !
;
áá! "
}
àà $
_luceneIndexingService
ää "
.
ää" #

ResetIndex
ää# -
(
ää- .
id
ää. 0
)
ää0 1
;
ää1 2
await
ãã $
_luceneIndexingService
ãã (
.
ãã( )&
ProcessContentItemsAsync
ãã) A
(
ããA B
id
ããB D
)
ããD E
;
ããE F
	_notifier
çç 
.
çç 
Success
çç 
(
çç 
H
çç 
[
çç  
$str
çç  H
,
ççH I
id
ççJ L
]
ççL M
)
ççM N
;
ççN O
return
èè 
RedirectToAction
èè #
(
èè# $
$str
èè$ +
)
èè+ ,
;
èè, -
}
êê 	
[
íí 	
HttpPost
íí	 
]
íí 
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
ActionResult
ìì &
>
ìì& '
Rebuild
ìì( /
(
ìì/ 0
string
ìì0 6
id
ìì7 9
)
ìì9 :
{
îî 	
if
ïï 
(
ïï 
!
ïï 
await
ïï #
_authorizationService
ïï ,
.
ïï, -
AuthorizeAsync
ïï- ;
(
ïï; <
User
ïï< @
,
ïï@ A
Permissions
ïïB M
.
ïïM N
ManageIndexes
ïïN [
)
ïï[ \
)
ïï\ ]
{
ññ 
return
óó 
Forbid
óó 
(
óó 
)
óó 
;
óó  
}
òò 
if
öö 
(
öö 
!
öö !
_luceneIndexManager
öö $
.
öö$ %
Exists
öö% +
(
öö+ ,
id
öö, .
)
öö. /
)
öö/ 0
{
õõ 
return
úú 
NotFound
úú 
(
úú  
)
úú  !
;
úú! "
}
ùù 
await
üü $
_luceneIndexingService
üü (
.
üü( )
RebuildIndexAsync
üü) :
(
üü: ;
id
üü; =
)
üü= >
;
üü> ?
await
†† $
_luceneIndexingService
†† (
.
††( )&
ProcessContentItemsAsync
††) A
(
††A B
id
††B D
)
††D E
;
††E F
	_notifier
¢¢ 
.
¢¢ 
Success
¢¢ 
(
¢¢ 
H
¢¢ 
[
¢¢  
$str
¢¢  J
,
¢¢J K
id
¢¢L N
]
¢¢N O
)
¢¢O P
;
¢¢P Q
return
§§ 
RedirectToAction
§§ #
(
§§# $
$str
§§$ +
)
§§+ ,
;
§§, -
}
•• 	
[
ßß 	
HttpPost
ßß	 
]
ßß 
public
®® 
async
®® 
Task
®® 
<
®® 
ActionResult
®® &
>
®®& '
Delete
®®( .
(
®®. /*
LuceneIndexSettingsViewModel
®®/ K
model
®®L Q
)
®®Q R
{
©© 	
if
™™ 
(
™™ 
!
™™ 
await
™™ #
_authorizationService
™™ ,
.
™™, -
AuthorizeAsync
™™- ;
(
™™; <
User
™™< @
,
™™@ A
Permissions
™™B M
.
™™M N
ManageIndexes
™™N [
)
™™[ \
)
™™\ ]
{
´´ 
return
¨¨ 
Forbid
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨  
}
≠≠ 
if
ØØ 
(
ØØ 
!
ØØ !
_luceneIndexManager
ØØ $
.
ØØ$ %
Exists
ØØ% +
(
ØØ+ ,
model
ØØ, 1
.
ØØ1 2
	IndexName
ØØ2 ;
)
ØØ; <
)
ØØ< =
{
∞∞ 
return
±± 
NotFound
±± 
(
±±  
)
±±  !
;
±±! "
}
≤≤ 
try
¥¥ 
{
µµ 
await
∂∂ $
_luceneIndexingService
∂∂ ,
.
∂∂, -
DeleteIndexAsync
∂∂- =
(
∂∂= >
model
∂∂> C
.
∂∂C D
	IndexName
∂∂D M
)
∂∂M N
;
∂∂N O
	_notifier
∏∏ 
.
∏∏ 
Success
∏∏ !
(
∏∏! "
H
∏∏" #
[
∏∏# $
$str
∏∏$ N
,
∏∏N O
model
∏∏P U
.
∏∏U V
	IndexName
∏∏V _
]
∏∏_ `
)
∏∏` a
;
∏∏a b
}
ππ 
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 
	_notifier
ºº 
.
ºº 
Error
ºº 
(
ºº  
H
ºº  !
[
ºº! "
$str
ºº" O
]
ººO P
)
ººP Q
;
ººQ R
_logger
ΩΩ 
.
ΩΩ 
LogError
ΩΩ  
(
ΩΩ  !
$str
ΩΩ! N
+
ΩΩO P
model
ΩΩQ V
.
ΩΩV W
	IndexName
ΩΩW `
,
ΩΩ` a
e
ΩΩb c
)
ΩΩc d
;
ΩΩd e
}
ææ 
return
¿¿ 
RedirectToAction
¿¿ #
(
¿¿# $
$str
¿¿$ +
)
¿¿+ ,
;
¿¿, -
}
¡¡ 	
public
√√ 
Task
√√ 
<
√√ 
IActionResult
√√ !
>
√√! "
Query
√√# (
(
√√( )
string
√√) /
	indexName
√√0 9
,
√√9 :
string
√√; A
query
√√B G
)
√√G H
{
ƒƒ 	
query
≈≈ 
=
≈≈ 
String
≈≈ 
.
≈≈  
IsNullOrWhiteSpace
≈≈ -
(
≈≈- .
query
≈≈. 3
)
≈≈3 4
?
≈≈5 6
$str
≈≈7 9
:
≈≈: ;
System
≈≈< B
.
≈≈B C
Text
≈≈C G
.
≈≈G H
Encoding
≈≈H P
.
≈≈P Q
UTF8
≈≈Q U
.
≈≈U V
	GetString
≈≈V _
(
≈≈_ `
Convert
≈≈` g
.
≈≈g h
FromBase64String
≈≈h x
(
≈≈x y
query
≈≈y ~
)
≈≈~ 
)≈≈ Ä
;≈≈Ä Å
return
∆∆ 
Query
∆∆ 
(
∆∆ 
new
∆∆ !
AdminQueryViewModel
∆∆ 0
{
∆∆1 2
	IndexName
∆∆3 <
=
∆∆= >
	indexName
∆∆? H
,
∆∆H I
DecodedQuery
∆∆J V
=
∆∆W X
query
∆∆Y ^
}
∆∆_ `
)
∆∆` a
;
∆∆a b
}
«« 	
[
…… 	
HttpPost
……	 
]
…… 
public
   
async
   
Task
   
<
   
IActionResult
   '
>
  ' (
Query
  ) .
(
  . /!
AdminQueryViewModel
  / B
model
  C H
)
  H I
{
ÀÀ 	
if
ÃÃ 
(
ÃÃ 
!
ÃÃ 
await
ÃÃ #
_authorizationService
ÃÃ ,
.
ÃÃ, -
AuthorizeAsync
ÃÃ- ;
(
ÃÃ; <
User
ÃÃ< @
,
ÃÃ@ A
Permissions
ÃÃB M
.
ÃÃM N
ManageIndexes
ÃÃN [
)
ÃÃ[ \
)
ÃÃ\ ]
{
ÕÕ 
return
ŒŒ 
Forbid
ŒŒ 
(
ŒŒ 
)
ŒŒ 
;
ŒŒ  
}
œœ 
model
—— 
.
—— 
Indices
—— 
=
—— 
(
—— 
await
—— ")
_luceneIndexSettingsService
——# >
.
——> ?
GetSettingsAsync
——? O
(
——O P
)
——P Q
)
——Q R
.
——R S
Select
——S Y
(
——Y Z
x
——Z [
=>
——\ ^
x
——_ `
.
——` a
	IndexName
——a j
)
——j k
.
——k l
ToArray
——l s
(
——s t
)
——t u
;
——u v
if
‘‘ 
(
‘‘ 
model
‘‘ 
.
‘‘ 
Indices
‘‘ 
.
‘‘ 
Length
‘‘ $
==
‘‘% '
$num
‘‘( )
)
‘‘) *
{
’’ 
return
÷÷ 
RedirectToAction
÷÷ '
(
÷÷' (
$str
÷÷( /
)
÷÷/ 0
;
÷÷0 1
}
◊◊ 
if
ŸŸ 
(
ŸŸ 
String
ŸŸ 
.
ŸŸ 
IsNullOrEmpty
ŸŸ $
(
ŸŸ$ %
model
ŸŸ% *
.
ŸŸ* +
	IndexName
ŸŸ+ 4
)
ŸŸ4 5
)
ŸŸ5 6
{
⁄⁄ 
model
€€ 
.
€€ 
	IndexName
€€ 
=
€€  !
model
€€" '
.
€€' (
Indices
€€( /
[
€€/ 0
$num
€€0 1
]
€€1 2
;
€€2 3
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ 
!
ﬁﬁ !
_luceneIndexManager
ﬁﬁ $
.
ﬁﬁ$ %
Exists
ﬁﬁ% +
(
ﬁﬁ+ ,
model
ﬁﬁ, 1
.
ﬁﬁ1 2
	IndexName
ﬁﬁ2 ;
)
ﬁﬁ; <
)
ﬁﬁ< =
{
ﬂﬂ 
return
‡‡ 
NotFound
‡‡ 
(
‡‡  
)
‡‡  !
;
‡‡! "
}
·· 
if
„„ 
(
„„ 
String
„„ 
.
„„  
IsNullOrWhiteSpace
„„ )
(
„„) *
model
„„* /
.
„„/ 0
DecodedQuery
„„0 <
)
„„< =
)
„„= >
{
‰‰ 
return
ÂÂ 
View
ÂÂ 
(
ÂÂ 
model
ÂÂ !
)
ÂÂ! "
;
ÂÂ" #
}
ÊÊ 
if
ËË 
(
ËË 
String
ËË 
.
ËË 
IsNullOrEmpty
ËË $
(
ËË$ %
model
ËË% *
.
ËË* +

Parameters
ËË+ 5
)
ËË5 6
)
ËË6 7
{
ÈÈ 
model
ÍÍ 
.
ÍÍ 

Parameters
ÍÍ  
=
ÍÍ! "
$str
ÍÍ# (
;
ÍÍ( )
}
ÎÎ 
var
ÌÌ 
	stopwatch
ÌÌ 
=
ÌÌ 
new
ÌÌ 
	Stopwatch
ÌÌ  )
(
ÌÌ) *
)
ÌÌ* +
;
ÌÌ+ ,
	stopwatch
ÓÓ 
.
ÓÓ 
Start
ÓÓ 
(
ÓÓ 
)
ÓÓ 
;
ÓÓ 
await
 !
_luceneIndexManager
 %
.
% &
SearchAsync
& 1
(
1 2
model
2 7
.
7 8
	IndexName
8 A
,
A B
async
C H
searcher
I Q
=>
R T
{
ÒÒ 
var
ÚÚ 
analyzer
ÚÚ 
=
ÚÚ $
_luceneAnalyzerManager
ÚÚ 5
.
ÚÚ5 6
CreateAnalyzer
ÚÚ6 D
(
ÚÚD E
await
ÚÚE J)
_luceneIndexSettingsService
ÚÚK f
.
ÚÚf g#
GetIndexAnalyzerAsync
ÚÚg |
(
ÚÚ| }
modelÚÚ} Ç
.ÚÚÇ É
	IndexNameÚÚÉ å
)ÚÚå ç
)ÚÚç é
;ÚÚé è
var
ÛÛ 
context
ÛÛ 
=
ÛÛ 
new
ÛÛ ! 
LuceneQueryContext
ÛÛ" 4
(
ÛÛ4 5
searcher
ÛÛ5 =
,
ÛÛ= >
LuceneSettings
ÛÛ? M
.
ÛÛM N
DefaultVersion
ÛÛN \
,
ÛÛ\ ]
analyzer
ÛÛ^ f
)
ÛÛf g
;
ÛÛg h
var
ıı 
templateContext
ıı #
=
ıı$ %$
_liquidTemplateManager
ıı& <
.
ıı< =
Context
ıı= D
;
ııD E
var
ˆˆ 

parameters
ˆˆ 
=
ˆˆ  
JsonConvert
ˆˆ! ,
.
ˆˆ, -
DeserializeObject
ˆˆ- >
<
ˆˆ> ?

Dictionary
ˆˆ? I
<
ˆˆI J
string
ˆˆJ P
,
ˆˆP Q
object
ˆˆR X
>
ˆˆX Y
>
ˆˆY Z
(
ˆˆZ [
model
ˆˆ[ `
.
ˆˆ` a

Parameters
ˆˆa k
)
ˆˆk l
;
ˆˆl m
foreach
¯¯ 
(
¯¯ 
var
¯¯ 
	parameter
¯¯ &
in
¯¯' )

parameters
¯¯* 4
)
¯¯4 5
{
˘˘ 
templateContext
˙˙ #
.
˙˙# $
SetValue
˙˙$ ,
(
˙˙, -
	parameter
˙˙- 6
.
˙˙6 7
Key
˙˙7 :
,
˙˙: ;
	parameter
˙˙< E
.
˙˙E F
Value
˙˙F K
)
˙˙K L
;
˙˙L M
}
˚˚ 
var
˝˝ 
tokenizedContent
˝˝ $
=
˝˝% &
await
˝˝' ,$
_liquidTemplateManager
˝˝- C
.
˝˝C D
RenderAsync
˝˝D O
(
˝˝O P
model
˝˝P U
.
˝˝U V
DecodedQuery
˝˝V b
,
˝˝b c 
_javaScriptEncoder
˝˝d v
)
˝˝v w
;
˝˝w x
try
ˇˇ 
{
ÄÄ 
var
ÅÅ  
parameterizedQuery
ÅÅ *
=
ÅÅ+ ,
JObject
ÅÅ- 4
.
ÅÅ4 5
Parse
ÅÅ5 :
(
ÅÅ: ;
tokenizedContent
ÅÅ; K
)
ÅÅK L
;
ÅÅL M
var
ÇÇ 
luceneTopDocs
ÇÇ %
=
ÇÇ& '
await
ÇÇ( -
_queryService
ÇÇ. ;
.
ÇÇ; <
SearchAsync
ÇÇ< G
(
ÇÇG H
context
ÇÇH O
,
ÇÇO P 
parameterizedQuery
ÇÇQ c
)
ÇÇc d
;
ÇÇd e
if
ÑÑ 
(
ÑÑ 
luceneTopDocs
ÑÑ %
!=
ÑÑ& (
null
ÑÑ) -
)
ÑÑ- .
{
ÖÖ 
model
ÜÜ 
.
ÜÜ 
	Documents
ÜÜ '
=
ÜÜ( )
luceneTopDocs
ÜÜ* 7
.
ÜÜ7 8
TopDocs
ÜÜ8 ?
.
ÜÜ? @
	ScoreDocs
ÜÜ@ I
.
ÜÜI J
Select
ÜÜJ P
(
ÜÜP Q
hit
ÜÜQ T
=>
ÜÜU W
searcher
ÜÜX `
.
ÜÜ` a
Doc
ÜÜa d
(
ÜÜd e
hit
ÜÜe h
.
ÜÜh i
Doc
ÜÜi l
)
ÜÜl m
)
ÜÜm n
.
ÜÜn o
ToList
ÜÜo u
(
ÜÜu v
)
ÜÜv w
;
ÜÜw x
model
áá 
.
áá 
Count
áá #
=
áá$ %
luceneTopDocs
áá& 3
.
áá3 4
Count
áá4 9
;
áá9 :
}
àà 
}
ââ 
catch
ää 
(
ää 
	Exception
ää  
e
ää! "
)
ää" #
{
ãã 
_logger
åå 
.
åå 
LogError
åå $
(
åå$ %
e
åå% &
,
åå& '
$str
åå( E
)
ååE F
;
ååF G

ModelState
çç 
.
çç 
AddModelError
çç ,
(
çç, -
nameof
çç- 3
(
çç3 4
model
çç4 9
.
çç9 :
DecodedQuery
çç: F
)
ççF G
,
ççG H
S
ççI J
[
ççJ K
$str
ççK `
,
çç` a
e
ççb c
.
ççc d
Message
ççd k
]
ççk l
)
ççl m
;
ççm n
}
éé 
	stopwatch
êê 
.
êê 
Stop
êê 
(
êê 
)
êê  
;
êê  !
model
ëë 
.
ëë 
Elapsed
ëë 
=
ëë 
	stopwatch
ëë  )
.
ëë) *
Elapsed
ëë* 1
;
ëë1 2
}
íí 
)
íí 
;
íí 
return
îî 
View
îî 
(
îî 
model
îî 
)
îî 
;
îî 
}
ïï 	
[
óó 	
HttpPost
óó	 
,
óó 

ActionName
óó 
(
óó 
$str
óó %
)
óó% &
]
óó& '
[
òò 	
FormValueRequired
òò	 
(
òò 
$str
òò .
)
òò. /
]
òò/ 0
public
ôô 
async
ôô 
Task
ôô 
<
ôô 
ActionResult
ôô &
>
ôô& '
	IndexPost
ôô( 1
(
ôô1 2

ViewModels
ôô2 <
.
ôô< =
ContentOptions
ôô= K
options
ôôL S
,
ôôS T
IEnumerable
ôôU `
<
ôô` a
string
ôôa g
>
ôôg h
itemIds
ôôi p
)
ôôp q
{
öö 	
if
õõ 
(
õõ 
!
õõ 
await
õõ #
_authorizationService
õõ ,
.
õõ, -
AuthorizeAsync
õõ- ;
(
õõ; <
User
õõ< @
,
õõ@ A
Permissions
õõB M
.
õõM N
ManageIndexes
õõN [
)
õõ[ \
)
õõ\ ]
{
úú 
return
ùù 
Forbid
ùù 
(
ùù 
)
ùù 
;
ùù  
}
ûû 
if
†† 
(
†† 
itemIds
†† 
?
†† 
.
†† 
Count
†† 
(
†† 
)
††  
>
††! "
$num
††# $
)
††$ %
{
°° 
var
¢¢ !
luceneIndexSettings
¢¢ '
=
¢¢( )
await
¢¢* /)
_luceneIndexSettingsService
¢¢0 K
.
¢¢K L
GetSettingsAsync
¢¢L \
(
¢¢\ ]
)
¢¢] ^
;
¢¢^ _
var
££ !
checkedContentItems
££ '
=
££( )!
luceneIndexSettings
££* =
.
££= >
Where
££> C
(
££C D
x
££D E
=>
££F H
itemIds
££I P
.
££P Q
Contains
££Q Y
(
££Y Z
x
££Z [
.
££[ \
	IndexName
££\ e
)
££e f
)
££f g
;
££g h
switch
§§ 
(
§§ 
options
§§ 
.
§§  

BulkAction
§§  *
)
§§* +
{
•• 
case
¶¶  
ContentsBulkAction
¶¶ +
.
¶¶+ ,
None
¶¶, 0
:
¶¶0 1
break
ßß 
;
ßß 
case
®®  
ContentsBulkAction
®® +
.
®®+ ,
Remove
®®, 2
:
®®2 3
foreach
©© 
(
©©  !
var
©©! $
item
©©% )
in
©©* ,!
checkedContentItems
©©- @
)
©©@ A
{
™™ 
await
´´ !$
_luceneIndexingService
´´" 8
.
´´8 9
DeleteIndexAsync
´´9 I
(
´´I J
item
´´J N
.
´´N O
	IndexName
´´O X
)
´´X Y
;
´´Y Z
}
¨¨ 
	_notifier
≠≠ !
.
≠≠! "
Success
≠≠" )
(
≠≠) *
H
≠≠* +
[
≠≠+ ,
$str
≠≠, K
]
≠≠K L
)
≠≠L M
;
≠≠M N
break
ÆÆ 
;
ÆÆ 
case
ØØ  
ContentsBulkAction
ØØ +
.
ØØ+ ,
Reset
ØØ, 1
:
ØØ1 2
foreach
∞∞ 
(
∞∞  !
var
∞∞! $
item
∞∞% )
in
∞∞* ,!
checkedContentItems
∞∞- @
)
∞∞@ A
{
±± 
if
≤≤ 
(
≤≤  
!
≤≤  !!
_luceneIndexManager
≤≤! 4
.
≤≤4 5
Exists
≤≤5 ;
(
≤≤; <
item
≤≤< @
.
≤≤@ A
	IndexName
≤≤A J
)
≤≤J K
)
≤≤K L
{
≥≥ 
return
¥¥  &
NotFound
¥¥' /
(
¥¥/ 0
)
¥¥0 1
;
¥¥1 2
}
µµ $
_luceneIndexingService
∑∑ 2
.
∑∑2 3

ResetIndex
∑∑3 =
(
∑∑= >
item
∑∑> B
.
∑∑B C
	IndexName
∑∑C L
)
∑∑L M
;
∑∑M N
await
∏∏ !$
_luceneIndexingService
∏∏" 8
.
∏∏8 9&
ProcessContentItemsAsync
∏∏9 Q
(
∏∏Q R
item
∏∏R V
.
∏∏V W
	IndexName
∏∏W `
)
∏∏` a
;
∏∏a b
	_notifier
∫∫ %
.
∫∫% &
Success
∫∫& -
(
∫∫- .
H
∫∫. /
[
∫∫/ 0
$str
∫∫0 X
,
∫∫X Y
item
∫∫Z ^
.
∫∫^ _
	IndexName
∫∫_ h
]
∫∫h i
)
∫∫i j
;
∫∫j k
}
ªª 
break
ºº 
;
ºº 
case
ΩΩ  
ContentsBulkAction
ΩΩ +
.
ΩΩ+ ,
Rebuild
ΩΩ, 3
:
ΩΩ3 4
foreach
ææ 
(
ææ  !
var
ææ! $
item
ææ% )
in
ææ* ,!
checkedContentItems
ææ- @
)
ææ@ A
{
øø 
if
¿¿ 
(
¿¿  
!
¿¿  !!
_luceneIndexManager
¿¿! 4
.
¿¿4 5
Exists
¿¿5 ;
(
¿¿; <
item
¿¿< @
.
¿¿@ A
	IndexName
¿¿A J
)
¿¿J K
)
¿¿K L
{
¡¡ 
return
¬¬  &
NotFound
¬¬' /
(
¬¬/ 0
)
¬¬0 1
;
¬¬1 2
}
√√ 
await
≈≈ !$
_luceneIndexingService
≈≈" 8
.
≈≈8 9
RebuildIndexAsync
≈≈9 J
(
≈≈J K
item
≈≈K O
.
≈≈O P
	IndexName
≈≈P Y
)
≈≈Y Z
;
≈≈Z [
await
∆∆ !$
_luceneIndexingService
∆∆" 8
.
∆∆8 9&
ProcessContentItemsAsync
∆∆9 Q
(
∆∆Q R
item
∆∆R V
.
∆∆V W
	IndexName
∆∆W `
)
∆∆` a
;
∆∆a b
	_notifier
»» %
.
»»% &
Success
»»& -
(
»»- .
H
»». /
[
»»/ 0
$str
»»0 Z
,
»»Z [
item
»»\ `
.
»»` a
	IndexName
»»a j
]
»»j k
)
»»k l
;
»»l m
}
…… 
break
   
;
   
default
ÀÀ 
:
ÀÀ 
throw
ÃÃ 
new
ÃÃ !)
ArgumentOutOfRangeException
ÃÃ" =
(
ÃÃ= >
)
ÃÃ> ?
;
ÃÃ? @
}
ÕÕ 
}
ŒŒ 
return
–– 
RedirectToAction
–– #
(
––# $
$str
––$ +
)
––+ ,
;
––, -
}
—— 	
private
”” 
void
”” 
ValidateModel
”” "
(
””" #*
LuceneIndexSettingsViewModel
””# ?
model
””@ E
)
””E F
{
‘‘ 	
if
’’ 
(
’’ 
model
’’ 
.
’’ !
IndexedContentTypes
’’ )
==
’’* ,
null
’’- 1
||
’’2 4
model
’’5 :
.
’’: ;!
IndexedContentTypes
’’; N
.
’’N O
Count
’’O T
(
’’T U
)
’’U V
<
’’W X
$num
’’Y Z
)
’’Z [
{
÷÷ 

ModelState
◊◊ 
.
◊◊ 
AddModelError
◊◊ (
(
◊◊( )
nameof
◊◊) /
(
◊◊/ 0*
LuceneIndexSettingsViewModel
◊◊0 L
.
◊◊L M!
IndexedContentTypes
◊◊M `
)
◊◊` a
,
◊◊a b
S
◊◊c d
[
◊◊d e
$str◊◊e ó
]◊◊ó ò
)◊◊ò ô
;◊◊ô ö
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄ 
String
⁄⁄ 
.
⁄⁄  
IsNullOrWhiteSpace
⁄⁄ )
(
⁄⁄) *
model
⁄⁄* /
.
⁄⁄/ 0
	IndexName
⁄⁄0 9
)
⁄⁄9 :
)
⁄⁄: ;
{
€€ 

ModelState
‹‹ 
.
‹‹ 
AddModelError
‹‹ (
(
‹‹( )
nameof
‹‹) /
(
‹‹/ 0*
LuceneIndexSettingsViewModel
‹‹0 L
.
‹‹L M
	IndexName
‹‹M V
)
‹‹V W
,
‹‹W X
S
‹‹Y Z
[
‹‹Z [
$str
‹‹[ x
]
‹‹x y
)
‹‹y z
;
‹‹z {
}
›› 
else
ﬁﬁ 
if
ﬁﬁ 
(
ﬁﬁ 
model
ﬁﬁ 
.
ﬁﬁ 
	IndexName
ﬁﬁ $
.
ﬁﬁ$ %

ToSafeName
ﬁﬁ% /
(
ﬁﬁ/ 0
)
ﬁﬁ0 1
!=
ﬁﬁ2 4
model
ﬁﬁ5 :
.
ﬁﬁ: ;
	IndexName
ﬁﬁ; D
)
ﬁﬁD E
{
ﬂﬂ 

ModelState
‡‡ 
.
‡‡ 
AddModelError
‡‡ (
(
‡‡( )
nameof
‡‡) /
(
‡‡/ 0*
LuceneIndexSettingsViewModel
‡‡0 L
.
‡‡L M
	IndexName
‡‡M V
)
‡‡V W
,
‡‡W X
S
‡‡Y Z
[
‡‡Z [
$str‡‡[ Ö
]‡‡Ö Ü
)‡‡Ü á
;‡‡á à
}
·· 
}
‚‚ 	
}
„„ 
}‰‰ ˜/
èD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Controllers\ApiController.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Controllers (
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
[ 
	Authorize 
( !
AuthenticationSchemes $
=% &
$str' ,
), -
,- ."
IgnoreAntiforgeryToken/ E
,E F
AllowAnonymousG U
]U V
public 

class 
ApiController 
:  

Controller! +
{ 
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly 
LuceneQuerySource *
_luceneQuerySource+ =
;= >
public 
ApiController 
( !
IAuthorizationService ! 
authorizationService" 6
,6 7
LuceneQuerySource 
luceneQuerySource /
)/ 0
{ 	!
_authorizationService !
=" # 
authorizationService$ 8
;8 9
_luceneQuerySource 
=  
luceneQuerySource! 2
;2 3
} 	
[ 	
HttpPost	 
, 
HttpGet 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Content) 0
(0 1
string 
	indexName 
, 
string 
query 
, 
string 

parameters 
) 
{   	
if!! 
(!! 
!!! 
await!! !
_authorizationService!! ,
.!!, -
AuthorizeAsync!!- ;
(!!; <
User!!< @
,!!@ A
Permissions!!B M
.!!M N
QueryLuceneApi!!N \
)!!\ ]
)!!] ^
{"" 
return## 
this## 
.## 
ChallengeOrForbid## -
(##- .
$str##. 3
)##3 4
;##4 5
}$$ 
var&& 
luceneQuery&& 
=&& 
new&& !
LuceneQuery&&" -
{'' 
Index(( 
=(( 
	indexName(( !
,((! "
Template)) 
=)) 
query))  
,))  !
ReturnContentItems** "
=**# $
true**% )
}++ 
;++ 
var-- 
queryParameters-- 
=--  !

parameters--" ,
!=--- /
null--0 4
?--5 6
JsonConvert.. 
... 
DeserializeObject.. -
<..- .

Dictionary... 8
<..8 9
string..9 ?
,..? @
object..A G
>..G H
>..H I
(..I J

parameters..J T
)..T U
:// 
new// 

Dictionary//  
<//  !
string//! '
,//' (
object//) /
>/// 0
(//0 1
)//1 2
;//2 3
var11 
result11 
=11 
await11 
_luceneQuerySource11 1
.111 2
ExecuteQueryAsync112 C
(11C D
luceneQuery11D O
,11O P
queryParameters11Q `
)11` a
;11a b
return33 
new33 
ObjectResult33 #
(33# $
result33$ *
)33* +
;33+ ,
}44 	
[66 	
HttpPost66	 
,66 
HttpGet66 
]66 
[77 	
Route77	 
(77 
$str77 
)77 
]77 
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
	Documents88) 2
(882 3
string99 
	indexName99 
,99 
string:: 
query:: 
,:: 
string;; 

parameters;; 
);; 
{<< 	
if== 
(== 
!== 
await== !
_authorizationService== ,
.==, -
AuthorizeAsync==- ;
(==; <
User==< @
,==@ A
Permissions==B M
.==M N
QueryLuceneApi==N \
)==\ ]
)==] ^
{>> 
return?? 
this?? 
.?? 
ChallengeOrForbid?? -
(??- .
$str??. 3
)??3 4
;??4 5
}@@ 
varBB 
luceneQueryBB 
=BB 
newBB !
LuceneQueryBB" -
{CC 
IndexDD 
=DD 
	indexNameDD !
,DD! "
TemplateEE 
=EE 
queryEE  
}FF 
;FF 
varHH 
queryParametersHH 
=HH  !

parametersHH" ,
!=HH- /
nullHH0 4
?HH5 6
JsonConvertII 
.II 
DeserializeObjectII -
<II- .

DictionaryII. 8
<II8 9
stringII9 ?
,II? @
objectIIA G
>IIG H
>IIH I
(III J

parametersIIJ T
)IIT U
:JJ 
newJJ 

DictionaryJJ  
<JJ  !
stringJJ! '
,JJ' (
objectJJ) /
>JJ/ 0
(JJ0 1
)JJ1 2
;JJ2 3
varLL 
resultLL 
=LL 
awaitLL 
_luceneQuerySourceLL 1
.LL1 2
ExecuteQueryAsyncLL2 C
(LLC D
luceneQueryLLD O
,LLO P
queryParametersLLQ `
)LL` a
;LLa b
returnNN 
newNN 
ObjectResultNN #
(NN# $
resultNN$ *
.NN* +
ItemsNN+ 0
)NN0 1
;NN1 2
}OO 	
}PP 
}QQ ï•
íD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Controllers\SearchController.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Controllers (
{ 
public 

class 
SearchController !
:" #

Controller$ .
{ 
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
private 
readonly 
ISiteService %
_siteService& 2
;2 3
private 
readonly 
LuceneIndexManager + 
_luceneIndexProvider, @
;@ A
private 
readonly !
LuceneIndexingService ."
_luceneIndexingService/ E
;E F
private   
readonly   &
LuceneIndexSettingsService   3'
_luceneIndexSettingsService  4 O
;  O P
private!! 
readonly!! !
LuceneAnalyzerManager!! ."
_luceneAnalyzerManager!!/ E
;!!E F
private"" 
readonly"" 
ISearchQueryService"" ,
_searchQueryService""- @
;""@ A
private## 
readonly## 
ISession## !
_session##" *
;##* +
private$$ 
readonly$$ 
IStringLocalizer$$ )
S$$* +
;$$+ ,
private%% 
readonly%% 
IEnumerable%% $
<%%$ %
IPermissionProvider%%% 8
>%%8 9 
_permissionProviders%%: N
;%%N O
private&& 
readonly&& 
dynamic&&  
New&&! $
;&&$ %
private'' 
readonly'' 
ILogger''  
_logger''! (
;''( )
public)) 
SearchController)) 
())  !
IAuthorizationService** ! 
authorizationService**" 6
,**6 7
ISiteService++ 
siteService++ $
,++$ %
LuceneIndexManager,, 
luceneIndexProvider,, 2
,,,2 3!
LuceneIndexingService-- !!
luceneIndexingService--" 7
,--7 8&
LuceneIndexSettingsService.. &&
luceneIndexSettingsService..' A
,..A B!
LuceneAnalyzerManager// !!
luceneAnalyzerManager//" 7
,//7 8
ISearchQueryService00 
searchQueryService00  2
,002 3
ISession11 
session11 
,11 
IStringLocalizer22 
<22 
SearchController22 -
>22- .
stringLocalizer22/ >
,22> ?
IEnumerable33 
<33 
IPermissionProvider33 +
>33+ ,
permissionProviders33- @
,33@ A
IShapeFactory44 
shapeFactory44 &
,44& '
ILogger55 
<55 
SearchController55 $
>55$ %
logger55& ,
)66 
{77 	!
_authorizationService88 !
=88" # 
authorizationService88$ 8
;888 9
_siteService99 
=99 
siteService99 &
;99& ' 
_luceneIndexProvider::  
=::! "
luceneIndexProvider::# 6
;::6 7"
_luceneIndexingService;; "
=;;# $!
luceneIndexingService;;% :
;;;: ;'
_luceneIndexSettingsService<< '
=<<( )&
luceneIndexSettingsService<<* D
;<<D E"
_luceneAnalyzerManager== "
===# $!
luceneAnalyzerManager==% :
;==: ;
_searchQueryService>> 
=>>  !
searchQueryService>>" 4
;>>4 5
_session?? 
=?? 
session?? 
;?? 
S@@ 
=@@ 
stringLocalizer@@ 
;@@   
_permissionProvidersAA  
=AA! "
permissionProvidersAA# 6
;AA6 7
NewBB 
=BB 
shapeFactoryBB 
;BB 
_loggerCC 
=CC 
loggerCC 
;CC 
}DD 	
[FF 	
HttpGetFF	 
]FF 
publicGG 
asyncGG 
TaskGG 
<GG 
IActionResultGG '
>GG' (
SearchGG) /
(GG/ 0 
SearchIndexViewModelGG0 D
	viewModelGGE N
,GGN O
PagerSlimParametersGGP c
pagerParametersGGd s
)GGs t
{HH 	
varII 
permissionsProviderII #
=II$ % 
_permissionProvidersII& :
.II: ;
FirstOrDefaultII; I
(III J
xIIJ K
=>IIL N
xIIO P
.IIP Q
GetTypeIIQ X
(IIX Y
)IIY Z
.IIZ [
FullNameII[ c
==IId f
$str	IIg á
)
IIá à
;
IIà â
varJJ 
permissionsJJ 
=JJ 
awaitJJ #
permissionsProviderJJ$ 7
.JJ7 8
GetPermissionsAsyncJJ8 K
(JJK L
)JJL M
;JJM N
varLL 
siteSettingsLL 
=LL 
awaitLL $
_siteServiceLL% 1
.LL1 2 
GetSiteSettingsAsyncLL2 F
(LLF G
)LLG H
;LLH I
varMM 
searchSettingsMM 
=MM  
siteSettingsMM! -
.MM- .
AsMM. 0
<MM0 1
LuceneSettingsMM1 ?
>MM? @
(MM@ A
)MMA B
;MMB C
ifOO 
(OO 
permissionsOO 
.OO 
FirstOrDefaultOO *
(OO* +
xOO+ ,
=>OO- /
xOO0 1
.OO1 2
NameOO2 6
==OO7 9
$strOO: G
+OOH I
searchSettingsOOJ X
.OOX Y
SearchIndexOOY d
+OOe f
$strOOg n
)OOn o
!=OOp r
nullOOs w
)OOw x
{PP 
ifQQ 
(QQ 
!QQ 
awaitQQ !
_authorizationServiceQQ 0
.QQ0 1
AuthorizeAsyncQQ1 ?
(QQ? @
UserQQ@ D
,QQD E
permissionsQQF Q
.QQQ R
FirstOrDefaultQQR `
(QQ` a
xQQa b
=>QQc e
xQQf g
.QQg h
NameQQh l
==QQm o
$strQQp }
+QQ~ 
searchSettings
QQÄ é
.
QQé è
SearchIndex
QQè ö
+
QQõ ú
$str
QQù §
)
QQ§ •
)
QQ• ¶
)
QQ¶ ß
{RR 
returnSS 
thisSS 
.SS  
ChallengeOrForbidSS  1
(SS1 2
)SS2 3
;SS3 4
}TT 
}UU 
elseVV 
{WW 
_loggerXX 
.XX 
LogInformationXX &
(XX& '
$strXX' a
)XXa b
;XXb c
returnYY 

BadRequestYY !
(YY! "
$strYY" =
)YY= >
;YY> ?
}ZZ 
if\\ 
(\\ 
searchSettings\\ 
.\\ 
SearchIndex\\ *
!=\\+ -
null\\. 2
&&\\3 5
!\\6 7 
_luceneIndexProvider\\7 K
.\\K L
Exists\\L R
(\\R S
searchSettings\\S a
.\\a b
SearchIndex\\b m
)\\m n
)\\n o
{]] 
_logger^^ 
.^^ 
LogInformation^^ &
(^^& '
$str^^' a
)^^a b
;^^b c
return__ 

BadRequest__ !
(__! "
$str__" =
)__= >
;__> ?
}`` 
varbb 
luceneSettingsbb 
=bb  
awaitbb! &"
_luceneIndexingServicebb' =
.bb= >"
GetLuceneSettingsAsyncbb> T
(bbT U
)bbU V
;bbV W
ifdd 
(dd 
luceneSettingsdd 
==dd !
nulldd" &
||dd' )
luceneSettingsdd* 8
?dd8 9
.dd9 :
DefaultSearchFieldsdd: M
==ddN P
nullddQ U
)ddU V
{ee 
_loggerff 
.ff 
LogInformationff &
(ff& '
$strff' a
)ffa b
;ffb c
returngg 

BadRequestgg !
(gg! "
$strgg" =
)gg= >
;gg> ?
}hh 
varjj 
luceneIndexSettingsjj #
=jj$ %
awaitjj& +'
_luceneIndexSettingsServicejj, G
.jjG H
GetSettingsAsyncjjH X
(jjX Y
searchSettingsjjY g
.jjg h
SearchIndexjjh s
)jjs t
;jjt u
ifll 
(ll 
luceneIndexSettingsll #
==ll$ &
nullll' +
)ll+ ,
{mm 
_loggernn 
.nn 
LogInformationnn &
(nn& '
$"nn' )O
CCouldn't execute search. No Lucene index settings was defined for (nn) l
{nnl m
searchSettingsnnm {
.nn{ |
SearchIndex	nn| á
}
nná à
) index.
nnà ê
"
nnê ë
)
nnë í
;
nní ì
returnoo 

BadRequestoo !
(oo! "
$"oo" $
Search index (oo$ 2
{oo2 3
searchSettingsoo3 A
.ooA B
SearchIndexooB M
}ooM N 
) is not configured.ooN b
"oob c
)ooc d
;ood e
}pp 
ifrr 
(rr 
stringrr 
.rr 
IsNullOrWhiteSpacerr )
(rr) *
	viewModelrr* 3
.rr3 4
Termsrr4 9
)rr9 :
)rr: ;
{ss 
returntt 
Viewtt 
(tt 
newtt  
SearchIndexViewModeltt  4
{uu 

SearchFormvv 
=vv  
newvv! $
SearchFormViewModelvv% 8
(vv8 9
$strvv9 G
)vvG H
{vvI J
}vvK L
,vvL M
}ww 
)ww 
;ww 
}xx 
varzz 
pagerzz 
=zz 
newzz 
	PagerSlimzz %
(zz% &
pagerParameterszz& 5
,zz5 6
siteSettingszz7 C
.zzC D
PageSizezzD L
)zzL M
;zzM N
var}} 
analyzer}} 
=}} "
_luceneAnalyzerManager}} 1
.}}1 2
CreateAnalyzer}}2 @
(}}@ A
await}}A F'
_luceneIndexSettingsService}}G b
.}}b c!
GetIndexAnalyzerAsync}}c x
(}}x y 
luceneIndexSettings	}}y å
.
}}å ç
	IndexName
}}ç ñ
)
}}ñ ó
)
}}ó ò
;
}}ò ô
var~~ 
queryParser~~ 
=~~ 
new~~ !!
MultiFieldQueryParser~~" 7
(~~7 8
LuceneSettings~~8 F
.~~F G
DefaultVersion~~G U
,~~U V
luceneSettings~~W e
.~~e f
DefaultSearchFields~~f y
,~~y z
analyzer	~~{ É
)
~~É Ñ
;
~~Ñ Ö
var
ÅÅ 
start
ÅÅ 
=
ÅÅ 
$num
ÅÅ 
;
ÅÅ 
var
ÇÇ 
end
ÇÇ 
=
ÇÇ 
pager
ÇÇ 
.
ÇÇ 
PageSize
ÇÇ $
+
ÇÇ% &
$num
ÇÇ' (
;
ÇÇ( )
if
ÑÑ 
(
ÑÑ 
pagerParameters
ÑÑ 
.
ÑÑ  
Before
ÑÑ  &
!=
ÑÑ' )
null
ÑÑ* .
)
ÑÑ. /
{
ÖÖ 
start
ÜÜ 
=
ÜÜ 
Convert
ÜÜ 
.
ÜÜ  
ToInt32
ÜÜ  '
(
ÜÜ' (
pagerParameters
ÜÜ( 7
.
ÜÜ7 8
Before
ÜÜ8 >
)
ÜÜ> ?
-
ÜÜ@ A
pager
ÜÜB G
.
ÜÜG H
PageSize
ÜÜH P
-
ÜÜQ R
$num
ÜÜS T
;
ÜÜT U
end
áá 
=
áá 
Convert
áá 
.
áá 
ToInt32
áá %
(
áá% &
pagerParameters
áá& 5
.
áá5 6
Before
áá6 <
)
áá< =
;
áá= >
}
àà 
else
ââ 
if
ââ 
(
ââ 
pagerParameters
ââ $
.
ââ$ %
After
ââ% *
!=
ââ+ -
null
ââ. 2
)
ââ2 3
{
ää 
start
ãã 
=
ãã 
Convert
ãã 
.
ãã  
ToInt32
ãã  '
(
ãã' (
pagerParameters
ãã( 7
.
ãã7 8
After
ãã8 =
)
ãã= >
;
ãã> ?
end
åå 
=
åå 
Convert
åå 
.
åå 
ToInt32
åå %
(
åå% &
pagerParameters
åå& 5
.
åå5 6
After
åå6 ;
)
åå; <
+
åå= >
pager
åå? D
.
ååD E
PageSize
ååE M
+
ååN O
$num
ååP Q
;
ååQ R
}
çç 
var
èè 
terms
èè 
=
èè 
	viewModel
èè !
.
èè! "
Terms
èè" '
;
èè' (
if
êê 
(
êê 
!
êê 
searchSettings
êê 
.
êê  (
AllowLuceneQueriesInSearch
êê  :
)
êê: ;
{
ëë 
terms
íí 
=
íí 
QueryParser
íí #
.
íí# $
Escape
íí$ *
(
íí* +
terms
íí+ 0
)
íí0 1
;
íí1 2
}
ìì 
IList
ïï 
<
ïï 
string
ïï 
>
ïï 
contentItemIds
ïï (
;
ïï( )
try
ññ 
{
óó 
var
òò 
query
òò 
=
òò 
queryParser
òò '
.
òò' (
Parse
òò( -
(
òò- .
terms
òò. 3
)
òò3 4
;
òò4 5
contentItemIds
ôô 
=
ôô  
(
ôô! "
await
ôô" '!
_searchQueryService
ôô( ;
.
ôô; <
ExecuteQueryAsync
ôô< M
(
ôôM N
query
ôôN S
,
ôôS T
searchSettings
ôôU c
.
ôôc d
SearchIndex
ôôd o
,
ôôo p
start
ôôq v
,
ôôv w
end
ôôx {
)
ôô{ |
)
ôô| }
.
öö 
ToList
öö 
(
öö 
)
öö 
;
öö 
}
õõ 
catch
úú 
(
úú 
ParseException
úú !
e
úú" #
)
úú# $
{
ùù 

ModelState
ûû 
.
ûû 
AddModelError
ûû (
(
ûû( )
$str
ûû) 0
,
ûû0 1
S
ûû2 3
[
ûû3 4
$str
ûû4 M
]
ûûM N
)
ûûN O
;
ûûO P
_logger
üü 
.
üü 
LogError
üü  
(
üü  !
e
üü! "
,
üü" #
$str
üü$ ^
)
üü^ _
;
üü_ `
return
¢¢ 
View
¢¢ 
(
¢¢ 
new
¢¢ "
SearchIndexViewModel
¢¢  4
{
££ 
Terms
§§ 
=
§§ 
	viewModel
§§ %
.
§§% &
Terms
§§& +
,
§§+ ,

SearchForm
•• 
=
••  
new
••! $!
SearchFormViewModel
••% 8
(
••8 9
$str
••9 G
)
••G H
{
••I J
Terms
••K P
=
••Q R
	viewModel
••S \
.
••\ ]
Terms
••] b
}
••c d
,
••d e
}
¶¶ 
)
¶¶ 
;
¶¶ 
}
ßß 
IQuery
™™ 
<
™™ 
ContentItem
™™ 
>
™™ 
queryDb
™™  '
;
™™' (
if
¨¨ 
(
¨¨ !
luceneIndexSettings
¨¨ #
.
¨¨# $
IndexLatest
¨¨$ /
)
¨¨/ 0
{
≠≠ 
queryDb
ÆÆ 
=
ÆÆ 
_session
ÆÆ "
.
ÆÆ" #
Query
ÆÆ# (
<
ÆÆ( )
ContentItem
ÆÆ) 4
,
ÆÆ4 5
ContentItemIndex
ÆÆ6 F
>
ÆÆF G
(
ÆÆG H
)
ÆÆH I
.
ØØ 
Where
ØØ 
(
ØØ 
x
ØØ 
=>
ØØ 
x
ØØ  !
.
ØØ! "
ContentItemId
ØØ" /
.
ØØ/ 0
IsIn
ØØ0 4
(
ØØ4 5
contentItemIds
ØØ5 C
)
ØØC D
&&
ØØE G
x
ØØH I
.
ØØI J
Latest
ØØJ P
==
ØØQ S
true
ØØT X
)
ØØX Y
.
∞∞ 
Take
∞∞ 
(
∞∞ 
pager
∞∞ 
.
∞∞  
PageSize
∞∞  (
+
∞∞) *
$num
∞∞+ ,
)
∞∞, -
;
∞∞- .
}
±± 
else
≤≤ 
{
≥≥ 
queryDb
¥¥ 
=
¥¥ 
_session
¥¥ "
.
¥¥" #
Query
¥¥# (
<
¥¥( )
ContentItem
¥¥) 4
,
¥¥4 5
ContentItemIndex
¥¥6 F
>
¥¥F G
(
¥¥G H
)
¥¥H I
.
µµ 
Where
µµ 
(
µµ 
x
µµ 
=>
µµ 
x
µµ  !
.
µµ! "
ContentItemId
µµ" /
.
µµ/ 0
IsIn
µµ0 4
(
µµ4 5
contentItemIds
µµ5 C
)
µµC D
&&
µµE G
x
µµH I
.
µµI J
	Published
µµJ S
==
µµT V
true
µµW [
)
µµ[ \
.
∂∂ 
Take
∂∂ 
(
∂∂ 
pager
∂∂ 
.
∂∂  
PageSize
∂∂  (
+
∂∂) *
$num
∂∂+ ,
)
∂∂, -
;
∂∂- .
}
∑∑ 
var
∫∫ 
containedItems
∫∫ 
=
∫∫  
(
∫∫! "
await
∫∫" '
queryDb
∫∫( /
.
∫∫/ 0
	ListAsync
∫∫0 9
(
∫∫9 :
)
∫∫: ;
)
∫∫; <
.
∫∫< =
OrderBy
∫∫= D
(
∫∫D E
x
∫∫E F
=>
∫∫G I
contentItemIds
∫∫J X
.
∫∫X Y
IndexOf
∫∫Y `
(
∫∫` a
x
∫∫a b
.
∫∫b c
ContentItemId
∫∫c p
)
∫∫p q
)
∫∫q r
;
∫∫r s
if
ΩΩ 
(
ΩΩ 
pagerParameters
ΩΩ 
.
ΩΩ  
After
ΩΩ  %
!=
ΩΩ& (
null
ΩΩ) -
||
ΩΩ. 0
pagerParameters
ΩΩ1 @
.
ΩΩ@ A
Before
ΩΩA G
!=
ΩΩH J
null
ΩΩK O
)
ΩΩO P
{
ææ 
if
øø 
(
øø 
start
øø 
+
øø 
$num
øø 
>
øø 
$num
øø  !
)
øø! "
{
¿¿ 
pager
¡¡ 
.
¡¡ 
Before
¡¡  
=
¡¡! "
(
¡¡# $
start
¡¡$ )
+
¡¡* +
$num
¡¡, -
)
¡¡- .
.
¡¡. /
ToString
¡¡/ 7
(
¡¡7 8
)
¡¡8 9
;
¡¡9 :
}
¬¬ 
else
√√ 
{
ƒƒ 
pager
≈≈ 
.
≈≈ 
Before
≈≈  
=
≈≈! "
null
≈≈# '
;
≈≈' (
}
∆∆ 
}
«« 
if
…… 
(
…… 
containedItems
…… 
.
…… 
Count
…… $
(
……$ %
)
……% &
==
……' )
pager
……* /
.
……/ 0
PageSize
……0 8
+
……9 :
$num
……; <
)
……< =
{
   
pager
ÀÀ 
.
ÀÀ 
After
ÀÀ 
=
ÀÀ 
(
ÀÀ 
end
ÀÀ "
-
ÀÀ# $
$num
ÀÀ% &
)
ÀÀ& '
.
ÀÀ' (
ToString
ÀÀ( 0
(
ÀÀ0 1
)
ÀÀ1 2
;
ÀÀ2 3
}
ÃÃ 
else
ÕÕ 
{
ŒŒ 
pager
œœ 
.
œœ 
After
œœ 
=
œœ 
null
œœ "
;
œœ" #
}
–– 
var
““ 
model
““ 
=
““ 
new
““ "
SearchIndexViewModel
““ 0
{
”” 
Terms
‘‘ 
=
‘‘ 
	viewModel
‘‘ !
.
‘‘! "
Terms
‘‘" '
,
‘‘' (

SearchForm
’’ 
=
’’ 
new
’’  !
SearchFormViewModel
’’! 4
(
’’4 5
$str
’’5 C
)
’’C D
{
’’E F
Terms
’’G L
=
’’M N
	viewModel
’’O X
.
’’X Y
Terms
’’Y ^
}
’’_ `
,
’’` a
SearchResults
÷÷ 
=
÷÷ 
new
÷÷  #$
SearchResultsViewModel
÷÷$ :
(
÷÷: ;
$str
÷÷; L
)
÷÷L M
{
÷÷N O
ContentItems
÷÷P \
=
÷÷] ^
containedItems
÷÷_ m
.
÷÷m n
Take
÷÷n r
(
÷÷r s
pager
÷÷s x
.
÷÷x y
PageSize÷÷y Å
)÷÷Å Ç
}÷÷É Ñ
,÷÷Ñ Ö
Pager
◊◊ 
=
◊◊ 
(
◊◊ 
await
◊◊ 
New
◊◊ "
.
◊◊" #
	PagerSlim
◊◊# ,
(
◊◊, -
pager
◊◊- 2
)
◊◊2 3
)
◊◊3 4
.
◊◊4 5
	UrlParams
◊◊5 >
(
◊◊> ?
new
◊◊? B

Dictionary
◊◊C M
<
◊◊M N
string
◊◊N T
,
◊◊T U
string
◊◊V \
>
◊◊\ ]
(
◊◊] ^
)
◊◊^ _
{
◊◊` a
{
◊◊b c
$str
◊◊d k
,
◊◊k l
	viewModel
◊◊m v
.
◊◊v w
Terms
◊◊w |
}
◊◊} ~
}◊◊ Ä
)◊◊Ä Å
}
ÿÿ 
;
ÿÿ 
return
⁄⁄ 
View
⁄⁄ 
(
⁄⁄ 
model
⁄⁄ 
)
⁄⁄ 
;
⁄⁄ 
}
€€ 	
}
‹‹ 
}›› ¸
úD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneIndexDeploymentSource.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

Deployment '
{		 
public

 

class

 '
LuceneIndexDeploymentSource

 ,
:

- .
IDeploymentSource

/ @
{ 
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
public '
LuceneIndexDeploymentSource *
(* +&
LuceneIndexSettingsService+ E&
luceneIndexSettingsServiceF `
)` a
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E
} 	
public 
async 
Task &
ProcessDeploymentStepAsync 4
(4 5
DeploymentStep5 C
stepD H
,H I 
DeploymentPlanResultJ ^
result_ e
)e f
{ 	
var 
luceneIndexStep 
=  !
step" &
as' )%
LuceneIndexDeploymentStep* C
;C D
if 
( 
luceneIndexStep 
==  "
null# '
)' (
{ 
return 
; 
} 
var 
indexSettings 
= 
await  %'
_luceneIndexSettingsService& A
.A B
GetSettingsAsyncB R
(R S
)S T
;T U
var 
data 
= 
new 
JArray !
(! "
)" #
;# $
var 
indicesToAdd 
= 
luceneIndexStep .
.. /

IncludeAll/ 9
?: ;
indexSettings< I
.I J
SelectJ P
(P Q
xQ R
=>S U
xV W
.W X
	IndexNameX a
)a b
.b c
ToArrayc j
(j k
)k l
:m n
luceneIndexStepo ~
.~ 

IndexNames	 â
;
â ä
foreach!! 
(!! 
var!! 
index!! 
in!! !
indexSettings!!" /
)!!/ 0
{"" 
if## 
(## 
indicesToAdd##  
.##  !
Contains##! )
(##) *
index##* /
.##/ 0
	IndexName##0 9
)##9 :
)##: ;
{$$ 
var%% 
indexSettingsDict%% )
=%%* +
new%%, /

Dictionary%%0 :
<%%: ;
string%%; A
,%%A B
LuceneIndexSettings%%C V
>%%V W
(%%W X
)%%X Y
;%%Y Z
indexSettingsDict&& %
.&&% &
Add&&& )
(&&) *
index&&* /
.&&/ 0
	IndexName&&0 9
,&&9 :
index&&; @
)&&@ A
;&&A B
data'' 
.'' 
Add'' 
('' 
JObject'' $
.''$ %

FromObject''% /
(''/ 0
indexSettingsDict''0 A
)''A B
)''B C
;''C D
}(( 
})) 
result,, 
.,, 
Steps,, 
.,, 
Add,, 
(,, 
new,,  
JObject,,! (
(,,( )
new-- 
	JProperty-- 
(-- 
$str-- $
,--$ %
$str--& 4
)--4 5
,--5 6
new.. 
	JProperty.. 
(.. 
$str.. '
,..' (
data..) -
)..- .
)// 
)// 
;// 
}00 	
}11 
}22 á
öD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneIndexDeploymentStep.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

Deployment '
{ 
public 

class %
LuceneIndexDeploymentStep *
:+ ,
DeploymentStep- ;
{		 
public

 %
LuceneIndexDeploymentStep

 (
(

( )
)

) *
{ 	
Name 
= 
$str  
;  !
} 	
public 
bool 

IncludeAll 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
true/ 3
;3 4
public 
string 
[ 
] 

IndexNames "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} †#
†D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneIndexDeploymentStepDriver.cs
	namespace

 	
OrchardCore


 
.

 
Lucene

 
.

 

Deployment

 '
{ 
public 

class +
LuceneIndexDeploymentStepDriver 0
:1 2
DisplayDriver3 @
<@ A
DeploymentStepA O
,O P%
LuceneIndexDeploymentStepQ j
>j k
{ 
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
public +
LuceneIndexDeploymentStepDriver .
(. /&
LuceneIndexSettingsService/ I&
luceneIndexSettingsServiceJ d
)d e
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E
} 	
public 
override 
IDisplayResult &
Display' .
(. /%
LuceneIndexDeploymentStep/ H
stepI M
)M N
{ 	
return 
Combine 
( 
View 
( 
$str C
,C D
stepE I
)I J
.J K
LocationK S
(S T
$strT ]
,] ^
$str_ h
)h i
,i j
View 
( 
$str E
,E F
stepG K
)K L
.L M
LocationM U
(U V
$strV a
,a b
$strc l
)l m
) 
; 
} 	
public 
override 
IDisplayResult &
Edit' +
(+ ,%
LuceneIndexDeploymentStep, E
stepF J
)J K
{ 	
return   

Initialize   
<   .
"LuceneIndexDeploymentStepViewModel   @
>  @ A
(  A B
$str  B i
,  i j
async  k p
model  q v
=>  w y
{!! 
model"" 
."" 

IncludeAll""  
=""! "
step""# '
.""' (

IncludeAll""( 2
;""2 3
model## 
.## 

IndexNames##  
=##! "
step### '
.##' (

IndexNames##( 2
;##2 3
model$$ 
.$$ 
AllIndexNames$$ #
=$$$ %
($$& '
await$$' ,'
_luceneIndexSettingsService$$- H
.$$H I
GetSettingsAsync$$I Y
($$Y Z
)$$Z [
)$$[ \
.$$\ ]
Select$$] c
($$c d
x$$d e
=>$$f h
x$$i j
.$$j k
	IndexName$$k t
)$$t u
.$$u v
ToArray$$v }
($$} ~
)$$~ 
;	$$ Ä
}%% 
)%% 
.%% 
Location%% 
(%% 
$str%% !
)%%! "
;%%" #
}&& 	
public(( 
override(( 
async(( 
Task(( "
<((" #
IDisplayResult((# 1
>((1 2
UpdateAsync((3 >
(((> ?%
LuceneIndexDeploymentStep((? X
step((Y ]
,((] ^
IUpdateModel((_ k
updater((l s
)((s t
{)) 	
step** 
.** 

IndexNames** 
=** 
Array** #
.**# $
Empty**$ )
<**) *
string*** 0
>**0 1
(**1 2
)**2 3
;**3 4
await,, 
updater,, 
.,, 
TryUpdateModelAsync,, -
(,,- .
step,,. 2
,,,2 3
Prefix--. 4
,--4 5
x... /
=>..0 2
x..3 4
...4 5

IndexNames..5 ?
,..? @
x//. /
=>//0 2
x//3 4
.//4 5

IncludeAll//5 ?
)//? @
;//@ A
if22 
(22 
step22 
.22 

IncludeAll22 
)22  
{33 
step44 
.44 

IndexNames44 
=44  !
Array44" '
.44' (
Empty44( -
<44- .
string44. 4
>444 5
(445 6
)446 7
;447 8
}55 
return77 
Edit77 
(77 
step77 
)77 
;77 
}88 	
}99 
}:: ÷
üD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneSettingsDeploymentSource.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

Deployment '
{ 
public 

class *
LuceneSettingsDeploymentSource /
:0 1
IDeploymentSource2 C
{ 
private		 
readonly		 !
LuceneIndexingService		 ."
_luceneIndexingService		/ E
;		E F
public *
LuceneSettingsDeploymentSource -
(- .!
LuceneIndexingService. C!
luceneIndexingServiceD Y
)Y Z
{ 	"
_luceneIndexingService "
=# $!
luceneIndexingService% :
;: ;
} 	
public 
async 
Task &
ProcessDeploymentStepAsync 4
(4 5
DeploymentStep5 C
stepD H
,H I 
DeploymentPlanResultJ ^
result_ e
)e f
{ 	
var 
luceneSettingsStep "
=# $
step% )
as* ,(
LuceneSettingsDeploymentStep- I
;I J
if 
( 
luceneSettingsStep "
==# %
null& *
)* +
{ 
return 
; 
} 
var 
luceneSettings 
=  
await! &"
_luceneIndexingService' =
.= >"
GetLuceneSettingsAsync> T
(T U
)U V
;V W
result 
. 
Steps 
. 
Add 
( 
new  
JObject! (
(( )
new 
	JProperty 
( 
$str $
,$ %
$str& 0
)0 1
,1 2
new 
	JProperty 
( 
$str .
,. /
JObject0 7
.7 8

FromObject8 B
(B C
luceneSettingsC Q
)Q R
)R S
) 
) 
; 
}   	
}!! 
}"" à
ùD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneSettingsDeploymentStep.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

Deployment '
{ 
public 

class (
LuceneSettingsDeploymentStep -
:. /
DeploymentStep0 >
{		 
public

 (
LuceneSettingsDeploymentStep

 +
(

+ ,
)

, -
{ 	
Name 
= 
$str #
;# $
} 	
} 
} ﬂ
£D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Deployment\LuceneSettingsDeploymentStepDriver.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

Deployment '
{ 
public 

class .
"LuceneSettingsDeploymentStepDriver 3
:4 5
DisplayDriver6 C
<C D
DeploymentStepD R
,R S(
LuceneSettingsDeploymentStepT p
>p q
{ 
public		 
override		 
IDisplayResult		 &
Display		' .
(		. /(
LuceneSettingsDeploymentStep		/ K
step		L P
)		P Q
{

 	
return 
Combine 
( 
View 
( 
$str F
,F G
stepH L
)L M
.M N
LocationN V
(V W
$strW `
,` a
$strb k
)k l
,l m
View 
( 
$str H
,H I
stepJ N
)N O
.O P
LocationP X
(X Y
$strY d
,d e
$strf o
)o p
) 
; 
} 	
public 
override 
IDisplayResult &
Edit' +
(+ ,(
LuceneSettingsDeploymentStep, H
stepI M
)M N
{ 	
return 
View 
( 
$str B
,B C
stepD H
)H I
.I J
LocationJ R
(R S
$strS \
)\ ]
;] ^
} 	
} 
} §7
ñD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Drivers\LuceneQueryDisplayDriver.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Drivers $
{ 
public 

class $
LuceneQueryDisplayDriver )
:* +
DisplayDriver, 9
<9 :
Query: ?
,? @
LuceneQueryA L
>L M
{ 
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public $
LuceneQueryDisplayDriver '
(' (
IStringLocalizer 
< $
LuceneQueryDisplayDriver 5
>5 6
stringLocalizer7 F
,F G&
LuceneIndexSettingsService &&
luceneIndexSettingsService' A
)A B
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E
S 
= 
stringLocalizer 
;  
} 	
public 
override 
IDisplayResult &
Display' .
(. /
LuceneQuery/ :
query; @
,@ A
IUpdateModelB N
updaterO V
)V W
{ 	
return 
Combine 
( 
Dynamic 
( 
$str 2
,2 3
model4 9
=>: <
{= >
model? D
.D E
QueryE J
=K L
queryM R
;R S
}T U
)U V
.V W
LocationW _
(_ `
$str` k
)k l
,l m
Dynamic 
( 
$str :
,: ;
model< A
=>B D
{E F
modelG L
.L M
QueryM R
=S T
queryU Z
;Z [
}\ ]
)] ^
.^ _
Location_ g
(g h
$strh s
)s t
) 
; 
}   	
public"" 
override"" 
IDisplayResult"" &
Edit""' +
(""+ ,
LuceneQuery"", 7
query""8 =
,""= >
IUpdateModel""? K
updater""L S
)""S T
{## 	
return$$ 

Initialize$$ 
<$$  
LuceneQueryViewModel$$ 2
>$$2 3
($$3 4
$str$$4 F
,$$F G
async$$H M
model$$N S
=>$$T V
{%% 
model&& 
.&& 
Query&& 
=&& 
query&& #
.&&# $
Template&&$ ,
;&&, -
model'' 
.'' 
Index'' 
='' 
query'' #
.''# $
Index''$ )
;'') *
model(( 
.(( 
ReturnContentItems(( (
=(() *
query((+ 0
.((0 1
ReturnContentItems((1 C
;((C D
model)) 
.)) 
Indices)) 
=)) 
())  !
await))! &'
_luceneIndexSettingsService))' B
.))B C
GetSettingsAsync))C S
())S T
)))T U
)))U V
.))V W
Select))W ]
())] ^
x))^ _
=>))` b
x))c d
.))d e
	IndexName))e n
)))n o
.))o p
ToArray))p w
())w x
)))x y
;))y z
if,, 
(,, 
String,, 
.,, 
IsNullOrEmpty,, (
(,,( )
query,,) .
.,,. /
Template,,/ 7
),,7 8
),,8 9
{-- 
await.. 
updater.. !
...! "
TryUpdateModelAsync.." 5
(..5 6
model..6 ;
,..; <
$str..= ?
,..? @
m..A B
=>..C E
m..F G
...G H
Query..H M
)..M N
;..N O
}// 
}00 
)00 
.00 
Location00 
(00 
$str00 #
)00# $
;00$ %
}11 	
public33 
override33 
async33 
Task33 "
<33" #
IDisplayResult33# 1
>331 2
UpdateAsync333 >
(33> ?
LuceneQuery33? J
model33K P
,33P Q
IUpdateModel33R ^
updater33_ f
)33f g
{44 	
var55 
	viewModel55 
=55 
new55  
LuceneQueryViewModel55  4
(554 5
)555 6
;556 7
if66 
(66 
await66 
updater66 
.66 
TryUpdateModelAsync66 1
(661 2
	viewModel662 ;
,66; <
Prefix66= C
,66C D
m66E F
=>66G I
m66J K
.66K L
Query66L Q
,66Q R
m66S T
=>66U W
m66X Y
.66Y Z
Index66Z _
,66_ `
m66a b
=>66c e
m66f g
.66g h
ReturnContentItems66h z
)66z {
)66{ |
{77 
model88 
.88 
Template88 
=88  
	viewModel88! *
.88* +
Query88+ 0
;880 1
model99 
.99 
Index99 
=99 
	viewModel99 '
.99' (
Index99( -
;99- .
model:: 
.:: 
ReturnContentItems:: (
=::) *
	viewModel::+ 4
.::4 5
ReturnContentItems::5 G
;::G H
};; 
if== 
(== 
String== 
.== 
IsNullOrWhiteSpace== )
(==) *
model==* /
.==/ 0
Template==0 8
)==8 9
)==9 :
{>> 
updater?? 
.?? 

ModelState?? "
.??" #
AddModelError??# 0
(??0 1
nameof??1 7
(??7 8
model??8 =
.??= >
Template??> F
)??F G
,??G H
S??I J
[??J K
$str??K h
]??h i
)??i j
;??j k
}@@ 
ifBB 
(BB 
StringBB 
.BB 
IsNullOrWhiteSpaceBB )
(BB) *
modelBB* /
.BB/ 0
IndexBB0 5
)BB5 6
)BB6 7
{CC 
updaterDD 
.DD 

ModelStateDD "
.DD" #
AddModelErrorDD# 0
(DD0 1
nameofDD1 7
(DD7 8
modelDD8 =
.DD= >
IndexDD> C
)DDC D
,DDD E
SDDF G
[DDG H
$strDDH e
]DDe f
)DDf g
;DDg h
}EE 
returnGG 
EditGG 
(GG 
modelGG 
,GG 
updaterGG &
)GG& '
;GG' (
}HH 	
}II 
}JJ …3
ôD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Drivers\LuceneSettingsDisplayDriver.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Drivers $
{ 
public 

class '
LuceneSettingsDisplayDriver ,
:- . 
SectionDisplayDriver/ C
<C D
ISiteD I
,I J
LuceneSettingsK Y
>Y Z
{ 
public 
const 
string 
GroupId #
=$ %
$str& .
;. /
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
public '
LuceneSettingsDisplayDriver *
(* +&
LuceneIndexSettingsService &&
luceneIndexSettingsService' A
,A B 
IHttpContextAccessor  
httpContextAccessor! 4
,4 5!
IAuthorizationService ! 
authorizationService" 6
) 
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_authorizationService !
=" # 
authorizationService$ 8
;8 9
} 	
public!! 
override!! 
async!! 
Task!! "
<!!" #
IDisplayResult!!# 1
>!!1 2
	EditAsync!!3 <
(!!< =
LuceneSettings!!= K
settings!!L T
,!!T U
BuildEditorContext!!V h
context!!i p
)!!p q
{"" 	
var## 
user## 
=##  
_httpContextAccessor## +
.##+ ,
HttpContext##, 7
?##7 8
.##8 9
User##9 =
;##= >
if%% 
(%% 
!%% 
await%% !
_authorizationService%% ,
.%%, -
AuthorizeAsync%%- ;
(%%; <
user%%< @
,%%@ A
Permissions%%B M
.%%M N
ManageIndexes%%N [
)%%[ \
)%%\ ]
{&& 
return'' 
null'' 
;'' 
}(( 
return** 

Initialize** 
<** #
LuceneSettingsViewModel** 5
>**5 6
(**6 7
$str**7 L
,**L M
async**N S
model**T Y
=>**Z \
{++ 
model,, 
.,, 
SearchIndex,, %
=,,& '
settings,,( 0
.,,0 1
SearchIndex,,1 <
;,,< =
model-- 
.-- 
SearchFields-- &
=--' (
String--) /
.--/ 0
Join--0 4
(--4 5
$str--5 9
,--9 :
settings--; C
.--C D
DefaultSearchFields--D W
??--X Z
new--[ ^
string--_ e
[--e f
$num--f g
]--g h
)--h i
;--i j
model.. 
... 
SearchIndexes.. '
=..( )
(..* +
await..+ 0'
_luceneIndexSettingsService..1 L
...L M
GetSettingsAsync..M ]
(..] ^
)..^ _
).._ `
...` a
Select..a g
(..g h
x..h i
=>..j l
x..m n
...n o
	IndexName..o x
)..x y
;..y z
model// 
.// &
AllowLuceneQueriesInSearch// 4
=//5 6
settings//7 ?
.//? @&
AllowLuceneQueriesInSearch//@ Z
;//Z [
}00 
)00 
.00 
Location00 
(00 
$str00 '
)00' (
.00( )
OnGroup00) 0
(000 1
GroupId001 8
)008 9
;009 :
}11 	
public33 
override33 
async33 
Task33 "
<33" #
IDisplayResult33# 1
>331 2
UpdateAsync333 >
(33> ?
LuceneSettings33? M
section33N U
,33U V
BuildEditorContext33W i
context33j q
)33q r
{44 	
var55 
user55 
=55  
_httpContextAccessor55 +
.55+ ,
HttpContext55, 7
?557 8
.558 9
User559 =
;55= >
if77 
(77 
!77 
await77 !
_authorizationService77 ,
.77, -
AuthorizeAsync77- ;
(77; <
user77< @
,77@ A
Permissions77B M
.77M N
ManageIndexes77N [
)77[ \
)77\ ]
{88 
return99 
null99 
;99 
}:: 
if<< 
(<< 
context<< 
.<< 
GroupId<< 
==<<  "
GroupId<<# *
)<<* +
{== 
var>> 
model>> 
=>> 
new>> #
LuceneSettingsViewModel>>  7
(>>7 8
)>>8 9
;>>9 :
await@@ 
context@@ 
.@@ 
Updater@@ %
.@@% &
TryUpdateModelAsync@@& 9
(@@9 :
model@@: ?
,@@? @
Prefix@@A G
)@@G H
;@@H I
sectionBB 
.BB 
SearchIndexBB #
=BB$ %
modelBB& +
.BB+ ,
SearchIndexBB, 7
;BB7 8
sectionCC 
.CC 
DefaultSearchFieldsCC +
=CC, -
modelCC. 3
.CC3 4
SearchFieldsCC4 @
?CC@ A
.CCA B
SplitCCB G
(CCG H
newCCH K
[CCK L
]CCL M
{CCN O
$charCCP S
,CCS T
$charCCU X
}CCY Z
,CCZ [
StringSplitOptionsCC\ n
.CCn o
RemoveEmptyEntries	CCo Å
)
CCÅ Ç
;
CCÇ É
sectionDD 
.DD &
AllowLuceneQueriesInSearchDD 2
=DD3 4
modelDD5 :
.DD: ;&
AllowLuceneQueriesInSearchDD; U
;DDU V
}EE 
returnGG 
awaitGG 
	EditAsyncGG "
(GG" #
sectionGG# *
,GG* +
contextGG, 3
)GG3 4
;GG4 5
}HH 	
}II 
}JJ òì
öD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\GraphQL\LuceneQueryFieldTypeProvider.cs
	namespace 	
OrchardCore
 
. 
Queries 
. 
Lucene $
.$ %
GraphQL% ,
., -
Queries- 4
{ 
public 

class (
LuceneQueryFieldTypeProvider -
:. /
ISchemaBuilder0 >
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly 
ILogger  
<  !(
LuceneQueryFieldTypeProvider! =
>= >
_logger? F
;F G
public (
LuceneQueryFieldTypeProvider +
(+ , 
IHttpContextAccessor, @
httpContextAccessorA T
,T U
ILoggerV ]
<] ^(
LuceneQueryFieldTypeProvider^ z
>z {
logger	| Ç
)
Ç É
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
_logger 
= 
logger 
; 
} 	
public 
Task 
< 
string 
> 
GetIdentifierAsync .
(. /
)/ 0
{ 	
var 
queryManager 
=  
_httpContextAccessor 3
.3 4
HttpContext4 ?
.? @
RequestServices@ O
.O P

GetServiceP Z
<Z [
IQueryManager[ h
>h i
(i j
)j k
;k l
return   
queryManager   
.    
GetIdentifierAsync    2
(  2 3
)  3 4
;  4 5
}!! 	
public## 
async## 
Task## 

BuildAsync## $
(##$ %
ISchema##% ,
schema##- 3
)##3 4
{$$ 	
var%% 
queryManager%% 
=%%  
_httpContextAccessor%% 3
.%%3 4
HttpContext%%4 ?
.%%? @
RequestServices%%@ O
.%%O P

GetService%%P Z
<%%Z [
IQueryManager%%[ h
>%%h i
(%%i j
)%%j k
;%%k l
var'' 
queries'' 
='' 
await'' 
queryManager''  ,
.'', -
ListQueriesAsync''- =
(''= >
)''> ?
;''? @
foreach)) 
()) 
var)) 
query)) 
in)) !
queries))" )
.))) *
OfType))* 0
<))0 1
LuceneQuery))1 <
>))< =
())= >
)))> ?
)))? @
{** 
if++ 
(++ 
String++ 
.++ 
IsNullOrWhiteSpace++ -
(++- .
query++. 3
.++3 4
Schema++4 :
)++: ;
)++; <
continue,, 
;,, 
var.. 
name.. 
=.. 
query..  
...  !
Name..! %
;..% &
try00 
{11 
var22 
querySchema22 #
=22$ %
JObject22& -
.22- .
Parse22. 3
(223 4
query224 9
.229 :
Schema22: @
)22@ A
;22A B
if33 
(33 
!33 
querySchema33 $
.33$ %
ContainsKey33% 0
(330 1
$str331 7
)337 8
)338 9
{44 
_logger55 
.55  
LogError55  (
(55( )
$str55) s
,55s t
name55u y
)55y z
;55z {
continue66  
;66  !
}77 
var88 
type88 
=88 
querySchema88 *
[88* +
$str88+ 1
]881 2
.882 3
ToString883 ;
(88; <
)88< =
;88= >
	FieldType99 
	fieldType99 '
;99' (
var;; 
fieldTypeName;; %
=;;& '
querySchema;;( 3
[;;3 4
$str;;4 C
];;C D
?;;D E
.;;E F
ToString;;F N
(;;N O
);;O P
??;;Q S
query;;T Y
.;;Y Z
Name;;Z ^
;;;^ _
if== 
(== 
query== 
.== 
ReturnContentItems== 0
&&==1 3
type>> 
.>> 

StartsWith>> '
(>>' (
$str>>( 6
,>>6 7
StringComparison>>8 H
.>>H I
OrdinalIgnoreCase>>I Z
)>>Z [
)>>[ \
{?? 
var@@ 
contentType@@ '
=@@( )
type@@* .
.@@. /
Remove@@/ 5
(@@5 6
$num@@6 7
,@@7 8
$num@@9 ;
)@@; <
;@@< =
	fieldTypeAA !
=AA" #%
BuildContentTypeFieldTypeAA$ =
(AA= >
schemaAA> D
,AAD E
contentTypeAAF Q
,AAQ R
queryAAS X
,AAX Y
fieldTypeNameAAZ g
)AAg h
;AAh i
}BB 
elseCC 
{DD 
	fieldTypeEE !
=EE" #%
BuildSchemaBasedFieldTypeEE$ =
(EE= >
queryEE> C
,EEC D
querySchemaEEE P
,EEP Q
fieldTypeNameEER _
)EE_ `
;EE` a
}FF 
ifHH 
(HH 
	fieldTypeHH !
!=HH" $
nullHH% )
)HH) *
{II 
schemaJJ 
.JJ 
QueryJJ $
.JJ$ %
AddFieldJJ% -
(JJ- .
	fieldTypeJJ. 7
)JJ7 8
;JJ8 9
}KK 
}LL 
catchMM 
(MM 
	ExceptionMM  
eMM! "
)MM" #
{NN 
_loggerOO 
.OO 
LogErrorOO $
(OO$ %
eOO% &
,OO& '
$strOO( S
,OOS T
nameOOU Y
)OOY Z
;OOZ [
}PP 
}QQ 
}RR 	
privateTT 
	FieldTypeTT %
BuildSchemaBasedFieldTypeTT 3
(TT3 4
LuceneQueryTT4 ?
queryTT@ E
,TTE F
JTokenTTG M
querySchemaTTN Y
,TTY Z
stringTT[ a
fieldTypeNameTTb o
)TTo p
{UU 	
varVV 

propertiesVV 
=VV 
querySchemaVV (
[VV( )
$strVV) 5
]VV5 6
;VV6 7
ifWW 
(WW 

propertiesWW 
==WW 
nullWW "
)WW" #
{XX 
returnYY 
nullYY 
;YY 
}ZZ 
var\\ 
typetype\\ 
=\\ 
new\\ 
ObjectGraphType\\ .
<\\. /
JObject\\/ 6
>\\6 7
{]] 
Name^^ 
=^^ 
fieldTypeName^^ $
}__ 
;__ 
foreachaa 
(aa 
	JPropertyaa 
childaa $
inaa% '

propertiesaa( 2
.aa2 3
Childrenaa3 ;
(aa; <
)aa< =
)aa= >
{bb 
varcc 
namecc 
=cc 
childcc  
.cc  !
Namecc! %
;cc% &
vardd 
	nameLowerdd 
=dd 
namedd  $
.dd$ %
Replacedd% ,
(dd, -
$chardd- 0
,dd0 1
$chardd2 5
)dd5 6
;dd6 7
varee 
typeee 
=ee 
childee  
.ee  !
Valueee! &
[ee& '
$stree' -
]ee- .
.ee. /
ToStringee/ 7
(ee7 8
)ee8 9
;ee9 :
varff 
descriptionff 
=ff  !
childff" '
.ff' (
Valueff( -
[ff- .
$strff. ;
]ff; <
?ff< =
.ff= >
ToStringff> F
(ffF G
)ffG H
;ffH I
ifhh 
(hh 
typehh 
==hh 
$strhh $
)hh$ %
{ii 
varjj 
fieldjj 
=jj 
typetypejj  (
.jj( )
Fieldjj) .
(jj. /
typeofkk 
(kk 
StringGraphTypekk .
)kk. /
,kk/ 0
	nameLowerll !
,ll! "
descriptionmm #
:mm# $
descriptionmm% 0
,mm0 1
resolvenn 
:nn  
contextnn! (
=>nn) +
{oo 
varpp 
sourcepp  &
=pp' (
contextpp) 0
.pp0 1
Sourcepp1 7
;pp7 8
returnqq "
sourceqq# )
[qq) *
contextqq* 1
.qq1 2
FieldDefinitionqq2 A
.qqA B
MetadataqqB J
[qqJ K
$strqqK Q
]qqQ R
.qqR S
ToStringqqS [
(qq[ \
)qq\ ]
]qq] ^
.qq^ _
ToObjectqq_ g
<qqg h
stringqqh n
>qqn o
(qqo p
)qqp q
;qqq r
}rr 
)rr 
;rr 
fieldss 
.ss 
Metadatass "
.ss" #
Addss# &
(ss& '
$strss' -
,ss- .
namess/ 3
)ss3 4
;ss4 5
}tt 
elseuu 
ifuu 
(uu 
typeuu 
==uu  
$struu! *
)uu* +
{vv 
varww 
fieldww 
=ww 
typetypeww  (
.ww( )
Fieldww) .
(ww. /
typeofxx 
(xx 
IntGraphTypexx +
)xx+ ,
,xx, -
	nameLoweryy !
,yy! "
descriptionzz #
:zz# $
descriptionzz% 0
,zz0 1
resolve{{ 
:{{  
context{{! (
=>{{) +
{|| 
var}} 
source}}  &
=}}' (
context}}) 0
.}}0 1
Source}}1 7
;}}7 8
return~~ "
source~~# )
[~~) *
context~~* 1
.~~1 2
FieldDefinition~~2 A
.~~A B
Metadata~~B J
[~~J K
$str~~K Q
]~~Q R
.~~R S
ToString~~S [
(~~[ \
)~~\ ]
]~~] ^
.~~^ _
ToObject~~_ g
<~~g h
int~~h k
>~~k l
(~~l m
)~~m n
;~~n o
} 
) 
; 
field
ÄÄ 
.
ÄÄ 
Metadata
ÄÄ "
.
ÄÄ" #
Add
ÄÄ# &
(
ÄÄ& '
$str
ÄÄ' -
,
ÄÄ- .
name
ÄÄ/ 3
)
ÄÄ3 4
;
ÄÄ4 5
}
ÅÅ 
}
ÇÇ 
var
ÑÑ 
	fieldType
ÑÑ 
=
ÑÑ 
new
ÑÑ 
	FieldType
ÑÑ  )
{
ÖÖ 
	Arguments
ÜÜ 
=
ÜÜ 
new
ÜÜ 
QueryArguments
ÜÜ  .
(
ÜÜ. /
new
áá 
QueryArgument
áá %
<
áá% &
StringGraphType
áá& 5
>
áá5 6
{
áá7 8
Name
áá9 =
=
áá> ?
$str
áá@ L
}
ááM N
)
àà 
,
àà 
Name
ää 
=
ää 
fieldTypeName
ää $
,
ää$ %
Description
ãã 
=
ãã 
$str
ãã /
+
ãã0 1
query
ãã2 7
.
ãã7 8
Source
ãã8 >
+
ãã? @
$str
ããA L
+
ããM N
query
ããO T
.
ããT U
Name
ããU Y
,
ããY Z
ResolvedType
åå 
=
åå 
new
åå "
ListGraphType
åå# 0
(
åå0 1
typetype
åå1 9
)
åå9 :
,
åå: ;
Resolver
çç 
=
çç 
new
çç &
LockedAsyncFieldResolver
çç 7
<
çç7 8
object
çç8 >
,
çç> ?
object
çç@ F
>
ççF G
(
ççG H
async
ççH M
context
ççN U
=>
ççV X
{
éé 
var
èè 
queryManager
èè $
=
èè% &
context
èè' .
.
èè. /$
ResolveServiceProvider
èè/ E
(
èèE F
)
èèF G
.
èèG H

GetService
èèH R
<
èèR S
IQueryManager
èèS `
>
èè` a
(
èèa b
)
èèb c
;
èèc d
var
êê 
iquery
êê 
=
êê  
await
êê! &
queryManager
êê' 3
.
êê3 4
GetQueryAsync
êê4 A
(
êêA B
query
êêB G
.
êêG H
Name
êêH L
)
êêL M
;
êêM N
var
íí 

parameters
íí "
=
íí# $
context
íí% ,
.
íí, -
GetArgument
íí- 8
<
íí8 9
string
íí9 ?
>
íí? @
(
íí@ A
$str
ííA M
)
ííM N
;
ííN O
var
îî 
queryParameters
îî '
=
îî( )

parameters
îî* 4
!=
îî5 7
null
îî8 <
?
îî= >
JsonConvert
ïï #
.
ïï# $
DeserializeObject
ïï$ 5
<
ïï5 6

Dictionary
ïï6 @
<
ïï@ A
string
ïïA G
,
ïïG H
object
ïïI O
>
ïïO P
>
ïïP Q
(
ïïQ R

parameters
ïïR \
)
ïï\ ]
:
ññ 
new
ññ 

Dictionary
ññ (
<
ññ( )
string
ññ) /
,
ññ/ 0
object
ññ1 7
>
ññ7 8
(
ññ8 9
)
ññ9 :
;
ññ: ;
var
òò 
result
òò 
=
òò  
await
òò! &
queryManager
òò' 3
.
òò3 4
ExecuteQueryAsync
òò4 E
(
òòE F
iquery
òòF L
,
òòL M
queryParameters
òòN ]
)
òò] ^
;
òò^ _
return
ôô 
result
ôô !
.
ôô! "
Items
ôô" '
;
ôô' (
}
öö 
)
öö 
,
öö 
Type
õõ 
=
õõ 
typeof
õõ 
(
õõ 
ListGraphType
õõ +
<
õõ+ ,
ObjectGraphType
õõ, ;
<
õõ; <
JObject
õõ< C
>
õõC D
>
õõD E
)
õõE F
}
úú 
;
úú 
return
ûû 
	fieldType
ûû 
;
ûû 
}
üü 	
private
°° 
	FieldType
°° '
BuildContentTypeFieldType
°° 3
(
°°3 4
ISchema
°°4 ;
schema
°°< B
,
°°B C
string
°°D J
contentType
°°K V
,
°°V W
LuceneQuery
°°X c
query
°°d i
,
°°i j
string
°°k q
fieldTypeName
°°r 
)°° Ä
{
¢¢ 	
var
££ 
typetype
££ 
=
££ 
schema
££ !
.
££! "
Query
££" '
.
££' (
Fields
££( .
.
££. /
OfType
££/ 5
<
££5 6#
ContentItemsFieldType
££6 K
>
££K L
(
££L M
)
££M N
.
££N O
FirstOrDefault
££O ]
(
££] ^
x
££^ _
=>
££` b
x
££c d
.
££d e
Name
££e i
==
££j l
contentType
££m x
)
££x y
;
££y z
if
§§ 
(
§§ 
typetype
§§ 
==
§§ 
null
§§  
)
§§  !
{
•• 
return
¶¶ 
null
¶¶ 
;
¶¶ 
}
ßß 
var
©© 
	fieldType
©© 
=
©© 
new
©© 
	FieldType
©©  )
{
™™ 
	Arguments
´´ 
=
´´ 
new
´´ 
QueryArguments
´´  .
(
´´. /
new
¨¨ 
QueryArgument
¨¨ )
<
¨¨) *
StringGraphType
¨¨* 9
>
¨¨9 :
{
¨¨; <
Name
¨¨= A
=
¨¨B C
$str
¨¨D P
}
¨¨Q R
)
≠≠ 
,
≠≠ 
Name
ØØ 
=
ØØ 
fieldTypeName
ØØ $
,
ØØ$ %
Description
∞∞ 
=
∞∞ 
$str
∞∞ /
+
∞∞0 1
query
∞∞2 7
.
∞∞7 8
Source
∞∞8 >
+
∞∞? @
$str
∞∞A L
+
∞∞M N
query
∞∞O T
.
∞∞T U
Name
∞∞U Y
,
∞∞Y Z
ResolvedType
±± 
=
±± 
typetype
±± '
.
±±' (
ResolvedType
±±( 4
,
±±4 5
Resolver
≤≤ 
=
≤≤ 
new
≤≤ &
LockedAsyncFieldResolver
≤≤ 7
<
≤≤7 8
object
≤≤8 >
,
≤≤> ?
object
≤≤@ F
>
≤≤F G
(
≤≤G H
async
≤≤H M
context
≤≤N U
=>
≤≤V X
{
≥≥ 
var
¥¥ 
queryManager
¥¥ $
=
¥¥% &
context
¥¥' .
.
¥¥. /$
ResolveServiceProvider
¥¥/ E
(
¥¥E F
)
¥¥F G
.
¥¥G H

GetService
¥¥H R
<
¥¥R S
IQueryManager
¥¥S `
>
¥¥` a
(
¥¥a b
)
¥¥b c
;
¥¥c d
var
µµ 
iquery
µµ 
=
µµ  
await
µµ! &
queryManager
µµ' 3
.
µµ3 4
GetQueryAsync
µµ4 A
(
µµA B
query
µµB G
.
µµG H
Name
µµH L
)
µµL M
;
µµM N
var
∑∑ 

parameters
∑∑ "
=
∑∑# $
context
∑∑% ,
.
∑∑, -
GetArgument
∑∑- 8
<
∑∑8 9
string
∑∑9 ?
>
∑∑? @
(
∑∑@ A
$str
∑∑A M
)
∑∑M N
;
∑∑N O
var
ππ 
queryParameters
ππ '
=
ππ( )

parameters
ππ* 4
!=
ππ5 7
null
ππ8 <
?
ππ= >
JsonConvert
∫∫ #
.
∫∫# $
DeserializeObject
∫∫$ 5
<
∫∫5 6

Dictionary
∫∫6 @
<
∫∫@ A
string
∫∫A G
,
∫∫G H
object
∫∫I O
>
∫∫O P
>
∫∫P Q
(
∫∫Q R

parameters
∫∫R \
)
∫∫\ ]
:
ªª 
new
ªª 

Dictionary
ªª (
<
ªª( )
string
ªª) /
,
ªª/ 0
object
ªª1 7
>
ªª7 8
(
ªª8 9
)
ªª9 :
;
ªª: ;
var
ΩΩ 
result
ΩΩ 
=
ΩΩ  
await
ΩΩ! &
queryManager
ΩΩ' 3
.
ΩΩ3 4
ExecuteQueryAsync
ΩΩ4 E
(
ΩΩE F
iquery
ΩΩF L
,
ΩΩL M
queryParameters
ΩΩN ]
)
ΩΩ] ^
;
ΩΩ^ _
return
ææ 
result
ææ !
.
ææ! "
Items
ææ" '
;
ææ' (
}
øø 
)
øø 
,
øø 
Type
¿¿ 
=
¿¿ 
typetype
¿¿ 
.
¿¿  
Type
¿¿  $
}
¡¡ 
;
¡¡ 
return
√√ 
	fieldType
√√ 
;
√√ 
}
ƒƒ 	
}
≈≈ 
}∆∆ ∞
ÖD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\GraphQL\Startup.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
GraphQL $
{ 
[ 
RequireFeatures 
( 
$str /
)/ 0
]0 1
public 

class 
Startup 
: 
StartupBase &
{ 
public 
override 
void 
ConfigureServices .
(. /
IServiceCollection/ A
servicesB J
)J K
{ 	
services 
. 
AddSingleton !
<! "
ISchemaBuilder" 0
,0 1(
LuceneQueryFieldTypeProvider2 N
>N O
(O P
)P Q
;Q R
} 	
} 
} ìa
öD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Handler\LuceneIndexingContentHandler.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Handlers %
{ 
public 

class (
LuceneIndexingContentHandler -
:. /
ContentHandlerBase0 B
{ 
private 
readonly 
List 
< 
ContentContextBase 0
>0 1
	_contexts2 ;
=< =
new> A
ListB F
<F G
ContentContextBaseG Y
>Y Z
(Z [
)[ \
;\ ]
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public (
LuceneIndexingContentHandler +
(+ , 
IHttpContextAccessor, @
httpContextAccessorA T
)T U
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
} 	
public 
override 
Task 
PublishedAsync +
(+ ,!
PublishContentContext, A
contextB I
)I J
=>K M
AddContextAsyncN ]
(] ^
context^ e
)e f
;f g
public 
override 
Task 
CreatedAsync )
() * 
CreateContentContext* >
context? F
)F G
=>H J
AddContextAsyncK Z
(Z [
context[ b
)b c
;c d
public 
override 
Task 
UpdatedAsync )
() * 
UpdateContentContext* >
context? F
)F G
=>H J
AddContextAsyncK Z
(Z [
context[ b
)b c
;c d
public 
override 
Task 
RemovedAsync )
() * 
RemoveContentContext* >
context? F
)F G
=>H J
AddContextAsyncK Z
(Z [
context[ b
)b c
;c d
public   
override   
Task   
UnpublishedAsync   -
(  - .!
PublishContentContext  . C
context  D K
)  K L
=>  M O
AddContextAsync  P _
(  _ `
context  ` g
)  g h
;  h i
private"" 
Task"" 
AddContextAsync"" $
(""$ %
ContentContextBase""% 7
context""8 ?
)""? @
{## 	
if%% 
(%%  
_httpContextAccessor%% $
.%%$ %
HttpContext%%% 0
?%%0 1
.%%1 2
Features%%2 :
.%%: ;
Get%%; >
<%%> ?!
ContentPreviewFeature%%? T
>%%T U
(%%U V
)%%V W
?%%W X
.%%X Y

Previewing%%Y c
==%%d f
true%%g k
)%%k l
{&& 
return'' 
Task'' 
.'' 
CompletedTask'' )
;'') *
}(( 
if** 
(** 
context** 
.** 
ContentItem** #
.**# $
Id**$ &
==**' )
$num*** +
)**+ ,
{++ 
return-- 
Task-- 
.-- 
CompletedTask-- )
;--) *
}.. 
if00 
(00 
	_contexts00 
.00 
Count00 
==00  "
$num00# $
)00$ %
{11 
var22 
contexts22 
=22 
	_contexts22 (
;22( )

ShellScope55 
.55 
AddDeferredTask55 *
(55* +
scope55+ 0
=>551 3
IndexingAsync554 A
(55A B
scope55B G
,55G H
contexts55I Q
)55Q R
)55R S
;55S T
}66 
	_contexts88 
.88 
Add88 
(88 
context88 !
)88! "
;88" #
return:: 
Task:: 
.:: 
CompletedTask:: %
;::% &
};; 	
private== 
static== 
async== 
Task== !
IndexingAsync==" /
(==/ 0

ShellScope==0 :
scope==; @
,==@ A
IEnumerable==B M
<==M N
ContentContextBase==N `
>==` a
contexts==b j
)==j k
{>> 	
var?? 
services?? 
=?? 
scope??  
.??  !
ServiceProvider??! 0
;??0 1
var@@ 
contentManager@@ 
=@@  
services@@! )
.@@) *
GetRequiredService@@* <
<@@< =
IContentManager@@= L
>@@L M
(@@M N
)@@N O
;@@O P
varAA $
contentItemIndexHandlersAA (
=AA) *
servicesAA+ 3
.AA3 4
GetServicesAA4 ?
<AA? @$
IContentItemIndexHandlerAA@ X
>AAX Y
(AAY Z
)AAZ [
;AA[ \
varBB 
luceneIndexManagerBB "
=BB# $
servicesBB% -
.BB- .
GetRequiredServiceBB. @
<BB@ A
LuceneIndexManagerBBA S
>BBS T
(BBT U
)BBU V
;BBV W
varCC &
luceneIndexSettingsServiceCC *
=CC+ ,
servicesCC- 5
.CC5 6
GetRequiredServiceCC6 H
<CCH I&
LuceneIndexSettingsServiceCCI c
>CCc d
(CCd e
)CCe f
;CCf g
varDD 
loggerDD 
=DD 
servicesDD !
.DD! "
GetRequiredServiceDD" 4
<DD4 5
ILoggerDD5 <
<DD< =(
LuceneIndexingContentHandlerDD= Y
>DDY Z
>DDZ [
(DD[ \
)DD\ ]
;DD] ^
varFF 
contextsGroupByIdFF !
=FF" #
contextsFF$ ,
.FF, -
GroupByFF- 4
(FF4 5
cFF5 6
=>FF7 9
cFF: ;
.FF; <
ContentItemFF< G
.FFG H
ContentItemIdFFH U
,FFU V
cFFW X
=>FFY [
cFF\ ]
)FF] ^
;FF^ _
foreachII 
(II 
varII 
ContextsByIdII %
inII& (
contextsGroupByIdII) :
)II: ;
{JJ 
varLL 
contextLL 
=LL 
ContextsByIdLL *
.LL* +
LastLL+ /
(LL/ 0
)LL0 1
;LL1 2
ContentItemNN 
	publishedNN %
=NN& '
nullNN( ,
,NN, -
latestNN. 4
=NN5 6
nullNN7 ;
;NN; <
boolOO 
publishedLoadedOO $
=OO% &
falseOO' ,
,OO, -
latestLoadedOO. :
=OO; <
falseOO= B
;OOB C
foreachQQ 
(QQ 
varQQ 
indexSettingsQQ *
inQQ+ -
awaitQQ. 3&
luceneIndexSettingsServiceQQ4 N
.QQN O
GetSettingsAsyncQQO _
(QQ_ `
)QQ` a
)QQa b
{RR 
varSS 
cultureAspectSS %
=SS& '
awaitSS( -
contentManagerSS. <
.SS< =
PopulateAspectAsyncSS= P
<SSP Q
CultureAspectSSQ ^
>SS^ _
(SS_ `
contextSS` g
.SSg h
ContentItemSSh s
)SSs t
;SSt u
varTT 
cultureTT 
=TT  !
cultureAspectTT" /
.TT/ 0

HasCultureTT0 :
?TT; <
cultureAspectTT= J
.TTJ K
CultureTTK R
.TTR S
NameTTS W
:TTX Y
nullTTZ ^
;TT^ _
varUU  
ignoreIndexedCultureUU ,
=UU- .
indexSettingsUU/ <
.UU< =
CultureUU= D
==UUE G
$strUUH M
?UUN O
falseUUP U
:UUV W
cultureUUX _
!=UU` b
indexSettingsUUc p
.UUp q
CultureUUq x
;UUx y
ifWW 
(WW 
indexSettingsWW %
.WW% &
IndexedContentTypesWW& 9
.WW9 :
ContainsWW: B
(WWB C
contextWWC J
.WWJ K
ContentItemWWK V
.WWV W
ContentTypeWWW b
)WWb c
&&WWd f
!WWg h 
ignoreIndexedCultureWWh |
)WW| }
{XX 
ifYY 
(YY 
!YY 
indexSettingsYY *
.YY* +
IndexLatestYY+ 6
&&YY7 9
!YY: ;
publishedLoadedYY; J
)YYJ K
{ZZ 
publishedLoaded[[ +
=[[, -
true[[. 2
;[[2 3
	published\\ %
=\\& '
await\\( -
contentManager\\. <
.\\< =
GetAsync\\= E
(\\E F
context\\F M
.\\M N
ContentItem\\N Y
.\\Y Z
ContentItemId\\Z g
,\\g h
VersionOptions\\i w
.\\w x
	Published	\\x Å
)
\\Å Ç
;
\\Ç É
}]] 
if__ 
(__ 
indexSettings__ )
.__) *
IndexLatest__* 5
&&__6 8
!__9 :
latestLoaded__: F
)__F G
{`` 
latestLoadedaa (
=aa) *
trueaa+ /
;aa/ 0
latestbb "
=bb# $
awaitbb% *
contentManagerbb+ 9
.bb9 :
GetAsyncbb: B
(bbB C
contextbbC J
.bbJ K
ContentItembbK V
.bbV W
ContentItemIdbbW d
,bbd e
VersionOptionsbbf t
.bbt u
Latestbbu {
)bb{ |
;bb| }
}cc 
varee 
contentItemee '
=ee( )
!ee* +
indexSettingsee+ 8
.ee8 9
IndexLatestee9 D
?eeE F
	publishedeeG P
:eeQ R
latesteeS Y
;eeY Z
ifgg 
(gg 
contentItemgg '
==gg( *
nullgg+ /
)gg/ 0
{hh 
awaitii !
luceneIndexManagerii" 4
.ii4 5 
DeleteDocumentsAsyncii5 I
(iiI J
indexSettingsiiJ W
.iiW X
	IndexNameiiX a
,iia b
newiic f
stringiig m
[iim n
]iin o
{iip q
contextiir y
.iiy z
ContentItem	iiz Ö
.
iiÖ Ü
ContentItemId
iiÜ ì
}
iiî ï
)
iiï ñ
;
iiñ ó
}jj 
elsekk 
{ll 
varmm 
buildIndexContextmm  1
=mm2 3
newmm4 7
BuildIndexContextmm8 I
(mmI J
newmmJ M
DocumentIndexmmN [
(mm[ \
contentItemmm\ g
.mmg h
ContentItemIdmmh u
)mmu v
,mmv w
contentItem	mmx É
,
mmÉ Ñ
new
mmÖ à
string
mmâ è
[
mmè ê
]
mmê ë
{
mmí ì
contentItem
mmî ü
.
mmü †
ContentType
mm† ´
}
mm¨ ≠
)
mm≠ Æ
;
mmÆ Ø
awaitnn !$
contentItemIndexHandlersnn" :
.nn: ;
InvokeAsyncnn; F
(nnF G
xnnG H
=>nnI K
xnnL M
.nnM N
BuildIndexAsyncnnN ]
(nn] ^
buildIndexContextnn^ o
)nno p
,nnp q
loggernnr x
)nnx y
;nny z
awaitpp !
luceneIndexManagerpp" 4
.pp4 5 
DeleteDocumentsAsyncpp5 I
(ppI J
indexSettingsppJ W
.ppW X
	IndexNameppX a
,ppa b
newppc f
stringppg m
[ppm n
]ppn o
{ppp q
contentItemppr }
.pp} ~
ContentItemId	pp~ ã
}
ppå ç
)
ppç é
;
ppé è
awaitqq !
luceneIndexManagerqq" 4
.qq4 5
StoreDocumentsAsyncqq5 H
(qqH I
indexSettingsqqI V
.qqV W
	IndexNameqqW `
,qq` a
newqqb e
DocumentIndexqqf s
[qqs t
]qqt u
{qqv w
buildIndexContext	qqx â
.
qqâ ä
DocumentIndex
qqä ó
}
qqò ô
)
qqô ö
;
qqö õ
}rr 
}ss 
}tt 
}uu 
}vv 	
}ww 
}xx â
~D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Manifest.cs
[ 
assembly 	
:	 

Module 
( 
Name 
=	 

$str 
, 
Author 

= 
ManifestConstants 
. 
OrchardCoreTeam .
,. /
Website 
= 
ManifestConstants 
.  
OrchardCoreWebsite  2
,2 3
Version 
= 
ManifestConstants 
.  
OrchardCoreVersion  2
) 
] 
[

 
assembly

 	
:

	 

Feature

 
(

 
Id 
= 
$str	 
, 
Name 
=	 

$str 
, 
Description 
= 
$str	 Ç
,
Ç É
Dependencies 
= 
new 
[ 
] 
{ 
$str 
, 
$str "
} 
, 
Category 
= 
$str #
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	 $
,$ %
Name 
=	 

$str 
, 
Description 
= 
$str b
,b c
Dependencies 
= 
new 
[ 
] 
{ 
$str /
}0 1
,1 2
Category 
= 
$str #
) 
] 
[ 
assembly 	
:	 

Feature 
( 
Id 
= 
$str	 +
,+ ,
Name   
=  	 

$str   "
,  " #
Description!! 
=!! 
$str!! B
,!!B C
Dependencies"" 
="" 
new"" 
["" 
]"" 
{"" 
$str"" /
,""/ 0
$str""1 L
}""M N
,""N O
Category## 
=## 
$str## #
)$$ 
]$$ Â
èD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Model\LuceneIndexSettings.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Model "
{ 
public 

class 
LuceneIndexSettings $
{ 
[		 	

JsonIgnore			 
]		 
public

 
string

 
	IndexName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
AnalyzerName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
bool 
IndexLatest 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
[ 
] 
IndexedContentTypes +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
string 
Culture 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public 

class '
LuceneIndexSettingsDocument ,
:- .
Document/ 7
{ 
public 

Dictionary 
< 
string  
,  !
LuceneIndexSettings" 5
>5 6
LuceneIndexSettings7 J
{K L
getM P
;P Q
setR U
;U V
}W X
=Y Z
new[ ^

Dictionary_ i
<i j
stringj p
,p q 
LuceneIndexSettings	r Ö
>
Ö Ü
(
Ü á
)
á à
;
à â
} 
} é
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Model\LuceneSettings.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Model "
{ 
public 

class 
LuceneSettings 
{ 
public 
static 
readonly 
string %
[% &
]& '
FullTextField( 5
=6 7
new8 ;
string< B
[B C
]C D
{E F
IndexingConstantsG X
.X Y
FullTextKeyY d
}e f
;f g
public

 
static

 
string

 
StandardAnalyzer

 -
=

. /
$str

0 B
;

B C
public 
static 
LuceneVersion #
DefaultVersion$ 2
=3 4
LuceneVersion5 B
.B C
	LUCENE_48C L
;L M
public 
string 
SearchIndex !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
[ 
] 
DefaultSearchFields +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
=: ;
FullTextField< I
;I J
public 
bool &
AllowLuceneQueriesInSearch .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >
false? D
;D E
} 
} ” 
ÅD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Permissions.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class 
Permissions 
: 
IPermissionProvider 2
{ 
private		 
readonly		 &
LuceneIndexSettingsService		 3'
_luceneIndexSettingsService		4 O
;		O P
public 
static 
readonly 

Permission )
ManageIndexes* 7
=8 9
new: =

Permission> H
(H I
$strI X
,X Y
$strZ j
)j k
;k l
public 
static 
readonly 

Permission )
QueryLuceneApi* 8
=9 :
new; >

Permission? I
(I J
$strJ Z
,Z [
$str\ n
,n o
newp s
[s t
]t u
{v w
ManageIndexes	x Ö
}
Ü á
)
á à
;
à â
public 
Permissions 
( &
LuceneIndexSettingsService 5&
luceneIndexSettingsService6 P
)P Q
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E
} 	
public 
async 
Task 
< 
IEnumerable %
<% &

Permission& 0
>0 1
>1 2
GetPermissionsAsync3 F
(F G
)G H
{ 	
var 
luceneIndexSettings #
=$ %
await& +'
_luceneIndexSettingsService, G
.G H
GetSettingsAsyncH X
(X Y
)Y Z
;Z [
var 
result 
= 
new 
List !
<! "

Permission" ,
>, -
(- .
). /
;/ 0
foreach 
( 
var 
index 
in !
luceneIndexSettings" 5
)5 6
{ 
var 

permission 
=  
new! $

Permission% /
(/ 0
$str0 =
+> ?
index@ E
.E F
	IndexNameF O
+P Q
$strR Y
,Y Z
$str[ j
+k l
indexm r
.r s
	IndexNames |
+} ~
$str	 á
,
á à
new
â å
[
å ç
]
ç é
{
è ê
ManageIndexes
ë û
}
ü †
)
† °
;
° ¢
result 
. 
Add 
( 

permission %
)% &
;& '
} 
result 
. 
Add 
( 
ManageIndexes $
)$ %
;% &
result 
. 
Add 
( 
QueryLuceneApi %
)% &
;& '
return   
result   
;   
}!! 	
public## 
IEnumerable## 
<##  
PermissionStereotype## /
>##/ 0!
GetDefaultStereotypes##1 F
(##F G
)##G H
{$$ 	
return%% 
new%% 
[%% 
]%% 
{&& 
new''  
PermissionStereotype'' (
{(( 
Name)) 
=)) 
$str)) *
,))* +
Permissions** 
=**  !
new**" %
[**% &
]**& '
{**( )
ManageIndexes*** 7
}**8 9
}++ 
,++ 
new,,  
PermissionStereotype,, (
{-- 
Name.. 
=.. 
$str.. #
,..# $
Permissions// 
=//  !
new//" %
[//% &
]//& '
{//( )
QueryLuceneApi//* 8
}//9 :
}00 
}11 
;11 
}22 	
}33 
}44 ›
çD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[		 
assembly		 	
:			 

AssemblyProduct		 
(		 
$str		 /
)		/ 0
]		0 1
[

 
assembly

 	
:

	 

AssemblyTrademark

 
(

 
$str

 
)

  
]

  !
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8£
çD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Recipes\LuceneIndexStep.cs
	namespace

 	
OrchardCore


 
.

 
Lucene

 
.

 
Recipes

 $
{ 
public 

class 
LuceneIndexStep  
:! "
IRecipeStepHandler# 5
{ 
private 
readonly !
LuceneIndexingService ."
_luceneIndexingService/ E
;E F
private 
readonly 
LuceneIndexManager +
_luceneIndexManager, ?
;? @
public 
LuceneIndexStep 
( !
LuceneIndexingService !!
luceneIndexingService" 7
,7 8
LuceneIndexManager 
luceneIndexManager 1
) 
{ 	
_luceneIndexManager 
=  !
luceneIndexManager" 4
;4 5"
_luceneIndexingService "
=# $!
luceneIndexingService% :
;: ;
} 	
public 
async 
Task 
ExecuteAsync &
(& '"
RecipeExecutionContext' =
context> E
)E F
{ 	
if 
( 
! 
String 
. 
Equals 
( 
context &
.& '
Name' +
,+ ,
$str- ;
,; <
StringComparison= M
.M N
OrdinalIgnoreCaseN _
)_ `
)` a
{   
return!! 
;!! 
}"" 
var$$ 
indices$$ 
=$$ 
context$$ !
.$$! "
Step$$" &
[$$& '
$str$$' 0
]$$0 1
;$$1 2
if%% 
(%% 
indices%% 
!=%% 
null%% 
)%%  
{&& 
foreach'' 
('' 
var'' 
index'' "
in''# %
indices''& -
)''- .
{(( 
var)) 
luceneIndexSettings)) +
=)), -
index)). 3
.))3 4
ToObject))4 <
<))< =

Dictionary))= G
<))G H
string))H N
,))N O
LuceneIndexSettings))P c
>))c d
>))d e
())e f
)))f g
.))g h
FirstOrDefault))h v
())v w
)))w x
;))x y
if++ 
(++ 
!++ 
_luceneIndexManager++ ,
.++, -
Exists++- 3
(++3 4
luceneIndexSettings++4 G
.++G H
Key++H K
)++K L
)++L M
{,, 
luceneIndexSettings-- +
.--+ ,
Value--, 1
.--1 2
	IndexName--2 ;
=--< =
luceneIndexSettings--> Q
.--Q R
Key--R U
;--U V
await.. "
_luceneIndexingService.. 4
...4 5
CreateIndexAsync..5 E
(..E F
luceneIndexSettings..F Y
...Y Z
Value..Z _
).._ `
;..` a
}// 
}00 
}11 
}22 	
}33 
public55 

class55 
ContentStepModel55 !
{66 
public77 
JObject77 
Data77 
{77 
get77 !
;77! "
set77# &
;77& '
}77( )
}88 
}99 ı	
ïD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\IndexingBackgroundTask.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
[ 
BackgroundTask 
( 
Schedule 
= 
$str *
,* +
Description, 7
=8 9
$str: R
)R S
]S T
public 

class "
IndexingBackgroundTask '
:( )
IBackgroundTask* 9
{ 
public 
Task 
DoWorkAsync 
(  
IServiceProvider  0
serviceProvider1 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{ 	
var 
indexingService 
=  !
serviceProvider" 1
.1 2

GetService2 <
<< =!
LuceneIndexingService= R
>R S
(S T
)T U
;U V
return 
indexingService "
." #$
ProcessContentItemsAsync# ;
(; <
)< =
;= >
} 	
} 
} ÷
íD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\ISearchQueryService.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Services %
{ 
public 

	interface 
ISearchQueryService (
{ 
Task		 
<		 
IList		 
<		 
string		 
>		 
>		 
ExecuteQueryAsync		 -
(		- .
Query		. 3
query		4 9
,		9 :
string		; A
	indexName		B K
,		K L
int		M P
start		Q V
=		W X
$num		Y Z
,		Z [
int		\ _
end		` c
=		d e
$num		f h
)		h i
;		i j
}

 
} å
çD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneAnalyzer.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Services %
{ 
public 

class 
LuceneAnalyzer 
:  !
ILuceneAnalyzer" 1
{ 
private 
readonly 
Func 
< 
Analyzer &
>& '
_factory( 0
;0 1
public

 
LuceneAnalyzer

 
(

 
string

 $
name

% )
,

) *
Func

+ /
<

/ 0
Analyzer

0 8
>

8 9
factory

: A
)

A B
{ 	
_factory 
= 
factory 
; 
Name 
= 
name 
; 
} 	
public 
LuceneAnalyzer 
( 
string $
name% )
,) *
Analyzer+ 3
instance4 <
)< =
:> ?
this@ D
(D E
nameE I
,I J
(K L
)L M
=>N P
instanceQ Y
)Y Z
{ 	
} 	
public 
string 
Name 
{ 
get  
;  !
}" #
public 
Analyzer 
CreateAnalyzer &
(& '
)' (
{ 	
return 
_factory 
( 
) 
; 
} 	
} 
} ◊
îD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneAnalyzerManager.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Services %
{ 
public 

class !
LuceneAnalyzerManager &
{ 
private 
readonly 

Dictionary #
<# $
string$ *
,* +
ILuceneAnalyzer, ;
>; <

_analyzers= G
;G H
public !
LuceneAnalyzerManager $
($ %
IOptions% -
<- .
LuceneOptions. ;
>; <
options= D
)D E
{ 	

_analyzers 
= 
new 

Dictionary '
<' (
string( .
,. /
ILuceneAnalyzer0 ?
>? @
(@ A
StringComparerA O
.O P
OrdinalIgnoreCaseP a
)a b
;b c
foreach 
( 
var 
analyzer !
in" $
options% ,
., -
Value- 2
.2 3
	Analyzers3 <
)< =
{ 

_analyzers 
[ 
analyzer #
.# $
Name$ (
]( )
=* +
analyzer, 4
;4 5
} 
} 	
public 
IEnumerable 
< 
ILuceneAnalyzer *
>* +
GetAnalyzers, 8
(8 9
)9 :
{ 	
return 

_analyzers 
. 
Values $
;$ %
} 	
public 
Analyzer 
CreateAnalyzer &
(& '
string' -
name. 2
)2 3
{   	
if!! 
(!! 

_analyzers!! 
.!! 
TryGetValue!! &
(!!& '
name!!' +
,!!+ ,
out!!- 0
var!!1 4
analyzer!!5 =
)!!= >
)!!> ?
{"" 
return## 
analyzer## 
.##  
CreateAnalyzer##  .
(##. /
)##/ 0
;##0 1
}$$ 
return&& 
null&& 
;&& 
}'' 	
}(( 
})) À/
†D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneContentPickerResultProvider.cs
	namespace		 	
OrchardCore		
 
.		 
Lucene		 
.		 
Services		 %
{

 
public 

class -
!LuceneContentPickerResultProvider 2
:3 4(
IContentPickerResultProvider5 Q
{ 
private 
readonly 
LuceneIndexManager + 
_luceneIndexProvider, @
;@ A
public -
!LuceneContentPickerResultProvider 0
(0 1
LuceneIndexManager1 C
luceneIndexProviderD W
)W X
{ 	 
_luceneIndexProvider  
=! "
luceneIndexProvider# 6
;6 7
} 	
public 
string 
Name 
=> 
$str &
;& '
public 
async 
Task 
< 
IEnumerable %
<% &
ContentPickerResult& 9
>9 :
>: ;
Search< B
(B C&
ContentPickerSearchContextC ]
searchContext^ k
)k l
{ 	
var 
	indexName 
= 
$str $
;$ %
var 
fieldSettings 
= 
searchContext  -
.- .
PartFieldDefinition. A
?A B
.B C
GetSettingsC N
<N O2
&ContentPickerFieldLuceneEditorSettingsO u
>u v
(v w
)w x
;x y
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
fieldSettings+ 8
?8 9
.9 :
Index: ?
)? @
)@ A
{ 
	indexName 
= 
fieldSettings )
.) *
Index* /
;/ 0
} 
if   
(   
!    
_luceneIndexProvider   %
.  % &
Exists  & ,
(  , -
	indexName  - 6
)  6 7
)  7 8
{!! 
return"" 
new"" 
List"" 
<""  
ContentPickerResult""  3
>""3 4
(""4 5
)""5 6
;""6 7
}## 
var%% 
results%% 
=%% 
new%% 
List%% "
<%%" #
ContentPickerResult%%# 6
>%%6 7
(%%7 8
)%%8 9
;%%9 :
await''  
_luceneIndexProvider'' &
.''& '
SearchAsync''' 2
(''2 3
	indexName''3 <
,''< =
searcher''> F
=>''G I
{(( 
Query)) 
query)) 
=)) 
null)) "
;))" #
if++ 
(++ 
string++ 
.++ 
IsNullOrWhiteSpace++ -
(++- .
searchContext++. ;
.++; <
Query++< A
)++A B
)++B C
{,, 
query-- 
=-- 
new-- 
MatchAllDocsQuery--  1
(--1 2
)--2 3
;--3 4
}.. 
else// 
{00 
query11 
=11 
new11 
WildcardQuery11  -
(11- .
new11. 1
Term112 6
(116 7
$str117 a
,11a b
searchContext11c p
.11p q
Query11q v
.11v w
ToLowerInvariant	11w á
(
11á à
)
11à â
+
11ä ã
$str
11å è
)
11è ê
)
11ê ë
;
11ë í
}22 
var44 
filter44 
=44 
new44  !
FieldCacheTermsFilter44! 6
(446 7
$str447 X
,44X Y
searchContext44Z g
.44g h
ContentTypes44h t
.44t u
ToArray44u |
(44| }
)44} ~
)44~ 
;	44 Ä
var66 
docs66 
=66 
searcher66 #
.66# $
Search66$ *
(66* +
query66+ 0
,660 1
filter662 8
,668 9
$num66: <
,66< =
Sort66> B
.66B C
	RELEVANCE66C L
)66L M
;66M N
foreach88 
(88 
var88 
hit88  
in88! #
docs88$ (
.88( )
	ScoreDocs88) 2
)882 3
{99 
var:: 
doc:: 
=:: 
searcher:: &
.::& '
Doc::' *
(::* +
hit::+ .
.::. /
Doc::/ 2
)::2 3
;::3 4
results<< 
.<< 
Add<< 
(<<  
new<<  #
ContentPickerResult<<$ 7
{== 
ContentItemId>> %
=>>& '
doc>>( +
.>>+ ,
GetField>>, 4
(>>4 5
$str>>5 D
)>>D E
.>>E F
GetStringValue>>F T
(>>T U
)>>U V
,>>V W
DisplayText?? #
=??$ %
doc??& )
.??) *
GetField??* 2
(??2 3
$str??3 T
)??T U
.??U V
GetStringValue??V d
(??d e
)??e f
,??f g
HasPublished@@ $
=@@% &
doc@@' *
.@@* +
GetField@@+ 3
(@@3 4
$str@@4 S
)@@S T
.@@T U
GetStringValue@@U c
(@@c d
)@@d e
==@@f h
$str@@i o
?@@p q
true@@r v
:@@w x
false@@y ~
}AA 
)AA 
;AA 
}BB 
returnDD 
TaskDD 
.DD 
CompletedTaskDD )
;DD) *
}EE 
)EE 
;EE 
returnGG 
resultsGG 
.GG 
OrderByGG "
(GG" #
xGG# $
=>GG% '
xGG( )
.GG) *
DisplayTextGG* 5
)GG5 6
;GG6 7
}HH 	
}II 
}JJ °æ
îD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneIndexingService.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class !
LuceneIndexingService &
{ 
private 
const 
int 
	BatchSize #
=$ %
$num& )
;) *
private 
readonly 

IShellHost #

_shellHost$ .
;. /
private 
readonly 
ShellSettings &
_shellSettings' 5
;5 6
private 
readonly 
LuceneIndexingState ,
_indexingState- ;
;; <
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
private 
readonly 
LuceneIndexManager +
_indexManager, 9
;9 :
private 
readonly  
IIndexingTaskManager - 
_indexingTaskManager. B
;B C
private   
readonly   
ISiteService   %
_siteService  & 2
;  2 3
private!! 
readonly!! 
ILogger!!  
_logger!!! (
;!!( )
public## !
LuceneIndexingService## $
(##$ %

IShellHost$$ 
	shellHost$$  
,$$  !
ShellSettings%% 
shellSettings%% '
,%%' (
LuceneIndexingState&& 
indexingState&&  -
,&&- .&
LuceneIndexSettingsService'' &&
luceneIndexSettingsService''' A
,''A B
LuceneIndexManager(( 
indexManager(( +
,((+ , 
IIndexingTaskManager))  
indexingTaskManager))! 4
,))4 5
ISiteService** 
siteService** $
,**$ %
ILogger++ 
<++ !
LuceneIndexingService++ )
>++) *
logger+++ 1
)++1 2
{,, 	

_shellHost-- 
=-- 
	shellHost-- "
;--" #
_shellSettings.. 
=.. 
shellSettings.. *
;..* +
_indexingState// 
=// 
indexingState// *
;//* +'
_luceneIndexSettingsService00 '
=00( )&
luceneIndexSettingsService00* D
;00D E
_indexManager11 
=11 
indexManager11 (
;11( ) 
_indexingTaskManager22  
=22! "
indexingTaskManager22# 6
;226 7
_siteService33 
=33 
siteService33 &
;33& '
_logger44 
=44 
logger44 
;44 
}55 	
public77 
async77 
Task77 $
ProcessContentItemsAsync77 2
(772 3
string773 9
	indexName77: C
=77D E
default77F M
)77M N
{88 	
var:: 

allIndices:: 
=:: 
new::  

Dictionary::! +
<::+ ,
string::, 2
,::2 3
int::4 7
>::7 8
(::8 9
)::9 :
;::: ;
var;; 

lastTaskId;; 
=;; 
Int32;; "
.;;" #
MaxValue;;# +
;;;+ ,
IEnumerable<< 
<<< 
LuceneIndexSettings<< +
><<+ ,
indexSettingsList<<- >
=<<? @
null<<A E
;<<E F
if>> 
(>> 
String>> 
.>> 
IsNullOrEmpty>> $
(>>$ %
	indexName>>% .
)>>. /
)>>/ 0
{?? 
indexSettingsList@@ !
=@@" #
await@@$ )'
_luceneIndexSettingsService@@* E
.@@E F
GetSettingsAsync@@F V
(@@V W
)@@W X
;@@X Y
ifBB 
(BB 
!BB 
indexSettingsListBB &
.BB& '
AnyBB' *
(BB* +
)BB+ ,
)BB, -
{CC 
returnDD 
;DD 
}EE 
foreachHH 
(HH 
varHH 
indexSettingHH )
inHH* ,
indexSettingsListHH- >
)HH> ?
{II 
varJJ 
taskIdJJ 
=JJ  
_indexingStateJJ! /
.JJ/ 0
GetLastTaskIdJJ0 =
(JJ= >
indexSettingJJ> J
.JJJ K
	IndexNameJJK T
)JJT U
;JJU V

lastTaskIdKK 
=KK  
MathKK! %
.KK% &
MinKK& )
(KK) *

lastTaskIdKK* 4
,KK4 5
taskIdKK6 <
)KK< =
;KK= >

allIndicesLL 
.LL 
AddLL "
(LL" #
indexSettingLL# /
.LL/ 0
	IndexNameLL0 9
,LL9 :
taskIdLL; A
)LLA B
;LLB C
}MM 
}NN 
elseOO 
{PP 
varQQ 
settingsQQ 
=QQ 
awaitQQ $'
_luceneIndexSettingsServiceQQ% @
.QQ@ A
GetSettingsAsyncQQA Q
(QQQ R
	indexNameQQR [
)QQ[ \
;QQ\ ]
ifSS 
(SS 
settingsSS 
==SS 
nullSS  $
)SS$ %
{TT 
returnUU 
;UU 
}VV 
indexSettingsListXX !
=XX" #
newXX$ '
LuceneIndexSettingsXX( ;
[XX; <
$numXX< =
]XX= >
{XX? @
settingsXXA I
}XXJ K
.XXK L
AsEnumerableXXL X
(XXX Y
)XXY Z
;XXZ [
varZZ 
taskIdZZ 
=ZZ 
_indexingStateZZ +
.ZZ+ ,
GetLastTaskIdZZ, 9
(ZZ9 :
	indexNameZZ: C
)ZZC D
;ZZD E

lastTaskId[[ 
=[[ 
Math[[ !
.[[! "
Min[[" %
([[% &

lastTaskId[[& 0
,[[0 1
taskId[[2 8
)[[8 9
;[[9 :

allIndices\\ 
.\\ 
Add\\ 
(\\ 
	indexName\\ (
,\\( )
taskId\\* 0
)\\0 1
;\\1 2
}]] 
if__ 
(__ 

allIndices__ 
.__ 
Count__  
==__! #
$num__$ %
)__% &
{`` 
returnaa 
;aa 
}bb 
vardd 
batchdd 
=dd 
Arraydd 
.dd 
Emptydd #
<dd# $
IndexingTaskdd$ 0
>dd0 1
(dd1 2
)dd2 3
;dd3 4
doff 
{gg 
varii 

shellScopeii 
=ii  
awaitii! &

_shellHostii' 1
.ii1 2
GetScopeAsyncii2 ?
(ii? @
_shellSettingsii@ N
)iiN O
;iiO P
awaitkk 

shellScopekk  
.kk  !

UsingAsynckk! +
(kk+ ,
asynckk, 1
scopekk2 7
=>kk8 :
{ll 
batchnn 
=nn 
(nn 
awaitnn " 
_indexingTaskManagernn# 7
.nn7 8!
GetIndexingTasksAsyncnn8 M
(nnM N

lastTaskIdnnN X
,nnX Y
	BatchSizennZ c
)nnc d
)nnd e
.nne f
ToArraynnf m
(nnm n
)nnn o
;nno p
ifpp 
(pp 
!pp 
batchpp 
.pp 
Anypp "
(pp" #
)pp# $
)pp$ %
{qq 
returnrr 
;rr 
}ss 
varuu 
contentManageruu &
=uu' (
scopeuu) .
.uu. /
ServiceProvideruu/ >
.uu> ?
GetRequiredServiceuu? Q
<uuQ R
IContentManageruuR a
>uua b
(uub c
)uuc d
;uud e
varvv 
indexHandlersvv %
=vv& '
scopevv( -
.vv- .
ServiceProvidervv. =
.vv= >
GetServicesvv> I
<vvI J$
IContentItemIndexHandlervvJ b
>vvb c
(vvc d
)vvd e
;vve f
varyy !
updatedContentItemIdsyy -
=yy. /
batchyy0 5
.zz 
Wherezz 
(zz 
xzz  
=>zz! #
xzz$ %
.zz% &
Typezz& *
==zz+ -
IndexingTaskTypeszz. ?
.zz? @
Updatezz@ F
)zzF G
.{{ 
Select{{ 
({{  
x{{  !
=>{{" $
x{{% &
.{{& '
ContentItemId{{' 4
){{4 5
.|| 
ToArray||  
(||  !
)||! "
;||" #
var~~ 
allPublished~~ $
=~~% &
await~~' ,
contentManager~~- ;
.~~; <
GetAsync~~< D
(~~D E!
updatedContentItemIds~~E Z
)~~Z [
;~~[ \
var 
	allLatest !
=" #
await$ )
contentManager* 8
.8 9
GetAsync9 A
(A B!
updatedContentItemIdsB W
,W X
latestY _
:_ `
truea e
)e f
;f g
var
ÇÇ %
updatedDocumentsByIndex
ÇÇ /
=
ÇÇ0 1
new
ÇÇ2 5

Dictionary
ÇÇ6 @
<
ÇÇ@ A
string
ÇÇA G
,
ÇÇG H
List
ÇÇI M
<
ÇÇM N
DocumentIndex
ÇÇN [
>
ÇÇ[ \
>
ÇÇ\ ]
(
ÇÇ] ^
)
ÇÇ^ _
;
ÇÇ_ `
foreach
ÑÑ 
(
ÑÑ 
var
ÑÑ  
index
ÑÑ! &
in
ÑÑ' )

allIndices
ÑÑ* 4
)
ÑÑ4 5
{
ÖÖ %
updatedDocumentsByIndex
ÜÜ /
[
ÜÜ/ 0
index
ÜÜ0 5
.
ÜÜ5 6
Key
ÜÜ6 9
]
ÜÜ9 :
=
ÜÜ; <
new
ÜÜ= @
List
ÜÜA E
<
ÜÜE F
DocumentIndex
ÜÜF S
>
ÜÜS T
(
ÜÜT U
)
ÜÜU V
;
ÜÜV W
}
áá 
if
ââ 
(
ââ 
	indexName
ââ !
!=
ââ" $
null
ââ% )
)
ââ) *
{
ää 
indexSettingsList
ãã )
=
ãã* +
indexSettingsList
ãã, =
.
ãã= >
Where
ãã> C
(
ããC D
x
ããD E
=>
ããF H
x
ããI J
.
ããJ K
	IndexName
ããK T
==
ããU W
	indexName
ããX a
)
ããa b
;
ããb c
}
åå 
var
éé 

needLatest
éé "
=
éé# $
indexSettingsList
éé% 6
.
éé6 7
FirstOrDefault
éé7 E
(
ééE F
x
ééF G
=>
ééH J
x
ééK L
.
ééL M
IndexLatest
ééM X
)
ééX Y
!=
ééZ \
null
éé] a
;
ééa b
var
èè 
needPublished
èè %
=
èè& '
indexSettingsList
èè( 9
.
èè9 :
FirstOrDefault
èè: H
(
èèH I
x
èèI J
=>
èèK M
!
èèN O
x
èèO P
.
èèP Q
IndexLatest
èèQ \
)
èè\ ]
!=
èè^ `
null
èèa e
;
èèe f
var
ëë 
settingsByIndex
ëë '
=
ëë( )
indexSettingsList
ëë* ;
.
ëë; <
ToDictionary
ëë< H
(
ëëH I
x
ëëI J
=>
ëëK M
x
ëëN O
.
ëëO P
	IndexName
ëëP Y
,
ëëY Z
x
ëë[ \
=>
ëë] _
x
ëë` a
)
ëëa b
;
ëëb c
foreach
ìì 
(
ìì 
var
ìì  
task
ìì! %
in
ìì& (
batch
ìì) .
)
ìì. /
{
îî 
if
ïï 
(
ïï 
task
ïï  
.
ïï  !
Type
ïï! %
==
ïï& (
IndexingTaskTypes
ïï) :
.
ïï: ;
Update
ïï; A
)
ïïA B
{
ññ 
BuildIndexContext
óó -#
publishedIndexContext
óó. C
=
óóD E
null
óóF J
,
óóJ K 
latestIndexContext
óóL ^
=
óó_ `
null
óóa e
;
óóe f
if
ôô 
(
ôô  
needPublished
ôô  -
)
ôô- .
{
öö 
var
õõ  #
contentItem
õõ$ /
=
õõ0 1
await
õõ2 7
contentManager
õõ8 F
.
õõF G
GetAsync
õõG O
(
õõO P
task
õõP T
.
õõT U
ContentItemId
õõU b
)
õõb c
;
õõc d
if
úú  "
(
úú# $
contentItem
úú$ /
!=
úú0 2
null
úú3 7
)
úú7 8
{
ùù  !#
publishedIndexContext
ûû$ 9
=
ûû: ;
new
ûû< ?
BuildIndexContext
ûû@ Q
(
ûûQ R
new
ûûR U
DocumentIndex
ûûV c
(
ûûc d
task
ûûd h
.
ûûh i
ContentItemId
ûûi v
)
ûûv w
,
ûûw x
contentItemûûy Ñ
,ûûÑ Ö
newûûÜ â
stringûûä ê
[ûûê ë
]ûûë í
{ûûì î
contentItemûûï †
.ûû† °
ContentTypeûû° ¨
}ûû≠ Æ
)ûûÆ Ø
;ûûØ ∞
await
üü$ )
indexHandlers
üü* 7
.
üü7 8
InvokeAsync
üü8 C
(
üüC D
x
üüD E
=>
üüF H
x
üüI J
.
üüJ K
BuildIndexAsync
üüK Z
(
üüZ [#
publishedIndexContext
üü[ p
)
üüp q
,
üüq r
_logger
üüs z
)
üüz {
;
üü{ |
}
††  !
}
°° 
if
££ 
(
££  

needLatest
££  *
)
££* +
{
§§ 
var
••  #
contentItem
••$ /
=
••0 1
await
••2 7
contentManager
••8 F
.
••F G
GetAsync
••G O
(
••O P
task
••P T
.
••T U
ContentItemId
••U b
,
••b c
VersionOptions
••d r
.
••r s
Latest
••s y
)
••y z
;
••z {
if
¶¶  "
(
¶¶# $
contentItem
¶¶$ /
!=
¶¶0 2
null
¶¶3 7
)
¶¶7 8
{
ßß  ! 
latestIndexContext
®®$ 6
=
®®7 8
new
®®9 <
BuildIndexContext
®®= N
(
®®N O
new
®®O R
DocumentIndex
®®S `
(
®®` a
task
®®a e
.
®®e f
ContentItemId
®®f s
)
®®s t
,
®®t u
contentItem®®v Å
,®®Å Ç
new®®É Ü
string®®á ç
[®®ç é
]®®é è
{®®ê ë
contentItem®®í ù
.®®ù û
ContentType®®û ©
}®®™ ´
)®®´ ¨
;®®¨ ≠
await
©©$ )
indexHandlers
©©* 7
.
©©7 8
InvokeAsync
©©8 C
(
©©C D
x
©©D E
=>
©©F H
x
©©I J
.
©©J K
BuildIndexAsync
©©K Z
(
©©Z [ 
latestIndexContext
©©[ m
)
©©m n
,
©©n o
_logger
©©p w
)
©©w x
;
©©x y
}
™™  !
}
´´ 
foreach
ÆÆ #
(
ÆÆ$ %
var
ÆÆ% (
index
ÆÆ) .
in
ÆÆ/ 1

allIndices
ÆÆ2 <
)
ÆÆ< =
{
ØØ 
if
∞∞  "
(
∞∞# $
index
∞∞$ )
.
∞∞) *
Value
∞∞* /
>=
∞∞0 2
task
∞∞3 7
.
∞∞7 8
Id
∞∞8 :
||
∞∞; =
!
∞∞> ?
settingsByIndex
∞∞? N
.
∞∞N O
TryGetValue
∞∞O Z
(
∞∞Z [
index
∞∞[ `
.
∞∞` a
Key
∞∞a d
,
∞∞d e
out
∞∞f i
var
∞∞j m
settings
∞∞n v
)
∞∞v w
)
∞∞w x
{
±±  !
continue
≤≤$ ,
;
≤≤, -
}
≥≥  !
var
µµ  #
context
µµ$ +
=
µµ, -
!
µµ. /
settings
µµ/ 7
.
µµ7 8
IndexLatest
µµ8 C
?
µµD E#
publishedIndexContext
µµF [
:
µµ\ ] 
latestIndexContext
µµ^ p
;
µµp q
if
∏∏  "
(
∏∏# $
context
∏∏$ +
==
∏∏, .
null
∏∏/ 3
)
∏∏3 4
{
ππ  !
continue
ªª$ ,
;
ªª, -
}
ºº  !
var
ææ  #
cultureAspect
ææ$ 1
=
ææ2 3
await
ææ4 9
contentManager
ææ: H
.
ææH I!
PopulateAspectAsync
ææI \
<
ææ\ ]
CultureAspect
ææ] j
>
ææj k
(
ææk l
context
ææl s
.
ææs t
ContentItem
ææt 
)ææ Ä
;ææÄ Å
var
øø  #
culture
øø$ +
=
øø, -
cultureAspect
øø. ;
.
øø; <

HasCulture
øø< F
?
øøG H
cultureAspect
øøI V
.
øøV W
Culture
øøW ^
.
øø^ _
Name
øø_ c
:
øød e
null
øøf j
;
øøj k
var
¿¿  #"
ignoreIndexedCulture
¿¿$ 8
=
¿¿9 :
settings
¿¿; C
.
¿¿C D
Culture
¿¿D K
==
¿¿L N
$str
¿¿O T
?
¿¿U V
false
¿¿W \
:
¿¿] ^
culture
¿¿_ f
!=
¿¿g i
settings
¿¿j r
.
¿¿r s
Culture
¿¿s z
;
¿¿z {
if
√√  "
(
√√# $
!
√√$ %
settings
√√% -
.
√√- .!
IndexedContentTypes
√√. A
.
√√A B
Contains
√√B J
(
√√J K
context
√√K R
.
√√R S
ContentItem
√√S ^
.
√√^ _
ContentType
√√_ j
)
√√j k
||
√√l n#
ignoreIndexedCulture√√o É
)√√É Ñ
{
ƒƒ  !
continue
≈≈$ ,
;
≈≈, -
}
∆∆  !%
updatedDocumentsByIndex
»»  7
[
»»7 8
index
»»8 =
.
»»= >
Key
»»> A
]
»»A B
.
»»B C
Add
»»C F
(
»»F G
context
»»G N
.
»»N O
DocumentIndex
»»O \
)
»»\ ]
;
»»] ^
}
…… 
}
   
}
ÀÀ 
foreach
ŒŒ 
(
ŒŒ 
var
ŒŒ  
index
ŒŒ! &
in
ŒŒ' )%
updatedDocumentsByIndex
ŒŒ* A
)
ŒŒA B
{
œœ 
var
–– 
deletedDocuments
–– ,
=
––- .%
updatedDocumentsByIndex
––/ F
[
––F G
index
––G L
.
––L M
Key
––M P
]
––P Q
.
––Q R
Select
––R X
(
––X Y
x
––Y Z
=>
––[ ]
x
––^ _
.
––_ `
ContentItemId
––` m
)
––m n
;
––n o
await
““ 
_indexManager
““ +
.
““+ ,"
DeleteDocumentsAsync
““, @
(
““@ A
index
““A F
.
““F G
Key
““G J
,
““J K
deletedDocuments
““L \
)
““\ ]
;
““] ^
}
”” 
foreach
÷÷ 
(
÷÷ 
var
÷÷  
index
÷÷! &
in
÷÷' )%
updatedDocumentsByIndex
÷÷* A
)
÷÷A B
{
◊◊ 
await
ÿÿ 
_indexManager
ÿÿ +
.
ÿÿ+ ,!
StoreDocumentsAsync
ÿÿ, ?
(
ÿÿ? @
index
ÿÿ@ E
.
ÿÿE F
Key
ÿÿF I
,
ÿÿI J%
updatedDocumentsByIndex
ÿÿK b
[
ÿÿb c
index
ÿÿc h
.
ÿÿh i
Key
ÿÿi l
]
ÿÿl m
)
ÿÿm n
;
ÿÿn o
}
ŸŸ 

lastTaskId
‹‹ 
=
‹‹  
batch
‹‹! &
.
‹‹& '
Last
‹‹' +
(
‹‹+ ,
)
‹‹, -
.
‹‹- .
Id
‹‹. 0
;
‹‹0 1
foreach
ﬁﬁ 
(
ﬁﬁ 
var
ﬁﬁ  
indexStatus
ﬁﬁ! ,
in
ﬁﬁ- /

allIndices
ﬁﬁ0 :
)
ﬁﬁ: ;
{
ﬂﬂ 
if
‡‡ 
(
‡‡ 
indexStatus
‡‡ '
.
‡‡' (
Value
‡‡( -
<
‡‡. /

lastTaskId
‡‡0 :
)
‡‡: ;
{
·· 
_indexingState
‚‚ *
.
‚‚* +
SetLastTaskId
‚‚+ 8
(
‚‚8 9
indexStatus
‚‚9 D
.
‚‚D E
Key
‚‚E H
,
‚‚H I

lastTaskId
‚‚J T
)
‚‚T U
;
‚‚U V
}
„„ 
}
‰‰ 
_indexingState
ÊÊ "
.
ÊÊ" #
Update
ÊÊ# )
(
ÊÊ) *
)
ÊÊ* +
;
ÊÊ+ ,
}
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ËË 
while
ËË 
(
ËË 
batch
ËË 
.
ËË 
Length
ËË !
==
ËË" $
	BatchSize
ËË% .
)
ËË. /
;
ËË/ 0
}
ÈÈ 	
public
ÔÔ 
async
ÔÔ 
Task
ÔÔ 
CreateIndexAsync
ÔÔ *
(
ÔÔ* +!
LuceneIndexSettings
ÔÔ+ >
indexSettings
ÔÔ? L
)
ÔÔL M
{
 	
await
ÒÒ )
_luceneIndexSettingsService
ÒÒ -
.
ÒÒ- .
UpdateIndexAsync
ÒÒ. >
(
ÒÒ> ?
indexSettings
ÒÒ? L
)
ÒÒL M
;
ÒÒM N
await
ÚÚ 
RebuildIndexAsync
ÚÚ #
(
ÚÚ# $
indexSettings
ÚÚ$ 1
.
ÚÚ1 2
	IndexName
ÚÚ2 ;
)
ÚÚ; <
;
ÚÚ< =
}
ÛÛ 	
public
˘˘ 
Task
˘˘ 
UpdateIndexAsync
˘˘ $
(
˘˘$ %!
LuceneIndexSettings
˘˘% 8
indexSettings
˘˘9 F
)
˘˘F G
{
˙˙ 	
return
˚˚ )
_luceneIndexSettingsService
˚˚ .
.
˚˚. /
UpdateIndexAsync
˚˚/ ?
(
˚˚? @
indexSettings
˚˚@ M
)
˚˚M N
;
˚˚N O
}
¸¸ 	
public
ÇÇ 
Task
ÇÇ 
DeleteIndexAsync
ÇÇ $
(
ÇÇ$ %
string
ÇÇ% +
	indexName
ÇÇ, 5
)
ÇÇ5 6
{
ÉÉ 	
_indexManager
ÑÑ 
.
ÑÑ 
DeleteIndex
ÑÑ %
(
ÑÑ% &
	indexName
ÑÑ& /
)
ÑÑ/ 0
;
ÑÑ0 1
return
ÖÖ )
_luceneIndexSettingsService
ÖÖ .
.
ÖÖ. /
DeleteIndexAsync
ÖÖ/ ?
(
ÖÖ? @
	indexName
ÖÖ@ I
)
ÖÖI J
;
ÖÖJ K
}
ÜÜ 	
public
åå 
void
åå 

ResetIndex
åå 
(
åå 
string
åå %
	indexName
åå& /
)
åå/ 0
{
çç 	
_indexingState
éé 
.
éé 
SetLastTaskId
éé (
(
éé( )
	indexName
éé) 2
,
éé2 3
$num
éé4 5
)
éé5 6
;
éé6 7
_indexingState
èè 
.
èè 
Update
èè !
(
èè! "
)
èè" #
;
èè# $
}
êê 	
public
ïï 
async
ïï 
Task
ïï 
RebuildIndexAsync
ïï +
(
ïï+ ,
string
ïï, 2
	indexName
ïï3 <
)
ïï< =
{
ññ 	
_indexManager
óó 
.
óó 
DeleteIndex
óó %
(
óó% &
	indexName
óó& /
)
óó/ 0
;
óó0 1
await
òò 
_indexManager
òò 
.
òò  
CreateIndexAsync
òò  0
(
òò0 1
	indexName
òò1 :
)
òò: ;
;
òò; <

ResetIndex
öö 
(
öö 
	indexName
öö  
)
öö  !
;
öö! "
}
õõ 	
public
ùù 
async
ùù 
Task
ùù 
<
ùù 
LuceneSettings
ùù (
>
ùù( )$
GetLuceneSettingsAsync
ùù* @
(
ùù@ A
)
ùùA B
{
ûû 	
var
üü 
siteSettings
üü 
=
üü 
await
üü $
_siteService
üü% 1
.
üü1 2"
GetSiteSettingsAsync
üü2 F
(
üüF G
)
üüG H
;
üüH I
if
°° 
(
°° 
siteSettings
°° 
.
°° 
Has
°°  
<
°°  !
LuceneSettings
°°! /
>
°°/ 0
(
°°0 1
)
°°1 2
)
°°2 3
{
¢¢ 
return
££ 
siteSettings
££ #
.
££# $
As
££$ &
<
££& '
LuceneSettings
££' 5
>
££5 6
(
££6 7
)
££7 8
;
££8 9
}
§§ 
else
•• 
{
¶¶ 
return
ßß 
new
ßß 
LuceneSettings
ßß )
(
ßß) *
)
ßß* +
;
ßß+ ,
}
®® 
}
©© 	
}
™™ 
}´´ Â#
íD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneIndexingState.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class 
LuceneIndexingState $
{ 
private 
readonly 
string "
_indexSettingsFilename  6
;6 7
private 
readonly 
JObject  
_content! )
;) *
public 
LuceneIndexingState "
(" #
IOptions 
< 
ShellOptions !
>! "
shellOptions# /
,/ 0
ShellSettings 
shellSettings '
) 
{ 	"
_indexSettingsFilename "
=# $
PathExtensions% 3
.3 4
Combine4 ;
(; <
shellOptions 
. 
Value "
." #%
ShellsApplicationDataPath# <
,< =
shellOptions 
. 
Value "
." #
ShellsContainerName# 6
,6 7
shellSettings 
. 
Name "
," #
$str $
)$ %
;% &
if 
( 
! 
File 
. 
Exists 
( "
_indexSettingsFilename 3
)3 4
)4 5
{ 
	Directory 
. 
CreateDirectory )
() *
Path* .
.. /
GetDirectoryName/ ?
(? @"
_indexSettingsFilename@ V
)V W
)W X
;X Y
File   
.   
WriteAllText   !
(  ! ""
_indexSettingsFilename  " 8
,  8 9
new  : =
JObject  > E
(  E F
)  F G
.  G H
ToString  H P
(  P Q

Newtonsoft  Q [
.  [ \
Json  \ `
.  ` a

Formatting  a k
.  k l
Indented  l t
)  t u
)  u v
;  v w
}!! 
_content## 
=## 
JObject## 
.## 
Parse## $
(##$ %
File##% )
.##) *
ReadAllText##* 5
(##5 6"
_indexSettingsFilename##6 L
)##L M
)##M N
;##N O
}$$ 	
public&& 
int&& 
GetLastTaskId&&  
(&&  !
string&&! '
	indexName&&( 1
)&&1 2
{'' 	
JToken(( 
value(( 
;(( 
if)) 
()) 
_content)) 
.)) 
TryGetValue)) $
())$ %
	indexName))% .
,)). /
out))0 3
value))4 9
)))9 :
))): ;
{** 
return++ 
value++ 
.++ 
Value++ "
<++" #
int++# &
>++& '
(++' (
)++( )
;++) *
},, 
else-- 
{.. 
lock// 
(// 
this// 
)// 
{00 
_content11 
.11 
Add11  
(11  !
new11! $
	JProperty11% .
(11. /
	indexName11/ 8
,118 9
$num11: ;
)11; <
)11< =
;11= >
}22 
return44 
$num44 
;44 
}55 
}66 	
public88 
void88 
SetLastTaskId88 !
(88! "
string88" (
	indexName88) 2
,882 3
int884 7
taskId888 >
)88> ?
{99 	
lock:: 
(:: 
this:: 
):: 
{;; 
_content<< 
[<< 
	indexName<< "
]<<" #
=<<$ %
taskId<<& ,
;<<, -
}== 
}>> 	
public@@ 
void@@ 
Update@@ 
(@@ 
)@@ 
{AA 	
lockBB 
(BB 
thisBB 
)BB 
{CC 
FileDD 
.DD 
WriteAllTextDD !
(DD! ""
_indexSettingsFilenameDD" 8
,DD8 9
_contentDD: B
.DDB C
ToStringDDC K
(DDK L

NewtonsoftDDL V
.DDV W
JsonDDW [
.DD[ \

FormattingDD\ f
.DDf g
IndentedDDg o
)DDo p
)DDp q
;DDq r
}EE 
}FF 	
}GG 
}HH ‰º
ëD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneIndexManager.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class 
LuceneIndexManager #
:$ %
IDisposable& 1
{ 
private 
readonly 
IClock 
_clock  &
;& '
private   
readonly   
ILogger    
_logger  ! (
;  ( )
private!! 
readonly!! 
string!! 
	_rootPath!!  )
;!!) *
private"" 
bool"" 

_disposing"" 
;""  
private##  
ConcurrentDictionary## $
<##$ %
string##% +
,##+ ,
IndexReaderPool##- <
>##< =
_indexPools##> I
=##J K
new##L O 
ConcurrentDictionary##P d
<##d e
string##e k
,##k l
IndexReaderPool##m |
>##| }
(##} ~
StringComparer	##~ å
.
##å ç
OrdinalIgnoreCase
##ç û
)
##û ü
;
##ü †
private$$  
ConcurrentDictionary$$ $
<$$$ %
string$$% +
,$$+ ,
IndexWriterWrapper$$- ?
>$$? @
_writers$$A I
=$$J K
new$$L O 
ConcurrentDictionary$$P d
<$$d e
string$$e k
,$$k l
IndexWriterWrapper$$m 
>	$$ Ä
(
$$Ä Å
StringComparer
$$Å è
.
$$è ê
OrdinalIgnoreCase
$$ê °
)
$$° ¢
;
$$¢ £
private%%  
ConcurrentDictionary%% $
<%%$ %
string%%% +
,%%+ ,
DateTime%%- 5
>%%5 6
_timestamps%%7 B
=%%C D
new%%E H 
ConcurrentDictionary%%I ]
<%%] ^
string%%^ d
,%%d e
DateTime%%f n
>%%n o
(%%o p
StringComparer%%p ~
.%%~ 
OrdinalIgnoreCase	%% ê
)
%%ê ë
;
%%ë í
private&& 
readonly&& !
LuceneAnalyzerManager&& ."
_luceneAnalyzerManager&&/ E
;&&E F
private'' 
readonly'' &
LuceneIndexSettingsService'' 3'
_luceneIndexSettingsService''4 O
;''O P
private(( 
static(( 
object(( 
_synLock(( &
=((' (
new(() ,
object((- 3
(((3 4
)((4 5
;((5 6
public** 
LuceneIndexManager** !
(**! "
IClock++ 
clock++ 
,++ 
IOptions,, 
<,, 
ShellOptions,, !
>,,! "
shellOptions,,# /
,,,/ 0
ShellSettings-- 
shellSettings-- '
,--' (
ILogger.. 
<.. 
LuceneIndexManager.. &
>..& '
logger..( .
,... /!
LuceneAnalyzerManager// !!
luceneAnalyzerManager//" 7
,//7 8&
LuceneIndexSettingsService00 &&
luceneIndexSettingsService00' A
)11 
{22 	
_clock33 
=33 
clock33 
;33 
_logger44 
=44 
logger44 
;44 
	_rootPath55 
=55 
PathExtensions55 &
.55& '
Combine55' .
(55. /
shellOptions66 
.66 
Value66 "
.66" #%
ShellsApplicationDataPath66# <
,66< =
shellOptions77 
.77 
Value77 "
.77" #
ShellsContainerName77# 6
,776 7
shellSettings88 
.88 
Name88 "
,88" #
$str88$ ,
)88, -
;88- .
	Directory:: 
.:: 
CreateDirectory:: %
(::% &
	_rootPath::& /
)::/ 0
;::0 1"
_luceneAnalyzerManager;; "
=;;# $!
luceneAnalyzerManager;;% :
;;;: ;'
_luceneIndexSettingsService<< '
=<<( )&
luceneIndexSettingsService<<* D
;<<D E
}== 	
public?? 
async?? 
Task?? 
CreateIndexAsync?? *
(??* +
string??+ 1
	indexName??2 ;
)??; <
{@@ 	
awaitAA 

WriteAsyncAA 
(AA 
	indexNameAA &
,AA& '
_AA( )
=>AA* ,
{AA- .
}AA/ 0
,AA0 1
trueAA2 6
)AA6 7
;AA7 8
}BB 	
publicDD 
asyncDD 
TaskDD  
DeleteDocumentsAsyncDD .
(DD. /
stringDD/ 5
	indexNameDD6 ?
,DD? @
IEnumerableDDA L
<DDL M
stringDDM S
>DDS T
contentItemIdsDDU c
)DDc d
{EE 	
awaitFF 

WriteAsyncFF 
(FF 
	indexNameFF &
,FF& '
writerFF( .
=>FF/ 1
{GG 
writerHH 
.HH 
DeleteDocumentsHH &
(HH& '
contentItemIdsHH' 5
.HH5 6
SelectHH6 <
(HH< =
xHH= >
=>HH? A
newHHB E
TermHHF J
(HHJ K
$strHHK Z
,HHZ [
xHH\ ]
)HH] ^
)HH^ _
.HH_ `
ToArrayHH` g
(HHg h
)HHh i
)HHi j
;HHj k
writerJJ 
.JJ 
CommitJJ 
(JJ 
)JJ 
;JJ  
ifLL 
(LL 
_indexPoolsLL 
.LL  
	TryRemoveLL  )
(LL) *
	indexNameLL* 3
,LL3 4
outLL5 8
varLL9 <
poolLL= A
)LLA B
)LLB C
{MM 
poolNN 
.NN 
	MakeDirtyNN "
(NN" #
)NN# $
;NN$ %
poolOO 
.OO 
ReleaseOO  
(OO  !
)OO! "
;OO" #
}PP 
}QQ 
)QQ 
;QQ 
}RR 	
publicTT 
voidTT 
DeleteIndexTT 
(TT  
stringTT  &
	indexNameTT' 0
)TT0 1
{UU 	
lockVV 
(VV 
thisVV 
)VV 
{WW 
ifXX 
(XX 
_writersXX 
.XX 
TryGetValueXX (
(XX( )
	indexNameXX) 2
,XX2 3
outXX4 7
varXX8 ;
writerXX< B
)XXB C
)XXC D
{YY 
writerZZ 
.ZZ 
	IsClosingZZ $
=ZZ% &
trueZZ' +
;ZZ+ ,
writer[[ 
.[[ 
Dispose[[ "
([[" #
)[[# $
;[[$ %
}\\ 
if^^ 
(^^ 
_indexPools^^ 
.^^  
	TryRemove^^  )
(^^) *
	indexName^^* 3
,^^3 4
out^^5 8
var^^9 <
reader^^= C
)^^C D
)^^D E
{__ 
reader`` 
.`` 
Dispose`` "
(``" #
)``# $
;``$ %
}aa 
_timestampscc 
.cc 
	TryRemovecc %
(cc% &
	indexNamecc& /
,cc/ 0
outcc1 4
varcc5 8
	timestampcc9 B
)ccB C
;ccC D
varee 
indexFolderee 
=ee  !
PathExtensionsee" 0
.ee0 1
Combineee1 8
(ee8 9
	_rootPathee9 B
,eeB C
	indexNameeeD M
)eeM N
;eeN O
ifgg 
(gg 
	Directorygg 
.gg 
Existsgg $
(gg$ %
indexFoldergg% 0
)gg0 1
)gg1 2
{hh 
tryii 
{jj 
	Directorykk !
.kk! "
Deletekk" (
(kk( )
indexFolderkk) 4
,kk4 5
truekk6 :
)kk: ;
;kk; <
}ll 
catchmm 
{mm 
}mm 
}nn 
_writerspp 
.pp 
	TryRemovepp "
(pp" #
	indexNamepp# ,
,pp, -
outpp. 1
writerpp2 8
)pp8 9
;pp9 :
}qq 
}rr 	
publictt 
booltt 
Existstt 
(tt 
stringtt !
	indexNamett" +
)tt+ ,
{uu 	
ifvv 
(vv 
stringvv 
.vv 
IsNullOrWhiteSpacevv )
(vv) *
	indexNamevv* 3
)vv3 4
)vv4 5
{ww 
returnxx 
falsexx 
;xx 
}yy 
return{{ 
	Directory{{ 
.{{ 
Exists{{ #
({{# $
PathExtensions{{$ 2
.{{2 3
Combine{{3 :
({{: ;
	_rootPath{{; D
,{{D E
	indexName{{F O
){{O P
){{P Q
;{{Q R
}|| 	
public~~ 
async~~ 
Task~~ 
StoreDocumentsAsync~~ -
(~~- .
string~~. 4
	indexName~~5 >
,~~> ?
IEnumerable~~@ K
<~~K L
DocumentIndex~~L Y
>~~Y Z
indexDocuments~~[ i
)~~i j
{ 	
await
ÄÄ 

WriteAsync
ÄÄ 
(
ÄÄ 
	indexName
ÄÄ &
,
ÄÄ& '
writer
ÄÄ( .
=>
ÄÄ/ 1
{
ÅÅ 
foreach
ÇÇ 
(
ÇÇ 
var
ÇÇ 
indexDocument
ÇÇ *
in
ÇÇ+ -
indexDocuments
ÇÇ. <
)
ÇÇ< =
{
ÉÉ 
writer
ÑÑ 
.
ÑÑ 
AddDocument
ÑÑ &
(
ÑÑ& '"
CreateLuceneDocument
ÑÑ' ;
(
ÑÑ; <
indexDocument
ÑÑ< I
)
ÑÑI J
)
ÑÑJ K
;
ÑÑK L
}
ÖÖ 
writer
áá 
.
áá 
Commit
áá 
(
áá 
)
áá 
;
áá  
if
ââ 
(
ââ 
_indexPools
ââ 
.
ââ  
	TryRemove
ââ  )
(
ââ) *
	indexName
ââ* 3
,
ââ3 4
out
ââ5 8
var
ââ9 <
pool
ââ= A
)
ââA B
)
ââB C
{
ää 
pool
ãã 
.
ãã 
	MakeDirty
ãã "
(
ãã" #
)
ãã# $
;
ãã$ %
pool
åå 
.
åå 
Release
åå  
(
åå  !
)
åå! "
;
åå" #
}
çç 
}
éé 
)
éé 
;
éé 
}
èè 	
public
ëë 
async
ëë 
Task
ëë 
SearchAsync
ëë %
(
ëë% &
string
ëë& ,
	indexName
ëë- 6
,
ëë6 7
Func
ëë8 <
<
ëë< =
IndexSearcher
ëë= J
,
ëëJ K
Task
ëëL P
>
ëëP Q
searcher
ëëR Z
)
ëëZ [
{
íí 	
if
ìì 
(
ìì 
Exists
ìì 
(
ìì 
	indexName
ìì  
)
ìì  !
)
ìì! "
{
îî 
using
ïï 
(
ïï 
var
ïï 
reader
ïï !
=
ïï" #
	GetReader
ïï$ -
(
ïï- .
	indexName
ïï. 7
)
ïï7 8
)
ïï8 9
{
ññ 
var
óó 
indexSearcher
óó %
=
óó& '
new
óó( +
IndexSearcher
óó, 9
(
óó9 :
reader
óó: @
.
óó@ A
IndexReader
óóA L
)
óóL M
;
óóM N
await
òò 
searcher
òò "
(
òò" #
indexSearcher
òò# 0
)
òò0 1
;
òò1 2
}
ôô 
_timestamps
õõ 
[
õõ 
	indexName
õõ %
]
õõ% &
=
õõ' (
_clock
õõ) /
.
õõ/ 0
UtcNow
õõ0 6
;
õõ6 7
}
úú 
}
ùù 	
public
üü 
void
üü 
Read
üü 
(
üü 
string
üü 
	indexName
üü  )
,
üü) *
Action
üü+ 1
<
üü1 2
IndexReader
üü2 =
>
üü= >
reader
üü? E
)
üüE F
{
†† 	
if
°° 
(
°° 
Exists
°° 
(
°° 
	indexName
°°  
)
°°  !
)
°°! "
{
¢¢ 
using
££ 
(
££ 
var
££ 
indexReader
££ &
=
££' (
	GetReader
££) 2
(
££2 3
	indexName
££3 <
)
££< =
)
££= >
{
§§ 
reader
•• 
(
•• 
indexReader
•• &
.
••& '
IndexReader
••' 2
)
••2 3
;
••3 4
}
¶¶ 
_timestamps
®® 
[
®® 
	indexName
®® %
]
®®% &
=
®®' (
_clock
®®) /
.
®®/ 0
UtcNow
®®0 6
;
®®6 7
}
©© 
}
™™ 	
public
ØØ !
IReadOnlyDictionary
ØØ "
<
ØØ" #
string
ØØ# )
,
ØØ) *
DateTime
ØØ+ 3
>
ØØ3 4
GetTimestamps
ØØ5 B
(
ØØB C
)
ØØC D
{
∞∞ 	
return
±± 
new
±±  
ReadOnlyDictionary
±± )
<
±±) *
string
±±* 0
,
±±0 1
DateTime
±±2 :
>
±±: ;
(
±±; <
_timestamps
±±< G
)
±±G H
;
±±H I
}
≤≤ 	
private
¥¥ 
Document
¥¥ "
CreateLuceneDocument
¥¥ -
(
¥¥- .
DocumentIndex
¥¥. ;
documentIndex
¥¥< I
)
¥¥I J
{
µµ 	
var
∂∂ 
doc
∂∂ 
=
∂∂ 
new
∂∂ 
Document
∂∂ "
{
∑∑ 
new
ππ 
StringField
ππ 
(
ππ  
$str
ππ  /
,
ππ/ 0
documentIndex
ππ1 >
.
ππ> ?
ContentItemId
ππ? L
.
ππL M
ToString
ππM U
(
ππU V
)
ππV W
,
ππW X
Field
ππY ^
.
ππ^ _
Store
ππ_ d
.
ππd e
YES
ππe h
)
ππh i
}
∫∫ 
;
∫∫ 
foreach
ºº 
(
ºº 
var
ºº 
entry
ºº 
in
ºº !
documentIndex
ºº" /
.
ºº/ 0
Entries
ºº0 7
)
ºº7 8
{
ΩΩ 
var
ææ 
store
ææ 
=
ææ 
entry
ææ !
.
ææ! "
Options
ææ" )
.
ææ) *
HasFlag
ææ* 1
(
ææ1 2"
DocumentIndexOptions
ææ2 F
.
ææF G
Store
ææG L
)
ææL M
?
øø 
Field
øø #
.
øø# $
Store
øø$ )
.
øø) *
YES
øø* -
:
¿¿ 
Field
¿¿ #
.
¿¿# $
Store
¿¿$ )
.
¿¿) *
NO
¿¿* ,
;
¿¿, -
switch
¬¬ 
(
¬¬ 
entry
¬¬ 
.
¬¬ 
Type
¬¬ "
)
¬¬" #
{
√√ 
case
ƒƒ 
DocumentIndex
ƒƒ &
.
ƒƒ& '
Types
ƒƒ' ,
.
ƒƒ, -
Boolean
ƒƒ- 4
:
ƒƒ4 5
doc
∆∆ 
.
∆∆ 
Add
∆∆ 
(
∆∆  
new
∆∆  #
StringField
∆∆$ /
(
∆∆/ 0
entry
∆∆0 5
.
∆∆5 6
Name
∆∆6 :
,
∆∆: ;
Convert
∆∆< C
.
∆∆C D
ToString
∆∆D L
(
∆∆L M
entry
∆∆M R
.
∆∆R S
Value
∆∆S X
)
∆∆X Y
.
∆∆Y Z
ToLowerInvariant
∆∆Z j
(
∆∆j k
)
∆∆k l
,
∆∆l m
store
∆∆n s
)
∆∆s t
)
∆∆t u
;
∆∆u v
break
«« 
;
«« 
case
…… 
DocumentIndex
…… &
.
……& '
Types
……' ,
.
……, -
DateTime
……- 5
:
……5 6
if
   
(
   
entry
   !
.
  ! "
Value
  " '
!=
  ( *
null
  + /
)
  / 0
{
ÀÀ 
if
ÃÃ 
(
ÃÃ  
entry
ÃÃ  %
.
ÃÃ% &
Value
ÃÃ& +
is
ÃÃ, .
DateTimeOffset
ÃÃ/ =
)
ÃÃ= >
{
ÕÕ 
doc
ŒŒ  #
.
ŒŒ# $
Add
ŒŒ$ '
(
ŒŒ' (
new
ŒŒ( +
StringField
ŒŒ, 7
(
ŒŒ7 8
entry
ŒŒ8 =
.
ŒŒ= >
Name
ŒŒ> B
,
ŒŒB C
	DateTools
ŒŒD M
.
ŒŒM N
DateToString
ŒŒN Z
(
ŒŒZ [
(
ŒŒ[ \
(
ŒŒ\ ]
DateTimeOffset
ŒŒ] k
)
ŒŒk l
entry
ŒŒl q
.
ŒŒq r
Value
ŒŒr w
)
ŒŒw x
.
ŒŒx y
UtcDateTimeŒŒy Ñ
,ŒŒÑ Ö
	DateToolsŒŒÜ è
.ŒŒè ê

ResolutionŒŒê ö
.ŒŒö õ
SECONDŒŒõ °
)ŒŒ° ¢
,ŒŒ¢ £
storeŒŒ§ ©
)ŒŒ© ™
)ŒŒ™ ´
;ŒŒ´ ¨
}
œœ 
else
––  
{
—— 
doc
““  #
.
““# $
Add
““$ '
(
““' (
new
““( +
StringField
““, 7
(
““7 8
entry
““8 =
.
““= >
Name
““> B
,
““B C
	DateTools
““D M
.
““M N
DateToString
““N Z
(
““Z [
(
““[ \
(
““\ ]
DateTime
““] e
)
““e f
entry
““f k
.
““k l
Value
““l q
)
““q r
.
““r s
ToUniversalTime““s Ç
(““Ç É
)““É Ñ
,““Ñ Ö
	DateTools““Ü è
.““è ê

Resolution““ê ö
.““ö õ
SECOND““õ °
)““° ¢
,““¢ £
store““§ ©
)““© ™
)““™ ´
;““´ ¨
}
”” 
}
‘‘ 
else
’’ 
{
÷÷ 
doc
◊◊ 
.
◊◊  
Add
◊◊  #
(
◊◊# $
new
◊◊$ '
StringField
◊◊( 3
(
◊◊3 4
entry
◊◊4 9
.
◊◊9 :
Name
◊◊: >
,
◊◊> ?
$str
◊◊@ F
,
◊◊F G
store
◊◊H M
)
◊◊M N
)
◊◊N O
;
◊◊O P
}
ÿÿ 
break
ŸŸ 
;
ŸŸ 
case
€€ 
DocumentIndex
€€ &
.
€€& '
Types
€€' ,
.
€€, -
Integer
€€- 4
:
€€4 5
if
‹‹ 
(
‹‹ 
entry
‹‹ !
.
‹‹! "
Value
‹‹" '
!=
‹‹( *
null
‹‹+ /
&&
‹‹0 2
Int32
‹‹3 8
.
‹‹8 9
TryParse
‹‹9 A
(
‹‹A B
entry
‹‹B G
.
‹‹G H
Value
‹‹H M
.
‹‹M N
ToString
‹‹N V
(
‹‹V W
)
‹‹W X
,
‹‹X Y
out
‹‹Z ]
var
‹‹^ a
value
‹‹b g
)
‹‹g h
)
‹‹h i
{
›› 
doc
ﬁﬁ 
.
ﬁﬁ  
Add
ﬁﬁ  #
(
ﬁﬁ# $
new
ﬁﬁ$ '

Int32Field
ﬁﬁ( 2
(
ﬁﬁ2 3
entry
ﬁﬁ3 8
.
ﬁﬁ8 9
Name
ﬁﬁ9 =
,
ﬁﬁ= >
Convert
ﬁﬁ? F
.
ﬁﬁF G
ToInt32
ﬁﬁG N
(
ﬁﬁN O
entry
ﬁﬁO T
.
ﬁﬁT U
Value
ﬁﬁU Z
)
ﬁﬁZ [
,
ﬁﬁ[ \
store
ﬁﬁ] b
)
ﬁﬁb c
)
ﬁﬁc d
;
ﬁﬁd e
}
ﬂﬂ 
else
‡‡ 
{
·· 
doc
‚‚ 
.
‚‚  
Add
‚‚  #
(
‚‚# $
new
‚‚$ '
StringField
‚‚( 3
(
‚‚3 4
entry
‚‚4 9
.
‚‚9 :
Name
‚‚: >
,
‚‚> ?
$str
‚‚@ F
,
‚‚F G
store
‚‚H M
)
‚‚M N
)
‚‚N O
;
‚‚O P
}
„„ 
break
ÂÂ 
;
ÂÂ 
case
ÁÁ 
DocumentIndex
ÁÁ &
.
ÁÁ& '
Types
ÁÁ' ,
.
ÁÁ, -
Number
ÁÁ- 3
:
ÁÁ3 4
if
ËË 
(
ËË 
entry
ËË !
.
ËË! "
Value
ËË" '
!=
ËË( *
null
ËË+ /
)
ËË/ 0
{
ÈÈ 
doc
ÍÍ 
.
ÍÍ  
Add
ÍÍ  #
(
ÍÍ# $
new
ÍÍ$ '
DoubleField
ÍÍ( 3
(
ÍÍ3 4
entry
ÍÍ4 9
.
ÍÍ9 :
Name
ÍÍ: >
,
ÍÍ> ?
Convert
ÍÍ@ G
.
ÍÍG H
ToDouble
ÍÍH P
(
ÍÍP Q
entry
ÍÍQ V
.
ÍÍV W
Value
ÍÍW \
)
ÍÍ\ ]
,
ÍÍ] ^
store
ÍÍ_ d
)
ÍÍd e
)
ÍÍe f
;
ÍÍf g
}
ÎÎ 
else
ÏÏ 
{
ÌÌ 
doc
ÓÓ 
.
ÓÓ  
Add
ÓÓ  #
(
ÓÓ# $
new
ÓÓ$ '
StringField
ÓÓ( 3
(
ÓÓ3 4
entry
ÓÓ4 9
.
ÓÓ9 :
Name
ÓÓ: >
,
ÓÓ> ?
$str
ÓÓ@ F
,
ÓÓF G
store
ÓÓH M
)
ÓÓM N
)
ÓÓN O
;
ÓÓO P
}
ÔÔ 
break
 
;
 
case
ÚÚ 
DocumentIndex
ÚÚ &
.
ÚÚ& '
Types
ÚÚ' ,
.
ÚÚ, -
Text
ÚÚ- 1
:
ÚÚ1 2
if
ÛÛ 
(
ÛÛ 
entry
ÛÛ !
.
ÛÛ! "
Value
ÛÛ" '
!=
ÛÛ( *
null
ÛÛ+ /
&&
ÛÛ0 2
!
ÛÛ3 4
String
ÛÛ4 :
.
ÛÛ: ;
IsNullOrEmpty
ÛÛ; H
(
ÛÛH I
Convert
ÛÛI P
.
ÛÛP Q
ToString
ÛÛQ Y
(
ÛÛY Z
entry
ÛÛZ _
.
ÛÛ_ `
Value
ÛÛ` e
)
ÛÛe f
)
ÛÛf g
)
ÛÛg h
{
ÙÙ 
if
ıı 
(
ıı  
entry
ıı  %
.
ıı% &
Options
ıı& -
.
ıı- .
HasFlag
ıı. 5
(
ıı5 6"
DocumentIndexOptions
ıı6 J
.
ııJ K
Analyze
ııK R
)
ııR S
)
ııS T
{
ˆˆ 
doc
˜˜  #
.
˜˜# $
Add
˜˜$ '
(
˜˜' (
new
˜˜( +
	TextField
˜˜, 5
(
˜˜5 6
entry
˜˜6 ;
.
˜˜; <
Name
˜˜< @
,
˜˜@ A
Convert
˜˜B I
.
˜˜I J
ToString
˜˜J R
(
˜˜R S
entry
˜˜S X
.
˜˜X Y
Value
˜˜Y ^
)
˜˜^ _
,
˜˜_ `
store
˜˜a f
)
˜˜f g
)
˜˜g h
;
˜˜h i
}
¯¯ 
else
˘˘  
{
˙˙ 
doc
˚˚  #
.
˚˚# $
Add
˚˚$ '
(
˚˚' (
new
˚˚( +
StringField
˚˚, 7
(
˚˚7 8
entry
˚˚8 =
.
˚˚= >
Name
˚˚> B
,
˚˚B C
Convert
˚˚D K
.
˚˚K L
ToString
˚˚L T
(
˚˚T U
entry
˚˚U Z
.
˚˚Z [
Value
˚˚[ `
)
˚˚` a
,
˚˚a b
store
˚˚c h
)
˚˚h i
)
˚˚i j
;
˚˚j k
}
¸¸ 
}
˝˝ 
else
˛˛ 
{
ˇˇ 
if
ÄÄ 
(
ÄÄ  
entry
ÄÄ  %
.
ÄÄ% &
Options
ÄÄ& -
.
ÄÄ- .
HasFlag
ÄÄ. 5
(
ÄÄ5 6"
DocumentIndexOptions
ÄÄ6 J
.
ÄÄJ K
Analyze
ÄÄK R
)
ÄÄR S
)
ÄÄS T
{
ÅÅ 
doc
ÇÇ  #
.
ÇÇ# $
Add
ÇÇ$ '
(
ÇÇ' (
new
ÇÇ( +
	TextField
ÇÇ, 5
(
ÇÇ5 6
entry
ÇÇ6 ;
.
ÇÇ; <
Name
ÇÇ< @
,
ÇÇ@ A
$str
ÇÇB H
,
ÇÇH I
store
ÇÇJ O
)
ÇÇO P
)
ÇÇP Q
;
ÇÇQ R
}
ÉÉ 
else
ÑÑ  
{
ÖÖ 
doc
ÜÜ  #
.
ÜÜ# $
Add
ÜÜ$ '
(
ÜÜ' (
new
ÜÜ( +
StringField
ÜÜ, 7
(
ÜÜ7 8
entry
ÜÜ8 =
.
ÜÜ= >
Name
ÜÜ> B
,
ÜÜB C
$str
ÜÜD J
,
ÜÜJ K
store
ÜÜL Q
)
ÜÜQ R
)
ÜÜR S
;
ÜÜS T
}
áá 
}
àà 
break
ââ 
;
ââ 
}
ää 
}
ãã 
return
çç 
doc
çç 
;
çç 
}
éé 	
private
êê 
BaseDirectory
êê 
CreateDirectory
êê -
(
êê- .
string
êê. 4
	indexName
êê5 >
)
êê> ?
{
ëë 	
lock
íí 
(
íí 
this
íí 
)
íí 
{
ìì 
var
îî 
path
îî 
=
îî 
new
îî 
DirectoryInfo
îî ,
(
îî, -
PathExtensions
îî- ;
.
îî; <
Combine
îî< C
(
îîC D
	_rootPath
îîD M
,
îîM N
	indexName
îîO X
)
îîX Y
)
îîY Z
;
îîZ [
if
ññ 
(
ññ 
!
ññ 
path
ññ 
.
ññ 
Exists
ññ  
)
ññ  !
{
óó 
path
òò 
.
òò 
Create
òò 
(
òò  
)
òò  !
;
òò! "
}
ôô 
lock
úú 
(
úú 
_synLock
úú 
)
úú 
{
ùù 
return
ûû 
FSDirectory
ûû &
.
ûû& '
Open
ûû' +
(
ûû+ ,
path
ûû, 0
)
ûû0 1
;
ûû1 2
}
üü 
}
†† 
}
°° 	
private
££ 
async
££ 
Task
££ 

WriteAsync
££ %
(
££% &
string
££& ,
	indexName
££- 6
,
££6 7
Action
££8 >
<
££> ?
IndexWriter
££? J
>
££J K
action
££L R
,
££R S
bool
££T X
close
££Y ^
=
££_ `
false
££a f
)
££f g
{
§§ 	
if
•• 
(
•• 
!
•• 
_writers
•• 
.
•• 
TryGetValue
•• %
(
••% &
	indexName
••& /
,
••/ 0
out
••1 4
var
••5 8
writer
••9 ?
)
••? @
)
••@ A
{
¶¶ 
var
ßß 
indexAnalyzer
ßß !
=
ßß" #
await
ßß$ ))
_luceneIndexSettingsService
ßß* E
.
ßßE F$
LoadIndexAnalyzerAsync
ßßF \
(
ßß\ ]
	indexName
ßß] f
)
ßßf g
;
ßßg h
lock
®® 
(
®® 
this
®® 
)
®® 
{
©© 
if
™™ 
(
™™ 
!
™™ 
_writers
™™ !
.
™™! "
TryGetValue
™™" -
(
™™- .
	indexName
™™. 7
,
™™7 8
out
™™9 <
writer
™™= C
)
™™C D
)
™™D E
{
´´ 
var
¨¨ 
	directory
¨¨ %
=
¨¨& '
CreateDirectory
¨¨( 7
(
¨¨7 8
	indexName
¨¨8 A
)
¨¨A B
;
¨¨B C
var
≠≠ 
analyzer
≠≠ $
=
≠≠% &$
_luceneAnalyzerManager
≠≠' =
.
≠≠= >
CreateAnalyzer
≠≠> L
(
≠≠L M
indexAnalyzer
≠≠M Z
)
≠≠Z [
;
≠≠[ \
var
ÆÆ 
config
ÆÆ "
=
ÆÆ# $
new
ÆÆ% (
IndexWriterConfig
ÆÆ) :
(
ÆÆ: ;
LuceneSettings
ÆÆ; I
.
ÆÆI J
DefaultVersion
ÆÆJ X
,
ÆÆX Y
analyzer
ÆÆZ b
)
ÆÆb c
{
ØØ 
OpenMode
∞∞ $
=
∞∞% &
OpenMode
∞∞' /
.
∞∞/ 0
CREATE_OR_APPEND
∞∞0 @
,
∞∞@ A
WriteLockTimeout
±± ,
=
±±- .
Lock
±±/ 3
.
±±3 4 
LOCK_POLL_INTERVAL
±±4 F
*
±±G H
$num
±±I J
}
≤≤ 
;
≤≤ 
writer
¥¥ 
=
¥¥  
new
¥¥! $ 
IndexWriterWrapper
¥¥% 7
(
¥¥7 8
	directory
¥¥8 A
,
¥¥A B
config
¥¥C I
)
¥¥I J
;
¥¥J K
if
∂∂ 
(
∂∂ 
close
∂∂ !
)
∂∂! "
{
∑∑ 
action
∏∏ "
?
∏∏" #
.
∏∏# $
Invoke
∏∏$ *
(
∏∏* +
writer
∏∏+ 1
)
∏∏1 2
;
∏∏2 3
writer
ππ "
.
ππ" #
Dispose
ππ# *
(
ππ* +
)
ππ+ ,
;
ππ, -
_timestamps
∫∫ '
[
∫∫' (
	indexName
∫∫( 1
]
∫∫1 2
=
∫∫3 4
_clock
∫∫5 ;
.
∫∫; <
UtcNow
∫∫< B
;
∫∫B C
return
ªª "
;
ªª" #
}
ºº 
_writers
ææ  
[
ææ  !
	indexName
ææ! *
]
ææ* +
=
ææ, -
writer
ææ. 4
;
ææ4 5
}
øø 
}
¿¿ 
}
¡¡ 
if
√√ 
(
√√ 
writer
√√ 
.
√√ 
	IsClosing
√√  
)
√√  !
{
ƒƒ 
return
≈≈ 
;
≈≈ 
}
∆∆ 
action
»» 
?
»» 
.
»» 
Invoke
»» 
(
»» 
writer
»» !
)
»»! "
;
»»" #
_timestamps
   
[
   
	indexName
   !
]
  ! "
=
  # $
_clock
  % +
.
  + ,
UtcNow
  , 2
;
  2 3
}
ÀÀ 	
private
ÕÕ 
IndexReaderPool
ÕÕ 
.
ÕÕ  
IndexReaderLease
ÕÕ  0
	GetReader
ÕÕ1 :
(
ÕÕ: ;
string
ÕÕ; A
	indexName
ÕÕB K
)
ÕÕK L
{
ŒŒ 	
var
œœ 
pool
œœ 
=
œœ 
_indexPools
œœ "
.
œœ" #
GetOrAdd
œœ# +
(
œœ+ ,
	indexName
œœ, 5
,
œœ5 6
n
œœ7 8
=>
œœ9 ;
{
–– 
var
—— 
path
—— 
=
—— 
new
—— 
DirectoryInfo
—— ,
(
——, -
PathExtensions
——- ;
.
——; <
Combine
——< C
(
——C D
	_rootPath
——D M
,
——M N
	indexName
——O X
)
——X Y
)
——Y Z
;
——Z [
var
”” 
reader
”” 
=
”” 
DirectoryReader
”” ,
.
””, -
Open
””- 1
(
””1 2
FSDirectory
””2 =
.
””= >
Open
””> B
(
””B C
path
””C G
)
””G H
)
””H I
;
””I J
return
‘‘ 
new
‘‘ 
IndexReaderPool
‘‘ *
(
‘‘* +
reader
‘‘+ 1
)
‘‘1 2
;
‘‘2 3
}
’’ 
)
’’ 
;
’’ 
return
◊◊ 
pool
◊◊ 
.
◊◊ 
Acquire
◊◊ 
(
◊◊  
)
◊◊  !
;
◊◊! "
}
ÿÿ 	
private
⁄⁄ 
string
⁄⁄ 
GetFilename
⁄⁄ "
(
⁄⁄" #
string
⁄⁄# )
	indexName
⁄⁄* 3
,
⁄⁄3 4
int
⁄⁄5 8

documentId
⁄⁄9 C
)
⁄⁄C D
{
€€ 	
return
‹‹ 
PathExtensions
‹‹ !
.
‹‹! "
Combine
‹‹" )
(
‹‹) *
	_rootPath
‹‹* 3
,
‹‹3 4
	indexName
‹‹5 >
,
‹‹> ?

documentId
‹‹@ J
+
‹‹K L
$str
‹‹M T
)
‹‹T U
;
‹‹U V
}
›› 	
public
‚‚ 
void
‚‚ 
FreeReaderWriter
‚‚ $
(
‚‚$ %
)
‚‚% &
{
„„ 	
lock
‰‰ 
(
‰‰ 
this
‰‰ 
)
‰‰ 
{
ÂÂ 
foreach
ÊÊ 
(
ÊÊ 
var
ÊÊ 
writer
ÊÊ #
in
ÊÊ$ &
_writers
ÊÊ' /
)
ÊÊ/ 0
{
ÁÁ 
if
ËË 
(
ËË 
_logger
ËË 
.
ËË  
	IsEnabled
ËË  )
(
ËË) *
LogLevel
ËË* 2
.
ËË2 3
Information
ËË3 >
)
ËË> ?
)
ËË? @
{
ÈÈ 
_logger
ÍÍ 
.
ÍÍ  
LogInformation
ÍÍ  .
(
ÍÍ. /
$str
ÍÍ/ E
+
ÍÍF G
writer
ÍÍH N
.
ÍÍN O
Key
ÍÍO R
)
ÍÍR S
;
ÍÍS T
}
ÎÎ 
writer
ÌÌ 
.
ÌÌ 
Value
ÌÌ  
.
ÌÌ  !
	IsClosing
ÌÌ! *
=
ÌÌ+ ,
true
ÌÌ- 1
;
ÌÌ1 2
writer
ÓÓ 
.
ÓÓ 
Value
ÓÓ  
.
ÓÓ  !
Dispose
ÓÓ! (
(
ÓÓ( )
)
ÓÓ) *
;
ÓÓ* +
}
ÔÔ 
foreach
ÒÒ 
(
ÒÒ 
var
ÒÒ 
reader
ÒÒ #
in
ÒÒ$ &
_indexPools
ÒÒ' 2
)
ÒÒ2 3
{
ÚÚ 
if
ÛÛ 
(
ÛÛ 
_logger
ÛÛ 
.
ÛÛ  
	IsEnabled
ÛÛ  )
(
ÛÛ) *
LogLevel
ÛÛ* 2
.
ÛÛ2 3
Information
ÛÛ3 >
)
ÛÛ> ?
)
ÛÛ? @
{
ÙÙ 
_logger
ıı 
.
ıı  
LogInformation
ıı  .
(
ıı. /
$str
ıı/ E
+
ııF G
reader
ııH N
.
ııN O
Key
ııO R
)
ııR S
;
ııS T
}
ˆˆ 
reader
¯¯ 
.
¯¯ 
Value
¯¯  
.
¯¯  !
Dispose
¯¯! (
(
¯¯( )
)
¯¯) *
;
¯¯* +
}
˘˘ 
_writers
˚˚ 
.
˚˚ 
Clear
˚˚ 
(
˚˚ 
)
˚˚  
;
˚˚  !
_indexPools
¸¸ 
.
¸¸ 
Clear
¸¸ !
(
¸¸! "
)
¸¸" #
;
¸¸# $
_timestamps
˝˝ 
.
˝˝ 
Clear
˝˝ !
(
˝˝! "
)
˝˝" #
;
˝˝# $
}
˛˛ 
}
ˇˇ 	
public
ÑÑ 
void
ÑÑ 
FreeReaderWriter
ÑÑ $
(
ÑÑ$ %
string
ÑÑ% +
	indexName
ÑÑ, 5
)
ÑÑ5 6
{
ÖÖ 	
lock
ÜÜ 
(
ÜÜ 
this
ÜÜ 
)
ÜÜ 
{
áá 
if
àà 
(
àà 
_writers
àà 
.
àà 
TryGetValue
àà (
(
àà( )
	indexName
àà) 2
,
àà2 3
out
àà4 7
var
àà8 ;
writer
àà< B
)
ààB C
)
ààC D
{
ââ 
if
ää 
(
ää 
_logger
ää 
.
ää  
	IsEnabled
ää  )
(
ää) *
LogLevel
ää* 2
.
ää2 3
Information
ää3 >
)
ää> ?
)
ää? @
{
ãã 
_logger
åå 
.
åå  
LogInformation
åå  .
(
åå. /
$str
åå/ E
+
ååF G
	indexName
ååH Q
)
ååQ R
;
ååR S
}
çç 
writer
èè 
.
èè 
	IsClosing
èè $
=
èè% &
true
èè' +
;
èè+ ,
writer
êê 
.
êê 
Dispose
êê "
(
êê" #
)
êê# $
;
êê$ %
}
ëë 
if
ìì 
(
ìì 
_indexPools
ìì 
.
ìì  
TryGetValue
ìì  +
(
ìì+ ,
	indexName
ìì, 5
,
ìì5 6
out
ìì7 :
var
ìì; >
reader
ìì? E
)
ììE F
)
ììF G
{
îî 
if
ïï 
(
ïï 
_logger
ïï 
.
ïï  
	IsEnabled
ïï  )
(
ïï) *
LogLevel
ïï* 2
.
ïï2 3
Information
ïï3 >
)
ïï> ?
)
ïï? @
{
ññ 
_logger
óó 
.
óó  
LogInformation
óó  .
(
óó. /
$str
óó/ E
+
óóF G
	indexName
óóH Q
)
óóQ R
;
óóR S
}
òò 
reader
öö 
.
öö 
Dispose
öö "
(
öö" #
)
öö# $
;
öö$ %
}
õõ 
_timestamps
ùù 
.
ùù 
	TryRemove
ùù %
(
ùù% &
	indexName
ùù& /
,
ùù/ 0
out
ùù1 4
var
ùù5 8
	timestamp
ùù9 B
)
ùùB C
;
ùùC D
_writers
üü 
.
üü 
	TryRemove
üü "
(
üü" #
	indexName
üü# ,
,
üü, -
out
üü. 1
writer
üü2 8
)
üü8 9
;
üü9 :
}
†† 
}
°° 	
public
££ 
void
££ 
Dispose
££ 
(
££ 
)
££ 
{
§§ 	
if
•• 
(
•• 

_disposing
•• 
)
•• 
{
¶¶ 
return
ßß 
;
ßß 
}
®® 

_disposing
™™ 
=
™™ 
true
™™ 
;
™™ 
FreeReaderWriter
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ 
}
≠≠ 	
~
ØØ 	 
LuceneIndexManager
ØØ	 
(
ØØ 
)
ØØ 
{
∞∞ 	
Dispose
±± 
(
±± 
)
±± 
;
±± 
}
≤≤ 	
}
≥≥ 
internal
µµ 
class
µµ  
IndexWriterWrapper
µµ %
:
µµ& '
IndexWriter
µµ( 3
{
∂∂ 
public
∑∑  
IndexWriterWrapper
∑∑ !
(
∑∑! "

LDirectory
∑∑" ,
	directory
∑∑- 6
,
∑∑6 7
IndexWriterConfig
∑∑8 I
config
∑∑J P
)
∑∑P Q
:
∑∑R S
base
∑∑T X
(
∑∑X Y
	directory
∑∑Y b
,
∑∑b c
config
∑∑d j
)
∑∑j k
{
∏∏ 	
	IsClosing
ππ 
=
ππ 
false
ππ 
;
ππ 
}
∫∫ 	
public
ºº 
bool
ºº 
	IsClosing
ºº 
{
ºº 
get
ºº  #
;
ºº# $
set
ºº% (
;
ºº( )
}
ºº* +
}
ΩΩ 
internal
øø 
class
øø 
IndexReaderPool
øø "
:
øø# $
IDisposable
øø% 0
{
¿¿ 
private
¡¡ 
bool
¡¡ 
_dirty
¡¡ 
;
¡¡ 
private
¬¬ 
int
¬¬ 
_count
¬¬ 
;
¬¬ 
private
√√ 
IndexReader
√√ 
_reader
√√ #
;
√√# $
public
≈≈ 
IndexReaderPool
≈≈ 
(
≈≈ 
IndexReader
≈≈ *
reader
≈≈+ 1
)
≈≈1 2
{
∆∆ 	
_reader
«« 
=
«« 
reader
«« 
;
«« 
}
»» 	
public
   
void
   
	MakeDirty
   
(
   
)
   
{
ÀÀ 	
_dirty
ÃÃ 
=
ÃÃ 
true
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
public
œœ 
IndexReaderLease
œœ 
Acquire
œœ  '
(
œœ' (
)
œœ( )
{
–– 	
return
—— 
new
—— 
IndexReaderLease
—— '
(
——' (
this
——( ,
,
——, -
_reader
——. 5
)
——5 6
;
——6 7
}
““ 	
public
‘‘ 
void
‘‘ 
Release
‘‘ 
(
‘‘ 
)
‘‘ 
{
’’ 	
if
÷÷ 
(
÷÷ 
_dirty
÷÷ 
&&
÷÷ 
_count
÷÷  
==
÷÷! #
$num
÷÷$ %
)
÷÷% &
{
◊◊ 
_reader
ÿÿ 
.
ÿÿ 
Dispose
ÿÿ 
(
ÿÿ  
)
ÿÿ  !
;
ÿÿ! "
}
ŸŸ 
}
⁄⁄ 	
public
‹‹ 
void
‹‹ 
Dispose
‹‹ 
(
‹‹ 
)
‹‹ 
{
›› 	
_reader
ﬁﬁ 
.
ﬁﬁ 
Dispose
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
public
·· 
struct
·· 
IndexReaderLease
·· &
:
··' (
IDisposable
··) 4
{
‚‚ 	
private
„„ 
IndexReaderPool
„„ #
_pool
„„$ )
;
„„) *
public
ÂÂ 
IndexReaderLease
ÂÂ #
(
ÂÂ# $
IndexReaderPool
ÂÂ$ 3
pool
ÂÂ4 8
,
ÂÂ8 9
IndexReader
ÂÂ: E
reader
ÂÂF L
)
ÂÂL M
{
ÊÊ 
_pool
ÁÁ 
=
ÁÁ 
pool
ÁÁ 
;
ÁÁ 
Interlocked
ËË 
.
ËË 
	Increment
ËË %
(
ËË% &
ref
ËË& )
_pool
ËË* /
.
ËË/ 0
_count
ËË0 6
)
ËË6 7
;
ËË7 8
IndexReader
ÈÈ 
=
ÈÈ 
reader
ÈÈ $
;
ÈÈ$ %
}
ÍÍ 
public
ÏÏ 
IndexReader
ÏÏ 
IndexReader
ÏÏ *
{
ÏÏ+ ,
get
ÏÏ- 0
;
ÏÏ0 1
}
ÏÏ2 3
public
ÓÓ 
void
ÓÓ 
Dispose
ÓÓ 
(
ÓÓ  
)
ÓÓ  !
{
ÔÔ 
var
 
count
 
=
 
Interlocked
 '
.
' (
	Decrement
( 1
(
1 2
ref
2 5
_pool
6 ;
.
; <
_count
< B
)
B C
;
C D
_pool
ÒÒ 
.
ÒÒ 
Release
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ  
}
ÚÚ 
}
ÛÛ 	
}
ÙÙ 
}ıı ¥4
ôD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneIndexSettingsService.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{		 
public

 

class

 &
LuceneIndexSettingsService

 +
{ 
public &
LuceneIndexSettingsService )
() *
)* +
{ 	
} 	
public 
Task 
< '
LuceneIndexSettingsDocument /
>/ 0
LoadDocumentAsync1 B
(B C
)C D
=>E G
DocumentManagerH W
.W X#
GetOrCreateMutableAsyncX o
(o p
)p q
;q r
public 
async 
Task 
< '
LuceneIndexSettingsDocument 5
>5 6
GetDocumentAsync7 G
(G H
)H I
{ 	
var 
document 
= 
await  
DocumentManager! 0
.0 1%
GetOrCreateImmutableAsync1 J
(J K
)K L
;L M
foreach 
( 
var 
name 
in  
document! )
.) *
LuceneIndexSettings* =
.= >
Keys> B
)B C
{ 
document 
. 
LuceneIndexSettings ,
[, -
name- 1
]1 2
.2 3
	IndexName3 <
== >
name? C
;C D
} 
return!! 
document!! 
;!! 
}"" 	
public$$ 
async$$ 
Task$$ 
<$$ 
IEnumerable$$ %
<$$% &
LuceneIndexSettings$$& 9
>$$9 :
>$$: ;
GetSettingsAsync$$< L
($$L M
)$$M N
{%% 	
return&& 
(&& 
await&& 
GetDocumentAsync&& *
(&&* +
)&&+ ,
)&&, -
.&&- .
LuceneIndexSettings&&. A
.&&A B
Values&&B H
;&&H I
}'' 	
public)) 
async)) 
Task)) 
<)) 
LuceneIndexSettings)) -
>))- .
GetSettingsAsync))/ ?
())? @
string))@ F
	indexName))G P
)))P Q
{** 	
var++ 
document++ 
=++ 
await++  
GetDocumentAsync++! 1
(++1 2
)++2 3
;++3 4
if-- 
(-- 
document-- 
.-- 
LuceneIndexSettings-- ,
.--, -
TryGetValue--- 8
(--8 9
	indexName--9 B
,--B C
out--D G
var--H K
settings--L T
)--T U
)--U V
{.. 
return// 
settings// 
;//  
}00 
return22 
null22 
;22 
}33 	
public55 
async55 
Task55 
<55 
string55  
>55  !!
GetIndexAnalyzerAsync55" 7
(557 8
string558 >
	indexName55? H
)55H I
{66 	
var77 
document77 
=77 
await77  
GetDocumentAsync77! 1
(771 2
)772 3
;773 4
if99 
(99 
document99 
.99 
LuceneIndexSettings99 ,
.99, -
TryGetValue99- 8
(998 9
	indexName999 B
,99B C
out99D G
var99H K
settings99L T
)99T U
)99U V
{:: 
return;; 
settings;; 
.;;  
AnalyzerName;;  ,
;;;, -
}<< 
return>> 
LuceneSettings>> !
.>>! "
StandardAnalyzer>>" 2
;>>2 3
}?? 	
publicAA 
asyncAA 
TaskAA 
<AA 
stringAA  
>AA  !"
LoadIndexAnalyzerAsyncAA" 8
(AA8 9
stringAA9 ?
	indexNameAA@ I
)AAI J
{BB 	
varCC 
documentCC 
=CC 
awaitCC  
LoadDocumentAsyncCC! 2
(CC2 3
)CC3 4
;CC4 5
ifEE 
(EE 
documentEE 
.EE 
LuceneIndexSettingsEE ,
.EE, -
TryGetValueEE- 8
(EE8 9
	indexNameEE9 B
,EEB C
outEED G
varEEH K
settingsEEL T
)EET U
)EEU V
{FF 
returnGG 
settingsGG 
.GG  
AnalyzerNameGG  ,
;GG, -
}HH 
returnJJ 
LuceneSettingsJJ !
.JJ! "
StandardAnalyzerJJ" 2
;JJ2 3
}KK 	
publicMM 
asyncMM 
TaskMM 
UpdateIndexAsyncMM *
(MM* +
LuceneIndexSettingsMM+ >
settingsMM? G
)MMG H
{NN 	
varOO 
documentOO 
=OO 
awaitOO  
LoadDocumentAsyncOO! 2
(OO2 3
)OO3 4
;OO4 5
documentPP 
.PP 
LuceneIndexSettingsPP (
[PP( )
settingsPP) 1
.PP1 2
	IndexNamePP2 ;
]PP; <
=PP= >
settingsPP? G
;PPG H
awaitQQ 
DocumentManagerQQ !
.QQ! "
UpdateAsyncQQ" -
(QQ- .
documentQQ. 6
)QQ6 7
;QQ7 8
}RR 	
publicTT 
asyncTT 
TaskTT 
DeleteIndexAsyncTT *
(TT* +
stringTT+ 1
	indexNameTT2 ;
)TT; <
{UU 	
varVV 
documentVV 
=VV 
awaitVV  
LoadDocumentAsyncVV! 2
(VV2 3
)VV3 4
;VV4 5
documentWW 
.WW 
LuceneIndexSettingsWW (
.WW( )
RemoveWW) /
(WW/ 0
	indexNameWW0 9
)WW9 :
;WW: ;
awaitXX 
DocumentManagerXX !
.XX! "
UpdateAsyncXX" -
(XX- .
documentXX. 6
)XX6 7
;XX7 8
}YY 	
private[[ 
static[[ 
IDocumentManager[[ '
<[[' ('
LuceneIndexSettingsDocument[[( C
>[[C D
DocumentManager[[E T
=>[[U W

ShellScope\\ 
.\\ 
Services\\ 
.\\  
GetRequiredService\\  2
<\\2 3
IDocumentManager\\3 C
<\\C D'
LuceneIndexSettingsDocument\\D _
>\\_ `
>\\` a
(\\a b
)\\b c
;\\c d
}]] 
}^^ ã
äD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneQuery.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class 
LuceneQuery 
: 
Query $
{ 
public 
LuceneQuery 
( 
) 
: 
base #
(# $
$str$ ,
), -
{ 	
}		 	
public 
string 
Index 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Template 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
ReturnContentItems &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ®O
êD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\LuceneQuerySource.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{ 
public 

class 
LuceneQuerySource "
:# $
IQuerySource% 1
{ 
private 
readonly 
LuceneIndexManager + 
_luceneIndexProvider, @
;@ A
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
private 
readonly !
LuceneAnalyzerManager ."
_luceneAnalyzerManager/ E
;E F
private 
readonly 
ILuceneQueryService ,
_queryService- :
;: ;
private 
readonly "
ILiquidTemplateManager /"
_liquidTemplateManager0 F
;F G
private 
readonly 
ISession !
_session" *
;* +
private 
readonly 
JavaScriptEncoder *
_javaScriptEncoder+ =
;= >
public 
LuceneQuerySource  
(  !
LuceneIndexManager 
luceneIndexProvider 2
,2 3&
LuceneIndexSettingsService &&
luceneIndexSettingsService' A
,A B!
LuceneAnalyzerManager !!
luceneAnalyzerManager" 7
,7 8
ILuceneQueryService   
queryService    ,
,  , -"
ILiquidTemplateManager!! "!
liquidTemplateManager!!# 8
,!!8 9
ISession"" 
session"" 
,"" 
JavaScriptEncoder## 
javaScriptEncoder## /
)##/ 0
{$$ 	 
_luceneIndexProvider%%  
=%%! "
luceneIndexProvider%%# 6
;%%6 7'
_luceneIndexSettingsService&& '
=&&( )&
luceneIndexSettingsService&&* D
;&&D E"
_luceneAnalyzerManager'' "
=''# $!
luceneAnalyzerManager''% :
;'': ;
_queryService(( 
=(( 
queryService(( (
;((( )"
_liquidTemplateManager)) "
=))# $!
liquidTemplateManager))% :
;)): ;
_session** 
=** 
session** 
;** 
_javaScriptEncoder++ 
=++  
javaScriptEncoder++! 2
;++2 3
},, 	
public.. 
string.. 
Name.. 
=>.. 
$str.. &
;..& '
public00 
Query00 
Create00 
(00 
)00 
{11 	
return22 
new22 
LuceneQuery22 "
(22" #
)22# $
;22$ %
}33 	
public55 
async55 
Task55 
<55 
IQueryResults55 '
>55' (
ExecuteQueryAsync55) :
(55: ;
Query55; @
query55A F
,55F G
IDictionary55H S
<55S T
string55T Z
,55Z [
object55\ b
>55b c

parameters55d n
)55n o
{66 	
var77 
luceneQuery77 
=77 
query77 #
as77$ &
LuceneQuery77' 2
;772 3
var88 
luceneQueryResults88 "
=88# $
new88% (
LuceneQueryResults88) ;
(88; <
)88< =
;88= >
await::  
_luceneIndexProvider:: &
.::& '
SearchAsync::' 2
(::2 3
luceneQuery::3 >
.::> ?
Index::? D
,::D E
async::F K
searcher::L T
=>::U W
{;; 
var<< 
templateContext<< #
=<<$ %"
_liquidTemplateManager<<& <
.<<< =
Context<<= D
;<<D E
if>> 
(>> 

parameters>> 
!=>> !
null>>" &
)>>& '
{?? 
foreach@@ 
(@@ 
var@@  
	parameter@@! *
in@@+ -

parameters@@. 8
)@@8 9
{AA 
templateContextBB '
.BB' (
SetValueBB( 0
(BB0 1
	parameterBB1 :
.BB: ;
KeyBB; >
,BB> ?
	parameterBB@ I
.BBI J
ValueBBJ O
)BBO P
;BBP Q
}CC 
}DD 
varFF 
tokenizedContentFF $
=FF% &
awaitFF' ,"
_liquidTemplateManagerFF- C
.FFC D
RenderAsyncFFD O
(FFO P
luceneQueryFFP [
.FF[ \
TemplateFF\ d
,FFd e
_javaScriptEncoderFFf x
)FFx y
;FFy z
varGG 
parameterizedQueryGG &
=GG' (
JObjectGG) 0
.GG0 1
ParseGG1 6
(GG6 7
tokenizedContentGG7 G
)GGG H
;GGH I
varII 
analyzerII 
=II "
_luceneAnalyzerManagerII 5
.II5 6
CreateAnalyzerII6 D
(IID E
awaitIIE J'
_luceneIndexSettingsServiceIIK f
.IIf g!
GetIndexAnalyzerAsyncIIg |
(II| }
luceneQuery	II} à
.
IIà â
Index
IIâ é
)
IIé è
)
IIè ê
;
IIê ë
varJJ 
contextJJ 
=JJ 
newJJ !
LuceneQueryContextJJ" 4
(JJ4 5
searcherJJ5 =
,JJ= >
LuceneSettingsJJ? M
.JJM N
DefaultVersionJJN \
,JJ\ ]
analyzerJJ^ f
)JJf g
;JJg h
varKK 
docsKK 
=KK 
awaitKK  
_queryServiceKK! .
.KK. /
SearchAsyncKK/ :
(KK: ;
contextKK; B
,KKB C
parameterizedQueryKKD V
)KKV W
;KKW X
luceneQueryResultsLL "
.LL" #
CountLL# (
=LL) *
docsLL+ /
.LL/ 0
CountLL0 5
;LL5 6
ifNN 
(NN 
luceneQueryNN 
.NN  
ReturnContentItemsNN  2
)NN2 3
{OO 
luceneQueryResultsQQ &
.QQ& '
ItemsQQ' ,
=QQ- .
newQQ/ 2
ListQQ3 7
<QQ7 8
ContentItemQQ8 C
>QQC D
(QQD E
)QQE F
;QQF G
varTT (
indexedContentItemVersionIdsTT 4
=TT5 6
docsTT7 ;
.TT; <
TopDocsTT< C
.TTC D
	ScoreDocsTTD M
.TTM N
SelectTTN T
(TTT U
xTTU V
=>TTW Y
searcherTTZ b
.TTb c
DocTTc f
(TTf g
xTTg h
.TTh i
DocTTi l
)TTl m
.TTm n
GetTTn q
(TTq r
$str	TTr ú
)
TTú ù
)
TTù û
.
TTû ü
ToArray
TTü ¶
(
TT¶ ß
)
TTß ®
;
TT® ©
varUU 
dbContentItemsUU &
=UU' (
awaitUU) .
_sessionUU/ 7
.UU7 8
QueryUU8 =
<UU= >
ContentItemUU> I
,UUI J
ContentItemIndexUUK [
>UU[ \
(UU\ ]
xUU] ^
=>UU_ a
xUUb c
.UUc d 
ContentItemVersionIdUUd x
.UUx y
IsInUUy }
(UU} ~)
indexedContentItemVersionIds	UU~ ö
)
UUö õ
)
UUõ ú
.
UUú ù
	ListAsync
UUù ¶
(
UU¶ ß
)
UUß ®
;
UU® ©
ifXX 
(XX 
dbContentItemsXX &
.XX& '
AnyXX' *
(XX* +
)XX+ ,
)XX, -
{YY 
varZZ #
dbContentItemVersionIdsZZ 3
=ZZ4 5
dbContentItemsZZ6 D
.ZZD E
ToDictionaryZZE Q
(ZZQ R
xZZR S
=>ZZT V
xZZW X
.ZZX Y 
ContentItemVersionIdZZY m
,ZZm n
xZZo p
=>ZZq s
xZZt u
)ZZu v
;ZZv w
var[[ 
indexedAndInDB[[ *
=[[+ ,(
indexedContentItemVersionIds[[- I
.[[I J
Where[[J O
([[O P#
dbContentItemVersionIds[[P g
.[[g h
ContainsKey[[h s
)[[s t
;[[t u
luceneQueryResults\\ *
.\\* +
Items\\+ 0
=\\1 2
indexedAndInDB\\3 A
.\\A B
Select\\B H
(\\H I
x\\I J
=>\\K M#
dbContentItemVersionIds\\N e
[\\e f
x\\f g
]\\g h
)\\h i
.\\i j
ToArray\\j q
(\\q r
)\\r s
;\\s t
}]] 
}^^ 
else__ 
{`` 
varaa 
resultsaa 
=aa  !
newaa" %
Listaa& *
<aa* +
JObjectaa+ 2
>aa2 3
(aa3 4
)aa4 5
;aa5 6
foreachbb 
(bb 
varbb  
documentbb! )
inbb* ,
docsbb- 1
.bb1 2
TopDocsbb2 9
.bb9 :
	ScoreDocsbb: C
.bbC D
SelectbbD J
(bbJ K
hitbbK N
=>bbO Q
searcherbbR Z
.bbZ [
Docbb[ ^
(bb^ _
hitbb_ b
.bbb c
Docbbc f
)bbf g
)bbg h
)bbh i
{cc 
resultsdd 
.dd  
Adddd  #
(dd# $
newdd$ '
JObjectdd( /
(dd/ 0
documentdd0 8
.dd8 9
Selectdd9 ?
(dd? @
xdd@ A
=>ddB D
newddE H
	JPropertyddI R
(ddR S
xddS T
.ddT U
NameddU Y
,ddY Z
xdd[ \
.dd\ ]
GetStringValuedd] k
(ddk l
)ddl m
)ddm n
)ddn o
)ddo p
)ddp q
;ddq r
}ee 
luceneQueryResultsgg &
.gg& '
Itemsgg' ,
=gg- .
resultsgg/ 6
;gg6 7
}hh 
}ii 
)ii 
;ii 
returnkk 
luceneQueryResultskk %
;kk% &
}ll 	
}mm 
}nn ’
ëD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Services\SearchQueryService.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Services %
{ 
public 

class 
SearchQueryService #
:$ %
ISearchQueryService& 9
{ 
private		 
readonly		 
LuceneIndexManager		 +
_luceneIndexManager		, ?
;		? @
private 
static 
HashSet 
< 
string %
>% &
IdSet' ,
=- .
new/ 2
HashSet3 :
<: ;
string; A
>A B
(B C
newC F
stringG M
[M N
]N O
{P Q
$strR a
}b c
)c d
;d e
public 
SearchQueryService !
(! "
LuceneIndexManager" 4
luceneIndexManager5 G
)G H
{ 	
_luceneIndexManager 
=  !
luceneIndexManager" 4
;4 5
} 	
public 
async 
Task 
< 
IList 
<  
string  &
>& '
>' (
ExecuteQueryAsync) :
(: ;
Query; @
queryA F
,F G
stringH N
	indexNameO X
,X Y
intZ ]
start^ c
,c d
inte h
endi l
)l m
{ 	
var 
contentItemIds 
=  
new! $
List% )
<) *
string* 0
>0 1
(1 2
)2 3
;3 4
await 
_luceneIndexManager %
.% &
SearchAsync& 1
(1 2
	indexName2 ;
,; <
searcher= E
=>F H
{ 
if 
( 
end 
> 
$num 
) 
{ 
var 
	collector !
=" # 
TopScoreDocCollector$ 8
.8 9
Create9 ?
(? @
end@ C
,C D
trueE I
)I J
;J K
searcher 
. 
Search #
(# $
query$ )
,) *
	collector+ 4
)4 5
;5 6
var 
hits 
= 
	collector (
.( )

GetTopDocs) 3
(3 4
start4 9
,9 :
end; >
)> ?
;? @
foreach 
( 
var  
hit! $
in% '
hits( ,
., -
	ScoreDocs- 6
)6 7
{   
var!! 
d!! 
=!! 
searcher!!  (
.!!( )
Doc!!) ,
(!!, -
hit!!- 0
.!!0 1
Doc!!1 4
,!!4 5
IdSet!!6 ;
)!!; <
;!!< =
contentItemIds"" &
.""& '
Add""' *
(""* +
d""+ ,
."", -
GetField""- 5
(""5 6
$str""6 E
)""E F
.""F G
GetStringValue""G U
(""U V
)""V W
)""W X
;""X Y
}## 
}$$ 
return&& 
Task&& 
.&& 
CompletedTask&& )
;&&) *
}'' 
)'' 
;'' 
return)) 
contentItemIds)) !
;))! "
}** 	
}++ 
},, ’
úD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\ContentIndexSettingsViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Settings %
{ 
public 

class )
ContentIndexSettingsViewModel .
{ 
public  
ContentIndexSettings # 
ContentIndexSettings$ 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
} 
}		 ˚!
©D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\ContentPartFieldIndexSettingsDisplayDriver.cs
	namespace

 	
OrchardCore


 
.

 
Lucene

 
.

 
Settings

 %
{ 
public 

class 6
*ContentPartFieldIndexSettingsDisplayDriver ;
:< =3
'ContentPartFieldDefinitionDisplayDriver> e
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
public 6
*ContentPartFieldIndexSettingsDisplayDriver 9
(9 :!
IAuthorizationService: O 
authorizationServiceP d
,d e 
IHttpContextAccessorf z 
httpContextAccessor	{ é
)
é è
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_authorizationService !
=" # 
authorizationService$ 8
;8 9
} 	
public 
override 
async 
Task "
<" #
IDisplayResult# 1
>1 2
	EditAsync3 <
(< =&
ContentPartFieldDefinition= W&
contentPartFieldDefinitionX r
,r s
IUpdateModel	t Ä
updater
Å à
)
à â
{ 	
if 
( 
! 
await !
_authorizationService ,
., -
AuthorizeAsync- ;
(; < 
_httpContextAccessor< P
.P Q
HttpContextQ \
.\ ]
User] a
,a b
Permissionsc n
.n o
ManageIndexeso |
)| }
)} ~
{ 
return 
null 
; 
} 
return 

Initialize 
< )
ContentIndexSettingsViewModel ;
>; <
(< =
$str= X
,X Y
modelZ _
=>` b
{ 
model   
.    
ContentIndexSettings   *
=  + ,&
contentPartFieldDefinition  - G
.  G H
GetSettings  H S
<  S T 
ContentIndexSettings  T h
>  h i
(  i j
)  j k
;  k l
}!! 
)!! 
.!! 
Location!! 
(!! 
$str!! $
)!!$ %
;!!% &
}"" 	
public$$ 
override$$ 
async$$ 
Task$$ "
<$$" #
IDisplayResult$$# 1
>$$1 2
UpdateAsync$$3 >
($$> ?&
ContentPartFieldDefinition$$? Y&
contentPartFieldDefinition$$Z t
,$$t u)
UpdatePartFieldEditorContext	$$v í
context
$$ì ö
)
$$ö õ
{%% 	
if&& 
(&& 
!&& 
await&& !
_authorizationService&& ,
.&&, -
AuthorizeAsync&&- ;
(&&; < 
_httpContextAccessor&&< P
.&&P Q
HttpContext&&Q \
.&&\ ]
User&&] a
,&&a b
Permissions&&c n
.&&n o
ManageIndexes&&o |
)&&| }
)&&} ~
{'' 
return(( 
null(( 
;(( 
})) 
var++ 
model++ 
=++ 
new++ )
ContentIndexSettingsViewModel++ 9
(++9 :
)++: ;
;++; <
await-- 
context-- 
.-- 
Updater-- !
.--! "
TryUpdateModelAsync--" 5
(--5 6
model--6 ;
,--; <
Prefix--= C
)--C D
;--D E
context// 
.// 
Builder// 
.// 
WithSettings// (
(//( )
model//) .
.//. / 
ContentIndexSettings/// C
)//C D
;//D E
return11 
await11 
	EditAsync11 "
(11" #&
contentPartFieldDefinition11# =
,11= >
context11? F
.11F G
Updater11G N
)11N O
;11O P
}22 	
}33 
}44 ∏
•D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\ContentPickerFieldLuceneEditorSettings.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Settings %
{ 
public 

class 2
&ContentPickerFieldLuceneEditorSettings 7
{ 
public 
string 
Index 
{ 
get !
;! "
set# &
;& '
}( )
[		 	
	BindNever			 
]		 
public

 
string

 
[

 
]

 
Indices

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} á
´D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\ContentPickerFieldLuceneEditorSettingsDriver.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 
Settings %
{		 
public

 

class

 8
,ContentPickerFieldLuceneEditorSettingsDriver

 =
:

> ?3
'ContentPartFieldDefinitionDisplayDriver

@ g
{ 
private 
readonly &
LuceneIndexSettingsService 3'
_luceneIndexSettingsService4 O
;O P
public 8
,ContentPickerFieldLuceneEditorSettingsDriver ;
(; <&
LuceneIndexSettingsService< V&
luceneIndexSettingsServiceW q
)q r
{ 	'
_luceneIndexSettingsService '
=( )&
luceneIndexSettingsService* D
;D E
} 	
public 
override 
IDisplayResult &
Edit' +
(+ ,&
ContentPartFieldDefinition, F
partFieldDefinitionG Z
)Z [
{ 	
return 

Initialize 
< 2
&ContentPickerFieldLuceneEditorSettings D
>D E
(E F
$strF s
,s t
asyncu z
model	{ Ä
=>
Å É
{ 
partFieldDefinition #
.# $
PopulateSettings$ 4
<4 52
&ContentPickerFieldLuceneEditorSettings5 [
>[ \
(\ ]
model] b
)b c
;c d
model 
. 
Indices 
= 
(  !
await! &'
_luceneIndexSettingsService' B
.B C
GetSettingsAsyncC S
(S T
)T U
)U V
.V W
SelectW ]
(] ^
x^ _
=>` b
xc d
.d e
	IndexNamee n
)n o
.o p
ToArrayp w
(w x
)x y
;y z
} 
) 
. 
Location 
( 
$str  
)  !
;! "
} 	
public 
override 
async 
Task "
<" #
IDisplayResult# 1
>1 2
UpdateAsync3 >
(> ?&
ContentPartFieldDefinition? Y
partFieldDefinitionZ m
,m n)
UpdatePartFieldEditorContext	o ã
context
å ì
)
ì î
{ 	
if 
( 
partFieldDefinition #
.# $
Editor$ *
(* +
)+ ,
==- /
$str0 8
)8 9
{ 
var   
model   
=   
new   2
&ContentPickerFieldLuceneEditorSettings    F
(  F G
)  G H
;  H I
await"" 
context"" 
."" 
Updater"" %
.""% &
TryUpdateModelAsync""& 9
(""9 :
model"": ?
,""? @
Prefix""A G
)""G H
;""H I
context$$ 
.$$ 
Builder$$ 
.$$  
WithSettings$$  ,
($$, -
model$$- 2
)$$2 3
;$$3 4
}%% 
return'' 
Edit'' 
('' 
partFieldDefinition'' +
)''+ ,
;'', -
}(( 	
public** 
override** 
bool** 
CanHandleModel** +
(**+ ,&
ContentPartFieldDefinition**, F
model**G L
)**L M
{++ 	
return,, 
String,, 
.,, 
Equals,,  
(,,  !
$str,,! 5
,,,5 6
model,,7 <
.,,< =
FieldDefinition,,= L
.,,L M
Name,,M Q
),,Q R
;,,R S
}-- 	
}.. 
}// Ó!
®D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\ContentTypePartIndexSettingsDisplayDriver.cs
	namespace

 	
OrchardCore


 
.

 
Lucene

 
.

 
Settings

 %
{ 
public 

class 5
)ContentTypePartIndexSettingsDisplayDriver :
:; <2
&ContentTypePartDefinitionDisplayDriver= c
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly !
IAuthorizationService .!
_authorizationService/ D
;D E
public 5
)ContentTypePartIndexSettingsDisplayDriver 8
(8 9!
IAuthorizationService9 N 
authorizationServiceO c
,c d 
IHttpContextAccessore y 
httpContextAccessor	z ç
)
ç é
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_authorizationService !
=" # 
authorizationService$ 8
;8 9
} 	
public 
override 
async 
Task "
<" #
IDisplayResult# 1
>1 2
	EditAsync3 <
(< =%
ContentTypePartDefinition= V%
contentTypePartDefinitionW p
,p q
IUpdateModelr ~
updater	 Ü
)
Ü á
{ 	
if 
( 
! 
await !
_authorizationService ,
., -
AuthorizeAsync- ;
(; < 
_httpContextAccessor< P
.P Q
HttpContextQ \
.\ ]
User] a
,a b
Permissionsc n
.n o
ManageIndexeso |
)| }
)} ~
{ 
return 
null 
; 
} 
return 

Initialize 
< )
ContentIndexSettingsViewModel ;
>; <
(< =
$str= X
,X Y
modelZ _
=>` b
{ 
model   
.    
ContentIndexSettings   *
=  + ,%
contentTypePartDefinition  - F
.  F G
GetSettings  G R
<  R S 
ContentIndexSettings  S g
>  g h
(  h i
)  i j
;  j k
}!! 
)!! 
.!! 
Location!! 
(!! 
$str!! $
)!!$ %
;!!% &
}"" 	
public$$ 
override$$ 
async$$ 
Task$$ "
<$$" #
IDisplayResult$$# 1
>$$1 2
UpdateAsync$$3 >
($$> ?%
ContentTypePartDefinition$$? X%
contentTypePartDefinition$$Y r
,$$r s(
UpdateTypePartEditorContext	$$t è
context
$$ê ó
)
$$ó ò
{%% 	
if&& 
(&& 
!&& 
await&& !
_authorizationService&& ,
.&&, -
AuthorizeAsync&&- ;
(&&; < 
_httpContextAccessor&&< P
.&&P Q
HttpContext&&Q \
.&&\ ]
User&&] a
,&&a b
Permissions&&c n
.&&n o
ManageIndexes&&o |
)&&| }
)&&} ~
{'' 
return(( 
null(( 
;(( 
})) 
var++ 
model++ 
=++ 
new++ )
ContentIndexSettingsViewModel++ 9
(++9 :
)++: ;
;++; <
await-- 
context-- 
.-- 
Updater-- !
.--! "
TryUpdateModelAsync--" 5
(--5 6
model--6 ;
,--; <
Prefix--= C
)--C D
;--D E
context// 
.// 
Builder// 
.// 
WithSettings// (
(//( )
model//) .
.//. / 
ContentIndexSettings/// C
)//C D
;//D E
return11 
await11 
	EditAsync11 "
(11" #%
contentTypePartDefinition11# <
,11< =
context11> E
.11E F
Updater11F M
)11M N
;11N O
}22 	
}33 
}44 Ò	
êD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Settings\TypeIndexSettings.cs
	namespace 	
OrchardCore
 
. 
Indexing 
. 
Settings '
{ 
public 

class 
TypeIndexSettings "
{		 
public 
List 
< 
TypeIndexEntry "
>" #
Indexes$ +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
} 
public 

class 
TypeIndexEntry 
{ 
public 
const 
string 
	Published %
=& '
$str( 3
;3 4
public 
const 
string 
Latest "
=# $
$str% -
;- .
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Version 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ö
ùD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Shapes\LuceneContentPickerShapeProvider.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{		 
[

 
Feature

 
(

 
$str

 /
)

/ 0
]

0 1
public 

class ,
 LuceneContentPickerShapeProvider 1
:2 3#
IShapeAttributeProvider4 K
{ 
private 
readonly 
IStringLocalizer )
S* +
;+ ,
public ,
 LuceneContentPickerShapeProvider /
(/ 0
IStringLocalizer0 @
<@ A,
 LuceneContentPickerShapeProviderA a
>a b
stringLocalizerc r
)r s
{ 	
S 
= 
stringLocalizer 
;  
} 	
[ 	
Shape	 
] 
public 
IHtmlContent -
!ContentPickerField_Option__Lucene =
(= >
dynamic> E
shapeF K
)K L
{ 	
var 
selected 
= 
shape  
.  !
Editor! '
==( *
$str+ 3
;3 4
if 
( 
selected 
) 
{ 
return 
new 

HtmlString %
(% &
$"& (;
/<option value=\"Lucene\" selected=\"selected\">( W
{W X
SX Y
[Y Z
$strZ b
]b c
}c d
	</option>d m
"m n
)n o
;o p
} 
return 
new 

HtmlString !
(! "
$"" $%
<option value=\"Lucene\">$ =
{= >
S> ?
[? @
$str@ H
]H I
}I J
	</option>J S
"S T
)T U
;U V
} 	
} 
} è
âD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Shapes\SearchShapes.cs
	namespace

 	
OrchardCore


 
.

 
Lucene

 
{ 
public 

class %
SearchShapesTableProvider *
:+ ,
IShapeTableProvider- @
{ 
public 
void 
Discover 
( 
ShapeTableBuilder .
builder/ 6
)6 7
{ 	
builder 
. 
Describe 
( 
$str +
)+ ,
. 
OnDisplaying 
( 
context %
=>& (
{ 
dynamic 

searchForm &
=' (
context) 0
.0 1
Shape1 6
;6 7
} 
) 
; 
builder 
. 
Describe 
( 
$str .
). /
. 
OnDisplaying 
( 
context %
=>& (
{ 
dynamic 
searchResults )
=* +
context, 3
.3 4
Shape4 9
;9 :
} 
) 
; 
} 	
} 
public 

class 
SearchShapes 
: #
IShapeAttributeProvider  7
{ 
private   
readonly   
IStringLocalizer   )
S  * +
;  + ,
public"" 
SearchShapes"" 
("" 
IStringLocalizer"" ,
<"", -
SearchShapes""- 9
>""9 :
	localizer""; D
)""D E
{## 	
S$$ 
=$$ 
	localizer$$ 
;$$ 
}%% 	
['' 	
Shape''	 
]'' 
public(( 
Task(( 
<(( 
IHtmlContent((  
>((  !

SearchForm((" ,
(((, -
Shape((- 2
Shape((3 8
,((8 9
dynamic((: A
DisplayAsync((B N
,((N O
string((P V
Terms((W \
)((\ ]
{)) 	
Shape** 
.** 
Metadata** 
.** 
Type** 
=**  !
$str**" 0
;**0 1
return++ 
DisplayAsync++ 
(++  
Shape++  %
)++% &
;++& '
},, 	
[.. 	
Shape..	 
].. 
public// 
Task// 
<// 
IHtmlContent//  
>//  !
SearchResults//" /
(/// 0
Shape//0 5
Shape//6 ;
,//; <
dynamic//= D
DisplayAsync//E Q
,//Q R
IEnumerable//S ^
<//^ _
ContentItem//_ j
>//j k
ContentItems//l x
)//x y
{00 	
Shape11 
.11 
Metadata11 
.11 
Type11 
=11  !
$str11" 3
;113 4
return22 
DisplayAsync22 
(22  
Shape22  %
)22% &
;22& '
}33 	
}44 
}55 ˛p
}D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\Startup.cs
	namespace 	
OrchardCore
 
. 
Lucene 
{   
public$$ 

class$$ 
Startup$$ 
:$$ 
StartupBase$$ &
{%% 
private&& 
readonly&& 
AdminOptions&& %
_adminOptions&&& 3
;&&3 4
public(( 
Startup(( 
((( 
IOptions(( 
<((  
AdminOptions((  ,
>((, -
adminOptions((. :
)((: ;
{)) 	
_adminOptions** 
=** 
adminOptions** (
.**( )
Value**) .
;**. /
}++ 	
public-- 
override-- 
void-- 
ConfigureServices-- .
(--. /
IServiceCollection--/ A
services--B J
)--J K
{.. 	
services// 
.// 
AddSingleton// !
<//! "
LuceneIndexingState//" 5
>//5 6
(//6 7
)//7 8
;//8 9
services00 
.00 
AddSingleton00 !
<00! "&
LuceneIndexSettingsService00" <
>00< =
(00= >
)00> ?
;00? @
services11 
.11 
AddSingleton11 !
<11! "
LuceneIndexManager11" 4
>114 5
(115 6
)116 7
;117 8
services22 
.22 
AddSingleton22 !
<22! "!
LuceneAnalyzerManager22" 7
>227 8
(228 9
)229 :
;22: ;
services33 
.33 
	AddScoped33 
<33 !
LuceneIndexingService33 4
>334 5
(335 6
)336 7
;337 8
services44 
.44 
	AddScoped44 
<44 
ISearchQueryService44 2
,442 3
SearchQueryService444 F
>44F G
(44G H
)44H I
;44I J
services66 
.66 
	AddScoped66 
<66 3
'IContentTypePartDefinitionDisplayDriver66 F
,66F G5
)ContentTypePartIndexSettingsDisplayDriver66H q
>66q r
(66r s
)66s t
;66t u
services77 
.77 
	AddScoped77 
<77 4
(IContentPartFieldDefinitionDisplayDriver77 G
,77G H6
*ContentPartFieldIndexSettingsDisplayDriver77I s
>77s t
(77t u
)77u v
;77v w
services88 
.88 
	AddScoped88 
<88 
INavigationProvider88 2
,882 3
	AdminMenu884 =
>88= >
(88> ?
)88? @
;88@ A
services99 
.99 
	AddScoped99 
<99 
IPermissionProvider99 2
,992 3
Permissions994 ?
>99? @
(99@ A
)99A B
;99B C
services;; 
.;; 
	Configure;; 
<;; 
LuceneOptions;; ,
>;;, -
(;;- .
o;;. /
=>;;0 2
o<< 
.<< 
	Analyzers<< 
.<< 
Add<< 
(<<  
new<<  #
LuceneAnalyzer<<$ 2
(<<2 3
LuceneSettings<<3 A
.<<A B
StandardAnalyzer<<B R
,<<R S
new== 
StandardAnalyzer== (
(==( )
LuceneSettings==) 7
.==7 8
DefaultVersion==8 F
)==F G
)==G H
)==H I
)==I J
;==J K
services?? 
.?? 
	AddScoped?? 
<?? 
IDisplayDriver?? -
<??- .
ISite??. 3
>??3 4
,??4 5'
LuceneSettingsDisplayDriver??6 Q
>??Q R
(??R S
)??S T
;??T U
services@@ 
.@@ 
	AddScoped@@ 
<@@ 
IDisplayDriver@@ -
<@@- .
Query@@. 3
>@@3 4
,@@4 5$
LuceneQueryDisplayDriver@@6 N
>@@N O
(@@O P
)@@P Q
;@@Q R
servicesBB 
.BB 
	AddScopedBB 
<BB 
IContentHandlerBB .
,BB. /(
LuceneIndexingContentHandlerBB0 L
>BBL M
(BBM N
)BBN O
;BBO P
servicesCC 
.CC 
AddLuceneQueriesCC %
(CC% &
)CC& '
;CC' (
servicesFF 
.FF 
	AddScopedFF 
<FF 
IQuerySourceFF +
,FF+ ,
LuceneQuerySourceFF- >
>FF> ?
(FF? @
)FF@ A
;FFA B
servicesGG 
.GG 
	AddScopedGG 
<GG 
LuceneQuerySourceGG 0
>GG0 1
(GG1 2
)GG2 3
;GG3 4
servicesHH 
.HH "
AddRecipeExecutionStepHH +
<HH+ ,
LuceneIndexStepHH, ;
>HH; <
(HH< =
)HH= >
;HH> ?
servicesJJ 
.JJ 
	AddScopedJJ 
<JJ 
IShapeTableProviderJJ 2
,JJ2 3%
SearchShapesTableProviderJJ4 M
>JJM N
(JJN O
)JJO P
;JJP Q
servicesKK 
.KK 
AddShapeAttributesKK '
<KK' (
SearchShapesKK( 4
>KK4 5
(KK5 6
)KK6 7
;KK7 8
}LL 	
publicNN 
overrideNN 
voidNN 
	ConfigureNN &
(NN& '
IApplicationBuilderNN' :
appNN; >
,NN> ?!
IEndpointRouteBuilderNN@ U
routesNNV \
,NN\ ]
IServiceProviderNN^ n
serviceProviderNNo ~
)NN~ 
{OO 	
routesPP 
.PP "
MapAreaControllerRoutePP )
(PP) *
nameQQ 
:QQ 
$strQQ %
,QQ% &
areaNameRR 
:RR 
$strRR .
,RR. /
patternSS 
:SS 
$strSS !
,SS! "
defaultsTT 
:TT 
newTT 
{TT 

controllerTT  *
=TT+ ,
$strTT- 5
,TT5 6
actionTT7 =
=TT> ?
$strTT@ H
}TTI J
)UU 
;UU 
varWW 
adminControllerNameWW #
=WW$ %
typeofWW& ,
(WW, -
AdminControllerWW- <
)WW< =
.WW= >
ControllerNameWW> L
(WWL M
)WWM N
;WWN O
routesYY 
.YY "
MapAreaControllerRouteYY )
(YY) *
nameZZ 
:ZZ 
$strZZ $
,ZZ$ %
areaName[[ 
:[[ 
$str[[ .
,[[. /
pattern\\ 
:\\ 
_adminOptions\\ &
.\\& '
AdminUrlPrefix\\' 5
+\\6 7
$str\\8 G
,\\G H
defaults]] 
:]] 
new]] 
{]] 

controller]]  *
=]]+ ,
adminControllerName]]- @
,]]@ A
action]]B H
=]]I J
nameof]]K Q
(]]Q R
AdminController]]R a
.]]a b
Index]]b g
)]]g h
}]]i j
)^^ 
;^^ 
routes`` 
.`` "
MapAreaControllerRoute`` )
(``) *
nameaa 
:aa 
$straa %
,aa% &
areaNamebb 
:bb 
$strbb .
,bb. /
patterncc 
:cc 
_adminOptionscc &
.cc& '
AdminUrlPrefixcc' 5
+cc6 7
$strcc8 M
,ccM N
defaultsdd 
:dd 
newdd 
{dd 

controllerdd  *
=dd+ ,
adminControllerNamedd- @
,dd@ A
actionddB H
=ddI J
nameofddK Q
(ddQ R
AdminControllerddR a
.dda b
Deleteddb h
)ddh i
}ddj k
)ee 
;ee 
routesgg 
.gg "
MapAreaControllerRoutegg )
(gg) *
namehh 
:hh 
$strhh $
,hh$ %
areaNameii 
:ii 
$strii .
,ii. /
patternjj 
:jj 
_adminOptionsjj &
.jj& '
AdminUrlPrefixjj' 5
+jj6 7
$strjj8 G
,jjG H
defaultskk 
:kk 
newkk 
{kk 

controllerkk  *
=kk+ ,
adminControllerNamekk- @
,kk@ A
actionkkB H
=kkI J
nameofkkK Q
(kkQ R
AdminControllerkkR a
.kka b
Querykkb g
)kkg h
}kki j
)ll 
;ll 
routesnn 
.nn "
MapAreaControllerRoutenn )
(nn) *
nameoo 
:oo 
$stroo &
,oo& '
areaNamepp 
:pp 
$strpp .
,pp. /
patternqq 
:qq 
_adminOptionsqq &
.qq& '
AdminUrlPrefixqq' 5
+qq6 7
$strqq8 N
,qqN O
defaultsrr 
:rr 
newrr 
{rr 

controllerrr  *
=rr+ ,
adminControllerNamerr- @
,rr@ A
actionrrB H
=rrI J
nameofrrK Q
(rrQ R
AdminControllerrrR a
.rra b
Rebuildrrb i
)rri j
}rrk l
)ss 
;ss 
routesuu 
.uu "
MapAreaControllerRouteuu )
(uu) *
namevv 
:vv 
$strvv $
,vv$ %
areaNameww 
:ww 
$strww .
,ww. /
patternxx 
:xx 
_adminOptionsxx &
.xx& '
AdminUrlPrefixxx' 5
+xx6 7
$strxx8 L
,xxL M
defaultsyy 
:yy 
newyy 
{yy 

controlleryy  *
=yy+ ,
adminControllerNameyy- @
,yy@ A
actionyyB H
=yyI J
nameofyyK Q
(yyQ R
AdminControlleryyR a
.yya b
Resetyyb g
)yyg h
}yyi j
)zz 
;zz 
}{{ 	
}|| 
[~~ 
RequireFeatures~~ 
(~~ 
$str~~ -
)~~- .
]~~. /
public 

class 
DeploymentStartup "
:# $
StartupBase% 0
{
ÄÄ 
public
ÅÅ 
override
ÅÅ 
void
ÅÅ 
ConfigureServices
ÅÅ .
(
ÅÅ. / 
IServiceCollection
ÅÅ/ A
services
ÅÅB J
)
ÅÅJ K
{
ÇÇ 	
services
ÉÉ 
.
ÉÉ 
AddTransient
ÉÉ !
<
ÉÉ! "
IDeploymentSource
ÉÉ" 3
,
ÉÉ3 4)
LuceneIndexDeploymentSource
ÉÉ5 P
>
ÉÉP Q
(
ÉÉQ R
)
ÉÉR S
;
ÉÉS T
services
ÑÑ 
.
ÑÑ 
AddSingleton
ÑÑ !
<
ÑÑ! "$
IDeploymentStepFactory
ÑÑ" 8
>
ÑÑ8 9
(
ÑÑ9 :
new
ÑÑ: =#
DeploymentStepFactory
ÑÑ> S
<
ÑÑS T'
LuceneIndexDeploymentStep
ÑÑT m
>
ÑÑm n
(
ÑÑn o
)
ÑÑo p
)
ÑÑp q
;
ÑÑq r
services
ÖÖ 
.
ÖÖ 
	AddScoped
ÖÖ 
<
ÖÖ 
IDisplayDriver
ÖÖ -
<
ÖÖ- .
DeploymentStep
ÖÖ. <
>
ÖÖ< =
,
ÖÖ= >-
LuceneIndexDeploymentStepDriver
ÖÖ? ^
>
ÖÖ^ _
(
ÖÖ_ `
)
ÖÖ` a
;
ÖÖa b
services
áá 
.
áá 
AddTransient
áá !
<
áá! "
IDeploymentSource
áá" 3
,
áá3 4,
LuceneSettingsDeploymentSource
áá5 S
>
ááS T
(
ááT U
)
ááU V
;
ááV W
services
àà 
.
àà 
AddSingleton
àà !
<
àà! "$
IDeploymentStepFactory
àà" 8
>
àà8 9
(
àà9 :
new
àà: =#
DeploymentStepFactory
àà> S
<
ààS T*
LuceneSettingsDeploymentStep
ààT p
>
ààp q
(
ààq r
)
ààr s
)
ààs t
;
ààt u
services
ââ 
.
ââ 
	AddScoped
ââ 
<
ââ 
IDisplayDriver
ââ -
<
ââ- .
DeploymentStep
ââ. <
>
ââ< =
,
ââ= >0
"LuceneSettingsDeploymentStepDriver
ââ? a
>
ââa b
(
ââb c
)
ââc d
;
ââd e
}
ää 	
}
ãã 
[
çç 
Feature
çç 
(
çç 
$str
çç (
)
çç( )
]
çç) *
public
éé 

class
éé !
LuceneWorkerStartup
éé $
:
éé% &
StartupBase
éé' 2
{
èè 
public
êê 
override
êê 
void
êê 
ConfigureServices
êê .
(
êê. / 
IServiceCollection
êê/ A
services
êêB J
)
êêJ K
{
ëë 	
services
íí 
.
íí 
AddSingleton
íí !
<
íí! "
IBackgroundTask
íí" 1
,
íí1 2$
IndexingBackgroundTask
íí3 I
>
ííI J
(
ííJ K
)
ííK L
;
ííL M
}
ìì 	
}
îî 
[
ññ 
Feature
ññ 
(
ññ 
$str
ññ /
)
ññ/ 0
]
ññ0 1
public
óó 

class
óó (
LuceneContentPickerStartup
óó +
:
óó, -
StartupBase
óó. 9
{
òò 
public
ôô 
override
ôô 
void
ôô 
ConfigureServices
ôô .
(
ôô. / 
IServiceCollection
ôô/ A
services
ôôB J
)
ôôJ K
{
öö 	
services
õõ 
.
õõ 
	AddScoped
õõ 
<
õõ *
IContentPickerResultProvider
õõ ;
,
õõ; </
!LuceneContentPickerResultProvider
õõ= ^
>
õõ^ _
(
õõ_ `
)
õõ` a
;
õõa b
services
úú 
.
úú 
	AddScoped
úú 
<
úú 6
(IContentPartFieldDefinitionDisplayDriver
úú G
,
úúG H:
,ContentPickerFieldLuceneEditorSettingsDriver
úúI u
>
úúu v
(
úúv w
)
úúw x
;
úúx y
services
ùù 
.
ùù  
AddShapeAttributes
ùù '
<
ùù' (.
 LuceneContentPickerShapeProvider
ùù( H
>
ùùH I
(
ùùI J
)
ùùJ K
;
ùùK L
}
ûû 	
}
üü 
}†† €
îD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\AdminIndexViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class 
AdminIndexViewModel $
{ 
public		 
IEnumerable		 
<		 
IndexViewModel		 )
>		) *
Indexes		+ 2
{		3 4
get		5 8
;		8 9
set		: =
;		= >
}		? @
public 
ContentOptions 
Options %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
new6 9
ContentOptions: H
(H I
)I J
;J K
[ 	
	BindNever	 
] 
public 
dynamic 
Pager 
{ 
get "
;" #
set$ '
;' (
}) *
} 
public 

class 
ContentOptions 
{ 
public 
ContentsBulkAction !

BulkAction" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
string 
Search 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
	BindNever	 
] 
public 
List 
< 
SelectListItem "
>" #
ContentsBulkAction$ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
} 
public 

enum 
ContentsBulkAction "
{   
None!! 
,!! 
Reset"" 
,"" 
Rebuild## 
,## 
Remove$$ 
}%% 
}&& ˇ
îD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\AdminQueryViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public		 

class		 
AdminQueryViewModel		 $
{

 
public 
string 
DecodedQuery "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
	IndexName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 

Parameters  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
	BindNever	 
] 
public 
int 
Count 
{ 
get 
; 
set  #
;# $
}% &
[ 	
	BindNever	 
] 
public 
string 
[ 
] 
Indices 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
	BindNever	 
] 
public 
TimeSpan 
Elapsed 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
TimeSpan0 8
.8 9
Zero9 =
;= >
[ 	
	BindNever	 
] 
public 
IEnumerable 
< 
Document #
># $
	Documents% .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >

Enumerable? I
.I J
EmptyJ O
<O P
DocumentP X
>X Y
(Y Z
)Z [
;[ \
} 
} ‡
èD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\IndexViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class 
IndexViewModel 
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
AnalyzerName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
DateTime		 
LastUpdateUtc		 %
{		& '
get		( +
;		+ ,
set		- 0
;		0 1
}		2 3
}

 
} ƒ
£D:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\LuceneIndexDeploymentStepViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class .
"LuceneIndexDeploymentStepViewModel 3
{ 
public 
bool 

IncludeAll 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
[ 
] 

IndexNames "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
[ 
] 
AllIndexNames %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
}		 ñ
ùD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\LuceneIndexSettingsViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class (
LuceneIndexSettingsViewModel -
{ 
public		 
string		 
	IndexName		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public 
string 
AnalyzerName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
bool 
IndexLatest 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Culture 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
[ 
] 
IndexedContentTypes +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
bool 
IsCreate 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
	BindNever	 
] 
public 
IEnumerable 
< 
SelectListItem )
>) *
	Analyzers+ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
[ 	
	BindNever	 
] 
public 
IEnumerable 
< 
SelectListItem )
>) *
Cultures+ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
} 
} †
ïD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\LuceneQueryViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class  
LuceneQueryViewModel %
{ 
public 
string 
[ 
] 
Indices 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Index 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Query 
{ 
get !
;! "
set# &
;& '
}( )
public 
bool 
ReturnContentItems &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
}		 
}

 ˆ	
òD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\LuceneSettingsViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public 

class #
LuceneSettingsViewModel (
{ 
public 
string 
Analyzer 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
SearchIndex !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
IEnumerable		 
<		 
string		 !
>		! "
SearchIndexes		# 0
{		1 2
get		3 6
;		6 7
set		8 ;
;		; <
}		= >
public

 
string

 
SearchFields

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
bool &
AllowLuceneQueriesInSearch .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} Õ

îD:\Projects\DefensePoint\whitesource-testcases-csharp\CWE79\OrchardCore\src\OrchardCore.Modules\OrchardCore.Lucene\ViewModels\QueryIndexViewModel.cs
	namespace 	
OrchardCore
 
. 
Lucene 
. 

ViewModels '
{ 
public		 

class		 
QueryIndexViewModel		 $
{

 
public 
string 
Query 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	IndexName 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
	BindNever	 
] 
public 
TimeSpan 
Duration  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
	BindNever	 
] 
public 
IEnumerable 
< 
Document #
># $
	Documents% .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >

Enumerable? I
.I J
EmptyJ O
<O P
DocumentP X
>X Y
(Y Z
)Z [
;[ \
} 
} 